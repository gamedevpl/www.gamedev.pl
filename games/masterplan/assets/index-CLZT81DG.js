var Y_=Object.defineProperty;var Q_=(n,e,t)=>e in n?Y_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var me=(n,e,t)=>Q_(n,typeof e!="symbol"?e+"":e,t);function Z_(n,e){for(var t=0;t<e.length;t++){const s=e[t];if(typeof s!="string"&&!Array.isArray(s)){for(const r in s)if(r!=="default"&&!(r in n)){const o=Object.getOwnPropertyDescriptor(s,r);o&&Object.defineProperty(n,r,o.get?o:{enumerable:!0,get:()=>s[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(r){if(r.ep)return;r.ep=!0;const o=t(r);fetch(r.href,o)}})();function dy(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function J_(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(s){var r=Object.getOwnPropertyDescriptor(n,s);Object.defineProperty(t,s,r.get?r:{enumerable:!0,get:function(){return n[s]}})}),t}var A0={exports:{}},Ic={},D0={exports:{}},tt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KC;function eF(){if(KC)return tt;KC=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),i=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),f=Symbol.iterator;function p(z){return z===null||typeof z!="object"?null:(z=f&&z[f]||z["@@iterator"],typeof z=="function"?z:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},x=Object.assign,w={};function v(z,V,oe){this.props=z,this.context=V,this.refs=w,this.updater=oe||g}v.prototype.isReactComponent={},v.prototype.setState=function(z,V){if(typeof z!="object"&&typeof z!="function"&&z!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,z,V,"setState")},v.prototype.forceUpdate=function(z){this.updater.enqueueForceUpdate(this,z,"forceUpdate")};function b(){}b.prototype=v.prototype;function C(z,V,oe){this.props=z,this.context=V,this.refs=w,this.updater=oe||g}var $=C.prototype=new b;$.constructor=C,x($,v.prototype),$.isPureReactComponent=!0;var S=Array.isArray,T=Object.prototype.hasOwnProperty,E={current:null},A={key:!0,ref:!0,__self:!0,__source:!0};function F(z,V,oe){var ue,he={},de=null,we=null;if(V!=null)for(ue in V.ref!==void 0&&(we=V.ref),V.key!==void 0&&(de=""+V.key),V)T.call(V,ue)&&!A.hasOwnProperty(ue)&&(he[ue]=V[ue]);var xe=arguments.length-2;if(xe===1)he.children=oe;else if(1<xe){for(var be=Array(xe),Te=0;Te<xe;Te++)be[Te]=arguments[Te+2];he.children=be}if(z&&z.defaultProps)for(ue in xe=z.defaultProps,xe)he[ue]===void 0&&(he[ue]=xe[ue]);return{$$typeof:n,type:z,key:de,ref:we,props:he,_owner:E.current}}function D(z,V){return{$$typeof:n,type:z.type,key:V,ref:z.ref,props:z.props,_owner:z._owner}}function _(z){return typeof z=="object"&&z!==null&&z.$$typeof===n}function N(z){var V={"=":"=0",":":"=2"};return"$"+z.replace(/[=:]/g,function(oe){return V[oe]})}var L=/\/+/g;function G(z,V){return typeof z=="object"&&z!==null&&z.key!=null?N(""+z.key):V.toString(36)}function Q(z,V,oe,ue,he){var de=typeof z;(de==="undefined"||de==="boolean")&&(z=null);var we=!1;if(z===null)we=!0;else switch(de){case"string":case"number":we=!0;break;case"object":switch(z.$$typeof){case n:case e:we=!0}}if(we)return we=z,he=he(we),z=ue===""?"."+G(we,0):ue,S(he)?(oe="",z!=null&&(oe=z.replace(L,"$&/")+"/"),Q(he,V,oe,"",function(Te){return Te})):he!=null&&(_(he)&&(he=D(he,oe+(!he.key||we&&we.key===he.key?"":(""+he.key).replace(L,"$&/")+"/")+z)),V.push(he)),1;if(we=0,ue=ue===""?".":ue+":",S(z))for(var xe=0;xe<z.length;xe++){de=z[xe];var be=ue+G(de,xe);we+=Q(de,V,oe,be,he)}else if(be=p(z),typeof be=="function")for(z=be.call(z),xe=0;!(de=z.next()).done;)de=de.value,be=ue+G(de,xe++),we+=Q(de,V,oe,be,he);else if(de==="object")throw V=String(z),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(z).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.");return we}function K(z,V,oe){if(z==null)return z;var ue=[],he=0;return Q(z,ue,"","",function(de){return V.call(oe,de,he++)}),ue}function Z(z){if(z._status===-1){var V=z._result;V=V(),V.then(function(oe){(z._status===0||z._status===-1)&&(z._status=1,z._result=oe)},function(oe){(z._status===0||z._status===-1)&&(z._status=2,z._result=oe)}),z._status===-1&&(z._status=0,z._result=V)}if(z._status===1)return z._result.default;throw z._result}var te={current:null},B={transition:null},H={ReactCurrentDispatcher:te,ReactCurrentBatchConfig:B,ReactCurrentOwner:E};function X(){throw Error("act(...) is not supported in production builds of React.")}return tt.Children={map:K,forEach:function(z,V,oe){K(z,function(){V.apply(this,arguments)},oe)},count:function(z){var V=0;return K(z,function(){V++}),V},toArray:function(z){return K(z,function(V){return V})||[]},only:function(z){if(!_(z))throw Error("React.Children.only expected to receive a single React element child.");return z}},tt.Component=v,tt.Fragment=t,tt.Profiler=r,tt.PureComponent=C,tt.StrictMode=s,tt.Suspense=l,tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=H,tt.act=X,tt.cloneElement=function(z,V,oe){if(z==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+z+".");var ue=x({},z.props),he=z.key,de=z.ref,we=z._owner;if(V!=null){if(V.ref!==void 0&&(de=V.ref,we=E.current),V.key!==void 0&&(he=""+V.key),z.type&&z.type.defaultProps)var xe=z.type.defaultProps;for(be in V)T.call(V,be)&&!A.hasOwnProperty(be)&&(ue[be]=V[be]===void 0&&xe!==void 0?xe[be]:V[be])}var be=arguments.length-2;if(be===1)ue.children=oe;else if(1<be){xe=Array(be);for(var Te=0;Te<be;Te++)xe[Te]=arguments[Te+2];ue.children=xe}return{$$typeof:n,type:z.type,key:he,ref:de,props:ue,_owner:we}},tt.createContext=function(z){return z={$$typeof:i,_currentValue:z,_currentValue2:z,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},z.Provider={$$typeof:o,_context:z},z.Consumer=z},tt.createElement=F,tt.createFactory=function(z){var V=F.bind(null,z);return V.type=z,V},tt.createRef=function(){return{current:null}},tt.forwardRef=function(z){return{$$typeof:a,render:z}},tt.isValidElement=_,tt.lazy=function(z){return{$$typeof:d,_payload:{_status:-1,_result:z},_init:Z}},tt.memo=function(z,V){return{$$typeof:u,type:z,compare:V===void 0?null:V}},tt.startTransition=function(z){var V=B.transition;B.transition={};try{z()}finally{B.transition=V}},tt.unstable_act=X,tt.useCallback=function(z,V){return te.current.useCallback(z,V)},tt.useContext=function(z){return te.current.useContext(z)},tt.useDebugValue=function(){},tt.useDeferredValue=function(z){return te.current.useDeferredValue(z)},tt.useEffect=function(z,V){return te.current.useEffect(z,V)},tt.useId=function(){return te.current.useId()},tt.useImperativeHandle=function(z,V,oe){return te.current.useImperativeHandle(z,V,oe)},tt.useInsertionEffect=function(z,V){return te.current.useInsertionEffect(z,V)},tt.useLayoutEffect=function(z,V){return te.current.useLayoutEffect(z,V)},tt.useMemo=function(z,V){return te.current.useMemo(z,V)},tt.useReducer=function(z,V,oe){return te.current.useReducer(z,V,oe)},tt.useRef=function(z){return te.current.useRef(z)},tt.useState=function(z){return te.current.useState(z)},tt.useSyncExternalStore=function(z,V,oe){return te.current.useSyncExternalStore(z,V,oe)},tt.useTransition=function(){return te.current.useTransition()},tt.version="18.3.1",tt}var qC;function fy(){return qC||(qC=1,D0.exports=eF()),D0.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var YC;function tF(){if(YC)return Ic;YC=1;var n=fy(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),s=Object.prototype.hasOwnProperty,r=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function i(a,l,u){var d,f={},p=null,g=null;u!==void 0&&(p=""+u),l.key!==void 0&&(p=""+l.key),l.ref!==void 0&&(g=l.ref);for(d in l)s.call(l,d)&&!o.hasOwnProperty(d)&&(f[d]=l[d]);if(a&&a.defaultProps)for(d in l=a.defaultProps,l)f[d]===void 0&&(f[d]=l[d]);return{$$typeof:e,type:a,key:p,ref:g,props:f,_owner:r.current}}return Ic.Fragment=t,Ic.jsx=i,Ic.jsxs=i,Ic}var QC;function nF(){return QC||(QC=1,A0.exports=tF()),A0.exports}var De=nF(),Le=fy();const pr=dy(Le);var Pd={},_0={exports:{}},ds={},F0={exports:{}},O0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ZC;function sF(){return ZC||(ZC=1,function(n){function e(B,H){var X=B.length;B.push(H);e:for(;0<X;){var z=X-1>>>1,V=B[z];if(0<r(V,H))B[z]=H,B[X]=V,X=z;else break e}}function t(B){return B.length===0?null:B[0]}function s(B){if(B.length===0)return null;var H=B[0],X=B.pop();if(X!==H){B[0]=X;e:for(var z=0,V=B.length,oe=V>>>1;z<oe;){var ue=2*(z+1)-1,he=B[ue],de=ue+1,we=B[de];if(0>r(he,X))de<V&&0>r(we,he)?(B[z]=we,B[de]=X,z=de):(B[z]=he,B[ue]=X,z=ue);else if(de<V&&0>r(we,X))B[z]=we,B[de]=X,z=de;else break e}}return H}function r(B,H){var X=B.sortIndex-H.sortIndex;return X!==0?X:B.id-H.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var i=Date,a=i.now();n.unstable_now=function(){return i.now()-a}}var l=[],u=[],d=1,f=null,p=3,g=!1,x=!1,w=!1,v=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function $(B){for(var H=t(u);H!==null;){if(H.callback===null)s(u);else if(H.startTime<=B)s(u),H.sortIndex=H.expirationTime,e(l,H);else break;H=t(u)}}function S(B){if(w=!1,$(B),!x)if(t(l)!==null)x=!0,Z(T);else{var H=t(u);H!==null&&te(S,H.startTime-B)}}function T(B,H){x=!1,w&&(w=!1,b(F),F=-1),g=!0;var X=p;try{for($(H),f=t(l);f!==null&&(!(f.expirationTime>H)||B&&!N());){var z=f.callback;if(typeof z=="function"){f.callback=null,p=f.priorityLevel;var V=z(f.expirationTime<=H);H=n.unstable_now(),typeof V=="function"?f.callback=V:f===t(l)&&s(l),$(H)}else s(l);f=t(l)}if(f!==null)var oe=!0;else{var ue=t(u);ue!==null&&te(S,ue.startTime-H),oe=!1}return oe}finally{f=null,p=X,g=!1}}var E=!1,A=null,F=-1,D=5,_=-1;function N(){return!(n.unstable_now()-_<D)}function L(){if(A!==null){var B=n.unstable_now();_=B;var H=!0;try{H=A(!0,B)}finally{H?G():(E=!1,A=null)}}else E=!1}var G;if(typeof C=="function")G=function(){C(L)};else if(typeof MessageChannel<"u"){var Q=new MessageChannel,K=Q.port2;Q.port1.onmessage=L,G=function(){K.postMessage(null)}}else G=function(){v(L,0)};function Z(B){A=B,E||(E=!0,G())}function te(B,H){F=v(function(){B(n.unstable_now())},H)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(B){B.callback=null},n.unstable_continueExecution=function(){x||g||(x=!0,Z(T))},n.unstable_forceFrameRate=function(B){0>B||125<B?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<B?Math.floor(1e3/B):5},n.unstable_getCurrentPriorityLevel=function(){return p},n.unstable_getFirstCallbackNode=function(){return t(l)},n.unstable_next=function(B){switch(p){case 1:case 2:case 3:var H=3;break;default:H=p}var X=p;p=H;try{return B()}finally{p=X}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(B,H){switch(B){case 1:case 2:case 3:case 4:case 5:break;default:B=3}var X=p;p=B;try{return H()}finally{p=X}},n.unstable_scheduleCallback=function(B,H,X){var z=n.unstable_now();switch(typeof X=="object"&&X!==null?(X=X.delay,X=typeof X=="number"&&0<X?z+X:z):X=z,B){case 1:var V=-1;break;case 2:V=250;break;case 5:V=1073741823;break;case 4:V=1e4;break;default:V=5e3}return V=X+V,B={id:d++,callback:H,priorityLevel:B,startTime:X,expirationTime:V,sortIndex:-1},X>z?(B.sortIndex=X,e(u,B),t(l)===null&&B===t(u)&&(w?(b(F),F=-1):w=!0,te(S,X-z))):(B.sortIndex=V,e(l,B),x||g||(x=!0,Z(T))),B},n.unstable_shouldYield=N,n.unstable_wrapCallback=function(B){var H=p;return function(){var X=p;p=H;try{return B.apply(this,arguments)}finally{p=X}}}}(O0)),O0}var JC;function rF(){return JC||(JC=1,F0.exports=sF()),F0.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var ek;function oF(){if(ek)return ds;ek=1;var n=fy(),e=rF();function t(c){for(var h="https://reactjs.org/docs/error-decoder.html?invariant="+c,m=1;m<arguments.length;m++)h+="&args[]="+encodeURIComponent(arguments[m]);return"Minified React error #"+c+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=new Set,r={};function o(c,h){i(c,h),i(c+"Capture",h)}function i(c,h){for(r[c]=h,c=0;c<h.length;c++)s.add(h[c])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),l=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},f={};function p(c){return l.call(f,c)?!0:l.call(d,c)?!1:u.test(c)?f[c]=!0:(d[c]=!0,!1)}function g(c,h,m,y){if(m!==null&&m.type===0)return!1;switch(typeof h){case"function":case"symbol":return!0;case"boolean":return y?!1:m!==null?!m.acceptsBooleans:(c=c.toLowerCase().slice(0,5),c!=="data-"&&c!=="aria-");default:return!1}}function x(c,h,m,y){if(h===null||typeof h>"u"||g(c,h,m,y))return!0;if(y)return!1;if(m!==null)switch(m.type){case 3:return!h;case 4:return h===!1;case 5:return isNaN(h);case 6:return isNaN(h)||1>h}return!1}function w(c,h,m,y,k,I,R){this.acceptsBooleans=h===2||h===3||h===4,this.attributeName=y,this.attributeNamespace=k,this.mustUseProperty=m,this.propertyName=c,this.type=h,this.sanitizeURL=I,this.removeEmptyString=R}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(c){v[c]=new w(c,0,!1,c,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(c){var h=c[0];v[h]=new w(h,1,!1,c[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(c){v[c]=new w(c,2,!1,c.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(c){v[c]=new w(c,2,!1,c,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(c){v[c]=new w(c,3,!1,c.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(c){v[c]=new w(c,3,!0,c,null,!1,!1)}),["capture","download"].forEach(function(c){v[c]=new w(c,4,!1,c,null,!1,!1)}),["cols","rows","size","span"].forEach(function(c){v[c]=new w(c,6,!1,c,null,!1,!1)}),["rowSpan","start"].forEach(function(c){v[c]=new w(c,5,!1,c.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function C(c){return c[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(c){var h=c.replace(b,C);v[h]=new w(h,1,!1,c,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(c){var h=c.replace(b,C);v[h]=new w(h,1,!1,c,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(c){var h=c.replace(b,C);v[h]=new w(h,1,!1,c,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(c){v[c]=new w(c,1,!1,c.toLowerCase(),null,!1,!1)}),v.xlinkHref=new w("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(c){v[c]=new w(c,1,!1,c.toLowerCase(),null,!0,!0)});function $(c,h,m,y){var k=v.hasOwnProperty(h)?v[h]:null;(k!==null?k.type!==0:y||!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(x(h,m,k,y)&&(m=null),y||k===null?p(h)&&(m===null?c.removeAttribute(h):c.setAttribute(h,""+m)):k.mustUseProperty?c[k.propertyName]=m===null?k.type===3?!1:"":m:(h=k.attributeName,y=k.attributeNamespace,m===null?c.removeAttribute(h):(k=k.type,m=k===3||k===4&&m===!0?"":""+m,y?c.setAttributeNS(y,h,m):c.setAttribute(h,m))))}var S=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=Symbol.for("react.element"),E=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),F=Symbol.for("react.strict_mode"),D=Symbol.for("react.profiler"),_=Symbol.for("react.provider"),N=Symbol.for("react.context"),L=Symbol.for("react.forward_ref"),G=Symbol.for("react.suspense"),Q=Symbol.for("react.suspense_list"),K=Symbol.for("react.memo"),Z=Symbol.for("react.lazy"),te=Symbol.for("react.offscreen"),B=Symbol.iterator;function H(c){return c===null||typeof c!="object"?null:(c=B&&c[B]||c["@@iterator"],typeof c=="function"?c:null)}var X=Object.assign,z;function V(c){if(z===void 0)try{throw Error()}catch(m){var h=m.stack.trim().match(/\n( *(at )?)/);z=h&&h[1]||""}return`
`+z+c}var oe=!1;function ue(c,h){if(!c||oe)return"";oe=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(h)if(h=function(){throw Error()},Object.defineProperty(h.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(h,[])}catch(ae){var y=ae}Reflect.construct(c,[],h)}else{try{h.call()}catch(ae){y=ae}c.call(h.prototype)}else{try{throw Error()}catch(ae){y=ae}c()}}catch(ae){if(ae&&y&&typeof ae.stack=="string"){for(var k=ae.stack.split(`
`),I=y.stack.split(`
`),R=k.length-1,M=I.length-1;1<=R&&0<=M&&k[R]!==I[M];)M--;for(;1<=R&&0<=M;R--,M--)if(k[R]!==I[M]){if(R!==1||M!==1)do if(R--,M--,0>M||k[R]!==I[M]){var W=`
`+k[R].replace(" at new "," at ");return c.displayName&&W.includes("<anonymous>")&&(W=W.replace("<anonymous>",c.displayName)),W}while(1<=R&&0<=M);break}}}finally{oe=!1,Error.prepareStackTrace=m}return(c=c?c.displayName||c.name:"")?V(c):""}function he(c){switch(c.tag){case 5:return V(c.type);case 16:return V("Lazy");case 13:return V("Suspense");case 19:return V("SuspenseList");case 0:case 2:case 15:return c=ue(c.type,!1),c;case 11:return c=ue(c.type.render,!1),c;case 1:return c=ue(c.type,!0),c;default:return""}}function de(c){if(c==null)return null;if(typeof c=="function")return c.displayName||c.name||null;if(typeof c=="string")return c;switch(c){case A:return"Fragment";case E:return"Portal";case D:return"Profiler";case F:return"StrictMode";case G:return"Suspense";case Q:return"SuspenseList"}if(typeof c=="object")switch(c.$$typeof){case N:return(c.displayName||"Context")+".Consumer";case _:return(c._context.displayName||"Context")+".Provider";case L:var h=c.render;return c=c.displayName,c||(c=h.displayName||h.name||"",c=c!==""?"ForwardRef("+c+")":"ForwardRef"),c;case K:return h=c.displayName||null,h!==null?h:de(c.type)||"Memo";case Z:h=c._payload,c=c._init;try{return de(c(h))}catch{}}return null}function we(c){var h=c.type;switch(c.tag){case 24:return"Cache";case 9:return(h.displayName||"Context")+".Consumer";case 10:return(h._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return c=h.render,c=c.displayName||c.name||"",h.displayName||(c!==""?"ForwardRef("+c+")":"ForwardRef");case 7:return"Fragment";case 5:return h;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return de(h);case 8:return h===F?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof h=="function")return h.displayName||h.name||null;if(typeof h=="string")return h}return null}function xe(c){switch(typeof c){case"boolean":case"number":case"string":case"undefined":return c;case"object":return c;default:return""}}function be(c){var h=c.type;return(c=c.nodeName)&&c.toLowerCase()==="input"&&(h==="checkbox"||h==="radio")}function Te(c){var h=be(c)?"checked":"value",m=Object.getOwnPropertyDescriptor(c.constructor.prototype,h),y=""+c[h];if(!c.hasOwnProperty(h)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var k=m.get,I=m.set;return Object.defineProperty(c,h,{configurable:!0,get:function(){return k.call(this)},set:function(R){y=""+R,I.call(this,R)}}),Object.defineProperty(c,h,{enumerable:m.enumerable}),{getValue:function(){return y},setValue:function(R){y=""+R},stopTracking:function(){c._valueTracker=null,delete c[h]}}}}function Pe(c){c._valueTracker||(c._valueTracker=Te(c))}function Ve(c){if(!c)return!1;var h=c._valueTracker;if(!h)return!0;var m=h.getValue(),y="";return c&&(y=be(c)?c.checked?"true":"false":c.value),c=y,c!==m?(h.setValue(c),!0):!1}function st(c){if(c=c||(typeof document<"u"?document:void 0),typeof c>"u")return null;try{return c.activeElement||c.body}catch{return c.body}}function Xe(c,h){var m=h.checked;return X({},h,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:m??c._wrapperState.initialChecked})}function nt(c,h){var m=h.defaultValue==null?"":h.defaultValue,y=h.checked!=null?h.checked:h.defaultChecked;m=xe(h.value!=null?h.value:m),c._wrapperState={initialChecked:y,initialValue:m,controlled:h.type==="checkbox"||h.type==="radio"?h.checked!=null:h.value!=null}}function rt(c,h){h=h.checked,h!=null&&$(c,"checked",h,!1)}function ut(c,h){rt(c,h);var m=xe(h.value),y=h.type;if(m!=null)y==="number"?(m===0&&c.value===""||c.value!=m)&&(c.value=""+m):c.value!==""+m&&(c.value=""+m);else if(y==="submit"||y==="reset"){c.removeAttribute("value");return}h.hasOwnProperty("value")?vn(c,h.type,m):h.hasOwnProperty("defaultValue")&&vn(c,h.type,xe(h.defaultValue)),h.checked==null&&h.defaultChecked!=null&&(c.defaultChecked=!!h.defaultChecked)}function lt(c,h,m){if(h.hasOwnProperty("value")||h.hasOwnProperty("defaultValue")){var y=h.type;if(!(y!=="submit"&&y!=="reset"||h.value!==void 0&&h.value!==null))return;h=""+c._wrapperState.initialValue,m||h===c.value||(c.value=h),c.defaultValue=h}m=c.name,m!==""&&(c.name=""),c.defaultChecked=!!c._wrapperState.initialChecked,m!==""&&(c.name=m)}function vn(c,h,m){(h!=="number"||st(c.ownerDocument)!==c)&&(m==null?c.defaultValue=""+c._wrapperState.initialValue:c.defaultValue!==""+m&&(c.defaultValue=""+m))}var Et=Array.isArray;function bn(c,h,m,y){if(c=c.options,h){h={};for(var k=0;k<m.length;k++)h["$"+m[k]]=!0;for(m=0;m<c.length;m++)k=h.hasOwnProperty("$"+c[m].value),c[m].selected!==k&&(c[m].selected=k),k&&y&&(c[m].defaultSelected=!0)}else{for(m=""+xe(m),h=null,k=0;k<c.length;k++){if(c[k].value===m){c[k].selected=!0,y&&(c[k].defaultSelected=!0);return}h!==null||c[k].disabled||(h=c[k])}h!==null&&(h.selected=!0)}}function Vt(c,h){if(h.dangerouslySetInnerHTML!=null)throw Error(t(91));return X({},h,{value:void 0,defaultValue:void 0,children:""+c._wrapperState.initialValue})}function Sr(c,h){var m=h.value;if(m==null){if(m=h.children,h=h.defaultValue,m!=null){if(h!=null)throw Error(t(92));if(Et(m)){if(1<m.length)throw Error(t(93));m=m[0]}h=m}h==null&&(h=""),m=h}c._wrapperState={initialValue:xe(m)}}function is(c,h){var m=xe(h.value),y=xe(h.defaultValue);m!=null&&(m=""+m,m!==c.value&&(c.value=m),h.defaultValue==null&&c.defaultValue!==m&&(c.defaultValue=m)),y!=null&&(c.defaultValue=""+y)}function _s(c){var h=c.textContent;h===c._wrapperState.initialValue&&h!==""&&h!==null&&(c.value=h)}function nr(c){switch(c){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Fs(c,h){return c==null||c==="http://www.w3.org/1999/xhtml"?nr(h):c==="http://www.w3.org/2000/svg"&&h==="foreignObject"?"http://www.w3.org/1999/xhtml":c}var vs,bo=function(c){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(h,m,y,k){MSApp.execUnsafeLocalFunction(function(){return c(h,m,y,k)})}:c}(function(c,h){if(c.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in c)c.innerHTML=h;else{for(vs=vs||document.createElement("div"),vs.innerHTML="<svg>"+h.valueOf().toString()+"</svg>",h=vs.firstChild;c.firstChild;)c.removeChild(c.firstChild);for(;h.firstChild;)c.appendChild(h.firstChild)}});function Yr(c,h){if(h){var m=c.firstChild;if(m&&m===c.lastChild&&m.nodeType===3){m.nodeValue=h;return}}c.textContent=h}var Qr={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Vm=["Webkit","ms","Moz","O"];Object.keys(Qr).forEach(function(c){Vm.forEach(function(h){h=h+c.charAt(0).toUpperCase()+c.substring(1),Qr[h]=Qr[c]})});function mi(c,h,m){return h==null||typeof h=="boolean"||h===""?"":m||typeof h!="number"||h===0||Qr.hasOwnProperty(c)&&Qr[c]?(""+h).trim():h+"px"}function Rh(c,h){c=c.style;for(var m in h)if(h.hasOwnProperty(m)){var y=m.indexOf("--")===0,k=mi(m,h[m],y);m==="float"&&(m="cssFloat"),y?c.setProperty(m,k):c[m]=k}}var Wm=X({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Um(c,h){if(h){if(Wm[c]&&(h.children!=null||h.dangerouslySetInnerHTML!=null))throw Error(t(137,c));if(h.dangerouslySetInnerHTML!=null){if(h.children!=null)throw Error(t(60));if(typeof h.dangerouslySetInnerHTML!="object"||!("__html"in h.dangerouslySetInnerHTML))throw Error(t(61))}if(h.style!=null&&typeof h.style!="object")throw Error(t(62))}}function Gm(c,h){if(c.indexOf("-")===-1)return typeof h.is=="string";switch(c){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Hm=null;function jm(c){return c=c.target||c.srcElement||window,c.correspondingUseElement&&(c=c.correspondingUseElement),c.nodeType===3?c.parentNode:c}var Xm=null,ba=null,Ca=null;function hv(c){if(c=uc(c)){if(typeof Xm!="function")throw Error(t(280));var h=c.stateNode;h&&(h=Jh(h),Xm(c.stateNode,c.type,h))}}function dv(c){ba?Ca?Ca.push(c):Ca=[c]:ba=c}function fv(){if(ba){var c=ba,h=Ca;if(Ca=ba=null,hv(c),h)for(c=0;c<h.length;c++)hv(h[c])}}function pv(c,h){return c(h)}function mv(){}var Km=!1;function gv(c,h,m){if(Km)return c(h,m);Km=!0;try{return pv(c,h,m)}finally{Km=!1,(ba!==null||Ca!==null)&&(mv(),fv())}}function Ul(c,h){var m=c.stateNode;if(m===null)return null;var y=Jh(m);if(y===null)return null;m=y[h];e:switch(h){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(c=c.type,y=!(c==="button"||c==="input"||c==="select"||c==="textarea")),c=!y;break e;default:c=!1}if(c)return null;if(m&&typeof m!="function")throw Error(t(231,h,typeof m));return m}var qm=!1;if(a)try{var Gl={};Object.defineProperty(Gl,"passive",{get:function(){qm=!0}}),window.addEventListener("test",Gl,Gl),window.removeEventListener("test",Gl,Gl)}catch{qm=!1}function nD(c,h,m,y,k,I,R,M,W){var ae=Array.prototype.slice.call(arguments,3);try{h.apply(m,ae)}catch(ge){this.onError(ge)}}var Hl=!1,Ah=null,Dh=!1,Ym=null,sD={onError:function(c){Hl=!0,Ah=c}};function rD(c,h,m,y,k,I,R,M,W){Hl=!1,Ah=null,nD.apply(sD,arguments)}function oD(c,h,m,y,k,I,R,M,W){if(rD.apply(this,arguments),Hl){if(Hl){var ae=Ah;Hl=!1,Ah=null}else throw Error(t(198));Dh||(Dh=!0,Ym=ae)}}function gi(c){var h=c,m=c;if(c.alternate)for(;h.return;)h=h.return;else{c=h;do h=c,(h.flags&4098)!==0&&(m=h.return),c=h.return;while(c)}return h.tag===3?m:null}function xv(c){if(c.tag===13){var h=c.memoizedState;if(h===null&&(c=c.alternate,c!==null&&(h=c.memoizedState)),h!==null)return h.dehydrated}return null}function yv(c){if(gi(c)!==c)throw Error(t(188))}function iD(c){var h=c.alternate;if(!h){if(h=gi(c),h===null)throw Error(t(188));return h!==c?null:c}for(var m=c,y=h;;){var k=m.return;if(k===null)break;var I=k.alternate;if(I===null){if(y=k.return,y!==null){m=y;continue}break}if(k.child===I.child){for(I=k.child;I;){if(I===m)return yv(k),c;if(I===y)return yv(k),h;I=I.sibling}throw Error(t(188))}if(m.return!==y.return)m=k,y=I;else{for(var R=!1,M=k.child;M;){if(M===m){R=!0,m=k,y=I;break}if(M===y){R=!0,y=k,m=I;break}M=M.sibling}if(!R){for(M=I.child;M;){if(M===m){R=!0,m=I,y=k;break}if(M===y){R=!0,y=I,m=k;break}M=M.sibling}if(!R)throw Error(t(189))}}if(m.alternate!==y)throw Error(t(190))}if(m.tag!==3)throw Error(t(188));return m.stateNode.current===m?c:h}function wv(c){return c=iD(c),c!==null?vv(c):null}function vv(c){if(c.tag===5||c.tag===6)return c;for(c=c.child;c!==null;){var h=vv(c);if(h!==null)return h;c=c.sibling}return null}var bv=e.unstable_scheduleCallback,Cv=e.unstable_cancelCallback,aD=e.unstable_shouldYield,lD=e.unstable_requestPaint,Qt=e.unstable_now,cD=e.unstable_getCurrentPriorityLevel,Qm=e.unstable_ImmediatePriority,kv=e.unstable_UserBlockingPriority,_h=e.unstable_NormalPriority,uD=e.unstable_LowPriority,Sv=e.unstable_IdlePriority,Fh=null,Ir=null;function hD(c){if(Ir&&typeof Ir.onCommitFiberRoot=="function")try{Ir.onCommitFiberRoot(Fh,c,void 0,(c.current.flags&128)===128)}catch{}}var sr=Math.clz32?Math.clz32:pD,dD=Math.log,fD=Math.LN2;function pD(c){return c>>>=0,c===0?32:31-(dD(c)/fD|0)|0}var Oh=64,zh=4194304;function jl(c){switch(c&-c){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return c&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return c&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return c}}function Mh(c,h){var m=c.pendingLanes;if(m===0)return 0;var y=0,k=c.suspendedLanes,I=c.pingedLanes,R=m&268435455;if(R!==0){var M=R&~k;M!==0?y=jl(M):(I&=R,I!==0&&(y=jl(I)))}else R=m&~k,R!==0?y=jl(R):I!==0&&(y=jl(I));if(y===0)return 0;if(h!==0&&h!==y&&(h&k)===0&&(k=y&-y,I=h&-h,k>=I||k===16&&(I&4194240)!==0))return h;if((y&4)!==0&&(y|=m&16),h=c.entangledLanes,h!==0)for(c=c.entanglements,h&=y;0<h;)m=31-sr(h),k=1<<m,y|=c[m],h&=~k;return y}function mD(c,h){switch(c){case 1:case 2:case 4:return h+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function gD(c,h){for(var m=c.suspendedLanes,y=c.pingedLanes,k=c.expirationTimes,I=c.pendingLanes;0<I;){var R=31-sr(I),M=1<<R,W=k[R];W===-1?((M&m)===0||(M&y)!==0)&&(k[R]=mD(M,h)):W<=h&&(c.expiredLanes|=M),I&=~M}}function Zm(c){return c=c.pendingLanes&-1073741825,c!==0?c:c&1073741824?1073741824:0}function Iv(){var c=Oh;return Oh<<=1,(Oh&4194240)===0&&(Oh=64),c}function Jm(c){for(var h=[],m=0;31>m;m++)h.push(c);return h}function Xl(c,h,m){c.pendingLanes|=h,h!==536870912&&(c.suspendedLanes=0,c.pingedLanes=0),c=c.eventTimes,h=31-sr(h),c[h]=m}function xD(c,h){var m=c.pendingLanes&~h;c.pendingLanes=h,c.suspendedLanes=0,c.pingedLanes=0,c.expiredLanes&=h,c.mutableReadLanes&=h,c.entangledLanes&=h,h=c.entanglements;var y=c.eventTimes;for(c=c.expirationTimes;0<m;){var k=31-sr(m),I=1<<k;h[k]=0,y[k]=-1,c[k]=-1,m&=~I}}function eg(c,h){var m=c.entangledLanes|=h;for(c=c.entanglements;m;){var y=31-sr(m),k=1<<y;k&h|c[y]&h&&(c[y]|=h),m&=~k}}var wt=0;function $v(c){return c&=-c,1<c?4<c?(c&268435455)!==0?16:536870912:4:1}var Tv,tg,Nv,Ev,Rv,ng=!1,Ph=[],Co=null,ko=null,So=null,Kl=new Map,ql=new Map,Io=[],yD="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Av(c,h){switch(c){case"focusin":case"focusout":Co=null;break;case"dragenter":case"dragleave":ko=null;break;case"mouseover":case"mouseout":So=null;break;case"pointerover":case"pointerout":Kl.delete(h.pointerId);break;case"gotpointercapture":case"lostpointercapture":ql.delete(h.pointerId)}}function Yl(c,h,m,y,k,I){return c===null||c.nativeEvent!==I?(c={blockedOn:h,domEventName:m,eventSystemFlags:y,nativeEvent:I,targetContainers:[k]},h!==null&&(h=uc(h),h!==null&&tg(h)),c):(c.eventSystemFlags|=y,h=c.targetContainers,k!==null&&h.indexOf(k)===-1&&h.push(k),c)}function wD(c,h,m,y,k){switch(h){case"focusin":return Co=Yl(Co,c,h,m,y,k),!0;case"dragenter":return ko=Yl(ko,c,h,m,y,k),!0;case"mouseover":return So=Yl(So,c,h,m,y,k),!0;case"pointerover":var I=k.pointerId;return Kl.set(I,Yl(Kl.get(I)||null,c,h,m,y,k)),!0;case"gotpointercapture":return I=k.pointerId,ql.set(I,Yl(ql.get(I)||null,c,h,m,y,k)),!0}return!1}function Dv(c){var h=xi(c.target);if(h!==null){var m=gi(h);if(m!==null){if(h=m.tag,h===13){if(h=xv(m),h!==null){c.blockedOn=h,Rv(c.priority,function(){Nv(m)});return}}else if(h===3&&m.stateNode.current.memoizedState.isDehydrated){c.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}c.blockedOn=null}function Lh(c){if(c.blockedOn!==null)return!1;for(var h=c.targetContainers;0<h.length;){var m=rg(c.domEventName,c.eventSystemFlags,h[0],c.nativeEvent);if(m===null){m=c.nativeEvent;var y=new m.constructor(m.type,m);Hm=y,m.target.dispatchEvent(y),Hm=null}else return h=uc(m),h!==null&&tg(h),c.blockedOn=m,!1;h.shift()}return!0}function _v(c,h,m){Lh(c)&&m.delete(h)}function vD(){ng=!1,Co!==null&&Lh(Co)&&(Co=null),ko!==null&&Lh(ko)&&(ko=null),So!==null&&Lh(So)&&(So=null),Kl.forEach(_v),ql.forEach(_v)}function Ql(c,h){c.blockedOn===h&&(c.blockedOn=null,ng||(ng=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,vD)))}function Zl(c){function h(k){return Ql(k,c)}if(0<Ph.length){Ql(Ph[0],c);for(var m=1;m<Ph.length;m++){var y=Ph[m];y.blockedOn===c&&(y.blockedOn=null)}}for(Co!==null&&Ql(Co,c),ko!==null&&Ql(ko,c),So!==null&&Ql(So,c),Kl.forEach(h),ql.forEach(h),m=0;m<Io.length;m++)y=Io[m],y.blockedOn===c&&(y.blockedOn=null);for(;0<Io.length&&(m=Io[0],m.blockedOn===null);)Dv(m),m.blockedOn===null&&Io.shift()}var ka=S.ReactCurrentBatchConfig,Bh=!0;function bD(c,h,m,y){var k=wt,I=ka.transition;ka.transition=null;try{wt=1,sg(c,h,m,y)}finally{wt=k,ka.transition=I}}function CD(c,h,m,y){var k=wt,I=ka.transition;ka.transition=null;try{wt=4,sg(c,h,m,y)}finally{wt=k,ka.transition=I}}function sg(c,h,m,y){if(Bh){var k=rg(c,h,m,y);if(k===null)bg(c,h,y,Vh,m),Av(c,y);else if(wD(k,c,h,m,y))y.stopPropagation();else if(Av(c,y),h&4&&-1<yD.indexOf(c)){for(;k!==null;){var I=uc(k);if(I!==null&&Tv(I),I=rg(c,h,m,y),I===null&&bg(c,h,y,Vh,m),I===k)break;k=I}k!==null&&y.stopPropagation()}else bg(c,h,y,null,m)}}var Vh=null;function rg(c,h,m,y){if(Vh=null,c=jm(y),c=xi(c),c!==null)if(h=gi(c),h===null)c=null;else if(m=h.tag,m===13){if(c=xv(h),c!==null)return c;c=null}else if(m===3){if(h.stateNode.current.memoizedState.isDehydrated)return h.tag===3?h.stateNode.containerInfo:null;c=null}else h!==c&&(c=null);return Vh=c,null}function Fv(c){switch(c){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(cD()){case Qm:return 1;case kv:return 4;case _h:case uD:return 16;case Sv:return 536870912;default:return 16}default:return 16}}var $o=null,og=null,Wh=null;function Ov(){if(Wh)return Wh;var c,h=og,m=h.length,y,k="value"in $o?$o.value:$o.textContent,I=k.length;for(c=0;c<m&&h[c]===k[c];c++);var R=m-c;for(y=1;y<=R&&h[m-y]===k[I-y];y++);return Wh=k.slice(c,1<y?1-y:void 0)}function Uh(c){var h=c.keyCode;return"charCode"in c?(c=c.charCode,c===0&&h===13&&(c=13)):c=h,c===10&&(c=13),32<=c||c===13?c:0}function Gh(){return!0}function zv(){return!1}function bs(c){function h(m,y,k,I,R){this._reactName=m,this._targetInst=k,this.type=y,this.nativeEvent=I,this.target=R,this.currentTarget=null;for(var M in c)c.hasOwnProperty(M)&&(m=c[M],this[M]=m?m(I):I[M]);return this.isDefaultPrevented=(I.defaultPrevented!=null?I.defaultPrevented:I.returnValue===!1)?Gh:zv,this.isPropagationStopped=zv,this}return X(h.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=Gh)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=Gh)},persist:function(){},isPersistent:Gh}),h}var Sa={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(c){return c.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ig=bs(Sa),Jl=X({},Sa,{view:0,detail:0}),kD=bs(Jl),ag,lg,ec,Hh=X({},Jl,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ug,button:0,buttons:0,relatedTarget:function(c){return c.relatedTarget===void 0?c.fromElement===c.srcElement?c.toElement:c.fromElement:c.relatedTarget},movementX:function(c){return"movementX"in c?c.movementX:(c!==ec&&(ec&&c.type==="mousemove"?(ag=c.screenX-ec.screenX,lg=c.screenY-ec.screenY):lg=ag=0,ec=c),ag)},movementY:function(c){return"movementY"in c?c.movementY:lg}}),Mv=bs(Hh),SD=X({},Hh,{dataTransfer:0}),ID=bs(SD),$D=X({},Jl,{relatedTarget:0}),cg=bs($D),TD=X({},Sa,{animationName:0,elapsedTime:0,pseudoElement:0}),ND=bs(TD),ED=X({},Sa,{clipboardData:function(c){return"clipboardData"in c?c.clipboardData:window.clipboardData}}),RD=bs(ED),AD=X({},Sa,{data:0}),Pv=bs(AD),DD={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},_D={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},FD={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function OD(c){var h=this.nativeEvent;return h.getModifierState?h.getModifierState(c):(c=FD[c])?!!h[c]:!1}function ug(){return OD}var zD=X({},Jl,{key:function(c){if(c.key){var h=DD[c.key]||c.key;if(h!=="Unidentified")return h}return c.type==="keypress"?(c=Uh(c),c===13?"Enter":String.fromCharCode(c)):c.type==="keydown"||c.type==="keyup"?_D[c.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ug,charCode:function(c){return c.type==="keypress"?Uh(c):0},keyCode:function(c){return c.type==="keydown"||c.type==="keyup"?c.keyCode:0},which:function(c){return c.type==="keypress"?Uh(c):c.type==="keydown"||c.type==="keyup"?c.keyCode:0}}),MD=bs(zD),PD=X({},Hh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Lv=bs(PD),LD=X({},Jl,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ug}),BD=bs(LD),VD=X({},Sa,{propertyName:0,elapsedTime:0,pseudoElement:0}),WD=bs(VD),UD=X({},Hh,{deltaX:function(c){return"deltaX"in c?c.deltaX:"wheelDeltaX"in c?-c.wheelDeltaX:0},deltaY:function(c){return"deltaY"in c?c.deltaY:"wheelDeltaY"in c?-c.wheelDeltaY:"wheelDelta"in c?-c.wheelDelta:0},deltaZ:0,deltaMode:0}),GD=bs(UD),HD=[9,13,27,32],hg=a&&"CompositionEvent"in window,tc=null;a&&"documentMode"in document&&(tc=document.documentMode);var jD=a&&"TextEvent"in window&&!tc,Bv=a&&(!hg||tc&&8<tc&&11>=tc),Vv=" ",Wv=!1;function Uv(c,h){switch(c){case"keyup":return HD.indexOf(h.keyCode)!==-1;case"keydown":return h.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Gv(c){return c=c.detail,typeof c=="object"&&"data"in c?c.data:null}var Ia=!1;function XD(c,h){switch(c){case"compositionend":return Gv(h);case"keypress":return h.which!==32?null:(Wv=!0,Vv);case"textInput":return c=h.data,c===Vv&&Wv?null:c;default:return null}}function KD(c,h){if(Ia)return c==="compositionend"||!hg&&Uv(c,h)?(c=Ov(),Wh=og=$o=null,Ia=!1,c):null;switch(c){case"paste":return null;case"keypress":if(!(h.ctrlKey||h.altKey||h.metaKey)||h.ctrlKey&&h.altKey){if(h.char&&1<h.char.length)return h.char;if(h.which)return String.fromCharCode(h.which)}return null;case"compositionend":return Bv&&h.locale!=="ko"?null:h.data;default:return null}}var qD={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Hv(c){var h=c&&c.nodeName&&c.nodeName.toLowerCase();return h==="input"?!!qD[c.type]:h==="textarea"}function jv(c,h,m,y){dv(y),h=Yh(h,"onChange"),0<h.length&&(m=new ig("onChange","change",null,m,y),c.push({event:m,listeners:h}))}var nc=null,sc=null;function YD(c){ub(c,0)}function jh(c){var h=Ra(c);if(Ve(h))return c}function QD(c,h){if(c==="change")return h}var Xv=!1;if(a){var dg;if(a){var fg="oninput"in document;if(!fg){var Kv=document.createElement("div");Kv.setAttribute("oninput","return;"),fg=typeof Kv.oninput=="function"}dg=fg}else dg=!1;Xv=dg&&(!document.documentMode||9<document.documentMode)}function qv(){nc&&(nc.detachEvent("onpropertychange",Yv),sc=nc=null)}function Yv(c){if(c.propertyName==="value"&&jh(sc)){var h=[];jv(h,sc,c,jm(c)),gv(YD,h)}}function ZD(c,h,m){c==="focusin"?(qv(),nc=h,sc=m,nc.attachEvent("onpropertychange",Yv)):c==="focusout"&&qv()}function JD(c){if(c==="selectionchange"||c==="keyup"||c==="keydown")return jh(sc)}function e_(c,h){if(c==="click")return jh(h)}function t_(c,h){if(c==="input"||c==="change")return jh(h)}function n_(c,h){return c===h&&(c!==0||1/c===1/h)||c!==c&&h!==h}var rr=typeof Object.is=="function"?Object.is:n_;function rc(c,h){if(rr(c,h))return!0;if(typeof c!="object"||c===null||typeof h!="object"||h===null)return!1;var m=Object.keys(c),y=Object.keys(h);if(m.length!==y.length)return!1;for(y=0;y<m.length;y++){var k=m[y];if(!l.call(h,k)||!rr(c[k],h[k]))return!1}return!0}function Qv(c){for(;c&&c.firstChild;)c=c.firstChild;return c}function Zv(c,h){var m=Qv(c);c=0;for(var y;m;){if(m.nodeType===3){if(y=c+m.textContent.length,c<=h&&y>=h)return{node:m,offset:h-c};c=y}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=Qv(m)}}function Jv(c,h){return c&&h?c===h?!0:c&&c.nodeType===3?!1:h&&h.nodeType===3?Jv(c,h.parentNode):"contains"in c?c.contains(h):c.compareDocumentPosition?!!(c.compareDocumentPosition(h)&16):!1:!1}function eb(){for(var c=window,h=st();h instanceof c.HTMLIFrameElement;){try{var m=typeof h.contentWindow.location.href=="string"}catch{m=!1}if(m)c=h.contentWindow;else break;h=st(c.document)}return h}function pg(c){var h=c&&c.nodeName&&c.nodeName.toLowerCase();return h&&(h==="input"&&(c.type==="text"||c.type==="search"||c.type==="tel"||c.type==="url"||c.type==="password")||h==="textarea"||c.contentEditable==="true")}function s_(c){var h=eb(),m=c.focusedElem,y=c.selectionRange;if(h!==m&&m&&m.ownerDocument&&Jv(m.ownerDocument.documentElement,m)){if(y!==null&&pg(m)){if(h=y.start,c=y.end,c===void 0&&(c=h),"selectionStart"in m)m.selectionStart=h,m.selectionEnd=Math.min(c,m.value.length);else if(c=(h=m.ownerDocument||document)&&h.defaultView||window,c.getSelection){c=c.getSelection();var k=m.textContent.length,I=Math.min(y.start,k);y=y.end===void 0?I:Math.min(y.end,k),!c.extend&&I>y&&(k=y,y=I,I=k),k=Zv(m,I);var R=Zv(m,y);k&&R&&(c.rangeCount!==1||c.anchorNode!==k.node||c.anchorOffset!==k.offset||c.focusNode!==R.node||c.focusOffset!==R.offset)&&(h=h.createRange(),h.setStart(k.node,k.offset),c.removeAllRanges(),I>y?(c.addRange(h),c.extend(R.node,R.offset)):(h.setEnd(R.node,R.offset),c.addRange(h)))}}for(h=[],c=m;c=c.parentNode;)c.nodeType===1&&h.push({element:c,left:c.scrollLeft,top:c.scrollTop});for(typeof m.focus=="function"&&m.focus(),m=0;m<h.length;m++)c=h[m],c.element.scrollLeft=c.left,c.element.scrollTop=c.top}}var r_=a&&"documentMode"in document&&11>=document.documentMode,$a=null,mg=null,oc=null,gg=!1;function tb(c,h,m){var y=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;gg||$a==null||$a!==st(y)||(y=$a,"selectionStart"in y&&pg(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),oc&&rc(oc,y)||(oc=y,y=Yh(mg,"onSelect"),0<y.length&&(h=new ig("onSelect","select",null,h,m),c.push({event:h,listeners:y}),h.target=$a)))}function Xh(c,h){var m={};return m[c.toLowerCase()]=h.toLowerCase(),m["Webkit"+c]="webkit"+h,m["Moz"+c]="moz"+h,m}var Ta={animationend:Xh("Animation","AnimationEnd"),animationiteration:Xh("Animation","AnimationIteration"),animationstart:Xh("Animation","AnimationStart"),transitionend:Xh("Transition","TransitionEnd")},xg={},nb={};a&&(nb=document.createElement("div").style,"AnimationEvent"in window||(delete Ta.animationend.animation,delete Ta.animationiteration.animation,delete Ta.animationstart.animation),"TransitionEvent"in window||delete Ta.transitionend.transition);function Kh(c){if(xg[c])return xg[c];if(!Ta[c])return c;var h=Ta[c],m;for(m in h)if(h.hasOwnProperty(m)&&m in nb)return xg[c]=h[m];return c}var sb=Kh("animationend"),rb=Kh("animationiteration"),ob=Kh("animationstart"),ib=Kh("transitionend"),ab=new Map,lb="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function To(c,h){ab.set(c,h),o(h,[c])}for(var yg=0;yg<lb.length;yg++){var wg=lb[yg],o_=wg.toLowerCase(),i_=wg[0].toUpperCase()+wg.slice(1);To(o_,"on"+i_)}To(sb,"onAnimationEnd"),To(rb,"onAnimationIteration"),To(ob,"onAnimationStart"),To("dblclick","onDoubleClick"),To("focusin","onFocus"),To("focusout","onBlur"),To(ib,"onTransitionEnd"),i("onMouseEnter",["mouseout","mouseover"]),i("onMouseLeave",["mouseout","mouseover"]),i("onPointerEnter",["pointerout","pointerover"]),i("onPointerLeave",["pointerout","pointerover"]),o("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),o("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),o("onBeforeInput",["compositionend","keypress","textInput","paste"]),o("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),o("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ic="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),a_=new Set("cancel close invalid load scroll toggle".split(" ").concat(ic));function cb(c,h,m){var y=c.type||"unknown-event";c.currentTarget=m,oD(y,h,void 0,c),c.currentTarget=null}function ub(c,h){h=(h&4)!==0;for(var m=0;m<c.length;m++){var y=c[m],k=y.event;y=y.listeners;e:{var I=void 0;if(h)for(var R=y.length-1;0<=R;R--){var M=y[R],W=M.instance,ae=M.currentTarget;if(M=M.listener,W!==I&&k.isPropagationStopped())break e;cb(k,M,ae),I=W}else for(R=0;R<y.length;R++){if(M=y[R],W=M.instance,ae=M.currentTarget,M=M.listener,W!==I&&k.isPropagationStopped())break e;cb(k,M,ae),I=W}}}if(Dh)throw c=Ym,Dh=!1,Ym=null,c}function _t(c,h){var m=h[Tg];m===void 0&&(m=h[Tg]=new Set);var y=c+"__bubble";m.has(y)||(hb(h,c,2,!1),m.add(y))}function vg(c,h,m){var y=0;h&&(y|=4),hb(m,c,y,h)}var qh="_reactListening"+Math.random().toString(36).slice(2);function ac(c){if(!c[qh]){c[qh]=!0,s.forEach(function(m){m!=="selectionchange"&&(a_.has(m)||vg(m,!1,c),vg(m,!0,c))});var h=c.nodeType===9?c:c.ownerDocument;h===null||h[qh]||(h[qh]=!0,vg("selectionchange",!1,h))}}function hb(c,h,m,y){switch(Fv(h)){case 1:var k=bD;break;case 4:k=CD;break;default:k=sg}m=k.bind(null,h,m,c),k=void 0,!qm||h!=="touchstart"&&h!=="touchmove"&&h!=="wheel"||(k=!0),y?k!==void 0?c.addEventListener(h,m,{capture:!0,passive:k}):c.addEventListener(h,m,!0):k!==void 0?c.addEventListener(h,m,{passive:k}):c.addEventListener(h,m,!1)}function bg(c,h,m,y,k){var I=y;if((h&1)===0&&(h&2)===0&&y!==null)e:for(;;){if(y===null)return;var R=y.tag;if(R===3||R===4){var M=y.stateNode.containerInfo;if(M===k||M.nodeType===8&&M.parentNode===k)break;if(R===4)for(R=y.return;R!==null;){var W=R.tag;if((W===3||W===4)&&(W=R.stateNode.containerInfo,W===k||W.nodeType===8&&W.parentNode===k))return;R=R.return}for(;M!==null;){if(R=xi(M),R===null)return;if(W=R.tag,W===5||W===6){y=I=R;continue e}M=M.parentNode}}y=y.return}gv(function(){var ae=I,ge=jm(m),ve=[];e:{var pe=ab.get(c);if(pe!==void 0){var $e=ig,Re=c;switch(c){case"keypress":if(Uh(m)===0)break e;case"keydown":case"keyup":$e=MD;break;case"focusin":Re="focus",$e=cg;break;case"focusout":Re="blur",$e=cg;break;case"beforeblur":case"afterblur":$e=cg;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$e=Mv;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$e=ID;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$e=BD;break;case sb:case rb:case ob:$e=ND;break;case ib:$e=WD;break;case"scroll":$e=kD;break;case"wheel":$e=GD;break;case"copy":case"cut":case"paste":$e=RD;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$e=Lv}var _e=(h&4)!==0,Zt=!_e&&c==="scroll",ne=_e?pe!==null?pe+"Capture":null:pe;_e=[];for(var q=ae,re;q!==null;){re=q;var Ce=re.stateNode;if(re.tag===5&&Ce!==null&&(re=Ce,ne!==null&&(Ce=Ul(q,ne),Ce!=null&&_e.push(lc(q,Ce,re)))),Zt)break;q=q.return}0<_e.length&&(pe=new $e(pe,Re,null,m,ge),ve.push({event:pe,listeners:_e}))}}if((h&7)===0){e:{if(pe=c==="mouseover"||c==="pointerover",$e=c==="mouseout"||c==="pointerout",pe&&m!==Hm&&(Re=m.relatedTarget||m.fromElement)&&(xi(Re)||Re[Zr]))break e;if(($e||pe)&&(pe=ge.window===ge?ge:(pe=ge.ownerDocument)?pe.defaultView||pe.parentWindow:window,$e?(Re=m.relatedTarget||m.toElement,$e=ae,Re=Re?xi(Re):null,Re!==null&&(Zt=gi(Re),Re!==Zt||Re.tag!==5&&Re.tag!==6)&&(Re=null)):($e=null,Re=ae),$e!==Re)){if(_e=Mv,Ce="onMouseLeave",ne="onMouseEnter",q="mouse",(c==="pointerout"||c==="pointerover")&&(_e=Lv,Ce="onPointerLeave",ne="onPointerEnter",q="pointer"),Zt=$e==null?pe:Ra($e),re=Re==null?pe:Ra(Re),pe=new _e(Ce,q+"leave",$e,m,ge),pe.target=Zt,pe.relatedTarget=re,Ce=null,xi(ge)===ae&&(_e=new _e(ne,q+"enter",Re,m,ge),_e.target=re,_e.relatedTarget=Zt,Ce=_e),Zt=Ce,$e&&Re)t:{for(_e=$e,ne=Re,q=0,re=_e;re;re=Na(re))q++;for(re=0,Ce=ne;Ce;Ce=Na(Ce))re++;for(;0<q-re;)_e=Na(_e),q--;for(;0<re-q;)ne=Na(ne),re--;for(;q--;){if(_e===ne||ne!==null&&_e===ne.alternate)break t;_e=Na(_e),ne=Na(ne)}_e=null}else _e=null;$e!==null&&db(ve,pe,$e,_e,!1),Re!==null&&Zt!==null&&db(ve,Zt,Re,_e,!0)}}e:{if(pe=ae?Ra(ae):window,$e=pe.nodeName&&pe.nodeName.toLowerCase(),$e==="select"||$e==="input"&&pe.type==="file")var Fe=QD;else if(Hv(pe))if(Xv)Fe=t_;else{Fe=JD;var We=ZD}else($e=pe.nodeName)&&$e.toLowerCase()==="input"&&(pe.type==="checkbox"||pe.type==="radio")&&(Fe=e_);if(Fe&&(Fe=Fe(c,ae))){jv(ve,Fe,m,ge);break e}We&&We(c,pe,ae),c==="focusout"&&(We=pe._wrapperState)&&We.controlled&&pe.type==="number"&&vn(pe,"number",pe.value)}switch(We=ae?Ra(ae):window,c){case"focusin":(Hv(We)||We.contentEditable==="true")&&($a=We,mg=ae,oc=null);break;case"focusout":oc=mg=$a=null;break;case"mousedown":gg=!0;break;case"contextmenu":case"mouseup":case"dragend":gg=!1,tb(ve,m,ge);break;case"selectionchange":if(r_)break;case"keydown":case"keyup":tb(ve,m,ge)}var Ue;if(hg)e:{switch(c){case"compositionstart":var je="onCompositionStart";break e;case"compositionend":je="onCompositionEnd";break e;case"compositionupdate":je="onCompositionUpdate";break e}je=void 0}else Ia?Uv(c,m)&&(je="onCompositionEnd"):c==="keydown"&&m.keyCode===229&&(je="onCompositionStart");je&&(Bv&&m.locale!=="ko"&&(Ia||je!=="onCompositionStart"?je==="onCompositionEnd"&&Ia&&(Ue=Ov()):($o=ge,og="value"in $o?$o.value:$o.textContent,Ia=!0)),We=Yh(ae,je),0<We.length&&(je=new Pv(je,c,null,m,ge),ve.push({event:je,listeners:We}),Ue?je.data=Ue:(Ue=Gv(m),Ue!==null&&(je.data=Ue)))),(Ue=jD?XD(c,m):KD(c,m))&&(ae=Yh(ae,"onBeforeInput"),0<ae.length&&(ge=new Pv("onBeforeInput","beforeinput",null,m,ge),ve.push({event:ge,listeners:ae}),ge.data=Ue))}ub(ve,h)})}function lc(c,h,m){return{instance:c,listener:h,currentTarget:m}}function Yh(c,h){for(var m=h+"Capture",y=[];c!==null;){var k=c,I=k.stateNode;k.tag===5&&I!==null&&(k=I,I=Ul(c,m),I!=null&&y.unshift(lc(c,I,k)),I=Ul(c,h),I!=null&&y.push(lc(c,I,k))),c=c.return}return y}function Na(c){if(c===null)return null;do c=c.return;while(c&&c.tag!==5);return c||null}function db(c,h,m,y,k){for(var I=h._reactName,R=[];m!==null&&m!==y;){var M=m,W=M.alternate,ae=M.stateNode;if(W!==null&&W===y)break;M.tag===5&&ae!==null&&(M=ae,k?(W=Ul(m,I),W!=null&&R.unshift(lc(m,W,M))):k||(W=Ul(m,I),W!=null&&R.push(lc(m,W,M)))),m=m.return}R.length!==0&&c.push({event:h,listeners:R})}var l_=/\r\n?/g,c_=/\u0000|\uFFFD/g;function fb(c){return(typeof c=="string"?c:""+c).replace(l_,`
`).replace(c_,"")}function Qh(c,h,m){if(h=fb(h),fb(c)!==h&&m)throw Error(t(425))}function Zh(){}var Cg=null,kg=null;function Sg(c,h){return c==="textarea"||c==="noscript"||typeof h.children=="string"||typeof h.children=="number"||typeof h.dangerouslySetInnerHTML=="object"&&h.dangerouslySetInnerHTML!==null&&h.dangerouslySetInnerHTML.__html!=null}var Ig=typeof setTimeout=="function"?setTimeout:void 0,u_=typeof clearTimeout=="function"?clearTimeout:void 0,pb=typeof Promise=="function"?Promise:void 0,h_=typeof queueMicrotask=="function"?queueMicrotask:typeof pb<"u"?function(c){return pb.resolve(null).then(c).catch(d_)}:Ig;function d_(c){setTimeout(function(){throw c})}function $g(c,h){var m=h,y=0;do{var k=m.nextSibling;if(c.removeChild(m),k&&k.nodeType===8)if(m=k.data,m==="/$"){if(y===0){c.removeChild(k),Zl(h);return}y--}else m!=="$"&&m!=="$?"&&m!=="$!"||y++;m=k}while(m);Zl(h)}function No(c){for(;c!=null;c=c.nextSibling){var h=c.nodeType;if(h===1||h===3)break;if(h===8){if(h=c.data,h==="$"||h==="$!"||h==="$?")break;if(h==="/$")return null}}return c}function mb(c){c=c.previousSibling;for(var h=0;c;){if(c.nodeType===8){var m=c.data;if(m==="$"||m==="$!"||m==="$?"){if(h===0)return c;h--}else m==="/$"&&h++}c=c.previousSibling}return null}var Ea=Math.random().toString(36).slice(2),$r="__reactFiber$"+Ea,cc="__reactProps$"+Ea,Zr="__reactContainer$"+Ea,Tg="__reactEvents$"+Ea,f_="__reactListeners$"+Ea,p_="__reactHandles$"+Ea;function xi(c){var h=c[$r];if(h)return h;for(var m=c.parentNode;m;){if(h=m[Zr]||m[$r]){if(m=h.alternate,h.child!==null||m!==null&&m.child!==null)for(c=mb(c);c!==null;){if(m=c[$r])return m;c=mb(c)}return h}c=m,m=c.parentNode}return null}function uc(c){return c=c[$r]||c[Zr],!c||c.tag!==5&&c.tag!==6&&c.tag!==13&&c.tag!==3?null:c}function Ra(c){if(c.tag===5||c.tag===6)return c.stateNode;throw Error(t(33))}function Jh(c){return c[cc]||null}var Ng=[],Aa=-1;function Eo(c){return{current:c}}function Ft(c){0>Aa||(c.current=Ng[Aa],Ng[Aa]=null,Aa--)}function Rt(c,h){Aa++,Ng[Aa]=c.current,c.current=h}var Ro={},Ln=Eo(Ro),as=Eo(!1),yi=Ro;function Da(c,h){var m=c.type.contextTypes;if(!m)return Ro;var y=c.stateNode;if(y&&y.__reactInternalMemoizedUnmaskedChildContext===h)return y.__reactInternalMemoizedMaskedChildContext;var k={},I;for(I in m)k[I]=h[I];return y&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=h,c.__reactInternalMemoizedMaskedChildContext=k),k}function ls(c){return c=c.childContextTypes,c!=null}function ed(){Ft(as),Ft(Ln)}function gb(c,h,m){if(Ln.current!==Ro)throw Error(t(168));Rt(Ln,h),Rt(as,m)}function xb(c,h,m){var y=c.stateNode;if(h=h.childContextTypes,typeof y.getChildContext!="function")return m;y=y.getChildContext();for(var k in y)if(!(k in h))throw Error(t(108,we(c)||"Unknown",k));return X({},m,y)}function td(c){return c=(c=c.stateNode)&&c.__reactInternalMemoizedMergedChildContext||Ro,yi=Ln.current,Rt(Ln,c),Rt(as,as.current),!0}function yb(c,h,m){var y=c.stateNode;if(!y)throw Error(t(169));m?(c=xb(c,h,yi),y.__reactInternalMemoizedMergedChildContext=c,Ft(as),Ft(Ln),Rt(Ln,c)):Ft(as),Rt(as,m)}var Jr=null,nd=!1,Eg=!1;function wb(c){Jr===null?Jr=[c]:Jr.push(c)}function m_(c){nd=!0,wb(c)}function Ao(){if(!Eg&&Jr!==null){Eg=!0;var c=0,h=wt;try{var m=Jr;for(wt=1;c<m.length;c++){var y=m[c];do y=y(!0);while(y!==null)}Jr=null,nd=!1}catch(k){throw Jr!==null&&(Jr=Jr.slice(c+1)),bv(Qm,Ao),k}finally{wt=h,Eg=!1}}return null}var _a=[],Fa=0,sd=null,rd=0,Os=[],zs=0,wi=null,eo=1,to="";function vi(c,h){_a[Fa++]=rd,_a[Fa++]=sd,sd=c,rd=h}function vb(c,h,m){Os[zs++]=eo,Os[zs++]=to,Os[zs++]=wi,wi=c;var y=eo;c=to;var k=32-sr(y)-1;y&=~(1<<k),m+=1;var I=32-sr(h)+k;if(30<I){var R=k-k%5;I=(y&(1<<R)-1).toString(32),y>>=R,k-=R,eo=1<<32-sr(h)+k|m<<k|y,to=I+c}else eo=1<<I|m<<k|y,to=c}function Rg(c){c.return!==null&&(vi(c,1),vb(c,1,0))}function Ag(c){for(;c===sd;)sd=_a[--Fa],_a[Fa]=null,rd=_a[--Fa],_a[Fa]=null;for(;c===wi;)wi=Os[--zs],Os[zs]=null,to=Os[--zs],Os[zs]=null,eo=Os[--zs],Os[zs]=null}var Cs=null,ks=null,Pt=!1,or=null;function bb(c,h){var m=Bs(5,null,null,0);m.elementType="DELETED",m.stateNode=h,m.return=c,h=c.deletions,h===null?(c.deletions=[m],c.flags|=16):h.push(m)}function Cb(c,h){switch(c.tag){case 5:var m=c.type;return h=h.nodeType!==1||m.toLowerCase()!==h.nodeName.toLowerCase()?null:h,h!==null?(c.stateNode=h,Cs=c,ks=No(h.firstChild),!0):!1;case 6:return h=c.pendingProps===""||h.nodeType!==3?null:h,h!==null?(c.stateNode=h,Cs=c,ks=null,!0):!1;case 13:return h=h.nodeType!==8?null:h,h!==null?(m=wi!==null?{id:eo,overflow:to}:null,c.memoizedState={dehydrated:h,treeContext:m,retryLane:1073741824},m=Bs(18,null,null,0),m.stateNode=h,m.return=c,c.child=m,Cs=c,ks=null,!0):!1;default:return!1}}function Dg(c){return(c.mode&1)!==0&&(c.flags&128)===0}function _g(c){if(Pt){var h=ks;if(h){var m=h;if(!Cb(c,h)){if(Dg(c))throw Error(t(418));h=No(m.nextSibling);var y=Cs;h&&Cb(c,h)?bb(y,m):(c.flags=c.flags&-4097|2,Pt=!1,Cs=c)}}else{if(Dg(c))throw Error(t(418));c.flags=c.flags&-4097|2,Pt=!1,Cs=c}}}function kb(c){for(c=c.return;c!==null&&c.tag!==5&&c.tag!==3&&c.tag!==13;)c=c.return;Cs=c}function od(c){if(c!==Cs)return!1;if(!Pt)return kb(c),Pt=!0,!1;var h;if((h=c.tag!==3)&&!(h=c.tag!==5)&&(h=c.type,h=h!=="head"&&h!=="body"&&!Sg(c.type,c.memoizedProps)),h&&(h=ks)){if(Dg(c))throw Sb(),Error(t(418));for(;h;)bb(c,h),h=No(h.nextSibling)}if(kb(c),c.tag===13){if(c=c.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(t(317));e:{for(c=c.nextSibling,h=0;c;){if(c.nodeType===8){var m=c.data;if(m==="/$"){if(h===0){ks=No(c.nextSibling);break e}h--}else m!=="$"&&m!=="$!"&&m!=="$?"||h++}c=c.nextSibling}ks=null}}else ks=Cs?No(c.stateNode.nextSibling):null;return!0}function Sb(){for(var c=ks;c;)c=No(c.nextSibling)}function Oa(){ks=Cs=null,Pt=!1}function Fg(c){or===null?or=[c]:or.push(c)}var g_=S.ReactCurrentBatchConfig;function hc(c,h,m){if(c=m.ref,c!==null&&typeof c!="function"&&typeof c!="object"){if(m._owner){if(m=m._owner,m){if(m.tag!==1)throw Error(t(309));var y=m.stateNode}if(!y)throw Error(t(147,c));var k=y,I=""+c;return h!==null&&h.ref!==null&&typeof h.ref=="function"&&h.ref._stringRef===I?h.ref:(h=function(R){var M=k.refs;R===null?delete M[I]:M[I]=R},h._stringRef=I,h)}if(typeof c!="string")throw Error(t(284));if(!m._owner)throw Error(t(290,c))}return c}function id(c,h){throw c=Object.prototype.toString.call(h),Error(t(31,c==="[object Object]"?"object with keys {"+Object.keys(h).join(", ")+"}":c))}function Ib(c){var h=c._init;return h(c._payload)}function $b(c){function h(ne,q){if(c){var re=ne.deletions;re===null?(ne.deletions=[q],ne.flags|=16):re.push(q)}}function m(ne,q){if(!c)return null;for(;q!==null;)h(ne,q),q=q.sibling;return null}function y(ne,q){for(ne=new Map;q!==null;)q.key!==null?ne.set(q.key,q):ne.set(q.index,q),q=q.sibling;return ne}function k(ne,q){return ne=Lo(ne,q),ne.index=0,ne.sibling=null,ne}function I(ne,q,re){return ne.index=re,c?(re=ne.alternate,re!==null?(re=re.index,re<q?(ne.flags|=2,q):re):(ne.flags|=2,q)):(ne.flags|=1048576,q)}function R(ne){return c&&ne.alternate===null&&(ne.flags|=2),ne}function M(ne,q,re,Ce){return q===null||q.tag!==6?(q=I0(re,ne.mode,Ce),q.return=ne,q):(q=k(q,re),q.return=ne,q)}function W(ne,q,re,Ce){var Fe=re.type;return Fe===A?ge(ne,q,re.props.children,Ce,re.key):q!==null&&(q.elementType===Fe||typeof Fe=="object"&&Fe!==null&&Fe.$$typeof===Z&&Ib(Fe)===q.type)?(Ce=k(q,re.props),Ce.ref=hc(ne,q,re),Ce.return=ne,Ce):(Ce=Rd(re.type,re.key,re.props,null,ne.mode,Ce),Ce.ref=hc(ne,q,re),Ce.return=ne,Ce)}function ae(ne,q,re,Ce){return q===null||q.tag!==4||q.stateNode.containerInfo!==re.containerInfo||q.stateNode.implementation!==re.implementation?(q=$0(re,ne.mode,Ce),q.return=ne,q):(q=k(q,re.children||[]),q.return=ne,q)}function ge(ne,q,re,Ce,Fe){return q===null||q.tag!==7?(q=Ni(re,ne.mode,Ce,Fe),q.return=ne,q):(q=k(q,re),q.return=ne,q)}function ve(ne,q,re){if(typeof q=="string"&&q!==""||typeof q=="number")return q=I0(""+q,ne.mode,re),q.return=ne,q;if(typeof q=="object"&&q!==null){switch(q.$$typeof){case T:return re=Rd(q.type,q.key,q.props,null,ne.mode,re),re.ref=hc(ne,null,q),re.return=ne,re;case E:return q=$0(q,ne.mode,re),q.return=ne,q;case Z:var Ce=q._init;return ve(ne,Ce(q._payload),re)}if(Et(q)||H(q))return q=Ni(q,ne.mode,re,null),q.return=ne,q;id(ne,q)}return null}function pe(ne,q,re,Ce){var Fe=q!==null?q.key:null;if(typeof re=="string"&&re!==""||typeof re=="number")return Fe!==null?null:M(ne,q,""+re,Ce);if(typeof re=="object"&&re!==null){switch(re.$$typeof){case T:return re.key===Fe?W(ne,q,re,Ce):null;case E:return re.key===Fe?ae(ne,q,re,Ce):null;case Z:return Fe=re._init,pe(ne,q,Fe(re._payload),Ce)}if(Et(re)||H(re))return Fe!==null?null:ge(ne,q,re,Ce,null);id(ne,re)}return null}function $e(ne,q,re,Ce,Fe){if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number")return ne=ne.get(re)||null,M(q,ne,""+Ce,Fe);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case T:return ne=ne.get(Ce.key===null?re:Ce.key)||null,W(q,ne,Ce,Fe);case E:return ne=ne.get(Ce.key===null?re:Ce.key)||null,ae(q,ne,Ce,Fe);case Z:var We=Ce._init;return $e(ne,q,re,We(Ce._payload),Fe)}if(Et(Ce)||H(Ce))return ne=ne.get(re)||null,ge(q,ne,Ce,Fe,null);id(q,Ce)}return null}function Re(ne,q,re,Ce){for(var Fe=null,We=null,Ue=q,je=q=0,Sn=null;Ue!==null&&je<re.length;je++){Ue.index>je?(Sn=Ue,Ue=null):Sn=Ue.sibling;var dt=pe(ne,Ue,re[je],Ce);if(dt===null){Ue===null&&(Ue=Sn);break}c&&Ue&&dt.alternate===null&&h(ne,Ue),q=I(dt,q,je),We===null?Fe=dt:We.sibling=dt,We=dt,Ue=Sn}if(je===re.length)return m(ne,Ue),Pt&&vi(ne,je),Fe;if(Ue===null){for(;je<re.length;je++)Ue=ve(ne,re[je],Ce),Ue!==null&&(q=I(Ue,q,je),We===null?Fe=Ue:We.sibling=Ue,We=Ue);return Pt&&vi(ne,je),Fe}for(Ue=y(ne,Ue);je<re.length;je++)Sn=$e(Ue,ne,je,re[je],Ce),Sn!==null&&(c&&Sn.alternate!==null&&Ue.delete(Sn.key===null?je:Sn.key),q=I(Sn,q,je),We===null?Fe=Sn:We.sibling=Sn,We=Sn);return c&&Ue.forEach(function(Bo){return h(ne,Bo)}),Pt&&vi(ne,je),Fe}function _e(ne,q,re,Ce){var Fe=H(re);if(typeof Fe!="function")throw Error(t(150));if(re=Fe.call(re),re==null)throw Error(t(151));for(var We=Fe=null,Ue=q,je=q=0,Sn=null,dt=re.next();Ue!==null&&!dt.done;je++,dt=re.next()){Ue.index>je?(Sn=Ue,Ue=null):Sn=Ue.sibling;var Bo=pe(ne,Ue,dt.value,Ce);if(Bo===null){Ue===null&&(Ue=Sn);break}c&&Ue&&Bo.alternate===null&&h(ne,Ue),q=I(Bo,q,je),We===null?Fe=Bo:We.sibling=Bo,We=Bo,Ue=Sn}if(dt.done)return m(ne,Ue),Pt&&vi(ne,je),Fe;if(Ue===null){for(;!dt.done;je++,dt=re.next())dt=ve(ne,dt.value,Ce),dt!==null&&(q=I(dt,q,je),We===null?Fe=dt:We.sibling=dt,We=dt);return Pt&&vi(ne,je),Fe}for(Ue=y(ne,Ue);!dt.done;je++,dt=re.next())dt=$e(Ue,ne,je,dt.value,Ce),dt!==null&&(c&&dt.alternate!==null&&Ue.delete(dt.key===null?je:dt.key),q=I(dt,q,je),We===null?Fe=dt:We.sibling=dt,We=dt);return c&&Ue.forEach(function(q_){return h(ne,q_)}),Pt&&vi(ne,je),Fe}function Zt(ne,q,re,Ce){if(typeof re=="object"&&re!==null&&re.type===A&&re.key===null&&(re=re.props.children),typeof re=="object"&&re!==null){switch(re.$$typeof){case T:e:{for(var Fe=re.key,We=q;We!==null;){if(We.key===Fe){if(Fe=re.type,Fe===A){if(We.tag===7){m(ne,We.sibling),q=k(We,re.props.children),q.return=ne,ne=q;break e}}else if(We.elementType===Fe||typeof Fe=="object"&&Fe!==null&&Fe.$$typeof===Z&&Ib(Fe)===We.type){m(ne,We.sibling),q=k(We,re.props),q.ref=hc(ne,We,re),q.return=ne,ne=q;break e}m(ne,We);break}else h(ne,We);We=We.sibling}re.type===A?(q=Ni(re.props.children,ne.mode,Ce,re.key),q.return=ne,ne=q):(Ce=Rd(re.type,re.key,re.props,null,ne.mode,Ce),Ce.ref=hc(ne,q,re),Ce.return=ne,ne=Ce)}return R(ne);case E:e:{for(We=re.key;q!==null;){if(q.key===We)if(q.tag===4&&q.stateNode.containerInfo===re.containerInfo&&q.stateNode.implementation===re.implementation){m(ne,q.sibling),q=k(q,re.children||[]),q.return=ne,ne=q;break e}else{m(ne,q);break}else h(ne,q);q=q.sibling}q=$0(re,ne.mode,Ce),q.return=ne,ne=q}return R(ne);case Z:return We=re._init,Zt(ne,q,We(re._payload),Ce)}if(Et(re))return Re(ne,q,re,Ce);if(H(re))return _e(ne,q,re,Ce);id(ne,re)}return typeof re=="string"&&re!==""||typeof re=="number"?(re=""+re,q!==null&&q.tag===6?(m(ne,q.sibling),q=k(q,re),q.return=ne,ne=q):(m(ne,q),q=I0(re,ne.mode,Ce),q.return=ne,ne=q),R(ne)):m(ne,q)}return Zt}var za=$b(!0),Tb=$b(!1),ad=Eo(null),ld=null,Ma=null,Og=null;function zg(){Og=Ma=ld=null}function Mg(c){var h=ad.current;Ft(ad),c._currentValue=h}function Pg(c,h,m){for(;c!==null;){var y=c.alternate;if((c.childLanes&h)!==h?(c.childLanes|=h,y!==null&&(y.childLanes|=h)):y!==null&&(y.childLanes&h)!==h&&(y.childLanes|=h),c===m)break;c=c.return}}function Pa(c,h){ld=c,Og=Ma=null,c=c.dependencies,c!==null&&c.firstContext!==null&&((c.lanes&h)!==0&&(cs=!0),c.firstContext=null)}function Ms(c){var h=c._currentValue;if(Og!==c)if(c={context:c,memoizedValue:h,next:null},Ma===null){if(ld===null)throw Error(t(308));Ma=c,ld.dependencies={lanes:0,firstContext:c}}else Ma=Ma.next=c;return h}var bi=null;function Lg(c){bi===null?bi=[c]:bi.push(c)}function Nb(c,h,m,y){var k=h.interleaved;return k===null?(m.next=m,Lg(h)):(m.next=k.next,k.next=m),h.interleaved=m,no(c,y)}function no(c,h){c.lanes|=h;var m=c.alternate;for(m!==null&&(m.lanes|=h),m=c,c=c.return;c!==null;)c.childLanes|=h,m=c.alternate,m!==null&&(m.childLanes|=h),m=c,c=c.return;return m.tag===3?m.stateNode:null}var Do=!1;function Bg(c){c.updateQueue={baseState:c.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Eb(c,h){c=c.updateQueue,h.updateQueue===c&&(h.updateQueue={baseState:c.baseState,firstBaseUpdate:c.firstBaseUpdate,lastBaseUpdate:c.lastBaseUpdate,shared:c.shared,effects:c.effects})}function so(c,h){return{eventTime:c,lane:h,tag:0,payload:null,callback:null,next:null}}function _o(c,h,m){var y=c.updateQueue;if(y===null)return null;if(y=y.shared,(ht&2)!==0){var k=y.pending;return k===null?h.next=h:(h.next=k.next,k.next=h),y.pending=h,no(c,m)}return k=y.interleaved,k===null?(h.next=h,Lg(y)):(h.next=k.next,k.next=h),y.interleaved=h,no(c,m)}function cd(c,h,m){if(h=h.updateQueue,h!==null&&(h=h.shared,(m&4194240)!==0)){var y=h.lanes;y&=c.pendingLanes,m|=y,h.lanes=m,eg(c,m)}}function Rb(c,h){var m=c.updateQueue,y=c.alternate;if(y!==null&&(y=y.updateQueue,m===y)){var k=null,I=null;if(m=m.firstBaseUpdate,m!==null){do{var R={eventTime:m.eventTime,lane:m.lane,tag:m.tag,payload:m.payload,callback:m.callback,next:null};I===null?k=I=R:I=I.next=R,m=m.next}while(m!==null);I===null?k=I=h:I=I.next=h}else k=I=h;m={baseState:y.baseState,firstBaseUpdate:k,lastBaseUpdate:I,shared:y.shared,effects:y.effects},c.updateQueue=m;return}c=m.lastBaseUpdate,c===null?m.firstBaseUpdate=h:c.next=h,m.lastBaseUpdate=h}function ud(c,h,m,y){var k=c.updateQueue;Do=!1;var I=k.firstBaseUpdate,R=k.lastBaseUpdate,M=k.shared.pending;if(M!==null){k.shared.pending=null;var W=M,ae=W.next;W.next=null,R===null?I=ae:R.next=ae,R=W;var ge=c.alternate;ge!==null&&(ge=ge.updateQueue,M=ge.lastBaseUpdate,M!==R&&(M===null?ge.firstBaseUpdate=ae:M.next=ae,ge.lastBaseUpdate=W))}if(I!==null){var ve=k.baseState;R=0,ge=ae=W=null,M=I;do{var pe=M.lane,$e=M.eventTime;if((y&pe)===pe){ge!==null&&(ge=ge.next={eventTime:$e,lane:0,tag:M.tag,payload:M.payload,callback:M.callback,next:null});e:{var Re=c,_e=M;switch(pe=h,$e=m,_e.tag){case 1:if(Re=_e.payload,typeof Re=="function"){ve=Re.call($e,ve,pe);break e}ve=Re;break e;case 3:Re.flags=Re.flags&-65537|128;case 0:if(Re=_e.payload,pe=typeof Re=="function"?Re.call($e,ve,pe):Re,pe==null)break e;ve=X({},ve,pe);break e;case 2:Do=!0}}M.callback!==null&&M.lane!==0&&(c.flags|=64,pe=k.effects,pe===null?k.effects=[M]:pe.push(M))}else $e={eventTime:$e,lane:pe,tag:M.tag,payload:M.payload,callback:M.callback,next:null},ge===null?(ae=ge=$e,W=ve):ge=ge.next=$e,R|=pe;if(M=M.next,M===null){if(M=k.shared.pending,M===null)break;pe=M,M=pe.next,pe.next=null,k.lastBaseUpdate=pe,k.shared.pending=null}}while(!0);if(ge===null&&(W=ve),k.baseState=W,k.firstBaseUpdate=ae,k.lastBaseUpdate=ge,h=k.shared.interleaved,h!==null){k=h;do R|=k.lane,k=k.next;while(k!==h)}else I===null&&(k.shared.lanes=0);Si|=R,c.lanes=R,c.memoizedState=ve}}function Ab(c,h,m){if(c=h.effects,h.effects=null,c!==null)for(h=0;h<c.length;h++){var y=c[h],k=y.callback;if(k!==null){if(y.callback=null,y=m,typeof k!="function")throw Error(t(191,k));k.call(y)}}}var dc={},Tr=Eo(dc),fc=Eo(dc),pc=Eo(dc);function Ci(c){if(c===dc)throw Error(t(174));return c}function Vg(c,h){switch(Rt(pc,h),Rt(fc,c),Rt(Tr,dc),c=h.nodeType,c){case 9:case 11:h=(h=h.documentElement)?h.namespaceURI:Fs(null,"");break;default:c=c===8?h.parentNode:h,h=c.namespaceURI||null,c=c.tagName,h=Fs(h,c)}Ft(Tr),Rt(Tr,h)}function La(){Ft(Tr),Ft(fc),Ft(pc)}function Db(c){Ci(pc.current);var h=Ci(Tr.current),m=Fs(h,c.type);h!==m&&(Rt(fc,c),Rt(Tr,m))}function Wg(c){fc.current===c&&(Ft(Tr),Ft(fc))}var Wt=Eo(0);function hd(c){for(var h=c;h!==null;){if(h.tag===13){var m=h.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||m.data==="$?"||m.data==="$!"))return h}else if(h.tag===19&&h.memoizedProps.revealOrder!==void 0){if((h.flags&128)!==0)return h}else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===c)break;for(;h.sibling===null;){if(h.return===null||h.return===c)return null;h=h.return}h.sibling.return=h.return,h=h.sibling}return null}var Ug=[];function Gg(){for(var c=0;c<Ug.length;c++)Ug[c]._workInProgressVersionPrimary=null;Ug.length=0}var dd=S.ReactCurrentDispatcher,Hg=S.ReactCurrentBatchConfig,ki=0,Ut=null,dn=null,Cn=null,fd=!1,mc=!1,gc=0,x_=0;function Bn(){throw Error(t(321))}function jg(c,h){if(h===null)return!1;for(var m=0;m<h.length&&m<c.length;m++)if(!rr(c[m],h[m]))return!1;return!0}function Xg(c,h,m,y,k,I){if(ki=I,Ut=h,h.memoizedState=null,h.updateQueue=null,h.lanes=0,dd.current=c===null||c.memoizedState===null?b_:C_,c=m(y,k),mc){I=0;do{if(mc=!1,gc=0,25<=I)throw Error(t(301));I+=1,Cn=dn=null,h.updateQueue=null,dd.current=k_,c=m(y,k)}while(mc)}if(dd.current=gd,h=dn!==null&&dn.next!==null,ki=0,Cn=dn=Ut=null,fd=!1,h)throw Error(t(300));return c}function Kg(){var c=gc!==0;return gc=0,c}function Nr(){var c={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Cn===null?Ut.memoizedState=Cn=c:Cn=Cn.next=c,Cn}function Ps(){if(dn===null){var c=Ut.alternate;c=c!==null?c.memoizedState:null}else c=dn.next;var h=Cn===null?Ut.memoizedState:Cn.next;if(h!==null)Cn=h,dn=c;else{if(c===null)throw Error(t(310));dn=c,c={memoizedState:dn.memoizedState,baseState:dn.baseState,baseQueue:dn.baseQueue,queue:dn.queue,next:null},Cn===null?Ut.memoizedState=Cn=c:Cn=Cn.next=c}return Cn}function xc(c,h){return typeof h=="function"?h(c):h}function qg(c){var h=Ps(),m=h.queue;if(m===null)throw Error(t(311));m.lastRenderedReducer=c;var y=dn,k=y.baseQueue,I=m.pending;if(I!==null){if(k!==null){var R=k.next;k.next=I.next,I.next=R}y.baseQueue=k=I,m.pending=null}if(k!==null){I=k.next,y=y.baseState;var M=R=null,W=null,ae=I;do{var ge=ae.lane;if((ki&ge)===ge)W!==null&&(W=W.next={lane:0,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null}),y=ae.hasEagerState?ae.eagerState:c(y,ae.action);else{var ve={lane:ge,action:ae.action,hasEagerState:ae.hasEagerState,eagerState:ae.eagerState,next:null};W===null?(M=W=ve,R=y):W=W.next=ve,Ut.lanes|=ge,Si|=ge}ae=ae.next}while(ae!==null&&ae!==I);W===null?R=y:W.next=M,rr(y,h.memoizedState)||(cs=!0),h.memoizedState=y,h.baseState=R,h.baseQueue=W,m.lastRenderedState=y}if(c=m.interleaved,c!==null){k=c;do I=k.lane,Ut.lanes|=I,Si|=I,k=k.next;while(k!==c)}else k===null&&(m.lanes=0);return[h.memoizedState,m.dispatch]}function Yg(c){var h=Ps(),m=h.queue;if(m===null)throw Error(t(311));m.lastRenderedReducer=c;var y=m.dispatch,k=m.pending,I=h.memoizedState;if(k!==null){m.pending=null;var R=k=k.next;do I=c(I,R.action),R=R.next;while(R!==k);rr(I,h.memoizedState)||(cs=!0),h.memoizedState=I,h.baseQueue===null&&(h.baseState=I),m.lastRenderedState=I}return[I,y]}function _b(){}function Fb(c,h){var m=Ut,y=Ps(),k=h(),I=!rr(y.memoizedState,k);if(I&&(y.memoizedState=k,cs=!0),y=y.queue,Qg(Mb.bind(null,m,y,c),[c]),y.getSnapshot!==h||I||Cn!==null&&Cn.memoizedState.tag&1){if(m.flags|=2048,yc(9,zb.bind(null,m,y,k,h),void 0,null),kn===null)throw Error(t(349));(ki&30)!==0||Ob(m,h,k)}return k}function Ob(c,h,m){c.flags|=16384,c={getSnapshot:h,value:m},h=Ut.updateQueue,h===null?(h={lastEffect:null,stores:null},Ut.updateQueue=h,h.stores=[c]):(m=h.stores,m===null?h.stores=[c]:m.push(c))}function zb(c,h,m,y){h.value=m,h.getSnapshot=y,Pb(h)&&Lb(c)}function Mb(c,h,m){return m(function(){Pb(h)&&Lb(c)})}function Pb(c){var h=c.getSnapshot;c=c.value;try{var m=h();return!rr(c,m)}catch{return!0}}function Lb(c){var h=no(c,1);h!==null&&cr(h,c,1,-1)}function Bb(c){var h=Nr();return typeof c=="function"&&(c=c()),h.memoizedState=h.baseState=c,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xc,lastRenderedState:c},h.queue=c,c=c.dispatch=v_.bind(null,Ut,c),[h.memoizedState,c]}function yc(c,h,m,y){return c={tag:c,create:h,destroy:m,deps:y,next:null},h=Ut.updateQueue,h===null?(h={lastEffect:null,stores:null},Ut.updateQueue=h,h.lastEffect=c.next=c):(m=h.lastEffect,m===null?h.lastEffect=c.next=c:(y=m.next,m.next=c,c.next=y,h.lastEffect=c)),c}function Vb(){return Ps().memoizedState}function pd(c,h,m,y){var k=Nr();Ut.flags|=c,k.memoizedState=yc(1|h,m,void 0,y===void 0?null:y)}function md(c,h,m,y){var k=Ps();y=y===void 0?null:y;var I=void 0;if(dn!==null){var R=dn.memoizedState;if(I=R.destroy,y!==null&&jg(y,R.deps)){k.memoizedState=yc(h,m,I,y);return}}Ut.flags|=c,k.memoizedState=yc(1|h,m,I,y)}function Wb(c,h){return pd(8390656,8,c,h)}function Qg(c,h){return md(2048,8,c,h)}function Ub(c,h){return md(4,2,c,h)}function Gb(c,h){return md(4,4,c,h)}function Hb(c,h){if(typeof h=="function")return c=c(),h(c),function(){h(null)};if(h!=null)return c=c(),h.current=c,function(){h.current=null}}function jb(c,h,m){return m=m!=null?m.concat([c]):null,md(4,4,Hb.bind(null,h,c),m)}function Zg(){}function Xb(c,h){var m=Ps();h=h===void 0?null:h;var y=m.memoizedState;return y!==null&&h!==null&&jg(h,y[1])?y[0]:(m.memoizedState=[c,h],c)}function Kb(c,h){var m=Ps();h=h===void 0?null:h;var y=m.memoizedState;return y!==null&&h!==null&&jg(h,y[1])?y[0]:(c=c(),m.memoizedState=[c,h],c)}function qb(c,h,m){return(ki&21)===0?(c.baseState&&(c.baseState=!1,cs=!0),c.memoizedState=m):(rr(m,h)||(m=Iv(),Ut.lanes|=m,Si|=m,c.baseState=!0),h)}function y_(c,h){var m=wt;wt=m!==0&&4>m?m:4,c(!0);var y=Hg.transition;Hg.transition={};try{c(!1),h()}finally{wt=m,Hg.transition=y}}function Yb(){return Ps().memoizedState}function w_(c,h,m){var y=Mo(c);if(m={lane:y,action:m,hasEagerState:!1,eagerState:null,next:null},Qb(c))Zb(h,m);else if(m=Nb(c,h,m,y),m!==null){var k=Zn();cr(m,c,y,k),Jb(m,h,y)}}function v_(c,h,m){var y=Mo(c),k={lane:y,action:m,hasEagerState:!1,eagerState:null,next:null};if(Qb(c))Zb(h,k);else{var I=c.alternate;if(c.lanes===0&&(I===null||I.lanes===0)&&(I=h.lastRenderedReducer,I!==null))try{var R=h.lastRenderedState,M=I(R,m);if(k.hasEagerState=!0,k.eagerState=M,rr(M,R)){var W=h.interleaved;W===null?(k.next=k,Lg(h)):(k.next=W.next,W.next=k),h.interleaved=k;return}}catch{}finally{}m=Nb(c,h,k,y),m!==null&&(k=Zn(),cr(m,c,y,k),Jb(m,h,y))}}function Qb(c){var h=c.alternate;return c===Ut||h!==null&&h===Ut}function Zb(c,h){mc=fd=!0;var m=c.pending;m===null?h.next=h:(h.next=m.next,m.next=h),c.pending=h}function Jb(c,h,m){if((m&4194240)!==0){var y=h.lanes;y&=c.pendingLanes,m|=y,h.lanes=m,eg(c,m)}}var gd={readContext:Ms,useCallback:Bn,useContext:Bn,useEffect:Bn,useImperativeHandle:Bn,useInsertionEffect:Bn,useLayoutEffect:Bn,useMemo:Bn,useReducer:Bn,useRef:Bn,useState:Bn,useDebugValue:Bn,useDeferredValue:Bn,useTransition:Bn,useMutableSource:Bn,useSyncExternalStore:Bn,useId:Bn,unstable_isNewReconciler:!1},b_={readContext:Ms,useCallback:function(c,h){return Nr().memoizedState=[c,h===void 0?null:h],c},useContext:Ms,useEffect:Wb,useImperativeHandle:function(c,h,m){return m=m!=null?m.concat([c]):null,pd(4194308,4,Hb.bind(null,h,c),m)},useLayoutEffect:function(c,h){return pd(4194308,4,c,h)},useInsertionEffect:function(c,h){return pd(4,2,c,h)},useMemo:function(c,h){var m=Nr();return h=h===void 0?null:h,c=c(),m.memoizedState=[c,h],c},useReducer:function(c,h,m){var y=Nr();return h=m!==void 0?m(h):h,y.memoizedState=y.baseState=h,c={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:c,lastRenderedState:h},y.queue=c,c=c.dispatch=w_.bind(null,Ut,c),[y.memoizedState,c]},useRef:function(c){var h=Nr();return c={current:c},h.memoizedState=c},useState:Bb,useDebugValue:Zg,useDeferredValue:function(c){return Nr().memoizedState=c},useTransition:function(){var c=Bb(!1),h=c[0];return c=y_.bind(null,c[1]),Nr().memoizedState=c,[h,c]},useMutableSource:function(){},useSyncExternalStore:function(c,h,m){var y=Ut,k=Nr();if(Pt){if(m===void 0)throw Error(t(407));m=m()}else{if(m=h(),kn===null)throw Error(t(349));(ki&30)!==0||Ob(y,h,m)}k.memoizedState=m;var I={value:m,getSnapshot:h};return k.queue=I,Wb(Mb.bind(null,y,I,c),[c]),y.flags|=2048,yc(9,zb.bind(null,y,I,m,h),void 0,null),m},useId:function(){var c=Nr(),h=kn.identifierPrefix;if(Pt){var m=to,y=eo;m=(y&~(1<<32-sr(y)-1)).toString(32)+m,h=":"+h+"R"+m,m=gc++,0<m&&(h+="H"+m.toString(32)),h+=":"}else m=x_++,h=":"+h+"r"+m.toString(32)+":";return c.memoizedState=h},unstable_isNewReconciler:!1},C_={readContext:Ms,useCallback:Xb,useContext:Ms,useEffect:Qg,useImperativeHandle:jb,useInsertionEffect:Ub,useLayoutEffect:Gb,useMemo:Kb,useReducer:qg,useRef:Vb,useState:function(){return qg(xc)},useDebugValue:Zg,useDeferredValue:function(c){var h=Ps();return qb(h,dn.memoizedState,c)},useTransition:function(){var c=qg(xc)[0],h=Ps().memoizedState;return[c,h]},useMutableSource:_b,useSyncExternalStore:Fb,useId:Yb,unstable_isNewReconciler:!1},k_={readContext:Ms,useCallback:Xb,useContext:Ms,useEffect:Qg,useImperativeHandle:jb,useInsertionEffect:Ub,useLayoutEffect:Gb,useMemo:Kb,useReducer:Yg,useRef:Vb,useState:function(){return Yg(xc)},useDebugValue:Zg,useDeferredValue:function(c){var h=Ps();return dn===null?h.memoizedState=c:qb(h,dn.memoizedState,c)},useTransition:function(){var c=Yg(xc)[0],h=Ps().memoizedState;return[c,h]},useMutableSource:_b,useSyncExternalStore:Fb,useId:Yb,unstable_isNewReconciler:!1};function ir(c,h){if(c&&c.defaultProps){h=X({},h),c=c.defaultProps;for(var m in c)h[m]===void 0&&(h[m]=c[m]);return h}return h}function Jg(c,h,m,y){h=c.memoizedState,m=m(y,h),m=m==null?h:X({},h,m),c.memoizedState=m,c.lanes===0&&(c.updateQueue.baseState=m)}var xd={isMounted:function(c){return(c=c._reactInternals)?gi(c)===c:!1},enqueueSetState:function(c,h,m){c=c._reactInternals;var y=Zn(),k=Mo(c),I=so(y,k);I.payload=h,m!=null&&(I.callback=m),h=_o(c,I,k),h!==null&&(cr(h,c,k,y),cd(h,c,k))},enqueueReplaceState:function(c,h,m){c=c._reactInternals;var y=Zn(),k=Mo(c),I=so(y,k);I.tag=1,I.payload=h,m!=null&&(I.callback=m),h=_o(c,I,k),h!==null&&(cr(h,c,k,y),cd(h,c,k))},enqueueForceUpdate:function(c,h){c=c._reactInternals;var m=Zn(),y=Mo(c),k=so(m,y);k.tag=2,h!=null&&(k.callback=h),h=_o(c,k,y),h!==null&&(cr(h,c,y,m),cd(h,c,y))}};function eC(c,h,m,y,k,I,R){return c=c.stateNode,typeof c.shouldComponentUpdate=="function"?c.shouldComponentUpdate(y,I,R):h.prototype&&h.prototype.isPureReactComponent?!rc(m,y)||!rc(k,I):!0}function tC(c,h,m){var y=!1,k=Ro,I=h.contextType;return typeof I=="object"&&I!==null?I=Ms(I):(k=ls(h)?yi:Ln.current,y=h.contextTypes,I=(y=y!=null)?Da(c,k):Ro),h=new h(m,I),c.memoizedState=h.state!==null&&h.state!==void 0?h.state:null,h.updater=xd,c.stateNode=h,h._reactInternals=c,y&&(c=c.stateNode,c.__reactInternalMemoizedUnmaskedChildContext=k,c.__reactInternalMemoizedMaskedChildContext=I),h}function nC(c,h,m,y){c=h.state,typeof h.componentWillReceiveProps=="function"&&h.componentWillReceiveProps(m,y),typeof h.UNSAFE_componentWillReceiveProps=="function"&&h.UNSAFE_componentWillReceiveProps(m,y),h.state!==c&&xd.enqueueReplaceState(h,h.state,null)}function e0(c,h,m,y){var k=c.stateNode;k.props=m,k.state=c.memoizedState,k.refs={},Bg(c);var I=h.contextType;typeof I=="object"&&I!==null?k.context=Ms(I):(I=ls(h)?yi:Ln.current,k.context=Da(c,I)),k.state=c.memoizedState,I=h.getDerivedStateFromProps,typeof I=="function"&&(Jg(c,h,I,m),k.state=c.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof k.getSnapshotBeforeUpdate=="function"||typeof k.UNSAFE_componentWillMount!="function"&&typeof k.componentWillMount!="function"||(h=k.state,typeof k.componentWillMount=="function"&&k.componentWillMount(),typeof k.UNSAFE_componentWillMount=="function"&&k.UNSAFE_componentWillMount(),h!==k.state&&xd.enqueueReplaceState(k,k.state,null),ud(c,m,k,y),k.state=c.memoizedState),typeof k.componentDidMount=="function"&&(c.flags|=4194308)}function Ba(c,h){try{var m="",y=h;do m+=he(y),y=y.return;while(y);var k=m}catch(I){k=`
Error generating stack: `+I.message+`
`+I.stack}return{value:c,source:h,stack:k,digest:null}}function t0(c,h,m){return{value:c,source:null,stack:m??null,digest:h??null}}function n0(c,h){try{console.error(h.value)}catch(m){setTimeout(function(){throw m})}}var S_=typeof WeakMap=="function"?WeakMap:Map;function sC(c,h,m){m=so(-1,m),m.tag=3,m.payload={element:null};var y=h.value;return m.callback=function(){Sd||(Sd=!0,x0=y),n0(c,h)},m}function rC(c,h,m){m=so(-1,m),m.tag=3;var y=c.type.getDerivedStateFromError;if(typeof y=="function"){var k=h.value;m.payload=function(){return y(k)},m.callback=function(){n0(c,h)}}var I=c.stateNode;return I!==null&&typeof I.componentDidCatch=="function"&&(m.callback=function(){n0(c,h),typeof y!="function"&&(Oo===null?Oo=new Set([this]):Oo.add(this));var R=h.stack;this.componentDidCatch(h.value,{componentStack:R!==null?R:""})}),m}function oC(c,h,m){var y=c.pingCache;if(y===null){y=c.pingCache=new S_;var k=new Set;y.set(h,k)}else k=y.get(h),k===void 0&&(k=new Set,y.set(h,k));k.has(m)||(k.add(m),c=P_.bind(null,c,h,m),h.then(c,c))}function iC(c){do{var h;if((h=c.tag===13)&&(h=c.memoizedState,h=h!==null?h.dehydrated!==null:!0),h)return c;c=c.return}while(c!==null);return null}function aC(c,h,m,y,k){return(c.mode&1)===0?(c===h?c.flags|=65536:(c.flags|=128,m.flags|=131072,m.flags&=-52805,m.tag===1&&(m.alternate===null?m.tag=17:(h=so(-1,1),h.tag=2,_o(m,h,1))),m.lanes|=1),c):(c.flags|=65536,c.lanes=k,c)}var I_=S.ReactCurrentOwner,cs=!1;function Qn(c,h,m,y){h.child=c===null?Tb(h,null,m,y):za(h,c.child,m,y)}function lC(c,h,m,y,k){m=m.render;var I=h.ref;return Pa(h,k),y=Xg(c,h,m,y,I,k),m=Kg(),c!==null&&!cs?(h.updateQueue=c.updateQueue,h.flags&=-2053,c.lanes&=~k,ro(c,h,k)):(Pt&&m&&Rg(h),h.flags|=1,Qn(c,h,y,k),h.child)}function cC(c,h,m,y,k){if(c===null){var I=m.type;return typeof I=="function"&&!S0(I)&&I.defaultProps===void 0&&m.compare===null&&m.defaultProps===void 0?(h.tag=15,h.type=I,uC(c,h,I,y,k)):(c=Rd(m.type,null,y,h,h.mode,k),c.ref=h.ref,c.return=h,h.child=c)}if(I=c.child,(c.lanes&k)===0){var R=I.memoizedProps;if(m=m.compare,m=m!==null?m:rc,m(R,y)&&c.ref===h.ref)return ro(c,h,k)}return h.flags|=1,c=Lo(I,y),c.ref=h.ref,c.return=h,h.child=c}function uC(c,h,m,y,k){if(c!==null){var I=c.memoizedProps;if(rc(I,y)&&c.ref===h.ref)if(cs=!1,h.pendingProps=y=I,(c.lanes&k)!==0)(c.flags&131072)!==0&&(cs=!0);else return h.lanes=c.lanes,ro(c,h,k)}return s0(c,h,m,y,k)}function hC(c,h,m){var y=h.pendingProps,k=y.children,I=c!==null?c.memoizedState:null;if(y.mode==="hidden")if((h.mode&1)===0)h.memoizedState={baseLanes:0,cachePool:null,transitions:null},Rt(Wa,Ss),Ss|=m;else{if((m&1073741824)===0)return c=I!==null?I.baseLanes|m:m,h.lanes=h.childLanes=1073741824,h.memoizedState={baseLanes:c,cachePool:null,transitions:null},h.updateQueue=null,Rt(Wa,Ss),Ss|=c,null;h.memoizedState={baseLanes:0,cachePool:null,transitions:null},y=I!==null?I.baseLanes:m,Rt(Wa,Ss),Ss|=y}else I!==null?(y=I.baseLanes|m,h.memoizedState=null):y=m,Rt(Wa,Ss),Ss|=y;return Qn(c,h,k,m),h.child}function dC(c,h){var m=h.ref;(c===null&&m!==null||c!==null&&c.ref!==m)&&(h.flags|=512,h.flags|=2097152)}function s0(c,h,m,y,k){var I=ls(m)?yi:Ln.current;return I=Da(h,I),Pa(h,k),m=Xg(c,h,m,y,I,k),y=Kg(),c!==null&&!cs?(h.updateQueue=c.updateQueue,h.flags&=-2053,c.lanes&=~k,ro(c,h,k)):(Pt&&y&&Rg(h),h.flags|=1,Qn(c,h,m,k),h.child)}function fC(c,h,m,y,k){if(ls(m)){var I=!0;td(h)}else I=!1;if(Pa(h,k),h.stateNode===null)wd(c,h),tC(h,m,y),e0(h,m,y,k),y=!0;else if(c===null){var R=h.stateNode,M=h.memoizedProps;R.props=M;var W=R.context,ae=m.contextType;typeof ae=="object"&&ae!==null?ae=Ms(ae):(ae=ls(m)?yi:Ln.current,ae=Da(h,ae));var ge=m.getDerivedStateFromProps,ve=typeof ge=="function"||typeof R.getSnapshotBeforeUpdate=="function";ve||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(M!==y||W!==ae)&&nC(h,R,y,ae),Do=!1;var pe=h.memoizedState;R.state=pe,ud(h,y,R,k),W=h.memoizedState,M!==y||pe!==W||as.current||Do?(typeof ge=="function"&&(Jg(h,m,ge,y),W=h.memoizedState),(M=Do||eC(h,m,M,y,pe,W,ae))?(ve||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(h.flags|=4194308)):(typeof R.componentDidMount=="function"&&(h.flags|=4194308),h.memoizedProps=y,h.memoizedState=W),R.props=y,R.state=W,R.context=ae,y=M):(typeof R.componentDidMount=="function"&&(h.flags|=4194308),y=!1)}else{R=h.stateNode,Eb(c,h),M=h.memoizedProps,ae=h.type===h.elementType?M:ir(h.type,M),R.props=ae,ve=h.pendingProps,pe=R.context,W=m.contextType,typeof W=="object"&&W!==null?W=Ms(W):(W=ls(m)?yi:Ln.current,W=Da(h,W));var $e=m.getDerivedStateFromProps;(ge=typeof $e=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(M!==ve||pe!==W)&&nC(h,R,y,W),Do=!1,pe=h.memoizedState,R.state=pe,ud(h,y,R,k);var Re=h.memoizedState;M!==ve||pe!==Re||as.current||Do?(typeof $e=="function"&&(Jg(h,m,$e,y),Re=h.memoizedState),(ae=Do||eC(h,m,ae,y,pe,Re,W)||!1)?(ge||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(y,Re,W),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(y,Re,W)),typeof R.componentDidUpdate=="function"&&(h.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(h.flags|=1024)):(typeof R.componentDidUpdate!="function"||M===c.memoizedProps&&pe===c.memoizedState||(h.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||M===c.memoizedProps&&pe===c.memoizedState||(h.flags|=1024),h.memoizedProps=y,h.memoizedState=Re),R.props=y,R.state=Re,R.context=W,y=ae):(typeof R.componentDidUpdate!="function"||M===c.memoizedProps&&pe===c.memoizedState||(h.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||M===c.memoizedProps&&pe===c.memoizedState||(h.flags|=1024),y=!1)}return r0(c,h,m,y,I,k)}function r0(c,h,m,y,k,I){dC(c,h);var R=(h.flags&128)!==0;if(!y&&!R)return k&&yb(h,m,!1),ro(c,h,I);y=h.stateNode,I_.current=h;var M=R&&typeof m.getDerivedStateFromError!="function"?null:y.render();return h.flags|=1,c!==null&&R?(h.child=za(h,c.child,null,I),h.child=za(h,null,M,I)):Qn(c,h,M,I),h.memoizedState=y.state,k&&yb(h,m,!0),h.child}function pC(c){var h=c.stateNode;h.pendingContext?gb(c,h.pendingContext,h.pendingContext!==h.context):h.context&&gb(c,h.context,!1),Vg(c,h.containerInfo)}function mC(c,h,m,y,k){return Oa(),Fg(k),h.flags|=256,Qn(c,h,m,y),h.child}var o0={dehydrated:null,treeContext:null,retryLane:0};function i0(c){return{baseLanes:c,cachePool:null,transitions:null}}function gC(c,h,m){var y=h.pendingProps,k=Wt.current,I=!1,R=(h.flags&128)!==0,M;if((M=R)||(M=c!==null&&c.memoizedState===null?!1:(k&2)!==0),M?(I=!0,h.flags&=-129):(c===null||c.memoizedState!==null)&&(k|=1),Rt(Wt,k&1),c===null)return _g(h),c=h.memoizedState,c!==null&&(c=c.dehydrated,c!==null)?((h.mode&1)===0?h.lanes=1:c.data==="$!"?h.lanes=8:h.lanes=1073741824,null):(R=y.children,c=y.fallback,I?(y=h.mode,I=h.child,R={mode:"hidden",children:R},(y&1)===0&&I!==null?(I.childLanes=0,I.pendingProps=R):I=Ad(R,y,0,null),c=Ni(c,y,m,null),I.return=h,c.return=h,I.sibling=c,h.child=I,h.child.memoizedState=i0(m),h.memoizedState=o0,c):a0(h,R));if(k=c.memoizedState,k!==null&&(M=k.dehydrated,M!==null))return $_(c,h,R,y,M,k,m);if(I){I=y.fallback,R=h.mode,k=c.child,M=k.sibling;var W={mode:"hidden",children:y.children};return(R&1)===0&&h.child!==k?(y=h.child,y.childLanes=0,y.pendingProps=W,h.deletions=null):(y=Lo(k,W),y.subtreeFlags=k.subtreeFlags&14680064),M!==null?I=Lo(M,I):(I=Ni(I,R,m,null),I.flags|=2),I.return=h,y.return=h,y.sibling=I,h.child=y,y=I,I=h.child,R=c.child.memoizedState,R=R===null?i0(m):{baseLanes:R.baseLanes|m,cachePool:null,transitions:R.transitions},I.memoizedState=R,I.childLanes=c.childLanes&~m,h.memoizedState=o0,y}return I=c.child,c=I.sibling,y=Lo(I,{mode:"visible",children:y.children}),(h.mode&1)===0&&(y.lanes=m),y.return=h,y.sibling=null,c!==null&&(m=h.deletions,m===null?(h.deletions=[c],h.flags|=16):m.push(c)),h.child=y,h.memoizedState=null,y}function a0(c,h){return h=Ad({mode:"visible",children:h},c.mode,0,null),h.return=c,c.child=h}function yd(c,h,m,y){return y!==null&&Fg(y),za(h,c.child,null,m),c=a0(h,h.pendingProps.children),c.flags|=2,h.memoizedState=null,c}function $_(c,h,m,y,k,I,R){if(m)return h.flags&256?(h.flags&=-257,y=t0(Error(t(422))),yd(c,h,R,y)):h.memoizedState!==null?(h.child=c.child,h.flags|=128,null):(I=y.fallback,k=h.mode,y=Ad({mode:"visible",children:y.children},k,0,null),I=Ni(I,k,R,null),I.flags|=2,y.return=h,I.return=h,y.sibling=I,h.child=y,(h.mode&1)!==0&&za(h,c.child,null,R),h.child.memoizedState=i0(R),h.memoizedState=o0,I);if((h.mode&1)===0)return yd(c,h,R,null);if(k.data==="$!"){if(y=k.nextSibling&&k.nextSibling.dataset,y)var M=y.dgst;return y=M,I=Error(t(419)),y=t0(I,y,void 0),yd(c,h,R,y)}if(M=(R&c.childLanes)!==0,cs||M){if(y=kn,y!==null){switch(R&-R){case 4:k=2;break;case 16:k=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:k=32;break;case 536870912:k=268435456;break;default:k=0}k=(k&(y.suspendedLanes|R))!==0?0:k,k!==0&&k!==I.retryLane&&(I.retryLane=k,no(c,k),cr(y,c,k,-1))}return k0(),y=t0(Error(t(421))),yd(c,h,R,y)}return k.data==="$?"?(h.flags|=128,h.child=c.child,h=L_.bind(null,c),k._reactRetry=h,null):(c=I.treeContext,ks=No(k.nextSibling),Cs=h,Pt=!0,or=null,c!==null&&(Os[zs++]=eo,Os[zs++]=to,Os[zs++]=wi,eo=c.id,to=c.overflow,wi=h),h=a0(h,y.children),h.flags|=4096,h)}function xC(c,h,m){c.lanes|=h;var y=c.alternate;y!==null&&(y.lanes|=h),Pg(c.return,h,m)}function l0(c,h,m,y,k){var I=c.memoizedState;I===null?c.memoizedState={isBackwards:h,rendering:null,renderingStartTime:0,last:y,tail:m,tailMode:k}:(I.isBackwards=h,I.rendering=null,I.renderingStartTime=0,I.last=y,I.tail=m,I.tailMode=k)}function yC(c,h,m){var y=h.pendingProps,k=y.revealOrder,I=y.tail;if(Qn(c,h,y.children,m),y=Wt.current,(y&2)!==0)y=y&1|2,h.flags|=128;else{if(c!==null&&(c.flags&128)!==0)e:for(c=h.child;c!==null;){if(c.tag===13)c.memoizedState!==null&&xC(c,m,h);else if(c.tag===19)xC(c,m,h);else if(c.child!==null){c.child.return=c,c=c.child;continue}if(c===h)break e;for(;c.sibling===null;){if(c.return===null||c.return===h)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}y&=1}if(Rt(Wt,y),(h.mode&1)===0)h.memoizedState=null;else switch(k){case"forwards":for(m=h.child,k=null;m!==null;)c=m.alternate,c!==null&&hd(c)===null&&(k=m),m=m.sibling;m=k,m===null?(k=h.child,h.child=null):(k=m.sibling,m.sibling=null),l0(h,!1,k,m,I);break;case"backwards":for(m=null,k=h.child,h.child=null;k!==null;){if(c=k.alternate,c!==null&&hd(c)===null){h.child=k;break}c=k.sibling,k.sibling=m,m=k,k=c}l0(h,!0,m,null,I);break;case"together":l0(h,!1,null,null,void 0);break;default:h.memoizedState=null}return h.child}function wd(c,h){(h.mode&1)===0&&c!==null&&(c.alternate=null,h.alternate=null,h.flags|=2)}function ro(c,h,m){if(c!==null&&(h.dependencies=c.dependencies),Si|=h.lanes,(m&h.childLanes)===0)return null;if(c!==null&&h.child!==c.child)throw Error(t(153));if(h.child!==null){for(c=h.child,m=Lo(c,c.pendingProps),h.child=m,m.return=h;c.sibling!==null;)c=c.sibling,m=m.sibling=Lo(c,c.pendingProps),m.return=h;m.sibling=null}return h.child}function T_(c,h,m){switch(h.tag){case 3:pC(h),Oa();break;case 5:Db(h);break;case 1:ls(h.type)&&td(h);break;case 4:Vg(h,h.stateNode.containerInfo);break;case 10:var y=h.type._context,k=h.memoizedProps.value;Rt(ad,y._currentValue),y._currentValue=k;break;case 13:if(y=h.memoizedState,y!==null)return y.dehydrated!==null?(Rt(Wt,Wt.current&1),h.flags|=128,null):(m&h.child.childLanes)!==0?gC(c,h,m):(Rt(Wt,Wt.current&1),c=ro(c,h,m),c!==null?c.sibling:null);Rt(Wt,Wt.current&1);break;case 19:if(y=(m&h.childLanes)!==0,(c.flags&128)!==0){if(y)return yC(c,h,m);h.flags|=128}if(k=h.memoizedState,k!==null&&(k.rendering=null,k.tail=null,k.lastEffect=null),Rt(Wt,Wt.current),y)break;return null;case 22:case 23:return h.lanes=0,hC(c,h,m)}return ro(c,h,m)}var wC,c0,vC,bC;wC=function(c,h){for(var m=h.child;m!==null;){if(m.tag===5||m.tag===6)c.appendChild(m.stateNode);else if(m.tag!==4&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===h)break;for(;m.sibling===null;){if(m.return===null||m.return===h)return;m=m.return}m.sibling.return=m.return,m=m.sibling}},c0=function(){},vC=function(c,h,m,y){var k=c.memoizedProps;if(k!==y){c=h.stateNode,Ci(Tr.current);var I=null;switch(m){case"input":k=Xe(c,k),y=Xe(c,y),I=[];break;case"select":k=X({},k,{value:void 0}),y=X({},y,{value:void 0}),I=[];break;case"textarea":k=Vt(c,k),y=Vt(c,y),I=[];break;default:typeof k.onClick!="function"&&typeof y.onClick=="function"&&(c.onclick=Zh)}Um(m,y);var R;m=null;for(ae in k)if(!y.hasOwnProperty(ae)&&k.hasOwnProperty(ae)&&k[ae]!=null)if(ae==="style"){var M=k[ae];for(R in M)M.hasOwnProperty(R)&&(m||(m={}),m[R]="")}else ae!=="dangerouslySetInnerHTML"&&ae!=="children"&&ae!=="suppressContentEditableWarning"&&ae!=="suppressHydrationWarning"&&ae!=="autoFocus"&&(r.hasOwnProperty(ae)?I||(I=[]):(I=I||[]).push(ae,null));for(ae in y){var W=y[ae];if(M=k!=null?k[ae]:void 0,y.hasOwnProperty(ae)&&W!==M&&(W!=null||M!=null))if(ae==="style")if(M){for(R in M)!M.hasOwnProperty(R)||W&&W.hasOwnProperty(R)||(m||(m={}),m[R]="");for(R in W)W.hasOwnProperty(R)&&M[R]!==W[R]&&(m||(m={}),m[R]=W[R])}else m||(I||(I=[]),I.push(ae,m)),m=W;else ae==="dangerouslySetInnerHTML"?(W=W?W.__html:void 0,M=M?M.__html:void 0,W!=null&&M!==W&&(I=I||[]).push(ae,W)):ae==="children"?typeof W!="string"&&typeof W!="number"||(I=I||[]).push(ae,""+W):ae!=="suppressContentEditableWarning"&&ae!=="suppressHydrationWarning"&&(r.hasOwnProperty(ae)?(W!=null&&ae==="onScroll"&&_t("scroll",c),I||M===W||(I=[])):(I=I||[]).push(ae,W))}m&&(I=I||[]).push("style",m);var ae=I;(h.updateQueue=ae)&&(h.flags|=4)}},bC=function(c,h,m,y){m!==y&&(h.flags|=4)};function wc(c,h){if(!Pt)switch(c.tailMode){case"hidden":h=c.tail;for(var m=null;h!==null;)h.alternate!==null&&(m=h),h=h.sibling;m===null?c.tail=null:m.sibling=null;break;case"collapsed":m=c.tail;for(var y=null;m!==null;)m.alternate!==null&&(y=m),m=m.sibling;y===null?h||c.tail===null?c.tail=null:c.tail.sibling=null:y.sibling=null}}function Vn(c){var h=c.alternate!==null&&c.alternate.child===c.child,m=0,y=0;if(h)for(var k=c.child;k!==null;)m|=k.lanes|k.childLanes,y|=k.subtreeFlags&14680064,y|=k.flags&14680064,k.return=c,k=k.sibling;else for(k=c.child;k!==null;)m|=k.lanes|k.childLanes,y|=k.subtreeFlags,y|=k.flags,k.return=c,k=k.sibling;return c.subtreeFlags|=y,c.childLanes=m,h}function N_(c,h,m){var y=h.pendingProps;switch(Ag(h),h.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Vn(h),null;case 1:return ls(h.type)&&ed(),Vn(h),null;case 3:return y=h.stateNode,La(),Ft(as),Ft(Ln),Gg(),y.pendingContext&&(y.context=y.pendingContext,y.pendingContext=null),(c===null||c.child===null)&&(od(h)?h.flags|=4:c===null||c.memoizedState.isDehydrated&&(h.flags&256)===0||(h.flags|=1024,or!==null&&(v0(or),or=null))),c0(c,h),Vn(h),null;case 5:Wg(h);var k=Ci(pc.current);if(m=h.type,c!==null&&h.stateNode!=null)vC(c,h,m,y,k),c.ref!==h.ref&&(h.flags|=512,h.flags|=2097152);else{if(!y){if(h.stateNode===null)throw Error(t(166));return Vn(h),null}if(c=Ci(Tr.current),od(h)){y=h.stateNode,m=h.type;var I=h.memoizedProps;switch(y[$r]=h,y[cc]=I,c=(h.mode&1)!==0,m){case"dialog":_t("cancel",y),_t("close",y);break;case"iframe":case"object":case"embed":_t("load",y);break;case"video":case"audio":for(k=0;k<ic.length;k++)_t(ic[k],y);break;case"source":_t("error",y);break;case"img":case"image":case"link":_t("error",y),_t("load",y);break;case"details":_t("toggle",y);break;case"input":nt(y,I),_t("invalid",y);break;case"select":y._wrapperState={wasMultiple:!!I.multiple},_t("invalid",y);break;case"textarea":Sr(y,I),_t("invalid",y)}Um(m,I),k=null;for(var R in I)if(I.hasOwnProperty(R)){var M=I[R];R==="children"?typeof M=="string"?y.textContent!==M&&(I.suppressHydrationWarning!==!0&&Qh(y.textContent,M,c),k=["children",M]):typeof M=="number"&&y.textContent!==""+M&&(I.suppressHydrationWarning!==!0&&Qh(y.textContent,M,c),k=["children",""+M]):r.hasOwnProperty(R)&&M!=null&&R==="onScroll"&&_t("scroll",y)}switch(m){case"input":Pe(y),lt(y,I,!0);break;case"textarea":Pe(y),_s(y);break;case"select":case"option":break;default:typeof I.onClick=="function"&&(y.onclick=Zh)}y=k,h.updateQueue=y,y!==null&&(h.flags|=4)}else{R=k.nodeType===9?k:k.ownerDocument,c==="http://www.w3.org/1999/xhtml"&&(c=nr(m)),c==="http://www.w3.org/1999/xhtml"?m==="script"?(c=R.createElement("div"),c.innerHTML="<script><\/script>",c=c.removeChild(c.firstChild)):typeof y.is=="string"?c=R.createElement(m,{is:y.is}):(c=R.createElement(m),m==="select"&&(R=c,y.multiple?R.multiple=!0:y.size&&(R.size=y.size))):c=R.createElementNS(c,m),c[$r]=h,c[cc]=y,wC(c,h,!1,!1),h.stateNode=c;e:{switch(R=Gm(m,y),m){case"dialog":_t("cancel",c),_t("close",c),k=y;break;case"iframe":case"object":case"embed":_t("load",c),k=y;break;case"video":case"audio":for(k=0;k<ic.length;k++)_t(ic[k],c);k=y;break;case"source":_t("error",c),k=y;break;case"img":case"image":case"link":_t("error",c),_t("load",c),k=y;break;case"details":_t("toggle",c),k=y;break;case"input":nt(c,y),k=Xe(c,y),_t("invalid",c);break;case"option":k=y;break;case"select":c._wrapperState={wasMultiple:!!y.multiple},k=X({},y,{value:void 0}),_t("invalid",c);break;case"textarea":Sr(c,y),k=Vt(c,y),_t("invalid",c);break;default:k=y}Um(m,k),M=k;for(I in M)if(M.hasOwnProperty(I)){var W=M[I];I==="style"?Rh(c,W):I==="dangerouslySetInnerHTML"?(W=W?W.__html:void 0,W!=null&&bo(c,W)):I==="children"?typeof W=="string"?(m!=="textarea"||W!=="")&&Yr(c,W):typeof W=="number"&&Yr(c,""+W):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(r.hasOwnProperty(I)?W!=null&&I==="onScroll"&&_t("scroll",c):W!=null&&$(c,I,W,R))}switch(m){case"input":Pe(c),lt(c,y,!1);break;case"textarea":Pe(c),_s(c);break;case"option":y.value!=null&&c.setAttribute("value",""+xe(y.value));break;case"select":c.multiple=!!y.multiple,I=y.value,I!=null?bn(c,!!y.multiple,I,!1):y.defaultValue!=null&&bn(c,!!y.multiple,y.defaultValue,!0);break;default:typeof k.onClick=="function"&&(c.onclick=Zh)}switch(m){case"button":case"input":case"select":case"textarea":y=!!y.autoFocus;break e;case"img":y=!0;break e;default:y=!1}}y&&(h.flags|=4)}h.ref!==null&&(h.flags|=512,h.flags|=2097152)}return Vn(h),null;case 6:if(c&&h.stateNode!=null)bC(c,h,c.memoizedProps,y);else{if(typeof y!="string"&&h.stateNode===null)throw Error(t(166));if(m=Ci(pc.current),Ci(Tr.current),od(h)){if(y=h.stateNode,m=h.memoizedProps,y[$r]=h,(I=y.nodeValue!==m)&&(c=Cs,c!==null))switch(c.tag){case 3:Qh(y.nodeValue,m,(c.mode&1)!==0);break;case 5:c.memoizedProps.suppressHydrationWarning!==!0&&Qh(y.nodeValue,m,(c.mode&1)!==0)}I&&(h.flags|=4)}else y=(m.nodeType===9?m:m.ownerDocument).createTextNode(y),y[$r]=h,h.stateNode=y}return Vn(h),null;case 13:if(Ft(Wt),y=h.memoizedState,c===null||c.memoizedState!==null&&c.memoizedState.dehydrated!==null){if(Pt&&ks!==null&&(h.mode&1)!==0&&(h.flags&128)===0)Sb(),Oa(),h.flags|=98560,I=!1;else if(I=od(h),y!==null&&y.dehydrated!==null){if(c===null){if(!I)throw Error(t(318));if(I=h.memoizedState,I=I!==null?I.dehydrated:null,!I)throw Error(t(317));I[$r]=h}else Oa(),(h.flags&128)===0&&(h.memoizedState=null),h.flags|=4;Vn(h),I=!1}else or!==null&&(v0(or),or=null),I=!0;if(!I)return h.flags&65536?h:null}return(h.flags&128)!==0?(h.lanes=m,h):(y=y!==null,y!==(c!==null&&c.memoizedState!==null)&&y&&(h.child.flags|=8192,(h.mode&1)!==0&&(c===null||(Wt.current&1)!==0?fn===0&&(fn=3):k0())),h.updateQueue!==null&&(h.flags|=4),Vn(h),null);case 4:return La(),c0(c,h),c===null&&ac(h.stateNode.containerInfo),Vn(h),null;case 10:return Mg(h.type._context),Vn(h),null;case 17:return ls(h.type)&&ed(),Vn(h),null;case 19:if(Ft(Wt),I=h.memoizedState,I===null)return Vn(h),null;if(y=(h.flags&128)!==0,R=I.rendering,R===null)if(y)wc(I,!1);else{if(fn!==0||c!==null&&(c.flags&128)!==0)for(c=h.child;c!==null;){if(R=hd(c),R!==null){for(h.flags|=128,wc(I,!1),y=R.updateQueue,y!==null&&(h.updateQueue=y,h.flags|=4),h.subtreeFlags=0,y=m,m=h.child;m!==null;)I=m,c=y,I.flags&=14680066,R=I.alternate,R===null?(I.childLanes=0,I.lanes=c,I.child=null,I.subtreeFlags=0,I.memoizedProps=null,I.memoizedState=null,I.updateQueue=null,I.dependencies=null,I.stateNode=null):(I.childLanes=R.childLanes,I.lanes=R.lanes,I.child=R.child,I.subtreeFlags=0,I.deletions=null,I.memoizedProps=R.memoizedProps,I.memoizedState=R.memoizedState,I.updateQueue=R.updateQueue,I.type=R.type,c=R.dependencies,I.dependencies=c===null?null:{lanes:c.lanes,firstContext:c.firstContext}),m=m.sibling;return Rt(Wt,Wt.current&1|2),h.child}c=c.sibling}I.tail!==null&&Qt()>Ua&&(h.flags|=128,y=!0,wc(I,!1),h.lanes=4194304)}else{if(!y)if(c=hd(R),c!==null){if(h.flags|=128,y=!0,m=c.updateQueue,m!==null&&(h.updateQueue=m,h.flags|=4),wc(I,!0),I.tail===null&&I.tailMode==="hidden"&&!R.alternate&&!Pt)return Vn(h),null}else 2*Qt()-I.renderingStartTime>Ua&&m!==1073741824&&(h.flags|=128,y=!0,wc(I,!1),h.lanes=4194304);I.isBackwards?(R.sibling=h.child,h.child=R):(m=I.last,m!==null?m.sibling=R:h.child=R,I.last=R)}return I.tail!==null?(h=I.tail,I.rendering=h,I.tail=h.sibling,I.renderingStartTime=Qt(),h.sibling=null,m=Wt.current,Rt(Wt,y?m&1|2:m&1),h):(Vn(h),null);case 22:case 23:return C0(),y=h.memoizedState!==null,c!==null&&c.memoizedState!==null!==y&&(h.flags|=8192),y&&(h.mode&1)!==0?(Ss&1073741824)!==0&&(Vn(h),h.subtreeFlags&6&&(h.flags|=8192)):Vn(h),null;case 24:return null;case 25:return null}throw Error(t(156,h.tag))}function E_(c,h){switch(Ag(h),h.tag){case 1:return ls(h.type)&&ed(),c=h.flags,c&65536?(h.flags=c&-65537|128,h):null;case 3:return La(),Ft(as),Ft(Ln),Gg(),c=h.flags,(c&65536)!==0&&(c&128)===0?(h.flags=c&-65537|128,h):null;case 5:return Wg(h),null;case 13:if(Ft(Wt),c=h.memoizedState,c!==null&&c.dehydrated!==null){if(h.alternate===null)throw Error(t(340));Oa()}return c=h.flags,c&65536?(h.flags=c&-65537|128,h):null;case 19:return Ft(Wt),null;case 4:return La(),null;case 10:return Mg(h.type._context),null;case 22:case 23:return C0(),null;case 24:return null;default:return null}}var vd=!1,Wn=!1,R_=typeof WeakSet=="function"?WeakSet:Set,Ne=null;function Va(c,h){var m=c.ref;if(m!==null)if(typeof m=="function")try{m(null)}catch(y){Gt(c,h,y)}else m.current=null}function u0(c,h,m){try{m()}catch(y){Gt(c,h,y)}}var CC=!1;function A_(c,h){if(Cg=Bh,c=eb(),pg(c)){if("selectionStart"in c)var m={start:c.selectionStart,end:c.selectionEnd};else e:{m=(m=c.ownerDocument)&&m.defaultView||window;var y=m.getSelection&&m.getSelection();if(y&&y.rangeCount!==0){m=y.anchorNode;var k=y.anchorOffset,I=y.focusNode;y=y.focusOffset;try{m.nodeType,I.nodeType}catch{m=null;break e}var R=0,M=-1,W=-1,ae=0,ge=0,ve=c,pe=null;t:for(;;){for(var $e;ve!==m||k!==0&&ve.nodeType!==3||(M=R+k),ve!==I||y!==0&&ve.nodeType!==3||(W=R+y),ve.nodeType===3&&(R+=ve.nodeValue.length),($e=ve.firstChild)!==null;)pe=ve,ve=$e;for(;;){if(ve===c)break t;if(pe===m&&++ae===k&&(M=R),pe===I&&++ge===y&&(W=R),($e=ve.nextSibling)!==null)break;ve=pe,pe=ve.parentNode}ve=$e}m=M===-1||W===-1?null:{start:M,end:W}}else m=null}m=m||{start:0,end:0}}else m=null;for(kg={focusedElem:c,selectionRange:m},Bh=!1,Ne=h;Ne!==null;)if(h=Ne,c=h.child,(h.subtreeFlags&1028)!==0&&c!==null)c.return=h,Ne=c;else for(;Ne!==null;){h=Ne;try{var Re=h.alternate;if((h.flags&1024)!==0)switch(h.tag){case 0:case 11:case 15:break;case 1:if(Re!==null){var _e=Re.memoizedProps,Zt=Re.memoizedState,ne=h.stateNode,q=ne.getSnapshotBeforeUpdate(h.elementType===h.type?_e:ir(h.type,_e),Zt);ne.__reactInternalSnapshotBeforeUpdate=q}break;case 3:var re=h.stateNode.containerInfo;re.nodeType===1?re.textContent="":re.nodeType===9&&re.documentElement&&re.removeChild(re.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(Ce){Gt(h,h.return,Ce)}if(c=h.sibling,c!==null){c.return=h.return,Ne=c;break}Ne=h.return}return Re=CC,CC=!1,Re}function vc(c,h,m){var y=h.updateQueue;if(y=y!==null?y.lastEffect:null,y!==null){var k=y=y.next;do{if((k.tag&c)===c){var I=k.destroy;k.destroy=void 0,I!==void 0&&u0(h,m,I)}k=k.next}while(k!==y)}}function bd(c,h){if(h=h.updateQueue,h=h!==null?h.lastEffect:null,h!==null){var m=h=h.next;do{if((m.tag&c)===c){var y=m.create;m.destroy=y()}m=m.next}while(m!==h)}}function h0(c){var h=c.ref;if(h!==null){var m=c.stateNode;switch(c.tag){case 5:c=m;break;default:c=m}typeof h=="function"?h(c):h.current=c}}function kC(c){var h=c.alternate;h!==null&&(c.alternate=null,kC(h)),c.child=null,c.deletions=null,c.sibling=null,c.tag===5&&(h=c.stateNode,h!==null&&(delete h[$r],delete h[cc],delete h[Tg],delete h[f_],delete h[p_])),c.stateNode=null,c.return=null,c.dependencies=null,c.memoizedProps=null,c.memoizedState=null,c.pendingProps=null,c.stateNode=null,c.updateQueue=null}function SC(c){return c.tag===5||c.tag===3||c.tag===4}function IC(c){e:for(;;){for(;c.sibling===null;){if(c.return===null||SC(c.return))return null;c=c.return}for(c.sibling.return=c.return,c=c.sibling;c.tag!==5&&c.tag!==6&&c.tag!==18;){if(c.flags&2||c.child===null||c.tag===4)continue e;c.child.return=c,c=c.child}if(!(c.flags&2))return c.stateNode}}function d0(c,h,m){var y=c.tag;if(y===5||y===6)c=c.stateNode,h?m.nodeType===8?m.parentNode.insertBefore(c,h):m.insertBefore(c,h):(m.nodeType===8?(h=m.parentNode,h.insertBefore(c,m)):(h=m,h.appendChild(c)),m=m._reactRootContainer,m!=null||h.onclick!==null||(h.onclick=Zh));else if(y!==4&&(c=c.child,c!==null))for(d0(c,h,m),c=c.sibling;c!==null;)d0(c,h,m),c=c.sibling}function f0(c,h,m){var y=c.tag;if(y===5||y===6)c=c.stateNode,h?m.insertBefore(c,h):m.appendChild(c);else if(y!==4&&(c=c.child,c!==null))for(f0(c,h,m),c=c.sibling;c!==null;)f0(c,h,m),c=c.sibling}var An=null,ar=!1;function Fo(c,h,m){for(m=m.child;m!==null;)$C(c,h,m),m=m.sibling}function $C(c,h,m){if(Ir&&typeof Ir.onCommitFiberUnmount=="function")try{Ir.onCommitFiberUnmount(Fh,m)}catch{}switch(m.tag){case 5:Wn||Va(m,h);case 6:var y=An,k=ar;An=null,Fo(c,h,m),An=y,ar=k,An!==null&&(ar?(c=An,m=m.stateNode,c.nodeType===8?c.parentNode.removeChild(m):c.removeChild(m)):An.removeChild(m.stateNode));break;case 18:An!==null&&(ar?(c=An,m=m.stateNode,c.nodeType===8?$g(c.parentNode,m):c.nodeType===1&&$g(c,m),Zl(c)):$g(An,m.stateNode));break;case 4:y=An,k=ar,An=m.stateNode.containerInfo,ar=!0,Fo(c,h,m),An=y,ar=k;break;case 0:case 11:case 14:case 15:if(!Wn&&(y=m.updateQueue,y!==null&&(y=y.lastEffect,y!==null))){k=y=y.next;do{var I=k,R=I.destroy;I=I.tag,R!==void 0&&((I&2)!==0||(I&4)!==0)&&u0(m,h,R),k=k.next}while(k!==y)}Fo(c,h,m);break;case 1:if(!Wn&&(Va(m,h),y=m.stateNode,typeof y.componentWillUnmount=="function"))try{y.props=m.memoizedProps,y.state=m.memoizedState,y.componentWillUnmount()}catch(M){Gt(m,h,M)}Fo(c,h,m);break;case 21:Fo(c,h,m);break;case 22:m.mode&1?(Wn=(y=Wn)||m.memoizedState!==null,Fo(c,h,m),Wn=y):Fo(c,h,m);break;default:Fo(c,h,m)}}function TC(c){var h=c.updateQueue;if(h!==null){c.updateQueue=null;var m=c.stateNode;m===null&&(m=c.stateNode=new R_),h.forEach(function(y){var k=B_.bind(null,c,y);m.has(y)||(m.add(y),y.then(k,k))})}}function lr(c,h){var m=h.deletions;if(m!==null)for(var y=0;y<m.length;y++){var k=m[y];try{var I=c,R=h,M=R;e:for(;M!==null;){switch(M.tag){case 5:An=M.stateNode,ar=!1;break e;case 3:An=M.stateNode.containerInfo,ar=!0;break e;case 4:An=M.stateNode.containerInfo,ar=!0;break e}M=M.return}if(An===null)throw Error(t(160));$C(I,R,k),An=null,ar=!1;var W=k.alternate;W!==null&&(W.return=null),k.return=null}catch(ae){Gt(k,h,ae)}}if(h.subtreeFlags&12854)for(h=h.child;h!==null;)NC(h,c),h=h.sibling}function NC(c,h){var m=c.alternate,y=c.flags;switch(c.tag){case 0:case 11:case 14:case 15:if(lr(h,c),Er(c),y&4){try{vc(3,c,c.return),bd(3,c)}catch(_e){Gt(c,c.return,_e)}try{vc(5,c,c.return)}catch(_e){Gt(c,c.return,_e)}}break;case 1:lr(h,c),Er(c),y&512&&m!==null&&Va(m,m.return);break;case 5:if(lr(h,c),Er(c),y&512&&m!==null&&Va(m,m.return),c.flags&32){var k=c.stateNode;try{Yr(k,"")}catch(_e){Gt(c,c.return,_e)}}if(y&4&&(k=c.stateNode,k!=null)){var I=c.memoizedProps,R=m!==null?m.memoizedProps:I,M=c.type,W=c.updateQueue;if(c.updateQueue=null,W!==null)try{M==="input"&&I.type==="radio"&&I.name!=null&&rt(k,I),Gm(M,R);var ae=Gm(M,I);for(R=0;R<W.length;R+=2){var ge=W[R],ve=W[R+1];ge==="style"?Rh(k,ve):ge==="dangerouslySetInnerHTML"?bo(k,ve):ge==="children"?Yr(k,ve):$(k,ge,ve,ae)}switch(M){case"input":ut(k,I);break;case"textarea":is(k,I);break;case"select":var pe=k._wrapperState.wasMultiple;k._wrapperState.wasMultiple=!!I.multiple;var $e=I.value;$e!=null?bn(k,!!I.multiple,$e,!1):pe!==!!I.multiple&&(I.defaultValue!=null?bn(k,!!I.multiple,I.defaultValue,!0):bn(k,!!I.multiple,I.multiple?[]:"",!1))}k[cc]=I}catch(_e){Gt(c,c.return,_e)}}break;case 6:if(lr(h,c),Er(c),y&4){if(c.stateNode===null)throw Error(t(162));k=c.stateNode,I=c.memoizedProps;try{k.nodeValue=I}catch(_e){Gt(c,c.return,_e)}}break;case 3:if(lr(h,c),Er(c),y&4&&m!==null&&m.memoizedState.isDehydrated)try{Zl(h.containerInfo)}catch(_e){Gt(c,c.return,_e)}break;case 4:lr(h,c),Er(c);break;case 13:lr(h,c),Er(c),k=c.child,k.flags&8192&&(I=k.memoizedState!==null,k.stateNode.isHidden=I,!I||k.alternate!==null&&k.alternate.memoizedState!==null||(g0=Qt())),y&4&&TC(c);break;case 22:if(ge=m!==null&&m.memoizedState!==null,c.mode&1?(Wn=(ae=Wn)||ge,lr(h,c),Wn=ae):lr(h,c),Er(c),y&8192){if(ae=c.memoizedState!==null,(c.stateNode.isHidden=ae)&&!ge&&(c.mode&1)!==0)for(Ne=c,ge=c.child;ge!==null;){for(ve=Ne=ge;Ne!==null;){switch(pe=Ne,$e=pe.child,pe.tag){case 0:case 11:case 14:case 15:vc(4,pe,pe.return);break;case 1:Va(pe,pe.return);var Re=pe.stateNode;if(typeof Re.componentWillUnmount=="function"){y=pe,m=pe.return;try{h=y,Re.props=h.memoizedProps,Re.state=h.memoizedState,Re.componentWillUnmount()}catch(_e){Gt(y,m,_e)}}break;case 5:Va(pe,pe.return);break;case 22:if(pe.memoizedState!==null){AC(ve);continue}}$e!==null?($e.return=pe,Ne=$e):AC(ve)}ge=ge.sibling}e:for(ge=null,ve=c;;){if(ve.tag===5){if(ge===null){ge=ve;try{k=ve.stateNode,ae?(I=k.style,typeof I.setProperty=="function"?I.setProperty("display","none","important"):I.display="none"):(M=ve.stateNode,W=ve.memoizedProps.style,R=W!=null&&W.hasOwnProperty("display")?W.display:null,M.style.display=mi("display",R))}catch(_e){Gt(c,c.return,_e)}}}else if(ve.tag===6){if(ge===null)try{ve.stateNode.nodeValue=ae?"":ve.memoizedProps}catch(_e){Gt(c,c.return,_e)}}else if((ve.tag!==22&&ve.tag!==23||ve.memoizedState===null||ve===c)&&ve.child!==null){ve.child.return=ve,ve=ve.child;continue}if(ve===c)break e;for(;ve.sibling===null;){if(ve.return===null||ve.return===c)break e;ge===ve&&(ge=null),ve=ve.return}ge===ve&&(ge=null),ve.sibling.return=ve.return,ve=ve.sibling}}break;case 19:lr(h,c),Er(c),y&4&&TC(c);break;case 21:break;default:lr(h,c),Er(c)}}function Er(c){var h=c.flags;if(h&2){try{e:{for(var m=c.return;m!==null;){if(SC(m)){var y=m;break e}m=m.return}throw Error(t(160))}switch(y.tag){case 5:var k=y.stateNode;y.flags&32&&(Yr(k,""),y.flags&=-33);var I=IC(c);f0(c,I,k);break;case 3:case 4:var R=y.stateNode.containerInfo,M=IC(c);d0(c,M,R);break;default:throw Error(t(161))}}catch(W){Gt(c,c.return,W)}c.flags&=-3}h&4096&&(c.flags&=-4097)}function D_(c,h,m){Ne=c,EC(c)}function EC(c,h,m){for(var y=(c.mode&1)!==0;Ne!==null;){var k=Ne,I=k.child;if(k.tag===22&&y){var R=k.memoizedState!==null||vd;if(!R){var M=k.alternate,W=M!==null&&M.memoizedState!==null||Wn;M=vd;var ae=Wn;if(vd=R,(Wn=W)&&!ae)for(Ne=k;Ne!==null;)R=Ne,W=R.child,R.tag===22&&R.memoizedState!==null?DC(k):W!==null?(W.return=R,Ne=W):DC(k);for(;I!==null;)Ne=I,EC(I),I=I.sibling;Ne=k,vd=M,Wn=ae}RC(c)}else(k.subtreeFlags&8772)!==0&&I!==null?(I.return=k,Ne=I):RC(c)}}function RC(c){for(;Ne!==null;){var h=Ne;if((h.flags&8772)!==0){var m=h.alternate;try{if((h.flags&8772)!==0)switch(h.tag){case 0:case 11:case 15:Wn||bd(5,h);break;case 1:var y=h.stateNode;if(h.flags&4&&!Wn)if(m===null)y.componentDidMount();else{var k=h.elementType===h.type?m.memoizedProps:ir(h.type,m.memoizedProps);y.componentDidUpdate(k,m.memoizedState,y.__reactInternalSnapshotBeforeUpdate)}var I=h.updateQueue;I!==null&&Ab(h,I,y);break;case 3:var R=h.updateQueue;if(R!==null){if(m=null,h.child!==null)switch(h.child.tag){case 5:m=h.child.stateNode;break;case 1:m=h.child.stateNode}Ab(h,R,m)}break;case 5:var M=h.stateNode;if(m===null&&h.flags&4){m=M;var W=h.memoizedProps;switch(h.type){case"button":case"input":case"select":case"textarea":W.autoFocus&&m.focus();break;case"img":W.src&&(m.src=W.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(h.memoizedState===null){var ae=h.alternate;if(ae!==null){var ge=ae.memoizedState;if(ge!==null){var ve=ge.dehydrated;ve!==null&&Zl(ve)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Wn||h.flags&512&&h0(h)}catch(pe){Gt(h,h.return,pe)}}if(h===c){Ne=null;break}if(m=h.sibling,m!==null){m.return=h.return,Ne=m;break}Ne=h.return}}function AC(c){for(;Ne!==null;){var h=Ne;if(h===c){Ne=null;break}var m=h.sibling;if(m!==null){m.return=h.return,Ne=m;break}Ne=h.return}}function DC(c){for(;Ne!==null;){var h=Ne;try{switch(h.tag){case 0:case 11:case 15:var m=h.return;try{bd(4,h)}catch(W){Gt(h,m,W)}break;case 1:var y=h.stateNode;if(typeof y.componentDidMount=="function"){var k=h.return;try{y.componentDidMount()}catch(W){Gt(h,k,W)}}var I=h.return;try{h0(h)}catch(W){Gt(h,I,W)}break;case 5:var R=h.return;try{h0(h)}catch(W){Gt(h,R,W)}}}catch(W){Gt(h,h.return,W)}if(h===c){Ne=null;break}var M=h.sibling;if(M!==null){M.return=h.return,Ne=M;break}Ne=h.return}}var __=Math.ceil,Cd=S.ReactCurrentDispatcher,p0=S.ReactCurrentOwner,Ls=S.ReactCurrentBatchConfig,ht=0,kn=null,nn=null,Dn=0,Ss=0,Wa=Eo(0),fn=0,bc=null,Si=0,kd=0,m0=0,Cc=null,us=null,g0=0,Ua=1/0,oo=null,Sd=!1,x0=null,Oo=null,Id=!1,zo=null,$d=0,kc=0,y0=null,Td=-1,Nd=0;function Zn(){return(ht&6)!==0?Qt():Td!==-1?Td:Td=Qt()}function Mo(c){return(c.mode&1)===0?1:(ht&2)!==0&&Dn!==0?Dn&-Dn:g_.transition!==null?(Nd===0&&(Nd=Iv()),Nd):(c=wt,c!==0||(c=window.event,c=c===void 0?16:Fv(c.type)),c)}function cr(c,h,m,y){if(50<kc)throw kc=0,y0=null,Error(t(185));Xl(c,m,y),((ht&2)===0||c!==kn)&&(c===kn&&((ht&2)===0&&(kd|=m),fn===4&&Po(c,Dn)),hs(c,y),m===1&&ht===0&&(h.mode&1)===0&&(Ua=Qt()+500,nd&&Ao()))}function hs(c,h){var m=c.callbackNode;gD(c,h);var y=Mh(c,c===kn?Dn:0);if(y===0)m!==null&&Cv(m),c.callbackNode=null,c.callbackPriority=0;else if(h=y&-y,c.callbackPriority!==h){if(m!=null&&Cv(m),h===1)c.tag===0?m_(FC.bind(null,c)):wb(FC.bind(null,c)),h_(function(){(ht&6)===0&&Ao()}),m=null;else{switch($v(y)){case 1:m=Qm;break;case 4:m=kv;break;case 16:m=_h;break;case 536870912:m=Sv;break;default:m=_h}m=WC(m,_C.bind(null,c))}c.callbackPriority=h,c.callbackNode=m}}function _C(c,h){if(Td=-1,Nd=0,(ht&6)!==0)throw Error(t(327));var m=c.callbackNode;if(Ga()&&c.callbackNode!==m)return null;var y=Mh(c,c===kn?Dn:0);if(y===0)return null;if((y&30)!==0||(y&c.expiredLanes)!==0||h)h=Ed(c,y);else{h=y;var k=ht;ht|=2;var I=zC();(kn!==c||Dn!==h)&&(oo=null,Ua=Qt()+500,$i(c,h));do try{z_();break}catch(M){OC(c,M)}while(!0);zg(),Cd.current=I,ht=k,nn!==null?h=0:(kn=null,Dn=0,h=fn)}if(h!==0){if(h===2&&(k=Zm(c),k!==0&&(y=k,h=w0(c,k))),h===1)throw m=bc,$i(c,0),Po(c,y),hs(c,Qt()),m;if(h===6)Po(c,y);else{if(k=c.current.alternate,(y&30)===0&&!F_(k)&&(h=Ed(c,y),h===2&&(I=Zm(c),I!==0&&(y=I,h=w0(c,I))),h===1))throw m=bc,$i(c,0),Po(c,y),hs(c,Qt()),m;switch(c.finishedWork=k,c.finishedLanes=y,h){case 0:case 1:throw Error(t(345));case 2:Ti(c,us,oo);break;case 3:if(Po(c,y),(y&130023424)===y&&(h=g0+500-Qt(),10<h)){if(Mh(c,0)!==0)break;if(k=c.suspendedLanes,(k&y)!==y){Zn(),c.pingedLanes|=c.suspendedLanes&k;break}c.timeoutHandle=Ig(Ti.bind(null,c,us,oo),h);break}Ti(c,us,oo);break;case 4:if(Po(c,y),(y&4194240)===y)break;for(h=c.eventTimes,k=-1;0<y;){var R=31-sr(y);I=1<<R,R=h[R],R>k&&(k=R),y&=~I}if(y=k,y=Qt()-y,y=(120>y?120:480>y?480:1080>y?1080:1920>y?1920:3e3>y?3e3:4320>y?4320:1960*__(y/1960))-y,10<y){c.timeoutHandle=Ig(Ti.bind(null,c,us,oo),y);break}Ti(c,us,oo);break;case 5:Ti(c,us,oo);break;default:throw Error(t(329))}}}return hs(c,Qt()),c.callbackNode===m?_C.bind(null,c):null}function w0(c,h){var m=Cc;return c.current.memoizedState.isDehydrated&&($i(c,h).flags|=256),c=Ed(c,h),c!==2&&(h=us,us=m,h!==null&&v0(h)),c}function v0(c){us===null?us=c:us.push.apply(us,c)}function F_(c){for(var h=c;;){if(h.flags&16384){var m=h.updateQueue;if(m!==null&&(m=m.stores,m!==null))for(var y=0;y<m.length;y++){var k=m[y],I=k.getSnapshot;k=k.value;try{if(!rr(I(),k))return!1}catch{return!1}}}if(m=h.child,h.subtreeFlags&16384&&m!==null)m.return=h,h=m;else{if(h===c)break;for(;h.sibling===null;){if(h.return===null||h.return===c)return!0;h=h.return}h.sibling.return=h.return,h=h.sibling}}return!0}function Po(c,h){for(h&=~m0,h&=~kd,c.suspendedLanes|=h,c.pingedLanes&=~h,c=c.expirationTimes;0<h;){var m=31-sr(h),y=1<<m;c[m]=-1,h&=~y}}function FC(c){if((ht&6)!==0)throw Error(t(327));Ga();var h=Mh(c,0);if((h&1)===0)return hs(c,Qt()),null;var m=Ed(c,h);if(c.tag!==0&&m===2){var y=Zm(c);y!==0&&(h=y,m=w0(c,y))}if(m===1)throw m=bc,$i(c,0),Po(c,h),hs(c,Qt()),m;if(m===6)throw Error(t(345));return c.finishedWork=c.current.alternate,c.finishedLanes=h,Ti(c,us,oo),hs(c,Qt()),null}function b0(c,h){var m=ht;ht|=1;try{return c(h)}finally{ht=m,ht===0&&(Ua=Qt()+500,nd&&Ao())}}function Ii(c){zo!==null&&zo.tag===0&&(ht&6)===0&&Ga();var h=ht;ht|=1;var m=Ls.transition,y=wt;try{if(Ls.transition=null,wt=1,c)return c()}finally{wt=y,Ls.transition=m,ht=h,(ht&6)===0&&Ao()}}function C0(){Ss=Wa.current,Ft(Wa)}function $i(c,h){c.finishedWork=null,c.finishedLanes=0;var m=c.timeoutHandle;if(m!==-1&&(c.timeoutHandle=-1,u_(m)),nn!==null)for(m=nn.return;m!==null;){var y=m;switch(Ag(y),y.tag){case 1:y=y.type.childContextTypes,y!=null&&ed();break;case 3:La(),Ft(as),Ft(Ln),Gg();break;case 5:Wg(y);break;case 4:La();break;case 13:Ft(Wt);break;case 19:Ft(Wt);break;case 10:Mg(y.type._context);break;case 22:case 23:C0()}m=m.return}if(kn=c,nn=c=Lo(c.current,null),Dn=Ss=h,fn=0,bc=null,m0=kd=Si=0,us=Cc=null,bi!==null){for(h=0;h<bi.length;h++)if(m=bi[h],y=m.interleaved,y!==null){m.interleaved=null;var k=y.next,I=m.pending;if(I!==null){var R=I.next;I.next=k,y.next=R}m.pending=y}bi=null}return c}function OC(c,h){do{var m=nn;try{if(zg(),dd.current=gd,fd){for(var y=Ut.memoizedState;y!==null;){var k=y.queue;k!==null&&(k.pending=null),y=y.next}fd=!1}if(ki=0,Cn=dn=Ut=null,mc=!1,gc=0,p0.current=null,m===null||m.return===null){fn=1,bc=h,nn=null;break}e:{var I=c,R=m.return,M=m,W=h;if(h=Dn,M.flags|=32768,W!==null&&typeof W=="object"&&typeof W.then=="function"){var ae=W,ge=M,ve=ge.tag;if((ge.mode&1)===0&&(ve===0||ve===11||ve===15)){var pe=ge.alternate;pe?(ge.updateQueue=pe.updateQueue,ge.memoizedState=pe.memoizedState,ge.lanes=pe.lanes):(ge.updateQueue=null,ge.memoizedState=null)}var $e=iC(R);if($e!==null){$e.flags&=-257,aC($e,R,M,I,h),$e.mode&1&&oC(I,ae,h),h=$e,W=ae;var Re=h.updateQueue;if(Re===null){var _e=new Set;_e.add(W),h.updateQueue=_e}else Re.add(W);break e}else{if((h&1)===0){oC(I,ae,h),k0();break e}W=Error(t(426))}}else if(Pt&&M.mode&1){var Zt=iC(R);if(Zt!==null){(Zt.flags&65536)===0&&(Zt.flags|=256),aC(Zt,R,M,I,h),Fg(Ba(W,M));break e}}I=W=Ba(W,M),fn!==4&&(fn=2),Cc===null?Cc=[I]:Cc.push(I),I=R;do{switch(I.tag){case 3:I.flags|=65536,h&=-h,I.lanes|=h;var ne=sC(I,W,h);Rb(I,ne);break e;case 1:M=W;var q=I.type,re=I.stateNode;if((I.flags&128)===0&&(typeof q.getDerivedStateFromError=="function"||re!==null&&typeof re.componentDidCatch=="function"&&(Oo===null||!Oo.has(re)))){I.flags|=65536,h&=-h,I.lanes|=h;var Ce=rC(I,M,h);Rb(I,Ce);break e}}I=I.return}while(I!==null)}PC(m)}catch(Fe){h=Fe,nn===m&&m!==null&&(nn=m=m.return);continue}break}while(!0)}function zC(){var c=Cd.current;return Cd.current=gd,c===null?gd:c}function k0(){(fn===0||fn===3||fn===2)&&(fn=4),kn===null||(Si&268435455)===0&&(kd&268435455)===0||Po(kn,Dn)}function Ed(c,h){var m=ht;ht|=2;var y=zC();(kn!==c||Dn!==h)&&(oo=null,$i(c,h));do try{O_();break}catch(k){OC(c,k)}while(!0);if(zg(),ht=m,Cd.current=y,nn!==null)throw Error(t(261));return kn=null,Dn=0,fn}function O_(){for(;nn!==null;)MC(nn)}function z_(){for(;nn!==null&&!aD();)MC(nn)}function MC(c){var h=VC(c.alternate,c,Ss);c.memoizedProps=c.pendingProps,h===null?PC(c):nn=h,p0.current=null}function PC(c){var h=c;do{var m=h.alternate;if(c=h.return,(h.flags&32768)===0){if(m=N_(m,h,Ss),m!==null){nn=m;return}}else{if(m=E_(m,h),m!==null){m.flags&=32767,nn=m;return}if(c!==null)c.flags|=32768,c.subtreeFlags=0,c.deletions=null;else{fn=6,nn=null;return}}if(h=h.sibling,h!==null){nn=h;return}nn=h=c}while(h!==null);fn===0&&(fn=5)}function Ti(c,h,m){var y=wt,k=Ls.transition;try{Ls.transition=null,wt=1,M_(c,h,m,y)}finally{Ls.transition=k,wt=y}return null}function M_(c,h,m,y){do Ga();while(zo!==null);if((ht&6)!==0)throw Error(t(327));m=c.finishedWork;var k=c.finishedLanes;if(m===null)return null;if(c.finishedWork=null,c.finishedLanes=0,m===c.current)throw Error(t(177));c.callbackNode=null,c.callbackPriority=0;var I=m.lanes|m.childLanes;if(xD(c,I),c===kn&&(nn=kn=null,Dn=0),(m.subtreeFlags&2064)===0&&(m.flags&2064)===0||Id||(Id=!0,WC(_h,function(){return Ga(),null})),I=(m.flags&15990)!==0,(m.subtreeFlags&15990)!==0||I){I=Ls.transition,Ls.transition=null;var R=wt;wt=1;var M=ht;ht|=4,p0.current=null,A_(c,m),NC(m,c),s_(kg),Bh=!!Cg,kg=Cg=null,c.current=m,D_(m),lD(),ht=M,wt=R,Ls.transition=I}else c.current=m;if(Id&&(Id=!1,zo=c,$d=k),I=c.pendingLanes,I===0&&(Oo=null),hD(m.stateNode),hs(c,Qt()),h!==null)for(y=c.onRecoverableError,m=0;m<h.length;m++)k=h[m],y(k.value,{componentStack:k.stack,digest:k.digest});if(Sd)throw Sd=!1,c=x0,x0=null,c;return($d&1)!==0&&c.tag!==0&&Ga(),I=c.pendingLanes,(I&1)!==0?c===y0?kc++:(kc=0,y0=c):kc=0,Ao(),null}function Ga(){if(zo!==null){var c=$v($d),h=Ls.transition,m=wt;try{if(Ls.transition=null,wt=16>c?16:c,zo===null)var y=!1;else{if(c=zo,zo=null,$d=0,(ht&6)!==0)throw Error(t(331));var k=ht;for(ht|=4,Ne=c.current;Ne!==null;){var I=Ne,R=I.child;if((Ne.flags&16)!==0){var M=I.deletions;if(M!==null){for(var W=0;W<M.length;W++){var ae=M[W];for(Ne=ae;Ne!==null;){var ge=Ne;switch(ge.tag){case 0:case 11:case 15:vc(8,ge,I)}var ve=ge.child;if(ve!==null)ve.return=ge,Ne=ve;else for(;Ne!==null;){ge=Ne;var pe=ge.sibling,$e=ge.return;if(kC(ge),ge===ae){Ne=null;break}if(pe!==null){pe.return=$e,Ne=pe;break}Ne=$e}}}var Re=I.alternate;if(Re!==null){var _e=Re.child;if(_e!==null){Re.child=null;do{var Zt=_e.sibling;_e.sibling=null,_e=Zt}while(_e!==null)}}Ne=I}}if((I.subtreeFlags&2064)!==0&&R!==null)R.return=I,Ne=R;else e:for(;Ne!==null;){if(I=Ne,(I.flags&2048)!==0)switch(I.tag){case 0:case 11:case 15:vc(9,I,I.return)}var ne=I.sibling;if(ne!==null){ne.return=I.return,Ne=ne;break e}Ne=I.return}}var q=c.current;for(Ne=q;Ne!==null;){R=Ne;var re=R.child;if((R.subtreeFlags&2064)!==0&&re!==null)re.return=R,Ne=re;else e:for(R=q;Ne!==null;){if(M=Ne,(M.flags&2048)!==0)try{switch(M.tag){case 0:case 11:case 15:bd(9,M)}}catch(Fe){Gt(M,M.return,Fe)}if(M===R){Ne=null;break e}var Ce=M.sibling;if(Ce!==null){Ce.return=M.return,Ne=Ce;break e}Ne=M.return}}if(ht=k,Ao(),Ir&&typeof Ir.onPostCommitFiberRoot=="function")try{Ir.onPostCommitFiberRoot(Fh,c)}catch{}y=!0}return y}finally{wt=m,Ls.transition=h}}return!1}function LC(c,h,m){h=Ba(m,h),h=sC(c,h,1),c=_o(c,h,1),h=Zn(),c!==null&&(Xl(c,1,h),hs(c,h))}function Gt(c,h,m){if(c.tag===3)LC(c,c,m);else for(;h!==null;){if(h.tag===3){LC(h,c,m);break}else if(h.tag===1){var y=h.stateNode;if(typeof h.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(Oo===null||!Oo.has(y))){c=Ba(m,c),c=rC(h,c,1),h=_o(h,c,1),c=Zn(),h!==null&&(Xl(h,1,c),hs(h,c));break}}h=h.return}}function P_(c,h,m){var y=c.pingCache;y!==null&&y.delete(h),h=Zn(),c.pingedLanes|=c.suspendedLanes&m,kn===c&&(Dn&m)===m&&(fn===4||fn===3&&(Dn&130023424)===Dn&&500>Qt()-g0?$i(c,0):m0|=m),hs(c,h)}function BC(c,h){h===0&&((c.mode&1)===0?h=1:(h=zh,zh<<=1,(zh&130023424)===0&&(zh=4194304)));var m=Zn();c=no(c,h),c!==null&&(Xl(c,h,m),hs(c,m))}function L_(c){var h=c.memoizedState,m=0;h!==null&&(m=h.retryLane),BC(c,m)}function B_(c,h){var m=0;switch(c.tag){case 13:var y=c.stateNode,k=c.memoizedState;k!==null&&(m=k.retryLane);break;case 19:y=c.stateNode;break;default:throw Error(t(314))}y!==null&&y.delete(h),BC(c,m)}var VC;VC=function(c,h,m){if(c!==null)if(c.memoizedProps!==h.pendingProps||as.current)cs=!0;else{if((c.lanes&m)===0&&(h.flags&128)===0)return cs=!1,T_(c,h,m);cs=(c.flags&131072)!==0}else cs=!1,Pt&&(h.flags&1048576)!==0&&vb(h,rd,h.index);switch(h.lanes=0,h.tag){case 2:var y=h.type;wd(c,h),c=h.pendingProps;var k=Da(h,Ln.current);Pa(h,m),k=Xg(null,h,y,c,k,m);var I=Kg();return h.flags|=1,typeof k=="object"&&k!==null&&typeof k.render=="function"&&k.$$typeof===void 0?(h.tag=1,h.memoizedState=null,h.updateQueue=null,ls(y)?(I=!0,td(h)):I=!1,h.memoizedState=k.state!==null&&k.state!==void 0?k.state:null,Bg(h),k.updater=xd,h.stateNode=k,k._reactInternals=h,e0(h,y,c,m),h=r0(null,h,y,!0,I,m)):(h.tag=0,Pt&&I&&Rg(h),Qn(null,h,k,m),h=h.child),h;case 16:y=h.elementType;e:{switch(wd(c,h),c=h.pendingProps,k=y._init,y=k(y._payload),h.type=y,k=h.tag=W_(y),c=ir(y,c),k){case 0:h=s0(null,h,y,c,m);break e;case 1:h=fC(null,h,y,c,m);break e;case 11:h=lC(null,h,y,c,m);break e;case 14:h=cC(null,h,y,ir(y.type,c),m);break e}throw Error(t(306,y,""))}return h;case 0:return y=h.type,k=h.pendingProps,k=h.elementType===y?k:ir(y,k),s0(c,h,y,k,m);case 1:return y=h.type,k=h.pendingProps,k=h.elementType===y?k:ir(y,k),fC(c,h,y,k,m);case 3:e:{if(pC(h),c===null)throw Error(t(387));y=h.pendingProps,I=h.memoizedState,k=I.element,Eb(c,h),ud(h,y,null,m);var R=h.memoizedState;if(y=R.element,I.isDehydrated)if(I={element:y,isDehydrated:!1,cache:R.cache,pendingSuspenseBoundaries:R.pendingSuspenseBoundaries,transitions:R.transitions},h.updateQueue.baseState=I,h.memoizedState=I,h.flags&256){k=Ba(Error(t(423)),h),h=mC(c,h,y,m,k);break e}else if(y!==k){k=Ba(Error(t(424)),h),h=mC(c,h,y,m,k);break e}else for(ks=No(h.stateNode.containerInfo.firstChild),Cs=h,Pt=!0,or=null,m=Tb(h,null,y,m),h.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling;else{if(Oa(),y===k){h=ro(c,h,m);break e}Qn(c,h,y,m)}h=h.child}return h;case 5:return Db(h),c===null&&_g(h),y=h.type,k=h.pendingProps,I=c!==null?c.memoizedProps:null,R=k.children,Sg(y,k)?R=null:I!==null&&Sg(y,I)&&(h.flags|=32),dC(c,h),Qn(c,h,R,m),h.child;case 6:return c===null&&_g(h),null;case 13:return gC(c,h,m);case 4:return Vg(h,h.stateNode.containerInfo),y=h.pendingProps,c===null?h.child=za(h,null,y,m):Qn(c,h,y,m),h.child;case 11:return y=h.type,k=h.pendingProps,k=h.elementType===y?k:ir(y,k),lC(c,h,y,k,m);case 7:return Qn(c,h,h.pendingProps,m),h.child;case 8:return Qn(c,h,h.pendingProps.children,m),h.child;case 12:return Qn(c,h,h.pendingProps.children,m),h.child;case 10:e:{if(y=h.type._context,k=h.pendingProps,I=h.memoizedProps,R=k.value,Rt(ad,y._currentValue),y._currentValue=R,I!==null)if(rr(I.value,R)){if(I.children===k.children&&!as.current){h=ro(c,h,m);break e}}else for(I=h.child,I!==null&&(I.return=h);I!==null;){var M=I.dependencies;if(M!==null){R=I.child;for(var W=M.firstContext;W!==null;){if(W.context===y){if(I.tag===1){W=so(-1,m&-m),W.tag=2;var ae=I.updateQueue;if(ae!==null){ae=ae.shared;var ge=ae.pending;ge===null?W.next=W:(W.next=ge.next,ge.next=W),ae.pending=W}}I.lanes|=m,W=I.alternate,W!==null&&(W.lanes|=m),Pg(I.return,m,h),M.lanes|=m;break}W=W.next}}else if(I.tag===10)R=I.type===h.type?null:I.child;else if(I.tag===18){if(R=I.return,R===null)throw Error(t(341));R.lanes|=m,M=R.alternate,M!==null&&(M.lanes|=m),Pg(R,m,h),R=I.sibling}else R=I.child;if(R!==null)R.return=I;else for(R=I;R!==null;){if(R===h){R=null;break}if(I=R.sibling,I!==null){I.return=R.return,R=I;break}R=R.return}I=R}Qn(c,h,k.children,m),h=h.child}return h;case 9:return k=h.type,y=h.pendingProps.children,Pa(h,m),k=Ms(k),y=y(k),h.flags|=1,Qn(c,h,y,m),h.child;case 14:return y=h.type,k=ir(y,h.pendingProps),k=ir(y.type,k),cC(c,h,y,k,m);case 15:return uC(c,h,h.type,h.pendingProps,m);case 17:return y=h.type,k=h.pendingProps,k=h.elementType===y?k:ir(y,k),wd(c,h),h.tag=1,ls(y)?(c=!0,td(h)):c=!1,Pa(h,m),tC(h,y,k),e0(h,y,k,m),r0(null,h,y,!0,c,m);case 19:return yC(c,h,m);case 22:return hC(c,h,m)}throw Error(t(156,h.tag))};function WC(c,h){return bv(c,h)}function V_(c,h,m,y){this.tag=c,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=h,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Bs(c,h,m,y){return new V_(c,h,m,y)}function S0(c){return c=c.prototype,!(!c||!c.isReactComponent)}function W_(c){if(typeof c=="function")return S0(c)?1:0;if(c!=null){if(c=c.$$typeof,c===L)return 11;if(c===K)return 14}return 2}function Lo(c,h){var m=c.alternate;return m===null?(m=Bs(c.tag,h,c.key,c.mode),m.elementType=c.elementType,m.type=c.type,m.stateNode=c.stateNode,m.alternate=c,c.alternate=m):(m.pendingProps=h,m.type=c.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=c.flags&14680064,m.childLanes=c.childLanes,m.lanes=c.lanes,m.child=c.child,m.memoizedProps=c.memoizedProps,m.memoizedState=c.memoizedState,m.updateQueue=c.updateQueue,h=c.dependencies,m.dependencies=h===null?null:{lanes:h.lanes,firstContext:h.firstContext},m.sibling=c.sibling,m.index=c.index,m.ref=c.ref,m}function Rd(c,h,m,y,k,I){var R=2;if(y=c,typeof c=="function")S0(c)&&(R=1);else if(typeof c=="string")R=5;else e:switch(c){case A:return Ni(m.children,k,I,h);case F:R=8,k|=8;break;case D:return c=Bs(12,m,h,k|2),c.elementType=D,c.lanes=I,c;case G:return c=Bs(13,m,h,k),c.elementType=G,c.lanes=I,c;case Q:return c=Bs(19,m,h,k),c.elementType=Q,c.lanes=I,c;case te:return Ad(m,k,I,h);default:if(typeof c=="object"&&c!==null)switch(c.$$typeof){case _:R=10;break e;case N:R=9;break e;case L:R=11;break e;case K:R=14;break e;case Z:R=16,y=null;break e}throw Error(t(130,c==null?c:typeof c,""))}return h=Bs(R,m,h,k),h.elementType=c,h.type=y,h.lanes=I,h}function Ni(c,h,m,y){return c=Bs(7,c,y,h),c.lanes=m,c}function Ad(c,h,m,y){return c=Bs(22,c,y,h),c.elementType=te,c.lanes=m,c.stateNode={isHidden:!1},c}function I0(c,h,m){return c=Bs(6,c,null,h),c.lanes=m,c}function $0(c,h,m){return h=Bs(4,c.children!==null?c.children:[],c.key,h),h.lanes=m,h.stateNode={containerInfo:c.containerInfo,pendingChildren:null,implementation:c.implementation},h}function U_(c,h,m,y,k){this.tag=h,this.containerInfo=c,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Jm(0),this.expirationTimes=Jm(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Jm(0),this.identifierPrefix=y,this.onRecoverableError=k,this.mutableSourceEagerHydrationData=null}function T0(c,h,m,y,k,I,R,M,W){return c=new U_(c,h,m,M,W),h===1?(h=1,I===!0&&(h|=8)):h=0,I=Bs(3,null,null,h),c.current=I,I.stateNode=c,I.memoizedState={element:y,isDehydrated:m,cache:null,transitions:null,pendingSuspenseBoundaries:null},Bg(I),c}function G_(c,h,m){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:E,key:y==null?null:""+y,children:c,containerInfo:h,implementation:m}}function UC(c){if(!c)return Ro;c=c._reactInternals;e:{if(gi(c)!==c||c.tag!==1)throw Error(t(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break e;case 1:if(ls(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break e}}h=h.return}while(h!==null);throw Error(t(171))}if(c.tag===1){var m=c.type;if(ls(m))return xb(c,m,h)}return h}function GC(c,h,m,y,k,I,R,M,W){return c=T0(m,y,!0,c,k,I,R,M,W),c.context=UC(null),m=c.current,y=Zn(),k=Mo(m),I=so(y,k),I.callback=h??null,_o(m,I,k),c.current.lanes=k,Xl(c,k,y),hs(c,y),c}function Dd(c,h,m,y){var k=h.current,I=Zn(),R=Mo(k);return m=UC(m),h.context===null?h.context=m:h.pendingContext=m,h=so(I,R),h.payload={element:c},y=y===void 0?null:y,y!==null&&(h.callback=y),c=_o(k,h,R),c!==null&&(cr(c,k,R,I),cd(c,k,R)),R}function _d(c){if(c=c.current,!c.child)return null;switch(c.child.tag){case 5:return c.child.stateNode;default:return c.child.stateNode}}function HC(c,h){if(c=c.memoizedState,c!==null&&c.dehydrated!==null){var m=c.retryLane;c.retryLane=m!==0&&m<h?m:h}}function N0(c,h){HC(c,h),(c=c.alternate)&&HC(c,h)}function H_(){return null}var jC=typeof reportError=="function"?reportError:function(c){console.error(c)};function E0(c){this._internalRoot=c}Fd.prototype.render=E0.prototype.render=function(c){var h=this._internalRoot;if(h===null)throw Error(t(409));Dd(c,h,null,null)},Fd.prototype.unmount=E0.prototype.unmount=function(){var c=this._internalRoot;if(c!==null){this._internalRoot=null;var h=c.containerInfo;Ii(function(){Dd(null,c,null,null)}),h[Zr]=null}};function Fd(c){this._internalRoot=c}Fd.prototype.unstable_scheduleHydration=function(c){if(c){var h=Ev();c={blockedOn:null,target:c,priority:h};for(var m=0;m<Io.length&&h!==0&&h<Io[m].priority;m++);Io.splice(m,0,c),m===0&&Dv(c)}};function R0(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)}function Od(c){return!(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11&&(c.nodeType!==8||c.nodeValue!==" react-mount-point-unstable "))}function XC(){}function j_(c,h,m,y,k){if(k){if(typeof y=="function"){var I=y;y=function(){var ae=_d(R);I.call(ae)}}var R=GC(h,y,c,0,null,!1,!1,"",XC);return c._reactRootContainer=R,c[Zr]=R.current,ac(c.nodeType===8?c.parentNode:c),Ii(),R}for(;k=c.lastChild;)c.removeChild(k);if(typeof y=="function"){var M=y;y=function(){var ae=_d(W);M.call(ae)}}var W=T0(c,0,!1,null,null,!1,!1,"",XC);return c._reactRootContainer=W,c[Zr]=W.current,ac(c.nodeType===8?c.parentNode:c),Ii(function(){Dd(h,W,m,y)}),W}function zd(c,h,m,y,k){var I=m._reactRootContainer;if(I){var R=I;if(typeof k=="function"){var M=k;k=function(){var W=_d(R);M.call(W)}}Dd(h,R,c,k)}else R=j_(m,h,c,k,y);return _d(R)}Tv=function(c){switch(c.tag){case 3:var h=c.stateNode;if(h.current.memoizedState.isDehydrated){var m=jl(h.pendingLanes);m!==0&&(eg(h,m|1),hs(h,Qt()),(ht&6)===0&&(Ua=Qt()+500,Ao()))}break;case 13:Ii(function(){var y=no(c,1);if(y!==null){var k=Zn();cr(y,c,1,k)}}),N0(c,1)}},tg=function(c){if(c.tag===13){var h=no(c,134217728);if(h!==null){var m=Zn();cr(h,c,134217728,m)}N0(c,134217728)}},Nv=function(c){if(c.tag===13){var h=Mo(c),m=no(c,h);if(m!==null){var y=Zn();cr(m,c,h,y)}N0(c,h)}},Ev=function(){return wt},Rv=function(c,h){var m=wt;try{return wt=c,h()}finally{wt=m}},Xm=function(c,h,m){switch(h){case"input":if(ut(c,m),h=m.name,m.type==="radio"&&h!=null){for(m=c;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll("input[name="+JSON.stringify(""+h)+'][type="radio"]'),h=0;h<m.length;h++){var y=m[h];if(y!==c&&y.form===c.form){var k=Jh(y);if(!k)throw Error(t(90));Ve(y),ut(y,k)}}}break;case"textarea":is(c,m);break;case"select":h=m.value,h!=null&&bn(c,!!m.multiple,h,!1)}},pv=b0,mv=Ii;var X_={usingClientEntryPoint:!1,Events:[uc,Ra,Jh,dv,fv,b0]},Sc={findFiberByHostInstance:xi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},K_={bundleType:Sc.bundleType,version:Sc.version,rendererPackageName:Sc.rendererPackageName,rendererConfig:Sc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:S.ReactCurrentDispatcher,findHostInstanceByFiber:function(c){return c=wv(c),c===null?null:c.stateNode},findFiberByHostInstance:Sc.findFiberByHostInstance||H_,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Md=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Md.isDisabled&&Md.supportsFiber)try{Fh=Md.inject(K_),Ir=Md}catch{}}return ds.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X_,ds.createPortal=function(c,h){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!R0(h))throw Error(t(200));return G_(c,h,null,m)},ds.createRoot=function(c,h){if(!R0(c))throw Error(t(299));var m=!1,y="",k=jC;return h!=null&&(h.unstable_strictMode===!0&&(m=!0),h.identifierPrefix!==void 0&&(y=h.identifierPrefix),h.onRecoverableError!==void 0&&(k=h.onRecoverableError)),h=T0(c,1,!1,null,null,m,!1,y,k),c[Zr]=h.current,ac(c.nodeType===8?c.parentNode:c),new E0(h)},ds.findDOMNode=function(c){if(c==null)return null;if(c.nodeType===1)return c;var h=c._reactInternals;if(h===void 0)throw typeof c.render=="function"?Error(t(188)):(c=Object.keys(c).join(","),Error(t(268,c)));return c=wv(h),c=c===null?null:c.stateNode,c},ds.flushSync=function(c){return Ii(c)},ds.hydrate=function(c,h,m){if(!Od(h))throw Error(t(200));return zd(null,c,h,!0,m)},ds.hydrateRoot=function(c,h,m){if(!R0(c))throw Error(t(405));var y=m!=null&&m.hydratedSources||null,k=!1,I="",R=jC;if(m!=null&&(m.unstable_strictMode===!0&&(k=!0),m.identifierPrefix!==void 0&&(I=m.identifierPrefix),m.onRecoverableError!==void 0&&(R=m.onRecoverableError)),h=GC(h,null,c,1,m??null,k,!1,I,R),c[Zr]=h.current,ac(c),y)for(c=0;c<y.length;c++)m=y[c],k=m._getVersion,k=k(m._source),h.mutableSourceEagerHydrationData==null?h.mutableSourceEagerHydrationData=[m,k]:h.mutableSourceEagerHydrationData.push(m,k);return new Fd(h)},ds.render=function(c,h,m){if(!Od(h))throw Error(t(200));return zd(null,c,h,!1,m)},ds.unmountComponentAtNode=function(c){if(!Od(c))throw Error(t(40));return c._reactRootContainer?(Ii(function(){zd(null,null,c,!1,function(){c._reactRootContainer=null,c[Zr]=null})}),!0):!1},ds.unstable_batchedUpdates=b0,ds.unstable_renderSubtreeIntoContainer=function(c,h,m,y){if(!Od(m))throw Error(t(200));if(c==null||c._reactInternals===void 0)throw Error(t(38));return zd(c,h,m,!1,y)},ds.version="18.3.1-next-f1338f8080-20240426",ds}var tk;function iF(){if(tk)return _0.exports;tk=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),_0.exports=oF(),_0.exports}var nk;function aF(){if(nk)return Pd;nk=1;var n=iF();return Pd.createRoot=n.createRoot,Pd.hydrateRoot=n.hydrateRoot,Pd}var lF=aF();const cF=dy(lF);var jn=function(){return jn=Object.assign||function(e){for(var t,s=1,r=arguments.length;s<r;s++){t=arguments[s];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},jn.apply(this,arguments)};function jc(n,e,t){if(t||arguments.length===2)for(var s=0,r=e.length,o;s<r;s++)(o||!(s in e))&&(o||(o=Array.prototype.slice.call(e,0,s)),o[s]=e[s]);return n.concat(o||Array.prototype.slice.call(e))}var Ot="-ms-",Wc="-moz-",gt="-webkit-",S2="comm",ap="rule",py="decl",uF="@import",I2="@keyframes",hF="@layer",$2=Math.abs,my=String.fromCharCode,px=Object.assign;function dF(n,e){return In(n,0)^45?(((e<<2^In(n,0))<<2^In(n,1))<<2^In(n,2))<<2^In(n,3):0}function T2(n){return n.trim()}function ao(n,e){return(n=e.exec(n))?n[0]:n}function Qe(n,e,t){return n.replace(e,t)}function tf(n,e,t){return n.indexOf(e,t)}function In(n,e){return n.charCodeAt(e)|0}function cl(n,e,t){return n.slice(e,t)}function Dr(n){return n.length}function N2(n){return n.length}function Dc(n,e){return e.push(n),n}function fF(n,e){return n.map(e).join("")}function sk(n,e){return n.filter(function(t){return!ao(t,e)})}var lp=1,ul=1,E2=0,Ys=0,sn=0,$l="";function cp(n,e,t,s,r,o,i,a){return{value:n,root:e,parent:t,type:s,props:r,children:o,line:lp,column:ul,length:i,return:"",siblings:a}}function Vo(n,e){return px(cp("",null,null,"",null,null,0,n.siblings),n,{length:-n.length},e)}function Ha(n){for(;n.root;)n=Vo(n.root,{children:[n]});Dc(n,n.siblings)}function pF(){return sn}function mF(){return sn=Ys>0?In($l,--Ys):0,ul--,sn===10&&(ul=1,lp--),sn}function gr(){return sn=Ys<E2?In($l,Ys++):0,ul++,sn===10&&(ul=1,lp++),sn}function Wi(){return In($l,Ys)}function nf(){return Ys}function up(n,e){return cl($l,n,e)}function mx(n){switch(n){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function gF(n){return lp=ul=1,E2=Dr($l=n),Ys=0,[]}function xF(n){return $l="",n}function z0(n){return T2(up(Ys-1,gx(n===91?n+2:n===40?n+1:n)))}function yF(n){for(;(sn=Wi())&&sn<33;)gr();return mx(n)>2||mx(sn)>3?"":" "}function wF(n,e){for(;--e&&gr()&&!(sn<48||sn>102||sn>57&&sn<65||sn>70&&sn<97););return up(n,nf()+(e<6&&Wi()==32&&gr()==32))}function gx(n){for(;gr();)switch(sn){case n:return Ys;case 34:case 39:n!==34&&n!==39&&gx(sn);break;case 40:n===41&&gx(n);break;case 92:gr();break}return Ys}function vF(n,e){for(;gr()&&n+sn!==57;)if(n+sn===84&&Wi()===47)break;return"/*"+up(e,Ys-1)+"*"+my(n===47?n:gr())}function bF(n){for(;!mx(Wi());)gr();return up(n,Ys)}function CF(n){return xF(sf("",null,null,null,[""],n=gF(n),0,[0],n))}function sf(n,e,t,s,r,o,i,a,l){for(var u=0,d=0,f=i,p=0,g=0,x=0,w=1,v=1,b=1,C=0,$="",S=r,T=o,E=s,A=$;v;)switch(x=C,C=gr()){case 40:if(x!=108&&In(A,f-1)==58){tf(A+=Qe(z0(C),"&","&\f"),"&\f",$2(u?a[u-1]:0))!=-1&&(b=-1);break}case 34:case 39:case 91:A+=z0(C);break;case 9:case 10:case 13:case 32:A+=yF(x);break;case 92:A+=wF(nf()-1,7);continue;case 47:switch(Wi()){case 42:case 47:Dc(kF(vF(gr(),nf()),e,t,l),l);break;default:A+="/"}break;case 123*w:a[u++]=Dr(A)*b;case 125*w:case 59:case 0:switch(C){case 0:case 125:v=0;case 59+d:b==-1&&(A=Qe(A,/\f/g,"")),g>0&&Dr(A)-f&&Dc(g>32?ok(A+";",s,t,f-1,l):ok(Qe(A," ","")+";",s,t,f-2,l),l);break;case 59:A+=";";default:if(Dc(E=rk(A,e,t,u,d,r,a,$,S=[],T=[],f,o),o),C===123)if(d===0)sf(A,e,E,E,S,o,f,a,T);else switch(p===99&&In(A,3)===110?100:p){case 100:case 108:case 109:case 115:sf(n,E,E,s&&Dc(rk(n,E,E,0,0,r,a,$,r,S=[],f,T),T),r,T,f,a,s?S:T);break;default:sf(A,E,E,E,[""],T,0,a,T)}}u=d=g=0,w=b=1,$=A="",f=i;break;case 58:f=1+Dr(A),g=x;default:if(w<1){if(C==123)--w;else if(C==125&&w++==0&&mF()==125)continue}switch(A+=my(C),C*w){case 38:b=d>0?1:(A+="\f",-1);break;case 44:a[u++]=(Dr(A)-1)*b,b=1;break;case 64:Wi()===45&&(A+=z0(gr())),p=Wi(),d=f=Dr($=A+=bF(nf())),C++;break;case 45:x===45&&Dr(A)==2&&(w=0)}}return o}function rk(n,e,t,s,r,o,i,a,l,u,d,f){for(var p=r-1,g=r===0?o:[""],x=N2(g),w=0,v=0,b=0;w<s;++w)for(var C=0,$=cl(n,p+1,p=$2(v=i[w])),S=n;C<x;++C)(S=T2(v>0?g[C]+" "+$:Qe($,/&\f/g,g[C])))&&(l[b++]=S);return cp(n,e,t,r===0?ap:a,l,u,d,f)}function kF(n,e,t,s){return cp(n,e,t,S2,my(pF()),cl(n,2,-2),0,s)}function ok(n,e,t,s,r){return cp(n,e,t,py,cl(n,0,s),cl(n,s+1,-1),s,r)}function R2(n,e,t){switch(dF(n,e)){case 5103:return gt+"print-"+n+n;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return gt+n+n;case 4789:return Wc+n+n;case 5349:case 4246:case 4810:case 6968:case 2756:return gt+n+Wc+n+Ot+n+n;case 5936:switch(In(n,e+11)){case 114:return gt+n+Ot+Qe(n,/[svh]\w+-[tblr]{2}/,"tb")+n;case 108:return gt+n+Ot+Qe(n,/[svh]\w+-[tblr]{2}/,"tb-rl")+n;case 45:return gt+n+Ot+Qe(n,/[svh]\w+-[tblr]{2}/,"lr")+n}case 6828:case 4268:case 2903:return gt+n+Ot+n+n;case 6165:return gt+n+Ot+"flex-"+n+n;case 5187:return gt+n+Qe(n,/(\w+).+(:[^]+)/,gt+"box-$1$2"+Ot+"flex-$1$2")+n;case 5443:return gt+n+Ot+"flex-item-"+Qe(n,/flex-|-self/g,"")+(ao(n,/flex-|baseline/)?"":Ot+"grid-row-"+Qe(n,/flex-|-self/g,""))+n;case 4675:return gt+n+Ot+"flex-line-pack"+Qe(n,/align-content|flex-|-self/g,"")+n;case 5548:return gt+n+Ot+Qe(n,"shrink","negative")+n;case 5292:return gt+n+Ot+Qe(n,"basis","preferred-size")+n;case 6060:return gt+"box-"+Qe(n,"-grow","")+gt+n+Ot+Qe(n,"grow","positive")+n;case 4554:return gt+Qe(n,/([^-])(transform)/g,"$1"+gt+"$2")+n;case 6187:return Qe(Qe(Qe(n,/(zoom-|grab)/,gt+"$1"),/(image-set)/,gt+"$1"),n,"")+n;case 5495:case 3959:return Qe(n,/(image-set\([^]*)/,gt+"$1$`$1");case 4968:return Qe(Qe(n,/(.+:)(flex-)?(.*)/,gt+"box-pack:$3"+Ot+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+gt+n+n;case 4200:if(!ao(n,/flex-|baseline/))return Ot+"grid-column-align"+cl(n,e)+n;break;case 2592:case 3360:return Ot+Qe(n,"template-","")+n;case 4384:case 3616:return t&&t.some(function(s,r){return e=r,ao(s.props,/grid-\w+-end/)})?~tf(n+(t=t[e].value),"span",0)?n:Ot+Qe(n,"-start","")+n+Ot+"grid-row-span:"+(~tf(t,"span",0)?ao(t,/\d+/):+ao(t,/\d+/)-+ao(n,/\d+/))+";":Ot+Qe(n,"-start","")+n;case 4896:case 4128:return t&&t.some(function(s){return ao(s.props,/grid-\w+-start/)})?n:Ot+Qe(Qe(n,"-end","-span"),"span ","")+n;case 4095:case 3583:case 4068:case 2532:return Qe(n,/(.+)-inline(.+)/,gt+"$1$2")+n;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Dr(n)-1-e>6)switch(In(n,e+1)){case 109:if(In(n,e+4)!==45)break;case 102:return Qe(n,/(.+:)(.+)-([^]+)/,"$1"+gt+"$2-$3$1"+Wc+(In(n,e+3)==108?"$3":"$2-$3"))+n;case 115:return~tf(n,"stretch",0)?R2(Qe(n,"stretch","fill-available"),e,t)+n:n}break;case 5152:case 5920:return Qe(n,/(.+?):(\d+)(\s*\/\s*(span)?\s*(\d+))?(.*)/,function(s,r,o,i,a,l,u){return Ot+r+":"+o+u+(i?Ot+r+"-span:"+(a?l:+l-+o)+u:"")+n});case 4949:if(In(n,e+6)===121)return Qe(n,":",":"+gt)+n;break;case 6444:switch(In(n,In(n,14)===45?18:11)){case 120:return Qe(n,/(.+:)([^;\s!]+)(;|(\s+)?!.+)?/,"$1"+gt+(In(n,14)===45?"inline-":"")+"box$3$1"+gt+"$2$3$1"+Ot+"$2box$3")+n;case 100:return Qe(n,":",":"+Ot)+n}break;case 5719:case 2647:case 2135:case 3927:case 2391:return Qe(n,"scroll-","scroll-snap-")+n}return n}function Cf(n,e){for(var t="",s=0;s<n.length;s++)t+=e(n[s],s,n,e)||"";return t}function SF(n,e,t,s){switch(n.type){case hF:if(n.children.length)break;case uF:case py:return n.return=n.return||n.value;case S2:return"";case I2:return n.return=n.value+"{"+Cf(n.children,s)+"}";case ap:if(!Dr(n.value=n.props.join(",")))return""}return Dr(t=Cf(n.children,s))?n.return=n.value+"{"+t+"}":""}function IF(n){var e=N2(n);return function(t,s,r,o){for(var i="",a=0;a<e;a++)i+=n[a](t,s,r,o)||"";return i}}function $F(n){return function(e){e.root||(e=e.return)&&n(e)}}function TF(n,e,t,s){if(n.length>-1&&!n.return)switch(n.type){case py:n.return=R2(n.value,n.length,t);return;case I2:return Cf([Vo(n,{value:Qe(n.value,"@","@"+gt)})],s);case ap:if(n.length)return fF(t=n.props,function(r){switch(ao(r,s=/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":Ha(Vo(n,{props:[Qe(r,/:(read-\w+)/,":"+Wc+"$1")]})),Ha(Vo(n,{props:[r]})),px(n,{props:sk(t,s)});break;case"::placeholder":Ha(Vo(n,{props:[Qe(r,/:(plac\w+)/,":"+gt+"input-$1")]})),Ha(Vo(n,{props:[Qe(r,/:(plac\w+)/,":"+Wc+"$1")]})),Ha(Vo(n,{props:[Qe(r,/:(plac\w+)/,Ot+"input-$1")]})),Ha(Vo(n,{props:[r]})),px(n,{props:sk(t,s)});break}return""})}}var NF={animationIterationCount:1,aspectRatio:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},Is={},hl=typeof process<"u"&&Is!==void 0&&(Is.REACT_APP_SC_ATTR||Is.SC_ATTR)||"data-styled",A2="active",D2="data-styled-version",hp="6.1.13",gy=`/*!sc*/
`,kf=typeof window<"u"&&"HTMLElement"in window,EF=!!(typeof SC_DISABLE_SPEEDY=="boolean"?SC_DISABLE_SPEEDY:typeof process<"u"&&Is!==void 0&&Is.REACT_APP_SC_DISABLE_SPEEDY!==void 0&&Is.REACT_APP_SC_DISABLE_SPEEDY!==""?Is.REACT_APP_SC_DISABLE_SPEEDY!=="false"&&Is.REACT_APP_SC_DISABLE_SPEEDY:typeof process<"u"&&Is!==void 0&&Is.SC_DISABLE_SPEEDY!==void 0&&Is.SC_DISABLE_SPEEDY!==""&&Is.SC_DISABLE_SPEEDY!=="false"&&Is.SC_DISABLE_SPEEDY),RF={},dp=Object.freeze([]),dl=Object.freeze({});function _2(n,e,t){return t===void 0&&(t=dl),n.theme!==t.theme&&n.theme||e||t.theme}var F2=new Set(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","tr","track","u","ul","use","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"]),AF=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,DF=/(^-|-$)/g;function ik(n){return n.replace(AF,"-").replace(DF,"")}var _F=/(a)(d)/gi,Ld=52,ak=function(n){return String.fromCharCode(n+(n>25?39:97))};function xx(n){var e,t="";for(e=Math.abs(n);e>Ld;e=e/Ld|0)t=ak(e%Ld)+t;return(ak(e%Ld)+t).replace(_F,"$1-$2")}var M0,O2=5381,tl=function(n,e){for(var t=e.length;t;)n=33*n^e.charCodeAt(--t);return n},z2=function(n){return tl(O2,n)};function M2(n){return xx(z2(n)>>>0)}function FF(n){return n.displayName||n.name||"Component"}function P0(n){return typeof n=="string"&&!0}var P2=typeof Symbol=="function"&&Symbol.for,L2=P2?Symbol.for("react.memo"):60115,OF=P2?Symbol.for("react.forward_ref"):60112,zF={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},MF={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},B2={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},PF=((M0={})[OF]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},M0[L2]=B2,M0);function lk(n){return("type"in(e=n)&&e.type.$$typeof)===L2?B2:"$$typeof"in n?PF[n.$$typeof]:zF;var e}var LF=Object.defineProperty,BF=Object.getOwnPropertyNames,ck=Object.getOwnPropertySymbols,VF=Object.getOwnPropertyDescriptor,WF=Object.getPrototypeOf,uk=Object.prototype;function V2(n,e,t){if(typeof e!="string"){if(uk){var s=WF(e);s&&s!==uk&&V2(n,s,t)}var r=BF(e);ck&&(r=r.concat(ck(e)));for(var o=lk(n),i=lk(e),a=0;a<r.length;++a){var l=r[a];if(!(l in MF||t&&t[l]||i&&l in i||o&&l in o)){var u=VF(e,l);try{LF(n,l,u)}catch{}}}}return n}function fl(n){return typeof n=="function"}function xy(n){return typeof n=="object"&&"styledComponentId"in n}function Li(n,e){return n&&e?"".concat(n," ").concat(e):n||e||""}function yx(n,e){if(n.length===0)return"";for(var t=n[0],s=1;s<n.length;s++)t+=n[s];return t}function Xc(n){return n!==null&&typeof n=="object"&&n.constructor.name===Object.name&&!("props"in n&&n.$$typeof)}function wx(n,e,t){if(t===void 0&&(t=!1),!t&&!Xc(n)&&!Array.isArray(n))return e;if(Array.isArray(e))for(var s=0;s<e.length;s++)n[s]=wx(n[s],e[s]);else if(Xc(e))for(var s in e)n[s]=wx(n[s],e[s]);return n}function yy(n,e){Object.defineProperty(n,"toString",{value:e})}function lu(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return new Error("An error occurred. See https://github.com/styled-components/styled-components/blob/main/packages/styled-components/src/utils/errors.md#".concat(n," for more information.").concat(e.length>0?" Args: ".concat(e.join(", ")):""))}var UF=function(){function n(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}return n.prototype.indexOfGroup=function(e){for(var t=0,s=0;s<e;s++)t+=this.groupSizes[s];return t},n.prototype.insertRules=function(e,t){if(e>=this.groupSizes.length){for(var s=this.groupSizes,r=s.length,o=r;e>=o;)if((o<<=1)<0)throw lu(16,"".concat(e));this.groupSizes=new Uint32Array(o),this.groupSizes.set(s),this.length=o;for(var i=r;i<o;i++)this.groupSizes[i]=0}for(var a=this.indexOfGroup(e+1),l=(i=0,t.length);i<l;i++)this.tag.insertRule(a,t[i])&&(this.groupSizes[e]++,a++)},n.prototype.clearGroup=function(e){if(e<this.length){var t=this.groupSizes[e],s=this.indexOfGroup(e),r=s+t;this.groupSizes[e]=0;for(var o=s;o<r;o++)this.tag.deleteRule(s)}},n.prototype.getGroup=function(e){var t="";if(e>=this.length||this.groupSizes[e]===0)return t;for(var s=this.groupSizes[e],r=this.indexOfGroup(e),o=r+s,i=r;i<o;i++)t+="".concat(this.tag.getRule(i)).concat(gy);return t},n}(),rf=new Map,Sf=new Map,of=1,Bd=function(n){if(rf.has(n))return rf.get(n);for(;Sf.has(of);)of++;var e=of++;return rf.set(n,e),Sf.set(e,n),e},GF=function(n,e){of=e+1,rf.set(n,e),Sf.set(e,n)},HF="style[".concat(hl,"][").concat(D2,'="').concat(hp,'"]'),jF=new RegExp("^".concat(hl,'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)')),XF=function(n,e,t){for(var s,r=t.split(","),o=0,i=r.length;o<i;o++)(s=r[o])&&n.registerName(e,s)},KF=function(n,e){for(var t,s=((t=e.textContent)!==null&&t!==void 0?t:"").split(gy),r=[],o=0,i=s.length;o<i;o++){var a=s[o].trim();if(a){var l=a.match(jF);if(l){var u=0|parseInt(l[1],10),d=l[2];u!==0&&(GF(d,u),XF(n,d,l[3]),n.getTag().insertRules(u,r)),r.length=0}else r.push(a)}}},hk=function(n){for(var e=document.querySelectorAll(HF),t=0,s=e.length;t<s;t++){var r=e[t];r&&r.getAttribute(hl)!==A2&&(KF(n,r),r.parentNode&&r.parentNode.removeChild(r))}};function qF(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:null}var W2=function(n){var e=document.head,t=n||e,s=document.createElement("style"),r=function(a){var l=Array.from(a.querySelectorAll("style[".concat(hl,"]")));return l[l.length-1]}(t),o=r!==void 0?r.nextSibling:null;s.setAttribute(hl,A2),s.setAttribute(D2,hp);var i=qF();return i&&s.setAttribute("nonce",i),t.insertBefore(s,o),s},YF=function(){function n(e){this.element=W2(e),this.element.appendChild(document.createTextNode("")),this.sheet=function(t){if(t.sheet)return t.sheet;for(var s=document.styleSheets,r=0,o=s.length;r<o;r++){var i=s[r];if(i.ownerNode===t)return i}throw lu(17)}(this.element),this.length=0}return n.prototype.insertRule=function(e,t){try{return this.sheet.insertRule(t,e),this.length++,!0}catch{return!1}},n.prototype.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},n.prototype.getRule=function(e){var t=this.sheet.cssRules[e];return t&&t.cssText?t.cssText:""},n}(),QF=function(){function n(e){this.element=W2(e),this.nodes=this.element.childNodes,this.length=0}return n.prototype.insertRule=function(e,t){if(e<=this.length&&e>=0){var s=document.createTextNode(t);return this.element.insertBefore(s,this.nodes[e]||null),this.length++,!0}return!1},n.prototype.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},n.prototype.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},n}(),ZF=function(){function n(e){this.rules=[],this.length=0}return n.prototype.insertRule=function(e,t){return e<=this.length&&(this.rules.splice(e,0,t),this.length++,!0)},n.prototype.deleteRule=function(e){this.rules.splice(e,1),this.length--},n.prototype.getRule=function(e){return e<this.length?this.rules[e]:""},n}(),dk=kf,JF={isServer:!kf,useCSSOMInjection:!EF},If=function(){function n(e,t,s){e===void 0&&(e=dl),t===void 0&&(t={});var r=this;this.options=jn(jn({},JF),e),this.gs=t,this.names=new Map(s),this.server=!!e.isServer,!this.server&&kf&&dk&&(dk=!1,hk(this)),yy(this,function(){return function(o){for(var i=o.getTag(),a=i.length,l="",u=function(f){var p=function(b){return Sf.get(b)}(f);if(p===void 0)return"continue";var g=o.names.get(p),x=i.getGroup(f);if(g===void 0||!g.size||x.length===0)return"continue";var w="".concat(hl,".g").concat(f,'[id="').concat(p,'"]'),v="";g!==void 0&&g.forEach(function(b){b.length>0&&(v+="".concat(b,","))}),l+="".concat(x).concat(w,'{content:"').concat(v,'"}').concat(gy)},d=0;d<a;d++)u(d);return l}(r)})}return n.registerId=function(e){return Bd(e)},n.prototype.rehydrate=function(){!this.server&&kf&&hk(this)},n.prototype.reconstructWithOptions=function(e,t){return t===void 0&&(t=!0),new n(jn(jn({},this.options),e),this.gs,t&&this.names||void 0)},n.prototype.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},n.prototype.getTag=function(){return this.tag||(this.tag=(e=function(t){var s=t.useCSSOMInjection,r=t.target;return t.isServer?new ZF(r):s?new YF(r):new QF(r)}(this.options),new UF(e)));var e},n.prototype.hasNameForId=function(e,t){return this.names.has(e)&&this.names.get(e).has(t)},n.prototype.registerName=function(e,t){if(Bd(e),this.names.has(e))this.names.get(e).add(t);else{var s=new Set;s.add(t),this.names.set(e,s)}},n.prototype.insertRules=function(e,t,s){this.registerName(e,t),this.getTag().insertRules(Bd(e),s)},n.prototype.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},n.prototype.clearRules=function(e){this.getTag().clearGroup(Bd(e)),this.clearNames(e)},n.prototype.clearTag=function(){this.tag=void 0},n}(),eO=/&/g,tO=/^\s*\/\/.*$/gm;function U2(n,e){return n.map(function(t){return t.type==="rule"&&(t.value="".concat(e," ").concat(t.value),t.value=t.value.replaceAll(",",",".concat(e," ")),t.props=t.props.map(function(s){return"".concat(e," ").concat(s)})),Array.isArray(t.children)&&t.type!=="@keyframes"&&(t.children=U2(t.children,e)),t})}function nO(n){var e,t,s,r=dl,o=r.options,i=o===void 0?dl:o,a=r.plugins,l=a===void 0?dp:a,u=function(p,g,x){return x.startsWith(t)&&x.endsWith(t)&&x.replaceAll(t,"").length>0?".".concat(e):p},d=l.slice();d.push(function(p){p.type===ap&&p.value.includes("&")&&(p.props[0]=p.props[0].replace(eO,t).replace(s,u))}),i.prefix&&d.push(TF),d.push(SF);var f=function(p,g,x,w){g===void 0&&(g=""),x===void 0&&(x=""),w===void 0&&(w="&"),e=w,t=g,s=new RegExp("\\".concat(t,"\\b"),"g");var v=p.replace(tO,""),b=CF(x||g?"".concat(x," ").concat(g," { ").concat(v," }"):v);i.namespace&&(b=U2(b,i.namespace));var C=[];return Cf(b,IF(d.concat($F(function($){return C.push($)})))),C};return f.hash=l.length?l.reduce(function(p,g){return g.name||lu(15),tl(p,g.name)},O2).toString():"",f}var sO=new If,vx=nO(),G2=pr.createContext({shouldForwardProp:void 0,styleSheet:sO,stylis:vx});G2.Consumer;pr.createContext(void 0);function bx(){return Le.useContext(G2)}var rO=function(){function n(e,t){var s=this;this.inject=function(r,o){o===void 0&&(o=vx);var i=s.name+o.hash;r.hasNameForId(s.id,i)||r.insertRules(s.id,i,o(s.rules,i,"@keyframes"))},this.name=e,this.id="sc-keyframes-".concat(e),this.rules=t,yy(this,function(){throw lu(12,String(s.name))})}return n.prototype.getName=function(e){return e===void 0&&(e=vx),this.name+e.hash},n}(),oO=function(n){return n>="A"&&n<="Z"};function fk(n){for(var e="",t=0;t<n.length;t++){var s=n[t];if(t===1&&s==="-"&&n[0]==="-")return n;oO(s)?e+="-"+s.toLowerCase():e+=s}return e.startsWith("ms-")?"-"+e:e}var H2=function(n){return n==null||n===!1||n===""},j2=function(n){var e,t,s=[];for(var r in n){var o=n[r];n.hasOwnProperty(r)&&!H2(o)&&(Array.isArray(o)&&o.isCss||fl(o)?s.push("".concat(fk(r),":"),o,";"):Xc(o)?s.push.apply(s,jc(jc(["".concat(r," {")],j2(o),!1),["}"],!1)):s.push("".concat(fk(r),": ").concat((e=r,(t=o)==null||typeof t=="boolean"||t===""?"":typeof t!="number"||t===0||e in NF||e.startsWith("--")?String(t).trim():"".concat(t,"px")),";")))}return s};function jo(n,e,t,s){if(H2(n))return[];if(xy(n))return[".".concat(n.styledComponentId)];if(fl(n)){if(!fl(o=n)||o.prototype&&o.prototype.isReactComponent||!e)return[n];var r=n(e);return jo(r,e,t,s)}var o;return n instanceof rO?t?(n.inject(t,s),[n.getName(s)]):[n]:Xc(n)?j2(n):Array.isArray(n)?Array.prototype.concat.apply(dp,n.map(function(i){return jo(i,e,t,s)})):[n.toString()]}function X2(n){for(var e=0;e<n.length;e+=1){var t=n[e];if(fl(t)&&!xy(t))return!1}return!0}var iO=z2(hp),aO=function(){function n(e,t,s){this.rules=e,this.staticRulesId="",this.isStatic=(s===void 0||s.isStatic)&&X2(e),this.componentId=t,this.baseHash=tl(iO,t),this.baseStyle=s,If.registerId(t)}return n.prototype.generateAndInjectStyles=function(e,t,s){var r=this.baseStyle?this.baseStyle.generateAndInjectStyles(e,t,s):"";if(this.isStatic&&!s.hash)if(this.staticRulesId&&t.hasNameForId(this.componentId,this.staticRulesId))r=Li(r,this.staticRulesId);else{var o=yx(jo(this.rules,e,t,s)),i=xx(tl(this.baseHash,o)>>>0);if(!t.hasNameForId(this.componentId,i)){var a=s(o,".".concat(i),void 0,this.componentId);t.insertRules(this.componentId,i,a)}r=Li(r,i),this.staticRulesId=i}else{for(var l=tl(this.baseHash,s.hash),u="",d=0;d<this.rules.length;d++){var f=this.rules[d];if(typeof f=="string")u+=f;else if(f){var p=yx(jo(f,e,t,s));l=tl(l,p+d),u+=p}}if(u){var g=xx(l>>>0);t.hasNameForId(this.componentId,g)||t.insertRules(this.componentId,g,s(u,".".concat(g),void 0,this.componentId)),r=Li(r,g)}}return r},n}(),wy=pr.createContext(void 0);wy.Consumer;var L0={};function lO(n,e,t){var s=xy(n),r=n,o=!P0(n),i=e.attrs,a=i===void 0?dp:i,l=e.componentId,u=l===void 0?function(S,T){var E=typeof S!="string"?"sc":ik(S);L0[E]=(L0[E]||0)+1;var A="".concat(E,"-").concat(M2(hp+E+L0[E]));return T?"".concat(T,"-").concat(A):A}(e.displayName,e.parentComponentId):l,d=e.displayName,f=d===void 0?function(S){return P0(S)?"styled.".concat(S):"Styled(".concat(FF(S),")")}(n):d,p=e.displayName&&e.componentId?"".concat(ik(e.displayName),"-").concat(e.componentId):e.componentId||u,g=s&&r.attrs?r.attrs.concat(a).filter(Boolean):a,x=e.shouldForwardProp;if(s&&r.shouldForwardProp){var w=r.shouldForwardProp;if(e.shouldForwardProp){var v=e.shouldForwardProp;x=function(S,T){return w(S,T)&&v(S,T)}}else x=w}var b=new aO(t,p,s?r.componentStyle:void 0);function C(S,T){return function(E,A,F){var D=E.attrs,_=E.componentStyle,N=E.defaultProps,L=E.foldedComponentIds,G=E.styledComponentId,Q=E.target,K=pr.useContext(wy),Z=bx(),te=E.shouldForwardProp||Z.shouldForwardProp,B=_2(A,K,N)||dl,H=function(he,de,we){for(var xe,be=jn(jn({},de),{className:void 0,theme:we}),Te=0;Te<he.length;Te+=1){var Pe=fl(xe=he[Te])?xe(be):xe;for(var Ve in Pe)be[Ve]=Ve==="className"?Li(be[Ve],Pe[Ve]):Ve==="style"?jn(jn({},be[Ve]),Pe[Ve]):Pe[Ve]}return de.className&&(be.className=Li(be.className,de.className)),be}(D,A,B),X=H.as||Q,z={};for(var V in H)H[V]===void 0||V[0]==="$"||V==="as"||V==="theme"&&H.theme===B||(V==="forwardedAs"?z.as=H.forwardedAs:te&&!te(V,X)||(z[V]=H[V]));var oe=function(he,de){var we=bx(),xe=he.generateAndInjectStyles(de,we.styleSheet,we.stylis);return xe}(_,H),ue=Li(L,G);return oe&&(ue+=" "+oe),H.className&&(ue+=" "+H.className),z[P0(X)&&!F2.has(X)?"class":"className"]=ue,z.ref=F,Le.createElement(X,z)}($,S,T)}C.displayName=f;var $=pr.forwardRef(C);return $.attrs=g,$.componentStyle=b,$.displayName=f,$.shouldForwardProp=x,$.foldedComponentIds=s?Li(r.foldedComponentIds,r.styledComponentId):"",$.styledComponentId=p,$.target=s?r.target:n,Object.defineProperty($,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(S){this._foldedDefaultProps=s?function(T){for(var E=[],A=1;A<arguments.length;A++)E[A-1]=arguments[A];for(var F=0,D=E;F<D.length;F++)wx(T,D[F],!0);return T}({},r.defaultProps,S):S}}),yy($,function(){return".".concat($.styledComponentId)}),o&&V2($,n,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0}),$}function pk(n,e){for(var t=[n[0]],s=0,r=e.length;s<r;s+=1)t.push(e[s],n[s+1]);return t}var mk=function(n){return Object.assign(n,{isCss:!0})};function K2(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];if(fl(n)||Xc(n))return mk(jo(pk(dp,jc([n],e,!0))));var s=n;return e.length===0&&s.length===1&&typeof s[0]=="string"?jo(s):mk(jo(pk(s,e)))}function Cx(n,e,t){if(t===void 0&&(t=dl),!e)throw lu(1,e);var s=function(r){for(var o=[],i=1;i<arguments.length;i++)o[i-1]=arguments[i];return n(e,t,K2.apply(void 0,jc([r],o,!1)))};return s.attrs=function(r){return Cx(n,e,jn(jn({},t),{attrs:Array.prototype.concat(t.attrs,r).filter(Boolean)}))},s.withConfig=function(r){return Cx(n,e,jn(jn({},t),r))},s}var q2=function(n){return Cx(lO,n)},yn=q2;F2.forEach(function(n){yn[n]=q2(n)});var cO=function(){function n(e,t){this.rules=e,this.componentId=t,this.isStatic=X2(e),If.registerId(this.componentId+1)}return n.prototype.createStyles=function(e,t,s,r){var o=r(yx(jo(this.rules,t,s,r)),""),i=this.componentId+e;s.insertRules(i,i,o)},n.prototype.removeStyles=function(e,t){t.clearRules(this.componentId+e)},n.prototype.renderStyles=function(e,t,s,r){e>2&&If.registerId(this.componentId+e),this.removeStyles(e,s),this.createStyles(e,t,s,r)},n}();function Y2(n){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var s=K2.apply(void 0,jc([n],e,!1)),r="sc-global-".concat(M2(JSON.stringify(s))),o=new cO(s,r),i=function(l){var u=bx(),d=pr.useContext(wy),f=pr.useRef(u.styleSheet.allocateGSInstance(r)).current;return u.styleSheet.server&&a(f,l,u.styleSheet,d,u.stylis),pr.useLayoutEffect(function(){if(!u.styleSheet.server)return a(f,l,u.styleSheet,d,u.stylis),function(){return o.removeStyles(f,u.styleSheet)}},[f,l,u.styleSheet,d,u.stylis]),null};function a(l,u,d,f,p){if(o.isStatic)o.renderStyles(l,RF,d,p);else{var g=jn(jn({},u),{theme:_2(u,f,i.defaultProps)});o.renderStyles(l,g,d,p)}}return pr.memo(i)}const uO=Y2`
:root {
  font-family: 'Press Start 2P', system-ui;
  font-size: 13px;
  line-height: 1.5;
  font-weight: 400;
  color-scheme: light dark;
  color: rgba(255, 255, 255, 0.87);
  background-color: #242424;
  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

input, button {
  font-family: 'Press Start 2P', system-ui;
}

body {
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
  background-color: #242424;
  overscroll-behavior: none;
  background: radial-gradient(ellipse at center, #6B8E23 0%, #6B8E23 64%, #5b791e 100%);
  touch-action: none;
  user-select: none;

  > #root {
    display: flex;
    flex-grow: 1;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 100%;
  }
}
`,hO=yn.div`
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100%;
  background-color: #242424;
  color: #ffffff;
  width: 100%;
`,dO=yn.h1`
  font-family: 'Press Start 2P', cursive;
  font-size: 3rem;
  margin-bottom: 2rem;
  text-align: center;
  @media (max-width: 768px) {
    font-size: 2rem;
  }
`,fO=yn.button`
  font-family: 'Press Start 2P', cursive;
  font-size: 1.5rem;
  padding: 1rem 2rem;
  background-color: #4caf50;
  color: white;
  border: none;
  cursor: pointer;
  transition: background-color 0.3s ease;
  &:hover {
    background-color: #45a049;
  }
  &:focus {
    outline: 2px solid #ffffff;
  }
`,pO=({onPlayClick:n})=>De.jsxs(hO,{children:[De.jsx(dO,{children:"MasterPlan"}),De.jsx(fO,{onClick:n,"aria-label":"Start the game",children:"Play"})]});function mO(n,e){var t=Le.useRef(!1),s=Le.useRef(),r=Le.useRef(n),o=Le.useCallback(function(){return t.current},[]),i=Le.useCallback(function(){t.current=!1,s.current&&clearTimeout(s.current),s.current=setTimeout(function(){t.current=!0,r.current()},e)},[e]),a=Le.useCallback(function(){t.current=null,s.current&&clearTimeout(s.current)},[]);return Le.useEffect(function(){r.current=n},[n]),Le.useEffect(function(){return i(),a},[e]),[o,a,i]}function gO(n,e,t){t===void 0&&(t=[]);var s=mO(n,e),r=s[0],o=s[1],i=s[2];return Le.useEffect(i,t),[r,o]}function Q2(n,e){e===void 0&&(e=!0);var t=Le.useRef(null),s=Le.useRef(!1),r=Le.useRef(n);r.current=n;var o=Le.useCallback(function(a){s.current&&(r.current(a),t.current=requestAnimationFrame(o))},[]),i=Le.useMemo(function(){return[function(){s.current&&(s.current=!1,t.current&&cancelAnimationFrame(t.current))},function(){s.current||(s.current=!0,t.current=requestAnimationFrame(o))},function(){return s.current}]},[]);return Le.useEffect(function(){return e&&i[1](),i[0]},[]),i}const Z2=10,gk=100,cu="layer-default",gs=800,$f=100,Kn=32,Ur=32,Ui=1600,Gi=800,Ks=Ui/Kn,qs=Gi/Ur,xO=Kn*3,yO=10,kx=Kn+yO,xk=gs,wO=250,yk=gs,wk=gs,vO=Kn*5,vk=2e3,bk=Kn/2,nl=Kn*4,J2=1500,bO=1e3,$s=Math.floor(Ks/2),Gs=Math.floor(qs/2);function Tf(n){return n.map(e=>({...e,col:-e.col,row:-e.row}))}function bt(n){return n.reduce((e,t)=>(e[t.type]=(e[t.type]||0)+1,e),{tank:0,warrior:0,archer:0,artillery:0})}function Tt(n){const e={left:0,center:0,right:0,front:0};n.forEach(s=>{s.col<-5?e.left++:s.col>5?e.right++:e.center++,s.row>-5&&e.front++});const t=n.length;return{left:e.left/t,center:e.center/t,right:e.right/t,front:e.front/t}}function Dt(n){return n.length===0?0:n.reduce((t,s)=>t+s.sizeCol*s.sizeRow,0)/(n.length*16)}function en(n){const e=n.map(i=>({x:i.col,y:i.row})),t=e.reduce((i,a)=>i+a.x,0)/e.length,s=e.reduce((i,a)=>i+a.y,0)/e.length,r=Math.sqrt(32*32+18*18);return e.reduce((i,a)=>{const l=a.x-t,u=a.y-s;return i+Math.sqrt(l*l+u*u)},0)/e.length/r}function CO(n,e){const t=n*e;return[{sizeCol:t,sizeRow:1},...Array.from({length:t-1},(s,r)=>({sizeCol:r+1,sizeRow:Math.ceil(t/(r+1))})).filter(s=>s.sizeCol*s.sizeRow<=t),{sizeCol:1,sizeRow:t}]}const vy=[{id:201,col:-12,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance-wait"},{id:202,col:0,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance-wait"},{id:203,col:12,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance-wait"},{id:204,col:-8,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:205,col:8,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:206,col:-16,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:207,col:16,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:208,col:2,row:-8,sizeCol:8,sizeRow:1,type:"artillery",command:"wait-advance"}],kO="Balanced Assault",SO=n=>{const e=bt(n),t=Tt(n),s=1-Math.abs(.25-e.warrior/n.length)-Math.abs(.25-e.archer/n.length)-Math.abs(.25-e.tank/n.length)-Math.abs(.25-e.artillery/n.length),r=(t.left+t.right+t.center)/3,o=1-Math.abs(.5-Dt(n));return(s*.5+r*.3+o*.2)*100},IO=Object.freeze(Object.defineProperty({__proto__:null,name:kO,probabilityScore:SO,units:vy},Symbol.toStringTag,{value:"Module"})),$O=[{id:301,col:-16,row:0,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:302,col:16,row:0,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:303,col:0,row:-4,sizeCol:8,sizeRow:3,type:"artillery",command:"advance-wait"},{id:304,col:-12,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:305,col:12,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:306,col:-8,row:-6,sizeCol:4,sizeRow:3,type:"tank",command:"advance"},{id:307,col:8,row:-6,sizeCol:4,sizeRow:3,type:"tank",command:"advance"}],TO="Anti-Tank Defense",NO=n=>{const e=bt(n),t=Tt(n),s=e.tank/n.length,r=Math.min(s*2,1),o=t.center,i=Dt(n.filter(a=>a.type==="tank"));return(r*.5+o*.3+i*.2)*100},EO=Object.freeze(Object.defineProperty({__proto__:null,name:TO,probabilityScore:NO,units:$O},Symbol.toStringTag,{value:"Module"})),RO=[{id:401,col:-12,row:-2,sizeCol:4,sizeRow:2,type:"tank",command:"flank-left"},{id:402,col:12,row:-2,sizeCol:4,sizeRow:2,type:"tank",command:"flank-right"},{id:403,col:0,row:-6,sizeCol:6,sizeRow:3,type:"artillery",command:"wait-advance"},{id:404,col:-16,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:405,col:16,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:406,col:-8,row:-10,sizeCol:4,sizeRow:3,type:"tank",command:"advance"},{id:407,col:8,row:-10,sizeCol:4,sizeRow:3,type:"tank",command:"advance"},{id:408,col:-4,row:-4,sizeCol:4,sizeRow:2,type:"warrior",command:"advance"},{id:409,col:4,row:-4,sizeCol:4,sizeRow:2,type:"warrior",command:"advance"}],AO="Archer Counter",DO=n=>{const e=bt(n),t=Tt(n),s=e.archer/n.length,r=Math.min(s*2,1),o=Math.max(t.left,t.right),i=1-Dt(n.filter(a=>a.type==="archer"));return(r*.5+o*.3+i*.2)*100},_O=Object.freeze(Object.defineProperty({__proto__:null,name:AO,probabilityScore:DO,units:RO},Symbol.toStringTag,{value:"Module"})),FO=[{id:501,col:-12,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:502,col:12,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:503,col:-8,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"flank-left"},{id:504,col:8,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"flank-right"},{id:505,col:-16,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:506,col:16,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:507,col:0,row:-6,sizeCol:6,sizeRow:3,type:"artillery",command:"wait-advance"},{id:508,col:-4,row:-2,sizeCol:4,sizeRow:2,type:"warrior",command:"advance"},{id:509,col:4,row:-2,sizeCol:4,sizeRow:2,type:"warrior",command:"advance"}],OO="Warrior Blitz",zO=n=>{const e=bt(n),t=Tt(n),s=e.tank/n.length,r=(e.warrior+e.archer)/n.length,o=(1-s)*.5+r*.5,i=t.center,a=1-Dt(n);return(o*.4+i*.4+a*.2)*100},MO=Object.freeze(Object.defineProperty({__proto__:null,name:OO,probabilityScore:zO,units:FO},Symbol.toStringTag,{value:"Module"})),PO=[{id:601,col:-12,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"advance-wait"},{id:602,col:12,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"advance-wait"},{id:603,col:-16,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance"},{id:604,col:16,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance"},{id:605,col:0,row:-8,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"},{id:606,col:-8,row:-10,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:607,col:8,row:-10,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:608,col:0,row:-12,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"},{id:609,col:0,row:-2,sizeCol:8,sizeRow:2,type:"warrior",command:"advance"}],LO="Tank Formation",BO=n=>{const e=bt(n),t=Tt(n),s=(e.warrior+e.archer)/n.length,r=Math.min(s*1.5,1),o=1-t.center,i=1-Dt(n);return(r*.4+o*.4+i*.2)*100},VO=Object.freeze(Object.defineProperty({__proto__:null,name:LO,probabilityScore:BO,units:PO},Symbol.toStringTag,{value:"Module"})),WO=[{id:701,col:-16,row:-4,sizeCol:6,sizeRow:3,type:"artillery",command:"advance"},{id:702,col:16,row:-4,sizeCol:6,sizeRow:3,type:"artillery",command:"advance"},{id:703,col:0,row:0,sizeCol:6,sizeRow:3,type:"tank",command:"advance-wait"},{id:704,col:-8,row:-10,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:705,col:8,row:-10,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:706,col:-12,row:-12,sizeCol:4,sizeRow:3,type:"tank",command:"advance"},{id:707,col:12,row:-12,sizeCol:4,sizeRow:3,type:"tank",command:"advance"},{id:708,col:0,row:-6,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"}],UO="Artillery Strike",GO=n=>{const e=bt(n),t=Tt(n),s=(e.tank+e.artillery)/n.length,r=Math.min(s*2,1),o=Math.max(t.left,t.center,t.right),i=Dt(n);return(r*.4+o*.4+i*.2)*100},HO=Object.freeze(Object.defineProperty({__proto__:null,name:UO,probabilityScore:GO,units:WO},Symbol.toStringTag,{value:"Module"})),jO=[{id:801,col:-16,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:802,col:-8,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:803,col:0,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:804,col:8,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:805,col:16,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:806,col:-12,row:-10,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:807,col:12,row:-10,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:808,col:0,row:-14,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"},{id:809,col:-20,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:810,col:20,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:811,col:-4,row:-8,sizeCol:4,sizeRow:2,type:"warrior",command:"advance"},{id:812,col:4,row:-8,sizeCol:4,sizeRow:2,type:"warrior",command:"advance"}],XO="Archer Ambush",KO=n=>{const e=bt(n),t=Tt(n),s=(e.warrior+e.tank)/n.length,r=Math.min(s*1.5,1),o=t.center+t.front*.5,i=Dt(n);return(r*.4+o*.4+i*.2)*100},qO=Object.freeze(Object.defineProperty({__proto__:null,name:XO,probabilityScore:KO,units:jO},Symbol.toStringTag,{value:"Module"})),YO=[{id:301,col:-16,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:302,col:-8,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:303,col:8,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:304,col:16,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:305,col:-12,row:-4,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"},{id:306,col:12,row:-4,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"},{id:307,col:-8,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:308,col:8,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:309,col:0,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:310,col:-16,row:-2,sizeCol:4,sizeRow:2,type:"warrior",command:"flank-left"},{id:311,col:16,row:-2,sizeCol:4,sizeRow:2,type:"warrior",command:"flank-right"}],QO="Warrior Counter",ZO=n=>{const e=bt(n),t=n.length,s=(e.warrior||0)/t,r=en(n),o=Math.min(s*2,1),i=1-r,a=1-Dt(n.filter(l=>l.type==="warrior"));return(o*.5+i*.3+a*.2)*100},JO=Object.freeze(Object.defineProperty({__proto__:null,name:QO,probabilityScore:ZO,units:YO},Symbol.toStringTag,{value:"Module"})),ez=[{id:301,col:-6,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:302,col:6,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:303,col:-10,row:-4,sizeCol:3,sizeRow:2,type:"warrior",command:"advance"},{id:304,col:-5,row:-4,sizeCol:3,sizeRow:2,type:"warrior",command:"advance"},{id:305,col:0,row:-4,sizeCol:3,sizeRow:2,type:"warrior",command:"advance"},{id:306,col:5,row:-4,sizeCol:3,sizeRow:2,type:"warrior",command:"advance"},{id:307,col:10,row:-4,sizeCol:3,sizeRow:2,type:"warrior",command:"advance"},{id:308,col:-12,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:309,col:0,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:310,col:12,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:311,col:-12,row:-12,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"},{id:312,col:12,row:-12,sizeCol:8,sizeRow:2,type:"artillery",command:"wait-advance"}],tz="Artillery Counter",nz=n=>{const e=bt(n),t=Tt(n),s=Math.min(e.artillery/n.length,.5)*2,r=t.center,o=Dt(n);return(s*.6+r*.2+o*.2)*100},sz=Object.freeze(Object.defineProperty({__proto__:null,name:tz,probabilityScore:nz,units:ez},Symbol.toStringTag,{value:"Module"})),af=[...[...Array(10)].map((n,e)=>({id:e,type:"warrior",col:-2+e%5,row:-4+Math.floor(e/5),sizeCol:2,sizeRow:2,command:"advance"})),...[...Array(5)].map((n,e)=>({id:e+10,type:"archer",col:-2+e,row:-2,sizeCol:2,sizeRow:2,command:"advance"})),...[...Array(3)].map((n,e)=>({id:e+15,type:"artillery",col:-3+e*3,row:0,sizeCol:3,sizeRow:2,command:"advance"})),...[...Array(4)].map((n,e)=>({id:e+18,type:"warrior",col:e<2?-4:4,row:-5+e%2*2,sizeCol:2,sizeRow:2,command:"advance"})),...[...Array(4)].map((n,e)=>({id:e+22,type:"archer",col:e<2?-5:5,row:-4+e%2*2,sizeCol:2,sizeRow:2,command:"advance"}))],rz="Phalanx Formation";function oz(n){const e=bt(af),t=bt(n),s=Tt(af),r=Tt(n),o=en(af),i=en(n);let a=.5;return a+=(e.warrior-t.warrior)*.02,a+=(t.tank-e.tank)*.03,a+=(s.center-r.center)*.1,a+=(i-o)*.1,a-=Math.max(0,t.archer-e.archer)*.01,a-=Math.max(0,t.artillery-e.artillery)*.01,Math.max(0,Math.min(1,a))}const iz=Object.freeze(Object.defineProperty({__proto__:null,name:rz,probabilityScore:oz,units:af},Symbol.toStringTag,{value:"Module"})),_c=[...[...Array(5)].map((n,e)=>({id:e,type:"tank",col:Math.floor(e/2)-1,row:-6+e%2+Math.floor(e/2),sizeCol:3,sizeRow:3,command:"advance"})),...[...Array(3)].map((n,e)=>({id:e+5,type:"tank",col:(e-1)*2,row:-2,sizeCol:3,sizeRow:3,command:"advance"})),...[...Array(2)].map((n,e)=>({id:e+8,type:"artillery",col:e*4-2,row:2,sizeCol:3,sizeRow:2,command:"advance"})),...[...Array(4)].map((n,e)=>({id:e+10,type:"warrior",col:e<2?-6:6,row:-4+e%2*2,sizeCol:2,sizeRow:2,command:"advance"}))],az="Cavalry Charge";function lz(n){const e=bt(_c),t=bt(n),s=Tt(_c),r=Tt(n),o=Dt(_c),i=Dt(n),a=en(_c),l=en(n);let u=.5;return u+=(e.tank-t.tank)*.03,u-=(t.warrior+t.artillery)*.02,u+=(s.front-r.front)*.1,u+=(l-a)*.1,u+=(o-i)*.2,u+=Math.max(0,t.archer-e.archer)*.01,Math.max(0,Math.min(1,u))}const cz=Object.freeze(Object.defineProperty({__proto__:null,name:az,probabilityScore:lz,units:_c},Symbol.toStringTag,{value:"Module"})),Fc=[...[...Array(7)].map((n,e)=>({id:e,type:"artillery",col:e*3-9,row:2,sizeCol:3,sizeRow:2,command:"advance"})),...[...Array(4)].map((n,e)=>({id:e+7,type:"artillery",col:e*4-6,row:0,sizeCol:3,sizeRow:2,command:"advance"})),...[...Array(3)].map((n,e)=>({id:e+11,type:"tank",col:e*6-6,row:-4,sizeCol:4,sizeRow:3,command:"wait-advance"})),...[...Array(5)].map((n,e)=>({id:e+14,type:"warrior",col:e*4-8,row:-6,sizeCol:3,sizeRow:2,command:"wait-advance"}))],uz="Artillery Barrage";function hz(n){const e=bt(Fc),t=bt(n),s=Tt(Fc),r=Tt(n),o=Dt(Fc),i=Dt(n),a=en(Fc),l=en(n);let u=.5;return u+=(e.artillery-t.artillery)*.04,u-=(t.tank+t.warrior)*.02,u+=(l-a)*.15,u+=(r.front-s.front)*.1,u+=(i-o)*.1,u+=Math.max(0,t.archer-e.archer)*.02,u-=Math.max(0,t.tank-e.tank)*.03,Math.max(0,Math.min(1,u))}const dz=Object.freeze(Object.defineProperty({__proto__:null,name:uz,probabilityScore:hz,units:Fc},Symbol.toStringTag,{value:"Module"})),Ei=(n,e,t)=>[{id:n,type:"warrior",col:e-1,row:t-1,sizeCol:2,sizeRow:2,command:"advance"},{id:n+1,type:"archer",col:e,row:t,sizeCol:2,sizeRow:2,command:"advance"},{id:n+2,type:"tank",col:e+1,row:t+1,sizeCol:3,sizeRow:3,command:"advance"}],lf=[...Ei(0,-10,-5),...Ei(3,0,-6),...Ei(6,10,-5),...Ei(9,-8,0),...Ei(12,8,0),...Ei(15,-5,5),...Ei(18,5,5),...[...Array(2)].map((n,e)=>({id:21+e,type:"artillery",col:e*10-5,row:8,sizeCol:3,sizeRow:2,command:"advance"}))],fz="Guerrilla Tactics";function pz(n){const e=bt(lf),t=bt(n),s=Tt(n),r=Dt(lf),o=Dt(n),i=en(lf),a=en(n);let l=.5;l+=(i-a)*.2,l+=(Math.abs(s.front-.5)+Math.abs(s.center-.5))*.15,l+=(o-r)*.15;const u=Math.min(e.warrior,e.archer,e.tank,e.artillery)/Math.max(e.warrior,e.archer,e.tank,e.artillery);l+=u*.1;const d=Math.max(t.warrior-e.warrior,t.archer-e.archer,t.tank-e.tank,t.artillery-e.artillery);return l-=Math.max(0,d)*.02,Math.max(0,Math.min(1,l))}const mz=Object.freeze(Object.defineProperty({__proto__:null,name:fz,probabilityScore:pz,units:lf},Symbol.toStringTag,{value:"Module"})),Oc=[...[...Array(12)].map((n,e)=>({id:e,type:"warrior",col:e<3?-6:e<6?e-7.5:e<9?6:7.5-e,row:e<3?e-7.5:e<6?-6:e<9?7.5-e:6,sizeCol:2,sizeRow:2,command:"advance"})),...[...Array(3)].map((n,e)=>({id:e+12,type:"tank",col:e===0?-3:e===1?3:0,row:e===0?-3:e===1?3:-3,sizeCol:3,sizeRow:3,command:"wait-advance"})),...[...Array(6)].map((n,e)=>({id:e+15,type:"archer",col:e<3?-2:2,row:e%3-1,sizeCol:2,sizeRow:2,command:"advance"})),...[...Array(2)].map((n,e)=>({id:e+21,type:"artillery",col:e*2-1,row:-1,sizeCol:2,sizeRow:2,command:"advance"})),...[...Array(3)].map((n,e)=>({id:e+23,type:"warrior",col:(e-1)*2,row:-5,sizeCol:2,sizeRow:2,command:"wait-advance"}))],gz="Fortress Defense";function xz(n){const e=bt(Oc),t=bt(n),s=Tt(Oc),r=Tt(n),o=Dt(Oc),i=Dt(n),a=en(Oc),l=en(n);let u=.5;u+=(l-a)*.2,u+=(e.warrior+e.tank-t.warrior-t.tank)*.02,u+=(e.artillery-t.artillery)*.03,u+=(r.front-s.front)*.15,u+=(s.center-r.center)*.1;const d=e.archer+e.artillery,f=t.archer+t.artillery;return u-=Math.max(0,f-d)*.02,u+=(i-o)*.1,Math.max(0,Math.min(1,u))}const yz=Object.freeze(Object.defineProperty({__proto__:null,name:gz,probabilityScore:xz,units:Oc},Symbol.toStringTag,{value:"Module"})),wz=[{id:301,col:-14,row:-2,sizeCol:4,sizeRow:3,type:"tank",command:"flank-left"},{id:302,col:-18,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"flank-left"},{id:303,col:-16,row:2,sizeCol:6,sizeRow:2,type:"warrior",command:"flank-left"},{id:304,col:-4,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:305,col:4,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:306,col:0,row:-6,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:307,col:14,row:-2,sizeCol:4,sizeRow:3,type:"tank",command:"flank-right"},{id:308,col:18,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"flank-right"},{id:309,col:16,row:2,sizeCol:6,sizeRow:2,type:"warrior",command:"flank-right"}],vz="Pincer Attack",bz=n=>{const e=bt(n),t=Tt(n),s=en(n),r=1-(t.left+t.right)/2,o=1-Math.max(Math.abs(e.warrior-e.archer),Math.abs(e.warrior-e.tank),Math.abs(e.warrior-e.artillery),Math.abs(e.archer-e.tank),Math.abs(e.archer-e.artillery),Math.abs(e.tank-e.artillery))/n.length,i=1-s;return(r*.4+o*.3+i*.3)*100},Cz=Object.freeze(Object.defineProperty({__proto__:null,name:vz,probabilityScore:bz,units:wz},Symbol.toStringTag,{value:"Module"})),kz=[{id:401,col:-16,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"wait-advance"},{id:402,col:0,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"wait-advance"},{id:403,col:16,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"wait-advance"},{id:404,col:-12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:405,col:0,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:406,col:12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:407,col:0,row:-8,sizeCol:8,sizeRow:2,type:"artillery",command:"advance"},{id:408,col:-16,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:409,col:16,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"}],Sz="Shield Wall",Iz=n=>{const e=bt(n),t=Tt(n),s=en(n),r=Dt(n),o=(e.warrior+e.tank)/n.length,i=t.front,a=s,l=r;return(o*.35+i*.25+a*.2+l*.2)*100},$z=Object.freeze(Object.defineProperty({__proto__:null,name:Sz,probabilityScore:Iz,units:kz},Symbol.toStringTag,{value:"Module"})),Tz=[{id:501,col:-4,row:2,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:502,col:4,row:2,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:503,col:0,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:504,col:-10,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:505,col:10,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:506,col:0,row:-6,sizeCol:8,sizeRow:2,type:"artillery",command:"advance"},{id:507,col:-16,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:508,col:16,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"advance"}],Nz="Blitzkrieg",Ez=n=>{const e=bt(n),t=Tt(n),s=en(n),r=Dt(n),o=1-e.tank/n.length,i=1-(t.left+t.right)/2,a=1-s,l=1-r,u=t.front;return(o*.25+i*.2+a*.2+l*.15+u*.2)*100},Rz=Object.freeze(Object.defineProperty({__proto__:null,name:Nz,probabilityScore:Ez,units:Tz},Symbol.toStringTag,{value:"Module"})),Az=[{id:601,col:-16,row:-8,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:602,col:0,row:-8,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:603,col:16,row:-8,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:604,col:-12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:605,col:0,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:606,col:12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"advance"},{id:607,col:-16,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"wait-advance"},{id:608,col:0,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"wait-advance"},{id:609,col:16,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"wait-advance"},{id:610,col:-10,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:611,col:10,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"}],Dz="Scorched Earth",_z=n=>{const e=bt(n),t=Tt(n),s=en(n),r=Dt(n),o=1-(e.artillery+e.archer)/n.length,i=s,a=t.front,l=r,u=(e.warrior+e.tank)/n.length;return(o*.25+i*.2+a*.2+l*.15+u*.2)*100},Fz=Object.freeze(Object.defineProperty({__proto__:null,name:Dz,probabilityScore:_z,units:Az},Symbol.toStringTag,{value:"Module"})),Oz=[{id:701,col:-8,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance"},{id:702,col:8,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"advance"},{id:703,col:-8,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:704,col:0,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:705,col:8,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:706,col:-12,row:-8,sizeCol:6,sizeRow:2,type:"artillery",command:"advance-wait"},{id:707,col:12,row:-8,sizeCol:6,sizeRow:2,type:"artillery",command:"advance-wait"},{id:708,col:-16,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:709,col:0,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:710,col:16,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"}],zz="Trojan Horse",Mz=n=>{const e=bt(n),t=Tt(n),s=en(n),r=Dt(n),o=(e.warrior+e.tank)/n.length,i=t.front,a=1-s,l=1-(e.artillery+e.archer)/n.length,u=r;return(o*.3+i*.25+a*.15+l*.2+u*.1)*100},Pz=Object.freeze(Object.defineProperty({__proto__:null,name:zz,probabilityScore:Mz,units:Oz},Symbol.toStringTag,{value:"Module"})),Lz=[{id:801,col:0,row:2,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:802,col:-4,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:803,col:-8,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:804,col:-12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:805,col:-16,row:-6,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:806,col:4,row:0,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:807,col:8,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:808,col:12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:809,col:16,row:-6,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:810,col:0,row:-4,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"}],Bz="Flying V",Vz=n=>{const e=bt(n),t=Tt(n),s=en(n),r=Dt(n),o=1-(t.left+t.right)/2,i=1-Math.max(Math.abs(e.warrior-e.archer),Math.abs(e.warrior-e.tank),Math.abs(e.warrior-e.artillery),Math.abs(e.archer-e.tank),Math.abs(e.archer-e.artillery),Math.abs(e.tank-e.artillery))/n.length,a=s,l=t.front,u=1-r;return(o*.3+i*.2+a*.15+l*.25+u*.1)*100},Wz=Object.freeze(Object.defineProperty({__proto__:null,name:Bz,probabilityScore:Vz,units:Lz},Symbol.toStringTag,{value:"Module"})),Uz=[{id:901,col:-8,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"wait-advance"},{id:902,col:8,row:0,sizeCol:8,sizeRow:2,type:"warrior",command:"wait-advance"},{id:903,col:-4,row:-2,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:904,col:4,row:-2,sizeCol:4,sizeRow:4,type:"tank",command:"wait-advance"},{id:905,col:-16,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:906,col:-20,row:-6,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:907,col:16,row:-4,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:908,col:20,row:-6,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:909,col:-12,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:910,col:12,row:-6,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:911,col:0,row:-8,sizeCol:6,sizeRow:2,type:"artillery",command:"wait-advance"}],Gz="Hammer and Anvil",Hz=n=>{const e=bt(n),t=Tt(n),s=en(n),r=Dt(n),o=1-(t.left+t.right)/2,i=(e.warrior+e.tank)/n.length,a=1-s,l=t.front,u=r,d=1-(e.artillery+e.archer)/n.length;return(o*.25+i*.2+a*.15+l*.2+u*.1+d*.1)*100},jz=Object.freeze(Object.defineProperty({__proto__:null,name:Gz,probabilityScore:Hz,units:Uz},Symbol.toStringTag,{value:"Module"})),Xz=[{id:1001,col:12,row:2,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:1002,col:8,row:0,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1003,col:4,row:-2,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:1004,col:0,row:-4,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1005,col:-4,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:1006,col:-8,row:-8,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1007,col:12,row:-4,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:1008,col:0,row:-8,sizeCol:4,sizeRow:2,type:"archer",command:"wait-advance"},{id:1009,col:-16,row:-12,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"}],Kz="Echelon Formation",qz=n=>{const e=bt(n),t=Tt(n),s=en(n),r=Dt(n),o=Math.abs(t.left-t.right),i=1-Math.max(Math.abs(e.warrior-e.archer),Math.abs(e.warrior-e.tank),Math.abs(e.warrior-e.artillery),Math.abs(e.archer-e.tank),Math.abs(e.archer-e.artillery),Math.abs(e.tank-e.artillery))/n.length,a=s,l=1-e.artillery/n.length,u=1-r;return(o*.25+i*.2+a*.2+l*.25+u*.1)*100},Yz=Object.freeze(Object.defineProperty({__proto__:null,name:Kz,probabilityScore:qz,units:Xz},Symbol.toStringTag,{value:"Module"})),Qz=[{id:1101,col:-6,row:2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1102,col:6,row:2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1103,col:-8,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1104,col:8,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1105,col:-6,row:-6,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1106,col:6,row:-6,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1107,col:-3,row:-2,sizeCol:3,sizeRow:3,type:"tank",command:"advance"},{id:1108,col:3,row:-2,sizeCol:3,sizeRow:3,type:"tank",command:"advance"},{id:1109,col:-4,row:-4,sizeCol:3,sizeRow:2,type:"archer",command:"advance"},{id:1110,col:4,row:-4,sizeCol:3,sizeRow:2,type:"archer",command:"advance"},{id:1111,col:0,row:-4,sizeCol:4,sizeRow:2,type:"artillery",command:"advance"}],Zz="Turtle Formation",Jz=n=>{const e=bt(n),t=Tt(n),s=en(n),r=Dt(n),o=(e.warrior+e.tank)/n.length,i=1-s,a=r,l=1-e.artillery/n.length,u=1-(e.artillery+e.archer)/n.length,d=t.front;return(o*.25+i*.2+a*.15+l*.2+u*.1+d*.1)*100},e3=Object.freeze(Object.defineProperty({__proto__:null,name:Zz,probabilityScore:Jz,units:Qz},Symbol.toStringTag,{value:"Module"})),t3=[{id:1201,col:-12,row:2,sizeCol:3,sizeRow:2,type:"archer",command:"wait-advance"},{id:1202,col:-4,row:2,sizeCol:3,sizeRow:2,type:"archer",command:"wait-advance"},{id:1203,col:4,row:2,sizeCol:3,sizeRow:2,type:"archer",command:"wait-advance"},{id:1204,col:12,row:2,sizeCol:3,sizeRow:2,type:"archer",command:"wait-advance"},{id:1205,col:-8,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1206,col:8,row:-2,sizeCol:6,sizeRow:2,type:"warrior",command:"advance"},{id:1207,col:-6,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:1208,col:6,row:-6,sizeCol:4,sizeRow:4,type:"tank",command:"advance"},{id:1209,col:-8,row:-10,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"},{id:1210,col:8,row:-10,sizeCol:6,sizeRow:2,type:"artillery",command:"advance"}],n3="Skirmisher Screen",s3=n=>{const e=bt(n),t=Tt(n),s=en(n),r=Dt(n),o=(e.tank+e.artillery)/n.length,i=s,a=r,l=1-e.archer/n.length,u=t.front,d=1-e.warrior/n.length;return(o*.25+i*.2+a*.15+l*.15+u*.15+d*.1)*100},r3=Object.freeze(Object.defineProperty({__proto__:null,name:n3,probabilityScore:s3,units:t3},Symbol.toStringTag,{value:"Module"})),Ck=[IO,EO,_O,MO,VO,HO,qO,JO,sz,iz,cz,dz,mz,yz,Cz,$z,Rz,Fz,Pz,Wz,jz,Yz,e3,r3];function o3(n,e,t){let s=0;for(let r=-1;r<=1;r++)for(let o=-1;o<=1;o++){if(r===0&&o===0)continue;const i=e+r,a=t+o;i>=0&&i<n[0].length&&a>=0&&a<n.length&&(s+=n[a][i]>0?1:0)}return s}function i3(n,e){const t=n.map(s=>[...s]);for(let s=0;s<e;s++)for(let r=0;r<n.length;r++)for(let o=0;o<n[0].length;o++){const i=o3(n,o,r);n[r][o]>0?t[r][o]=i<2||i>4?0:1:t[r][o]=i===3?1:0}return t}function a3(n,e){const t=n.map(s=>[...s]);for(let s=0;s<n.length;s++)for(let r=0;r<n[0].length;r++){let o=0,i=0;for(let a=-1;a<=1;a++)for(let l=-1;l<=1;l++){const u=r+a,d=s+l;u>=0&&u<n[0].length&&d>=0&&d<n.length&&(o+=n[d][u],i++)}t[s][r]=n[s][r]*(1-e)+o/i*e}return t}function l3(n,e,t){const s=Math.ceil(n/t),r=Math.ceil(e/t),o=Array.from({length:r+1},()=>Array(s+1).fill(0)),i=s/2,a=r/2,l=Math.min(i,a);for(let x=0;x<=r;x++)for(let w=0;w<=s;w++){const v=Math.abs(w-i),b=Math.abs(x-a);o[x][w]=(Math.pow(Math.sqrt(v*v+b*b)/l,.25)+Math.sin(x/r*Math.PI)/2)*t/2}const u=Math.max(...o.flat()),d=Math.min(...o.flat()),f=o.map(x=>x.map(w=>(w-d)/(u-d))),p=i3(f,5);for(let x=0;x<=r;x++)for(let w=0;w<=s;w++)o[x][w]+=p[x][w]*t*.5;return a3(o,.5)}function c3(n){const e=gs*3,t=gs*2,s=l3(e,t,n);return{width:e,height:t,tileSize:n,heightMap:s}}class by{static render(e,{width:t,height:s,cellWidth:r,cellHeight:o}){this.drawGridLines(e,t,s,r,o),this.drawCenterIndicator(e,r,o)}static drawGridLines(e,t,s,r,o){e.save(),e.strokeStyle="#333",e.lineWidth=1;for(let i=0;i<=t;i+=r)e.beginPath(),e.moveTo(i,0),e.lineTo(i,s),e.stroke();for(let i=0;i<=s;i+=o)e.beginPath(),e.moveTo(0,i),e.lineTo(t,i),e.stroke();e.restore()}static drawCenterIndicator(e,t,s){const r=$s*t,o=Gs*s;e.save(),e.strokeStyle="#666",e.lineWidth=2,e.beginPath(),e.moveTo(r,o-s/2),e.lineTo(r,o+s/2),e.stroke(),e.beginPath(),e.moveTo(r-t/2,o),e.lineTo(r+t/2,o),e.stroke(),e.fillStyle="#666",e.beginPath(),e.arc(r,o,3,0,Math.PI*2),e.fill(),e.restore()}static gridToCanvas(e,t,s,r){return{x:(e+$s)*s,y:(t+Gs)*r}}static canvasToGrid(e,t,s,r){return{col:Math.floor(e/s)-$s,row:Math.floor(t/r)-Gs}}}class cf{static render(e,t){const{units:s,worldTime:r,isPlayerArea:o}=t;o&&s.forEach(i=>{if(i.command){const a=r%this.WAVE_DURATION[i.type]/this.WAVE_DURATION[i.type];this.renderCommandPath(e,i,a,t)}})}static renderCommandPath(e,t,s,r){const{cellWidth:o,cellHeight:i,unitImages:a,isPlayerArea:l}=r;let u=Math.floor(s*this.WAVE_STEPS*5)/5;if(t.command==="wait-advance"&&u<3)return;t.command==="wait-advance"&&u>=3&&(u-=2);const d=u/this.WAVE_STEPS,f=this.calculateStepPosition(t,d);if(d<0)return;const p=Math.max(0,1-u/this.WAVE_STEPS-d);if(p<=0)return;e.save(),e.globalAlpha=p;const g={...t,col:f.col,row:f.row};eI.renderUnit(e,g,a,o,i,l),e.restore()}static calculateStepPosition(e,t){const s={col:e.col,row:e.row};let r={...s};switch(e.command){case"flank-left":{const o=this.FLANK_DISTANCE*.5*t,i=this.FLANK_DISTANCE*t;r={col:s.col-i,row:s.row-o};break}case"flank-right":{const o=this.FLANK_DISTANCE*.5*t,i=this.FLANK_DISTANCE*t;r={col:s.col+i,row:s.row-o};break}case"advance":case"advance-wait":case"wait-advance":{const o=this.FLANK_DISTANCE*t;r={col:s.col,row:s.row-o};break}}return r}}me(cf,"WAVE_DURATION",{archer:1e4,artillery:6e4,tank:2e4,warrior:5e3}),me(cf,"WAVE_STEPS",10),me(cf,"FLANK_DISTANCE",20);class eI{static render(e,t){const{units:s,unitImages:r,cellWidth:o,cellHeight:i,isPlayerArea:a,worldTime:l}=t;cf.render(e,{units:s,unitImages:r,cellWidth:o,cellHeight:i,isPlayerArea:a,worldTime:l}),s.forEach(u=>{this.renderUnit(e,u,r,o,i,a)})}static renderUnit(e,t,s,r,o,i){const{x:a,y:l}=by.gridToCanvas(t.col,t.row,r,o),u=t.sizeCol*r,d=t.sizeRow*o;s[t.type]?this.renderUnitWithImage(e,{unit:t,image:s[t.type],x:a,y:l,cellWidth:r,cellHeight:o,isPlayerArea:i}):this.renderUnitFallback(e,{unit:t,x:a,y:l,unitWidth:u,unitHeight:d}),this.renderUnitLabel(e,{unit:t,x:a,y:l,unitWidth:u,unitHeight:d})}static renderUnitWithImage(e,t){const{unit:s,image:r,x:o,y:i,cellWidth:a,cellHeight:l,isPlayerArea:u}=t;e.save();for(let d=0;d<s.sizeCol;d++)for(let f=0;f<s.sizeRow;f++)e.drawImage(r,o+d*a,i+f*l,a,l),this.renderHealthIndicator(e,{x:o+d*a,y:i+f*l,width:10,height:5,isPlayerArea:u});e.restore()}static renderUnitFallback(e,t){const{unit:s,x:r,y:o,unitWidth:i,unitHeight:a}=t;e.save(),e.fillStyle=this.getUnitColor(s.type),e.fillRect(r,o,i,a),e.restore()}static renderHealthIndicator(e,t){const{x:s,y:r,width:o,height:i,isPlayerArea:a}=t;e.save(),e.fillStyle=a?"#ff0000":"#00ff00",e.fillRect(s,r+10,o,i),e.restore()}static renderUnitLabel(e,t){const{unit:s,x:r,y:o,unitWidth:i,unitHeight:a}=t;e.save(),e.fillStyle="white",e.font="12px Arial",e.textAlign="center",e.textBaseline="middle",e.fillText(s.type,r+i/2,o+a/2),e.restore()}static getUnitColor(e){switch(e){case"archer":return"green";case"tank":return"blue";default:return"red"}}}class u3{static render(e,t){this.renderTerrainHeightMap(e,t)}static renderTerrainHeightMap(e,t){const{terrainData:s,cellWidth:r,cellHeight:o,isPlayerArea:i}=t,a=s.heightMap,l=a[0].length/2,u=Math.max(...a.flat()),d=i?a.length/2:0,f=i?a.length:a.length/2;e.save();for(let p=d;p<f;p++)for(let g=-l;g<l;g++){const x=g*r,w=(p-d)*o,v=a[Math.floor(p)][Math.floor(l+g)];e.fillStyle=`rgb(0, 0, 0, ${.5-v/u/2})`,e.fillRect($s*r+x,w,r,o)}e.restore()}static getTerrainHeightAt(e,t,s,r){const o=e.heightMap,i=o[0].length/2,a=r?s+o.length/2:s;return a>=0&&a<o.length&&t+i>=0&&t+i<o[0].length?o[Math.floor(a)][Math.floor(t+i)]:0}}class Di{static render(e,t){const{units:s,selectedUnitId:r,cellWidth:o,cellHeight:i,timestamp:a}=t;s.forEach(l=>{this.renderBorder(e,{unit:l,isSelected:l.id===r,cellWidth:o,cellHeight:i,timestamp:a})})}static renderBorder(e,t){const{unit:s,isSelected:r,cellWidth:o,cellHeight:i,timestamp:a}=t,{x:l,y:u}=by.gridToCanvas(s.col,s.row,o,i),d=s.sizeCol*o,f=s.sizeRow*i;e.save();const p=a/this.ANIMATION_SPEED%(this.DASH_LENGTH+this.DASH_GAP);e.strokeStyle=r?this.SELECTED_COLOR:this.UNSELECTED_COLOR,e.lineWidth=this.BORDER_WIDTH,e.setLineDash([this.DASH_LENGTH,this.DASH_GAP]),e.lineDashOffset=-p,e.strokeRect(l,u,d,f),r&&this.renderGlowEffect(e,{x:l,y:u,width:d,height:f}),this.renderCornerIndicators(e,{x:l,y:u,width:d,height:f,isSelected:r}),e.restore()}static renderGlowEffect(e,t){const{x:s,y:r,width:o,height:i}=t;e.save(),e.strokeStyle="rgba(255, 255, 255, 0.3)",e.lineWidth=4,e.setLineDash([]),e.strokeRect(s-1,r-1,o+2,i+2),e.strokeStyle="rgba(255, 255, 255, 0.5)",e.lineWidth=2,e.strokeRect(s-.5,r-.5,o+1,i+1),e.restore()}static renderCornerIndicators(e,t){const{x:s,y:r,width:o,height:i,isSelected:a}=t,l=4;e.save(),e.setLineDash([]),e.lineWidth=a?3:2,this.drawCorner(e,s,r,l,0,0),this.drawCorner(e,s+o,r,l,-1,0),this.drawCorner(e,s,r+i,l,0,-1),this.drawCorner(e,s+o,r+i,l,-1,-1),e.restore()}static drawCorner(e,t,s,r,o,i){e.beginPath(),e.moveTo(t,s),e.lineTo(t+r*(o||1),s),e.moveTo(t,s),e.lineTo(t,s+r*(i||1)),e.stroke()}}me(Di,"DASH_LENGTH",5),me(Di,"DASH_GAP",3),me(Di,"ANIMATION_SPEED",50),me(Di,"BORDER_WIDTH",2),me(Di,"SELECTED_COLOR","#FFFFFF"),me(Di,"UNSELECTED_COLOR","#FFD700");class h3{static getEventHandlers(e){const{canvasRef:t,cellWidth:s,cellHeight:r,isPlayerArea:o,onCellClick:i,onMouseDown:a,onMouseMove:l,onMouseUp:u,onTouchStart:d,onTouchMove:f,onTouchEnd:p}=e;return{onClick:g=>this.handleCanvasClick(g,{canvasRef:t,cellWidth:s,cellHeight:r,isPlayerArea:o,onCellClick:i}),onMouseDown:g=>this.handleMouseEvent(g,a),onMouseMove:g=>this.handleMouseEvent(g,l),onMouseUp:g=>this.handleMouseEvent(g,u),onTouchStart:g=>{this.handleTouchEvent(g,d),this.handleTouch(g,{canvasRef:t,cellWidth:s,cellHeight:r,isPlayerArea:o,onCellClick:i})},onTouchMove:g=>this.handleTouchEvent(g,f),onTouchEnd:g=>this.handleTouchEvent(g,p)}}static handleCanvasClick(e,t){const{canvasRef:s,cellWidth:r,cellHeight:o,isPlayerArea:i,onCellClick:a}=t;if(!i)return;const l=s.current;if(!l)return;const u=this.getMouseCoordinates(e,l),{col:d,row:f}=this.calculateGridPosition(u,r,o);a(d,f)}static handleTouch(e,t){const{canvasRef:s,cellWidth:r,cellHeight:o,isPlayerArea:i,onCellClick:a}=t;if(!i)return;const l=s.current;if(!l)return;const u=this.getTouchCoordinates(e,l);if(!u)return;const{col:d,row:f}=this.calculateGridPosition(u,r,o);a(d,f)}static handleMouseEvent(e,t){e.preventDefault(),t(e)}static handleTouchEvent(e,t){t(e)}static getMouseCoordinates(e,t){const s=t.getBoundingClientRect(),r=t.width/s.width,o=t.height/s.height;return{x:(e.clientX-s.left)*r,y:(e.clientY-s.top)*o}}static getTouchCoordinates(e,t){const s=e.touches[0]||e.changedTouches[0];if(!s)return null;const r=t.getBoundingClientRect(),o=t.width/r.width,i=t.height/r.height;return{x:(s.clientX-r.left)*o,y:(s.clientY-r.top)*i}}static calculateGridPosition(e,t,s){return{col:Math.floor(e.x/t)-$s,row:Math.floor(e.y/s)-Gs}}static isWithinBounds(e,t,s,r){return e>=-$s&&e<s-$s&&t>=-Gs&&t<r-Gs}static getNormalizedCoordinates(e,t,s,r){return{col:Math.max(-$s,Math.min(s-$s-1,e)),row:Math.max(-Gs,Math.min(r-Gs-1,t))}}}const d3="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gkDEigyAtVVggAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAB4SURBVFjD7VfLDsAgCIOF///l7rSTizp5aJZyMxFtoMUqsjnUmQ/vudfuChBAVKDDh7MroAsMD73bgqSKhb1UAQHIQ0J8II2yBRktqBzXzboSgL4NLcsgFklIAJUyRI/hv/aEIw847RHNWfLjXS8ow4xXrOzTUhI3cssYNHqG9WQAAAAASUVORK5CYII=",f3="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gkDEigk9gHg0wAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAACySURBVFjD1VZbDsAgCLPE+1+5+13cIqI8Nn7JpNAW1lpx4PB7brzLe16SG34AloLiqADAjAJUir/mJQHYVOjdeZS0uqw7WXcU2DLnUjH2SACm4hEAzJtVkjzOKABURKlORw461vheoqNvcMxFsTFSAzDm4bkJYaAJnraZFaeHJU9vAKMWx+zA8LRrOEwCFs49bPipGLk3a0HaT0PrdHkSu79k+FrH2/egXAPyF8FV0JcTF5HDMyNBbtWDAAAAAElFTkSuQmCC",p3="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gkJDBsdJGpj9QAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAACjSURBVFjD7VbREoAgCHMe///L6zW9wgLErpOnNLkNnACKzfjwHEYHallsHgLwRP6LDISYOHx5SjW71LNEqXT2K0AAiMcgCUDQMDJEyFkitOiMuw5sAqsJoP+WRHBerWVB9E3f2CLcBMTxjLRGkzITsgOEZZaoL9iaACJSikHkWnYw+idKsbAAa4Oru4wyyK/Zqy/Fll4HosBvrw8WJ2cXRPmSHSqNI0GjWZKJAAAAAElFTkSuQmCC",m3="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAABlBMVEUAAAAAAAClZ7nPAAAAAXRSTlMAQObYZgAAAAFiS0dEAIgFHUgAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfiCQwTIjRI+GJcAAAAGXRFWHRDb21tZW50AENyZWF0ZWQgd2l0aCBHSU1QV4EOFwAAAGtJREFUCNdjYCAHJICIG0DMeAJIMD8BEux/QMQPIMH/gYHxg/wDBiYP+wMMrCH1DAwsT/4B5f4CVbD8/9/AwBr+yYGByf/VAgbG//8VGBjk9z9gYNinDmTVaC1gYLAQcmBgEOBvYGDgYGAAAKEvGyWBDTuGAAAAAElFTkSuQmCC",g3={warrior:d3,archer:f3,tank:p3,artillery:m3},x3=n=>new Promise((e,t)=>{const s=new Image;s.onload=()=>e(s),s.onerror=t,s.src=n}),Cy=pr.memo(({width:n,height:e,cellWidth:t,cellHeight:s,units:r,selectedUnitId:o,onMouseDown:i,onMouseMove:a,onMouseUp:l,onTouchStart:u,onTouchMove:d,onTouchEnd:f,onCellClick:p,isPlayerArea:g,terrainData:x})=>{const w=Le.useRef(null),[v,b]=Le.useState({});return Le.useEffect(()=>{(async()=>{const $={};for(const[S,T]of Object.entries(g3))try{$[S]=await x3(T)}catch(E){console.error(`Failed to load image for ${S}:`,E)}b($)})()},[]),Q2(()=>{const C=w.current;if(!C)return;const $=C.getContext("2d");$&&($.clearRect(0,0,n,e),u3.render($,{width:n,height:e,cellWidth:t,cellHeight:s,terrainData:x,isPlayerArea:g}),by.render($,{width:n,height:e,cellWidth:t,cellHeight:s}),eI.render($,{units:r,unitImages:v,cellWidth:t,cellHeight:s,isPlayerArea:g,worldTime:Date.now()}),g&&Di.render($,{units:r,selectedUnitId:o,cellWidth:t,cellHeight:s,timestamp:Date.now()}))}),De.jsx(y3,{ref:w,"data-is-player-area":g,width:n,height:e,...h3.getEventHandlers({canvasRef:w,cellWidth:t,cellHeight:s,isPlayerArea:g,onCellClick:p,onMouseDown:i,onMouseMove:a,onMouseUp:l,onTouchStart:u,onTouchMove:d,onTouchEnd:f})})});Cy.displayName="CanvasGrid";const y3=yn.canvas`
  position: fixed;
  &[data-is-player-area='false'] {
    transform: translateX(-50%);
    bottom: 50%;
  }
  &[data-is-player-area='true'] {
    transform: translateX(-50%);
    top: 50%;
  }
  left: 50%;
  max-width: 100%;
  max-height: 50%;
`,w3=({units:n,selectedUnitId:e,hasInteracted:t,terrainData:s,onCellClick:r,onDragStart:o,onDragMove:i,onDragEnd:a,onModifyUnit:l})=>De.jsxs(v3,{children:[De.jsx(Cy,{isPlayerArea:!0,width:Ui,height:Gi,cellWidth:Kn*(Ui/Ui),cellHeight:Ur*(Gi/Gi),units:n,selectedUnitId:e,onCellClick:r,onMouseDown:o,onMouseMove:i,onMouseUp:a,onTouchStart:o,onTouchMove:i,onTouchEnd:a,onModifyUnit:l,terrainData:s}),!t&&De.jsx(b3,{})]}),v3=yn.div`
  flex: 1;
  position: relative;
`,b3=yn.div`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 255, 255, 0.1);
  display: flex;
  justify-content: center;
  align-items: center;
  pointer-events: none;
  animation: pulse 2s infinite;

  &::after {
    content: 'Click or drag units to edit your battle plan';
    color: white;
    font-size: 24px;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    background: rgba(0, 0, 0, 0.7);
    padding: 16px 32px;
    border-radius: 8px;
  }

  @keyframes pulse {
    0% {
      background: rgba(255, 255, 255, 0.1);
    }
    50% {
      background: rgba(255, 255, 255, 0.2);
    }
    100% {
      background: rgba(255, 255, 255, 0.1);
    }
  }
`,C3=({units:n,terrainData:e,hasInteracted:t=!0})=>{const s=()=>{};return De.jsxs(k3,{children:[De.jsx(Cy,{width:Ui,height:Gi,cellWidth:Kn*(Ui/Ui),cellHeight:Ur*(Gi/Gi),units:n,selectedUnitId:null,onCellClick:s,onMouseDown:s,onMouseMove:s,onMouseUp:s,onTouchStart:s,onTouchMove:s,onTouchEnd:s,onModifyUnit:s,isPlayerArea:!1,terrainData:e}),!t&&De.jsx(S3,{children:De.jsx(I3,{children:"Enemy battle plan"})})]})},k3=yn.div`
  width: 100%;
  height: 50%;
  position: relative;
`,S3=yn.div`
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(255, 0, 0, 0.1);
  display: flex;
  justify-content: center;
  align-items: center;
  pointer-events: none;
`,I3=yn.div`
  color: white;
  font-size: 24px;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  background: rgba(0, 0, 0, 0.7);
  padding: 16px 32px;
  border-radius: 8px;
`,$3=({onStartBattle:n})=>De.jsx(T3,{children:De.jsx(N3,{onClick:n,children:"Start Battle"})}),T3=yn.div`
  position: absolute;

  top: 20px;
  @media (orientation: portrait) {
    left: 50%;
    transform: translateX(-50%);
  }
  @media (orientation: landscape) {
    right: 20px;
  }

  border-radius: 4px;
  display: flex;
  justify-content: center;
  align-items: center;
  pointer-events: all;
`,N3=yn.button`
  padding: 8px 16px;
  font-size: 14px;
  @media (pointer: none), (pointer: coarse) {
    font-size: 18px;
  }
  background: rgba(0, 0, 0, 0.7);
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  animation: shake 5s cubic-bezier(0.36, 0.07, 0.19, 0.97) infinite, grow 5s ease-in-out infinite;
  transform-origin: center;

  &:hover {
    background: rgba(0, 0, 0, 0.8);
  }

  @keyframes shake {
    0%,
    92%,
    96% {
      transform: translate(0, 0) scale(1);
    }
    93% {
      transform: translate(-2px, 0) scale(1.02);
    }
    94% {
      transform: translate(2px, 0) scale(1.02);
    }
    95% {
      transform: translate(-2px, 0) scale(1.02);
    }
  }

  @keyframes grow {
    0%,
    92%,
    100% {
      transform: scale(1);
    }
    94% {
      transform: scale(1.03);
    }
  }
`,ja=20;function E3(n,e,t,s,r){const o=e.getBoundingClientRect(),i=window.innerWidth,a=window.innerHeight,l=i>a?o.width/e.width:o.height/e.height,u=(n.col+Ks/2+n.sizeCol/2)*t*l,d=(n.row+qs/2+n.sizeRow/2)*s*l,f=o.left+u,p=o.top+d,g=f<i/2,x=p<a/2,w=g?f-n.sizeCol/2*t*l-r.width-ja:f+n.sizeCol/2*t*l+ja,v=x?p-r.height:p+r.height;return{x:Math.max(ja,Math.min(w,i-r.width-ja)),y:Math.max(ja,Math.min(v,a-r.height-ja))}}const tI={width:250,height:320},R3=({unit:n,onModifyUnit:e})=>{const[t,s]=Le.useState(null),r=Le.useRef(null),o=Le.useCallback(()=>{const d=document.querySelector('canvas[data-is-player-area="true"]');if(!d)return;const f=E3(n,d,Kn,Ur,tI);s(f)},[n]);Le.useEffect(()=>{o();const d=()=>{o()};return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[o]),Le.useEffect(()=>{o()},[n,n.col,n.row,n.sizeCol,n.sizeRow,o]);const i=Le.useCallback(d=>{const f=d.target.value;e(n.id,{type:f})},[n.id,e]),a=Le.useCallback(d=>{const f=d.target.value;e(n.id,{command:f})},[n.id,e]),l=Le.useCallback(d=>{const[f,p]=d.target.value.split("x").map(g=>parseInt(g,10));e(n.id,{sizeCol:f,sizeRow:p})},[n.id,e]),u=d=>{d.stopPropagation(),s(null)};return t?De.jsxs(A3,{ref:r,style:{left:t.x,top:t.y},children:[De.jsxs(D3,{children:["Unit Info",De.jsx(_3,{onClick:u,children:"×"})]}),De.jsxs(B0,{children:[De.jsx(V0,{children:"Type:"}),De.jsxs(W0,{value:n.type,onChange:i,children:[De.jsx("option",{value:"warrior",children:"Warrior"}),De.jsx("option",{value:"archer",children:"Archer"}),De.jsx("option",{value:"tank",children:"Tank"}),De.jsx("option",{value:"artillery",children:"Artillery"})]})]}),De.jsxs(B0,{children:[De.jsx(V0,{children:"Command:"}),De.jsxs(W0,{value:n.command,onChange:a,children:[De.jsx("option",{value:"advance-wait",children:"Advance and Wait"}),De.jsx("option",{value:"advance",children:"Advance"}),De.jsx("option",{value:"wait-advance",children:"Wait then Advance"}),De.jsx("option",{value:"flank-left",children:"Flank Left"}),De.jsx("option",{value:"flank-right",children:"Flank Right"})]})]}),De.jsxs(B0,{children:[De.jsx(V0,{children:"Fomration:"}),De.jsx(W0,{value:`${n.sizeCol}x${n.sizeRow}`,onChange:l,children:CO(n.sizeCol,n.sizeRow).map((d,f)=>De.jsxs("option",{value:`${d.sizeCol}x${d.sizeRow}`,children:[d.sizeCol,"x",d.sizeRow]},f))})]})]}):null},A3=yn.div`
  position: absolute;
  background: rgba(0, 0, 0, 0.45);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 8px;
  padding: 16px;
  color: white;
  width: ${tI.width}px;
  backdrop-filter: blur(5px);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  z-index: 1000;
  transition: all 0.3s ease-out;

  box-sizing: border-box;
`,D3=yn.h3`
  margin: 0 0 16px 0;
  font-size: 16px;
  font-weight: bold;
  color: #ffd700;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  padding-bottom: 8px;
  position: relative;
  display: flex;
  justify-content: space-between;
  align-items: center;
`,_3=yn.button`
  background: none;
  border: none;
  color: rgba(255, 255, 255, 0.6);
  font-size: 24px;
  line-height: 1;
  padding: 0;
  cursor: pointer;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s ease;

  &:hover {
    color: white;
    background: rgba(255, 255, 255, 0.1);
  }

  &:active {
    background: rgba(255, 255, 255, 0.2);
  }
`,B0=yn.div`
  margin-bottom: 16px;
`,V0=yn.label`
  display: block;
  margin-bottom: 4px;
  font-size: 14px;
  color: #ccc;
`,W0=yn.select`
  width: 100%;
  padding: 6px;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 4px;
  color: white;
  font-size: 14px;
  cursor: pointer;

  &:hover {
    background: rgba(255, 255, 255, 0.15);
  }

  option {
    background: #333;
  }
`,F3=({playerUnits:n,oppositionUnits:e,selectedUnit:t,hasInteracted:s,terrainData:r,isDragging:o,onCellClick:i,onDragStart:a,onDragMove:l,onDragEnd:u,onModifyUnit:d,onStartBattle:f})=>De.jsxs(O3,{children:[De.jsx(C3,{units:e,terrainData:r,hasInteracted:s}),De.jsx(w3,{units:n,selectedUnitId:(t==null?void 0:t.id)||null,hasInteracted:s,terrainData:r,onCellClick:i,onDragStart:a,onDragMove:l,onDragEnd:u,onModifyUnit:d}),!o&&t&&De.jsx(R3,{unit:t,onModifyUnit:d}),De.jsx($3,{onStartBattle:f})]}),O3=yn.div`
  position: relative;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
  overflow: hidden;
  display: flex;
  flex-direction: column;
`,kk=(n,e)=>({x:(n+$s)*Kn,y:(e+Gs)*Ur}),Sk=(n,e)=>({col:Math.floor(n/Kn)-$s,row:Math.floor(e/Ur)-Gs}),z3=(n,e)=>{const[t,s]=Le.useState({isDragging:!1,draggedUnit:null,dragOffset:{x:0,y:0}}),r=Le.useCallback(l=>"touches"in l?{clientX:l.touches[0].clientX,clientY:l.touches[0].clientY}:{clientX:l.clientX,clientY:l.clientY},[]),o=Le.useCallback(l=>{const u=l.currentTarget,d=u.getBoundingClientRect(),{clientX:f,clientY:p}=r(l),{col:g,row:x}=Sk((f-d.left)*(u.width/d.width),(p-d.top)*(u.height/d.height)),w=n.find(v=>g>=v.col&&g<v.col+v.sizeCol&&x>=v.row&&x<v.row+v.sizeRow);w&&s({isDragging:!0,draggedUnit:w,dragOffset:{x:f-d.left-kk(w.col,w.row).x/(u.width/d.width),y:p-d.top-kk(w.col,w.row).y/(u.height/d.height)}})},[n,r]),i=Le.useCallback(l=>{if(t.isDragging&&t.draggedUnit){const u=l.currentTarget,d=u.getBoundingClientRect(),{clientX:f,clientY:p}=r(l),{col:g,row:x}=Sk((f-d.left)*(u.width/d.width)-t.dragOffset.x,(p-d.top)*(u.height/d.height)-t.dragOffset.y);e(w=>w.map(v=>v.id===t.draggedUnit.id?{...v,col:Math.max(-$s,Math.min(g,Ks-$s-v.sizeCol)),row:Math.max(-Gs,Math.min(x,qs-Gs-v.sizeRow))}:v))}},[t,e,r]),a=Le.useCallback(()=>{s({isDragging:!1,draggedUnit:null,dragOffset:{x:0,y:0}})},[]);return{isDragging:t.isDragging,handleDragStart:o,handleDragMove:i,handleDragEnd:a}},M3=n=>{const[e,t]=Le.useState(null),s=Le.useCallback((o,i)=>{const a=n.find(l=>o>=l.col&&o<l.col+l.sizeCol&&i>=l.row&&i<l.row+l.sizeRow);return t(a||null),a},[n]),r=Le.useCallback(()=>{t(null)},[]);return{selectedUnit:e,handleUnitSelect:s,setSelectedUnit:t,clearSelection:r}};function Ik(n,e){if(e.length===0)throw new Error("No AI plans available for selection");const t=e.map(r=>({plan:r,score:r.probabilityScore(n)}));t.sort((r,o)=>o.score-r.score);const s=t[0].plan;return console.log("Selected plan:",s.name,"with score:",t[0].score),console.log("All plan scores:"),t.forEach(({plan:r,score:o})=>{console.log(`${r.name}: ${o}`)}),s.units}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P3=1e-7,L3=1e-4;class nI{constructor(e,t){this.backend=e,this.dataMover=t,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,t){this.dataIdsCount++,this.data.set(e,t)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}}class ky{refCount(e){return fs("refCount")}incRef(e){return fs("incRef")}timerAvailable(){return!0}time(e){return fs("time")}read(e){return fs("read")}readSync(e){return fs("readSync")}readToGPU(e,t){return fs("readToGPU")}numDataIds(){return fs("numDataIds")}disposeData(e,t){return fs("disposeData")}write(e,t,s){return fs("write")}move(e,t,s,r,o){return fs("move")}createTensorFromGPUData(e,t,s){return fs("createTensorFromGPUData")}memory(){return fs("memory")}floatPrecision(){return fs("floatPrecision")}epsilon(){return this.floatPrecision()===32?P3:L3}dispose(){return fs("dispose")}}function fs(n){throw new Error(`'${n}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B3(n){let e=n.length,t=0;for(;e>0;)t=Math.random()*e|0,e--,Qa(n,e,t)}function qi(n,e,t){return Math.max(n,Math.min(e,t))}function Sy(n){return n%2===0?n:n+1}function Qa(n,e,t){const s=n[e];n[e]=n[t],n[t]=s}function V3(n){let e=0;for(let t=0;t<n.length;t++)e+=n[t];return e}function O(n,e){if(!n)throw new Error(typeof e=="string"?e:e())}function Iy(n,e,t=""){O(mt(n,e),()=>t+` Shapes ${n} and ${e} must match`)}function $y(n){O(n!=null,()=>"The input to the tensor constructor must be a non-null value.")}function ce(n){if(n.length===0)return 1;let e=n[0];for(let t=1;t<n.length;t++)e*=n[t];return e}function mt(n,e){if(n===e)return!0;if(n==null||e==null||n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(n[t]!==e[t])return!1;return!0}function pl(n){return n%1===0}function Sx(n){const e=Math.ceil(Math.sqrt(n));return[e,Math.ceil(n/e)]}function sl(n,e){return e<=n.length?n:n+" ".repeat(e-n.length)}function $k(n,e=r=>0,t,s){return new Promise((r,o)=>{let i=0;const a=()=>{if(n()){r();return}i++;const l=e(i);if(t!=null&&i>=t){o();return}s!=null?s(a,l):setTimeout(a,l)};a()})}function sI(n,e){let t=1,s=-1;for(let o=0;o<n.length;++o)if(n[o]>=0)t*=n[o];else if(n[o]===-1){if(s!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${o}`);s=o}else if(n[o]<0)throw Error(`Shapes can not be < 0. Found ${n[o]} at dim ${o}`);if(s===-1){if(e>0&&e!==t)throw Error(`Size(${e}) must match the product of shape ${n}`);return n}if(t===0)throw Error(`Cannot infer the missing size in [${n}] when there are 0 elements`);if(e%t!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${t}`);const r=n.slice();return r[s]=e/t,r}function Je(n,e){const t=e.length;return n=n==null?e.map((s,r)=>r):[].concat(n),O(n.every(s=>s>=-t&&s<t),()=>`All values in axis param must be in range [-${t}, ${t}) but got axis ${n}`),O(n.every(s=>pl(s)),()=>`All values in axis param must be integers but got axis ${n}`),n.map(s=>s<0?t+s:s)}function ri(n,e){const t=[],s=[],r=e!=null&&Array.isArray(e)&&e.length===0,o=e==null||r?null:Je(e,n).sort();let i=0;for(let a=0;a<n.length;++a){if(o!=null){if(o[i]===a&&n[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${n[a]}' is not 1`);(o[i]==null||o[i]>a)&&n[a]===1&&(t.push(n[a]),s.push(a)),o[i]<=a&&i++}n[a]!==1&&(t.push(n[a]),s.push(a))}return{newShape:t,keptDims:s}}function _n(n,e){return Ht(n,e)}function Ht(n,e){let t=null;if(n==null||n==="float32")t=new Float32Array(e);else if(n==="int32")t=new Int32Array(e);else if(n==="bool")t=new Uint8Array(e);else if(n==="string")t=new Array(e);else throw new Error(`Unknown data type ${n}`);return t}function W3(n,e){for(let t=0;t<n.length;t++){const s=n[t];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function U3(n){return n==="bool"||n==="complex64"||n==="float32"||n==="int32"||n==="string"}function rI(n,e){return!(e==="complex64"||e==="float32"&&n!=="complex64"||e==="int32"&&n!=="float32"&&n!=="complex64"||e==="bool"&&n==="bool")}function Nf(n){if(n==="float32"||n==="int32")return 4;if(n==="complex64")return 8;if(n==="bool")return 1;throw new Error(`Unknown dtype ${n}`)}function G3(n){if(n==null)return 0;let e=0;return n.forEach(t=>e+=t.length),e}function uu(n){return typeof n=="string"||n instanceof String}function H3(n){return typeof n=="boolean"}function Ix(n){return typeof n=="number"}function Tl(n){return Array.isArray(n)?Tl(n[0]):n instanceof Float32Array?"float32":n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray?"int32":Ix(n)?"float32":uu(n)?"string":H3(n)?"bool":"float32"}function $x(n){return!!(n&&n.constructor&&n.call&&n.apply)}function Tx(n,e){for(let t=e;t<n;++t)if(n%t===0)return t;return n}function ze(n){const e=n.length;if(e<2)return[];const t=new Array(e-1);t[e-2]=n[e-1];for(let s=e-3;s>=0;--s)t[s]=t[s+1]*n[s+1];return t}function oI(n,e,t,s=!1){const r=new Array;if(e.length===1){const o=e[0]*(s?2:1);for(let i=0;i<o;i++)r[i]=t[n+i]}else{const o=e[0],i=e.slice(1),a=i.reduce((l,u)=>l*u)*(s?2:1);for(let l=0;l<o;l++)r[l]=oI(n+l*a,i,t,s)}return r}function xr(n,e,t=!1){if(n.length===0)return e[0];const s=n.reduce((r,o)=>r*o)*(t?2:1);if(s===0)return[];if(s!==e.length)throw new Error(`[${n}] does not match the input size ${e.length}${t?" for a complex tensor":""}.`);return oI(0,n,e,t)}function j3(n,e){if(Array.isArray(n))return n;if(e==="float32")return n instanceof Float32Array?n:new Float32Array(n);if(e==="int32")return n instanceof Int32Array?n:new Int32Array(n);if(e==="bool"||e==="string")return Uint8Array.from(new Int32Array(n));throw new Error(`Unknown dtype ${e}`)}function Ty(n,e){const t=Fn(n,e);for(let s=0;s<t.length;s++)t[s]=1;return t}function Fn(n,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool")return new Uint8Array(n);throw new Error(`Unknown data type ${e}`)}function iI(n,e){const t=n.reduce((s,r)=>s*r,1);if(e==null||e==="float32")return xr(n,new Float32Array(t));if(e==="int32")return xr(n,new Int32Array(t));if(e==="bool")return xr(n,new Uint8Array(t));throw new Error(`Unknown data type ${e}`)}function xo(n){n.forEach(e=>{O(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${n}].`)})}function Mr(n,e,t){if(e===0)return 0;if(e===1)return n[0];let s=n[n.length-1];for(let r=0;r<n.length-1;++r)s+=t[r]*n[r];return s}function Nl(n,e,t){if(e===0)return[];if(e===1)return[n];const s=new Array(e);for(let r=0;r<s.length-1;++r)s[r]=Math.floor(n/t[r]),n-=s[r]*t[r];return s[s.length-1]=n,s}function Ny(n){return n&&n.then&&typeof n.then=="function"}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tk="tfjsflags";class X3{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=K3,this.populateURLFlags()}setPlatform(e,t){this.platform!=null&&(ie().getBool("IS_TEST")||ie().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=t}registerFlag(e,t,s){if(this.flagRegistry[e]={evaluationFn:t,setHook:s},this.urlFlags[e]!=null){const r=this.urlFlags[e];ie().getBool("IS_TEST")||ie().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${r}.`),this.set(e,r)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];const t=this.evaluateFlag(e);if(Ny(t))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=t,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getString(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,t){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=t,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(t)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;const e=this.getQueryParams(this.global.location.search);Tk in e&&e[Tk].split(",").forEach(s=>{const[r,o]=s.split(":");this.urlFlags[r]=Y3(r,o)})}}function K3(n){const e={};return n.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(t,...s)=>(q3(e,s[0],s[1]),s.join("="))),e}function q3(n,e,t){n[decodeURIComponent(e)]=decodeURIComponent(t||"")}function Y3(n,e){const t=e.toLowerCase();return t==="true"||t==="false"?t==="true":`${+t}`===t?+t:e}function ie(){return aI}let aI=null;function Q3(n){aI=n}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */let U0;function lI(){if(U0==null){let n;if(typeof window<"u")n=window;else if(typeof global<"u")n=global;else if(typeof process<"u")n=process;else if(typeof self<"u")n=self;else throw new Error("Could not find a global object");U0=n}return U0}function Z3(){const n=lI();return n._tfGlobals==null&&(n._tfGlobals=new Map),n._tfGlobals}function Ey(n,e){const t=Z3();if(t.has(n))return t.get(n);{const s=e();return t.set(n,s),t.get(n)}}const fp="Abs",hu="Acos",du="Acosh",El="Add",Ry="AddN",Ay="All",Dy="Any",pp="ArgMax",mp="ArgMin",fu="Asin",pu="Asinh",mu="Atan",gu="Atanh",xu="Atan2",gp="AvgPool",_y="AvgPoolGrad",xp="AvgPool3D",Fy="AvgPool3DGrad",yp="BatchMatMul",wp="BatchToSpaceND",Oy="Bincount",zy="BitwiseAnd",J3="BroadcastTo",cI="BroadcastArgs",yu="Cast",wu="Ceil",vu="ClipByValue",My="Complex",vp="ComplexAbs",bp="Concat",Cp="Conv2D",Py="Conv2DBackpropFilter",kp="Conv2DBackpropInput",Sp="Conv3D",Ly="Conv3DBackpropFilterV2",By="Conv3DBackpropInputV2",bu="Cos",Cu="Cosh",Vy="Cumprod",Ip="Cumsum",Wy="CropAndResize",Uy="DenseBincount",Gy="DepthToSpace",$p="DepthwiseConv2dNative",Hy="DepthwiseConv2dNativeBackpropFilter",jy="DepthwiseConv2dNativeBackpropInput",uI="Diag",Tp="Dilation2D",Nx="Dilation2DBackpropInput",Ex="Dilation2DBackpropFilter",eM="Draw",ku="RealDiv",Xy="Einsum",Su="Elu",Ky="EluGrad",Iu="Erf",Np="Equal",$u="Exp",Ep="ExpandDims",Tu="Expm1",qy="FFT",Yy="Fill",Qy="FlipLeftRight",Nu="Floor",Eu="FloorDiv",Rp="FusedBatchNorm",Ap="GatherV2",hI="GatherNd",Dp="Greater",Ru="GreaterEqual",Au="Identity",Zy="IFFT",Jy="Imag",Du="IsFinite",_u="IsInf",Fu="IsNan",_p="LeakyRelu",Fp="Less",Op="LessEqual",dI="LinSpace",Ou="Log",zu="Log1p",zp="LogicalAnd",Mp="LogicalNot",Pp="LogicalOr",tM="LogSoftmax",Lp="LRN",e1="LRNGrad",Bp="Max",Mu="Maximum",Vp="MaxPool",t1="MaxPoolGrad",Wp="MaxPool3D",n1="MaxPool3DGrad",fI="MaxPoolWithArgmax",Up="Mean",Gp="Min",Pu="Minimum",Hp="MirrorPad",Lu="Mod",pI="Multinomial",Bu="Multiply",jp="Neg",Xp="NotEqual",s1="NonMaxSuppressionV3",r1="NonMaxSuppressionV4",o1="NonMaxSuppressionV5",Kp="OnesLike",qp="OneHot",Yp="Pack",Qp="PadV2",Vu="Pow",Zp="Prelu",Jp="Prod",mI="RaggedGather",gI="RaggedRange",xI="RaggedTensorToTensor",i1="Range",a1="Real",Wu="Reciprocal",Uu="Relu",em="Reshape",tm="ResizeNearestNeighbor",l1="ResizeNearestNeighborGrad",nm="ResizeBilinear",c1="ResizeBilinearGrad",Gu="Relu6",sm="Reverse",Hu="Round",ju="Rsqrt",yI="ScatterNd",wI="TensorScatterUpdate",vI="SearchSorted",rm="Select",Xu="Selu",om="Slice",Ku="Sin",qu="Sinh",Yu="Sign",Qu="Sigmoid",Zu="Softplus",Ju="Sqrt",im="Sum",am="SpaceToBatchND",lm="SplitV",cm="Softmax",bI="SparseFillEmptyRows",CI="SparseReshape",kI="SparseSegmentMean",SI="SparseSegmentSum",II="SparseToDense",eh="SquaredDifference",u1="Square",h1="StaticRegexReplace",d1="StridedSlice",$I="StringNGrams",TI="StringSplit",NI="StringToHashBucketFast",th="Sub",nh="Tan",sh="Tanh",rh="Tile",f1="TopK",p1="Transform",rl="Transpose",m1="Unique",um="Unpack",hm="UnsortedSegmentSum",dm="ZerosLike",oh="Step",nM="FromPixels",g1="RotateWithOffset",Ef="_FusedMatMul",Rf="FusedConv2D",EI="FusedDepthwiseConv2D";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ts(...n){ie().getBool("IS_TEST")||ie().getBool("PROD")||console.warn(...n)}function sM(...n){ie().getBool("IS_TEST")||ie().getBool("PROD")||console.log(...n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Af=Ey("kernelRegistry",()=>new Map),Rx=Ey("gradRegistry",()=>new Map);function Nk(n,e){const t=AI(n,e);return Af.get(t)}function Ek(n){return Rx.get(n)}function Rk(n){const e=Af.entries(),t=[];for(;;){const{done:s,value:r}=e.next();if(s)break;const[o,i]=r,[a]=o.split("_");a===n&&t.push(i)}return t}function RI(n){const{kernelName:e,backendName:t}=n,s=AI(e,t);Af.has(s)&&Ts(`The kernel '${e}' for backend '${t}' is already registered`),Af.set(s,n)}function rM(n){const{kernelName:e}=n;Rx.has(e)&&ie().getBool("DEBUG")&&Ts(`Overriding the gradient for '${e}'`),Rx.set(e,n)}function AI(n,e){return`${e}_${n}`}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DI(n){return n instanceof Float32Array||n instanceof Int32Array||n instanceof Uint8Array||n instanceof Uint8ClampedArray}var G0,Ak;function oM(){if(Ak)return G0;Ak=1,G0=e;var n=null;try{n=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function e(_,N,L){this.low=_|0,this.high=N|0,this.unsigned=!!L}e.prototype.__isLong__,Object.defineProperty(e.prototype,"__isLong__",{value:!0});function t(_){return(_&&_.__isLong__)===!0}e.isLong=t;var s={},r={};function o(_,N){var L,G,Q;return N?(_>>>=0,(Q=0<=_&&_<256)&&(G=r[_],G)?G:(L=a(_,(_|0)<0?-1:0,!0),Q&&(r[_]=L),L)):(_|=0,(Q=-128<=_&&_<128)&&(G=s[_],G)?G:(L=a(_,_<0?-1:0,!1),Q&&(s[_]=L),L))}e.fromInt=o;function i(_,N){if(isNaN(_))return N?C:b;if(N){if(_<0)return C;if(_>=x)return A}else{if(_<=-9223372036854776e3)return F;if(_+1>=w)return E}return _<0?i(-_,N).neg():a(_%g|0,_/g|0,N)}e.fromNumber=i;function a(_,N,L){return new e(_,N,L)}e.fromBits=a;var l=Math.pow;function u(_,N,L){if(_.length===0)throw Error("empty string");if(_==="NaN"||_==="Infinity"||_==="+Infinity"||_==="-Infinity")return b;if(typeof N=="number"?(L=N,N=!1):N=!!N,L=L||10,L<2||36<L)throw RangeError("radix");var G;if((G=_.indexOf("-"))>0)throw Error("interior hyphen");if(G===0)return u(_.substring(1),N,L).neg();for(var Q=i(l(L,8)),K=b,Z=0;Z<_.length;Z+=8){var te=Math.min(8,_.length-Z),B=parseInt(_.substring(Z,Z+te),L);if(te<8){var H=i(l(L,te));K=K.mul(H).add(i(B))}else K=K.mul(Q),K=K.add(i(B))}return K.unsigned=N,K}e.fromString=u;function d(_,N){return typeof _=="number"?i(_,N):typeof _=="string"?u(_,N):a(_.low,_.high,typeof N=="boolean"?N:_.unsigned)}e.fromValue=d;var f=65536,p=1<<24,g=f*f,x=g*g,w=x/2,v=o(p),b=o(0);e.ZERO=b;var C=o(0,!0);e.UZERO=C;var $=o(1);e.ONE=$;var S=o(1,!0);e.UONE=S;var T=o(-1);e.NEG_ONE=T;var E=a(-1,2147483647,!1);e.MAX_VALUE=E;var A=a(-1,-1,!0);e.MAX_UNSIGNED_VALUE=A;var F=a(0,-2147483648,!1);e.MIN_VALUE=F;var D=e.prototype;return D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*g+(this.low>>>0):this.high*g+(this.low>>>0)},D.toString=function(N){if(N=N||10,N<2||36<N)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(F)){var L=i(N),G=this.div(L),Q=G.mul(L).sub(this);return G.toString(N)+Q.toInt().toString(N)}else return"-"+this.neg().toString(N);for(var K=i(l(N,6),this.unsigned),Z=this,te="";;){var B=Z.div(K),H=Z.sub(B.mul(K)).toInt()>>>0,X=H.toString(N);if(Z=B,Z.isZero())return X+te;for(;X.length<6;)X="0"+X;te=""+X+te}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(F)?64:this.neg().getNumBitsAbs();for(var N=this.high!=0?this.high:this.low,L=31;L>0&&(N&1<<L)==0;L--);return this.high!=0?L+33:L+1},D.isZero=function(){return this.high===0&&this.low===0},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&this.high<0},D.isPositive=function(){return this.unsigned||this.high>=0},D.isOdd=function(){return(this.low&1)===1},D.isEven=function(){return(this.low&1)===0},D.equals=function(N){return t(N)||(N=d(N)),this.unsigned!==N.unsigned&&this.high>>>31===1&&N.high>>>31===1?!1:this.high===N.high&&this.low===N.low},D.eq=D.equals,D.notEquals=function(N){return!this.eq(N)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(N){return this.comp(N)<0},D.lt=D.lessThan,D.lessThanOrEqual=function(N){return this.comp(N)<=0},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(N){return this.comp(N)>0},D.gt=D.greaterThan,D.greaterThanOrEqual=function(N){return this.comp(N)>=0},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(N){if(t(N)||(N=d(N)),this.eq(N))return 0;var L=this.isNegative(),G=N.isNegative();return L&&!G?-1:!L&&G?1:this.unsigned?N.high>>>0>this.high>>>0||N.high===this.high&&N.low>>>0>this.low>>>0?-1:1:this.sub(N).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(F)?F:this.not().add($)},D.neg=D.negate,D.add=function(N){t(N)||(N=d(N));var L=this.high>>>16,G=this.high&65535,Q=this.low>>>16,K=this.low&65535,Z=N.high>>>16,te=N.high&65535,B=N.low>>>16,H=N.low&65535,X=0,z=0,V=0,oe=0;return oe+=K+H,V+=oe>>>16,oe&=65535,V+=Q+B,z+=V>>>16,V&=65535,z+=G+te,X+=z>>>16,z&=65535,X+=L+Z,X&=65535,a(V<<16|oe,X<<16|z,this.unsigned)},D.subtract=function(N){return t(N)||(N=d(N)),this.add(N.neg())},D.sub=D.subtract,D.multiply=function(N){if(this.isZero())return b;if(t(N)||(N=d(N)),n){var L=n.mul(this.low,this.high,N.low,N.high);return a(L,n.get_high(),this.unsigned)}if(N.isZero())return b;if(this.eq(F))return N.isOdd()?F:b;if(N.eq(F))return this.isOdd()?F:b;if(this.isNegative())return N.isNegative()?this.neg().mul(N.neg()):this.neg().mul(N).neg();if(N.isNegative())return this.mul(N.neg()).neg();if(this.lt(v)&&N.lt(v))return i(this.toNumber()*N.toNumber(),this.unsigned);var G=this.high>>>16,Q=this.high&65535,K=this.low>>>16,Z=this.low&65535,te=N.high>>>16,B=N.high&65535,H=N.low>>>16,X=N.low&65535,z=0,V=0,oe=0,ue=0;return ue+=Z*X,oe+=ue>>>16,ue&=65535,oe+=K*X,V+=oe>>>16,oe&=65535,oe+=Z*H,V+=oe>>>16,oe&=65535,V+=Q*X,z+=V>>>16,V&=65535,V+=K*H,z+=V>>>16,V&=65535,V+=Z*B,z+=V>>>16,V&=65535,z+=G*X+Q*H+K*B+Z*te,z&=65535,a(oe<<16|ue,z<<16|V,this.unsigned)},D.mul=D.multiply,D.divide=function(N){if(t(N)||(N=d(N)),N.isZero())throw Error("division by zero");if(n){if(!this.unsigned&&this.high===-2147483648&&N.low===-1&&N.high===-1)return this;var L=(this.unsigned?n.div_u:n.div_s)(this.low,this.high,N.low,N.high);return a(L,n.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?C:b;var G,Q,K;if(this.unsigned){if(N.unsigned||(N=N.toUnsigned()),N.gt(this))return C;if(N.gt(this.shru(1)))return S;K=C}else{if(this.eq(F)){if(N.eq($)||N.eq(T))return F;if(N.eq(F))return $;var Z=this.shr(1);return G=Z.div(N).shl(1),G.eq(b)?N.isNegative()?$:T:(Q=this.sub(N.mul(G)),K=G.add(Q.div(N)),K)}else if(N.eq(F))return this.unsigned?C:b;if(this.isNegative())return N.isNegative()?this.neg().div(N.neg()):this.neg().div(N).neg();if(N.isNegative())return this.div(N.neg()).neg();K=b}for(Q=this;Q.gte(N);){G=Math.max(1,Math.floor(Q.toNumber()/N.toNumber()));for(var te=Math.ceil(Math.log(G)/Math.LN2),B=te<=48?1:l(2,te-48),H=i(G),X=H.mul(N);X.isNegative()||X.gt(Q);)G-=B,H=i(G,this.unsigned),X=H.mul(N);H.isZero()&&(H=$),K=K.add(H),Q=Q.sub(X)}return K},D.div=D.divide,D.modulo=function(N){if(t(N)||(N=d(N)),n){var L=(this.unsigned?n.rem_u:n.rem_s)(this.low,this.high,N.low,N.high);return a(L,n.get_high(),this.unsigned)}return this.sub(this.div(N).mul(N))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return a(~this.low,~this.high,this.unsigned)},D.and=function(N){return t(N)||(N=d(N)),a(this.low&N.low,this.high&N.high,this.unsigned)},D.or=function(N){return t(N)||(N=d(N)),a(this.low|N.low,this.high|N.high,this.unsigned)},D.xor=function(N){return t(N)||(N=d(N)),a(this.low^N.low,this.high^N.high,this.unsigned)},D.shiftLeft=function(N){return t(N)&&(N=N.toInt()),(N&=63)===0?this:N<32?a(this.low<<N,this.high<<N|this.low>>>32-N,this.unsigned):a(0,this.low<<N-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(N){return t(N)&&(N=N.toInt()),(N&=63)===0?this:N<32?a(this.low>>>N|this.high<<32-N,this.high>>N,this.unsigned):a(this.high>>N-32,this.high>=0?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(N){if(t(N)&&(N=N.toInt()),N&=63,N===0)return this;var L=this.high;if(N<32){var G=this.low;return a(G>>>N|L<<32-N,L>>>N,this.unsigned)}else return N===32?a(L,0,this.unsigned):a(L>>>N-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?a(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:a(this.low,this.high,!0)},D.toBytes=function(N){return N?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var N=this.high,L=this.low;return[L&255,L>>>8&255,L>>>16&255,L>>>24,N&255,N>>>8&255,N>>>16&255,N>>>24]},D.toBytesBE=function(){var N=this.high,L=this.low;return[N>>>24,N>>>16&255,N>>>8&255,N&255,L>>>24,L>>>16&255,L>>>8&255,L&255]},e.fromBytes=function(N,L,G){return G?e.fromBytesLE(N,L):e.fromBytesBE(N,L)},e.fromBytesLE=function(N,L){return new e(N[0]|N[1]<<8|N[2]<<16|N[3]<<24,N[4]|N[5]<<8|N[6]<<16|N[7]<<24,L)},e.fromBytesBE=function(N,L){return new e(N[4]<<24|N[5]<<16|N[6]<<8|N[7],N[0]<<24|N[1]<<16|N[2]<<8|N[3],L)},G0}var _I=oM();const FI=dy(_I),iM=Z_({__proto__:null,default:FI},[_I]);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zi=FI||iM;function fm(n){return zi.fromString(n,!0,16)}const OI=fm("c3a5c85c97cb3127"),_i=fm("b492b66fbe98f273"),Gn=fm("9ae16a3b2f90404f");function Ax(n){return n.xor(n.shru(47))}function zI(n,e,t){const s=n.slice(e,e+t);return zi.fromBytes(Array.from(s),!0,!0)}function It(n,e){return zI(n,e,8)}function Dk(n,e){return zI(n,e,4)}function mn(n,e){return e===0?n:n.shru(e).or(n.shl(64-e))}function Xo(n,e,t=fm("9ddfea08eb382d69")){let s=n.xor(e).mul(t);s=s.xor(s.shru(47));let r=e.xor(s).mul(t);return r=r.xor(r.shru(47)),r=r.mul(t),r}function aM(n,e,t,s,r,o){r=r.add(n),o=mn(o.add(r).add(s),21);const i=r;return r=r.add(e),r=r.add(t),o=o.add(mn(r,44)),[r.add(s),o.add(i)]}function Vd(n,e,t,s){return aM(It(n,e),It(n,e+8),It(n,e+16),It(n,e+24),t,s)}function lM(n,e=n.length){if(e>=8){const t=Gn.add(e*2),s=It(n,0).add(Gn),r=It(n,e-8),o=mn(r,37).mul(t).add(s),i=mn(s,25).add(r).mul(t);return Xo(o,i,t)}if(e>=4){const t=Gn.add(e*2),s=Dk(n,0);return Xo(s.shl(3).add(e),Dk(n,e-4),t)}if(e>0){const t=n[0],s=n[e>>1],r=n[e-1],o=t+(s<<8),i=e+(r<<2);return Ax(Gn.mul(o).xor(OI.mul(i))).mul(Gn)}return Gn}function cM(n,e=n.length){const t=Gn.add(e*2),s=It(n,0).mul(_i),r=It(n,8),o=It(n,e-8).mul(t),i=It(n,e-16).mul(Gn);return Xo(mn(s.add(r),43).add(mn(o,30)).add(i),s.add(mn(r.add(Gn),18)).add(o),t)}function uM(n,e=n.length){const t=Gn.add(e*2),s=It(n,0).mul(Gn),r=It(n,8),o=It(n,e-8).mul(t),i=It(n,e-16).mul(Gn),a=mn(s.add(r),43).add(mn(o,30)).add(i),l=Xo(a,s.add(mn(r.add(Gn),18)).add(o),t),u=It(n,16).mul(t),d=It(n,24),f=a.add(It(n,e-32)).mul(t),p=l.add(It(n,e-24)).mul(t);return Xo(mn(u.add(d),43).add(mn(f,30)).add(p),u.add(mn(d.add(s),18)).add(f),t)}function hM(n,e=n.length){const t=zi.fromNumber(81,!0);if(e<=32)return e<=16?lM(n,e):cM(n,e);if(e<=64)return uM(n,e);let s=t,r=t.mul(_i).add(113),o=Ax(r.mul(Gn).add(113)).mul(Gn),i=[zi.UZERO,zi.UZERO],a=[zi.UZERO,zi.UZERO];s=s.mul(Gn).add(It(n,0));let l=0;const u=(e-1>>6)*64,d=u+(e-1&63)-63;do s=mn(s.add(r).add(i[0]).add(It(n,l+8)),37).mul(_i),r=mn(r.add(i[1]).add(It(n,l+48)),42).mul(_i),s=s.xor(a[1]),r=r.add(i[0]).add(It(n,l+40)),o=mn(o.add(a[0]),33).mul(_i),i=Vd(n,l,i[1].mul(_i),s.add(a[0])),a=Vd(n,l+32,o.add(a[1]),r.add(It(n,l+16))),[o,s]=[s,o],l+=64;while(l!==u);const f=_i.add(o.and(255).shl(1));return l=d,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),s=mn(s.add(r).add(i[0]).add(It(n,l+8)),37).mul(f),r=mn(r.add(i[1]).add(It(n,l+48)),42).mul(f),s=s.xor(a[1].mul(9)),r=r.add(i[0].mul(9).add(It(n,l+40))),o=mn(o.add(a[0]),33).mul(f),i=Vd(n,l,i[1].mul(f),s.add(a[0])),a=Vd(n,l+32,o.add(a[1]),r.add(It(n,l+16))),[o,s]=[s,o],Xo(Xo(i[0],a[0],f).add(Ax(r).mul(OI)).add(o),Xo(i[1],a[1],f).add(s),f)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oi(n,e){return e==="string"?Ko(n):ha([n],e)}function dM(n,e){return n instanceof Float32Array&&e==="float32"||n instanceof Int32Array&&e==="int32"||n instanceof Uint8Array&&e==="bool"}function ha(n,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(n)&&(n=Yi(n)),ie().getBool("DEBUG")&&W3(n,e),dM(n,e))return n;if(e==null||e==="float32"||e==="complex64")return new Float32Array(n);if(e==="int32")return new Int32Array(n);if(e==="bool"){const t=new Uint8Array(n.length);for(let s=0;s<t.length;++s)Math.round(n[s])!==0&&(t[s]=1);return t}else throw new Error(`Unknown data type ${e}`)}function Jn(){return ie().platform.now()}function Ko(n,e="utf-8"){return e=e||"utf-8",ie().platform.encode(n,e)}function Qo(n,e="utf-8"){return e=e||"utf-8",ie().platform.decode(n,e)}function Qs(n){return ie().platform.isTypedArray!=null?ie().platform.isTypedArray(n):DI(n)}function Yi(n,e=[],t=!1){if(e==null&&(e=[]),typeof n=="boolean"||typeof n=="number"||typeof n=="string"||Ny(n)||n==null||Qs(n)&&t)e.push(n);else if(Array.isArray(n)||Qs(n))for(let s=0;s<n.length;++s)Yi(n[s],e,t);else{let s=-1;for(const r of Object.keys(n))/^([1-9]+[0-9]*|0)$/.test(r)&&(s=Math.max(s,Number(r)));for(let r=0;r<=s;r++)Yi(n[r],e,t)}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fM{constructor(e,t){this.backendTimer=e,this.logger=t,t==null&&(this.logger=new mM)}profileKernel(e,t,s){let r;const o=()=>{r=s()};let i;const a=Jn();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(o);else{o();for(const u of r)u.dataSync();i=Promise.resolve({kernelMs:Jn()-a})}if(ie().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<r.length;u++){const d=r[u];d.data().then(f=>{pM(f,d.dtype,e)})}return{kernelName:e,outputs:r,inputs:t,timeMs:i.then(u=>u.kernelMs),extraInfo:i.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){const{kernelName:t,outputs:s,timeMs:r,inputs:o,extraInfo:i}=e;s.forEach(a=>{Promise.all([a.data(),r,i]).then(l=>{this.logger.logKernelProfile(t,a,l[0],l[1],o,l[2])})})}}function pM(n,e,t){if(e!=="float32")return!1;for(let s=0;s<n.length;s++){const r=n[s];if(isNaN(r)||!isFinite(r))return console.warn(`Found ${r} in the result of '${t}'`),!0}return!1}class mM{logKernelProfile(e,t,s,r,o,i){const a=typeof r=="number"?sl(`${r}ms`,9):r.error,l=sl(e,25),u=t.rank,d=t.size,f=sl(t.shape.toString(),14);let p="";for(const g in o){const x=o[g];if(x!=null){const w=x.shape||t.shape,v=w.length;p+=`${g}: ${v}D ${v>0?w:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${f}	%c${d}	%c${p}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gM(n,e,t){const s={},r={};for(let l=0;l<e.length;l++)s[e[l].id]=!0;for(let l=0;l<n.length;l++){const u=n[l],d=u.inputs;for(const f in d){const p=d[f];let g=!1;for(let x=0;x<e.length;x++)if(s[p.id]){u.outputs.forEach(w=>s[w.id]=!0),g=!0,r[u.id]=!0;break}if(g)break}}const o={};o[t.id]=!0;const i={};for(let l=n.length-1;l>=0;l--){const u=n[l],d=u.inputs;for(let f=0;f<u.outputs.length;f++)if(o[u.outputs[f].id]){for(const p in d)o[d[p].id]=!0,i[u.id]=!0;break}}const a=[];for(let l=0;l<n.length;l++){const u=n[l];if(r[u.id]&&i[u.id]){const d={};for(const p in u.inputs){const g=u.inputs[p];s[g.id]&&(d[p]=g)}const f=Object.assign({},u);f.inputs=d,f.outputs=u.outputs,a.push(f)}}return a}function xM(n,e,t,s){for(let r=e.length-1;r>=0;r--){const o=e[r],i=[];if(o.outputs.forEach(l=>{const u=n[l.id];u!=null?i.push(u):i.push(null)}),o.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${o.kernelName}.`);const a=o.gradient(i);for(const l in o.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);const u=t(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);const d=o.inputs[l];if(!mt(u.shape,d.shape))throw new Error(`Error in gradient for op ${o.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${d.shape}'`);if(n[d.id]==null)n[d.id]=u;else{const f=n[d.id];n[d.id]=s(f,u),f.dispose()}}}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _k=20,$c=3,H0=7;function yM(n,e,t,s){const r=ze(e),o=wM(n,e,t,r),i=e.length,a=uf(n,e,t,r,o),l=["Tensor"];return s&&(l.push(`  dtype: ${t}`),l.push(`  rank: ${i}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function wM(n,e,t,s){const r=ce(e),o=s[s.length-1],i=new Array(o).fill(0),a=e.length,l=t==="complex64"?Mc(n):n;if(a>1)for(let u=0;u<r/o;u++){const d=u*o;for(let f=0;f<o;f++)i[f]=Math.max(i[f],zc(l[d+f],0,t).length)}return i}function zc(n,e,t){let s;return Array.isArray(n)?s=`${parseFloat(n[0].toFixed(H0))} + ${parseFloat(n[1].toFixed(H0))}j`:uu(n)?s=`'${n}'`:t==="bool"?s=MI(n):s=parseFloat(n.toFixed(H0)).toString(),sl(s,e)}function MI(n){return n===0?"false":"true"}function uf(n,e,t,s,r,o=!0){const i=t==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(t==="complex64"){const w=Mc(n);return[zc(w[0],0,t)]}return t==="bool"?[MI(n[0])]:[n[0].toString()]}if(l===1){if(a>_k){const v=$c*i;let b=Array.from(n.slice(0,v)),C=Array.from(n.slice((a-$c)*i,a*i));return t==="complex64"&&(b=Mc(b),C=Mc(C)),["["+b.map(($,S)=>zc($,r[S],t)).join(", ")+", ..., "+C.map(($,S)=>zc($,r[a-$c+S],t)).join(", ")+"]"]}return["["+(t==="complex64"?Mc(n):Array.from(n)).map((v,b)=>zc(v,r[b],t)).join(", ")+"]"]}const u=e.slice(1),d=s.slice(1),f=s[0]*i,p=[];if(a>_k){for(let w=0;w<$c;w++){const v=w*f,b=v+f;p.push(...uf(n.slice(v,b),u,t,d,r,!1))}p.push("...");for(let w=a-$c;w<a;w++){const v=w*f,b=v+f;p.push(...uf(n.slice(v,b),u,t,d,r,w===a-1))}}else for(let w=0;w<a;w++){const v=w*f,b=v+f;p.push(...uf(n.slice(v,b),u,t,d,r,w===a-1))}const g=l===2?",":"";p[0]="["+(a>0?p[0]+g:"");for(let w=1;w<p.length-1;w++)p[w]=" "+p[w]+g;let x=`,
`;for(let w=2;w<l;w++)x+=`
`;return p[p.length-1]=" "+p[p.length-1]+"]"+(o?"":x),p}function Mc(n){const e=[];for(let t=0;t<n.length;t+=2)e.push([n[t],n[t+1]]);return e}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tn{constructor(e,t,s){if(this.dtype=t,this.shape=e.slice(),this.size=ce(e),s!=null){const r=s.length;O(r===this.size,()=>`Length of values '${r}' does not match the size inferred by the shape '${this.size}'.`)}if(t==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=s||Ht(t,this.size),this.strides=ze(e)}set(e,...t){t.length===0&&(t=[0]),O(t.length===this.rank,()=>`The number of provided coordinates (${t.length}) must match the rank (${this.rank})`);const s=this.locToIndex(t);this.values[s]=e}get(...e){e.length===0&&(e=[0]);let t=0;for(const r of e){if(r<0||r>=this.shape[t]){const o=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(o)}t++}let s=e[e.length-1];for(let r=0;r<e.length-1;++r)s+=this.strides[r]*e[r];return this.values[s]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let t=e[e.length-1];for(let s=0;s<e.length-1;++s)t+=this.strides[s]*e[s];return t}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];const t=new Array(this.shape.length);for(let s=0;s<t.length-1;++s)t[s]=Math.floor(e/this.strides[s]),e-=t[s]*this.strides[s];return t[t.length-1]=e,t}get rank(){return this.shape.length}toTensor(){return dr().makeTensor(this.values,this.shape,this.dtype)}}let dr=null,Za=null;function vM(n){dr=n}function bM(n){Za=n}class rn{constructor(e,t,s,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=t||"float32",this.size=ce(e),this.strides=ze(e),this.dataId=s,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const e=await this.data();return Za.buffer(this.shape,this.dtype,e)}bufferSync(){return Za.buffer(this.shape,this.dtype,this.dataSync())}async array(){const e=await this.data();return xr(this.shape,e,this.dtype==="complex64")}arraySync(){return xr(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();const e=dr().read(this.dataId);if(this.dtype==="string"){const t=await e;try{return t.map(s=>Qo(s))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),dr().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();const e=dr().readSync(this.dataId);if(this.dtype==="string")try{return e.map(t=>Qo(t))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();const e=await dr().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(this.kerasMask&&this.kerasMask.dispose(),dr().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Za.print(this,e)}clone(){return this.throwIfDisposed(),Za.clone(this)}toString(e=!1){const t=this.dataSync();return yM(t,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Za.cast(this,e)}variable(e=!0,t,s){return this.throwIfDisposed(),dr().makeVariable(this,e,t,s)}}Object.defineProperty(rn,Symbol.hasInstance,{value:n=>!!n&&n.data!=null&&n.dataSync!=null&&n.throwIfDisposed!=null});function le(){return Ey("Tensor",()=>rn)}le();class Df extends rn{constructor(e,t,s,r){super(e.shape,e.dtype,e.dataId,r),this.trainable=t,this.name=s}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!mt(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);dr().disposeTensor(this),this.dataId=e.dataId,dr().incRef(this,null)}dispose(){dr().disposeVariable(this),this.isDisposedInternal=!0}}Object.defineProperty(Df,Symbol.hasInstance,{value:n=>n instanceof rn&&n.assign!=null&&n.assign instanceof Function});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Fk;(function(n){n.R0="R0",n.R1="R1",n.R2="R2",n.R3="R3",n.R4="R4",n.R5="R5",n.R6="R6"})(Fk||(Fk={}));var Dx;(function(n){n.float32="float32",n.int32="int32",n.bool="int32",n.complex64="complex64"})(Dx||(Dx={}));var _x;(function(n){n.float32="float32",n.int32="int32",n.bool="bool",n.complex64="complex64"})(_x||(_x={}));var Fx;(function(n){n.float32="float32",n.int32="float32",n.bool="float32",n.complex64="complex64"})(Fx||(Fx={}));var Ox;(function(n){n.float32="complex64",n.int32="complex64",n.bool="complex64",n.complex64="complex64"})(Ox||(Ox={}));const CM={float32:Fx,int32:Dx,bool:_x,complex64:Ox};function xs(n,e){if(n==="string"||e==="string"){if(n==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${n} with ${e}`)}return CM[n][e]}function x1(n){return xs(n,"int32")}function PI(n){return n!=null&&typeof n=="object"&&"texture"in n&&n.texture instanceof WebGLTexture}function LI(n){return typeof GPUBuffer<"u"&&n!=null&&typeof n=="object"&&"buffer"in n&&n.buffer instanceof GPUBuffer}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xt(n,e){if(n.dtype===e.dtype)return[n,e];const t=xs(n.dtype,e.dtype);return[n.cast(t),e.cast(t)]}function BI(n){const e=[];return VI(n,e,new Set),e}function VI(n,e,t){if(n==null)return;if(n instanceof rn){e.push(n);return}if(!kM(n))return;const s=n;for(const r in s){const o=s[r];t.has(o)||(t.add(o),VI(o,e,t))}}function kM(n){return Array.isArray(n)||typeof n=="object"}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j0(n){return n.kernelName!=null}class Ok{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(const e in this.registeredVariables)this.registeredVariables[e].dispose()}}class ml{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ok}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t];if(await this.initializeBackend(s).success){await this.setBackend(s);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){const{name:e,asyncInit:t}=this.initializeBackendsAndReturnBest();if(t)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){const{asyncInit:t}=this.initializeBackend(e);if(t)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,t,s=1){return e in this.registryFactory?(Ts(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:t,priority:s},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;const{success:t,asyncInit:s}=this.initializeBackend(e);if(!(s?await t:t))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new fM(this.backendInstance),!0}setupRegisteredKernels(){Rk(this.backendName).forEach(t=>{t.setupFunc!=null&&t.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){Rk(e).forEach(s=>{s.disposeFunc!=null&&s.disposeFunc(this.registry[e])})}initializeBackend(e){const t=this.registryFactory[e];if(t==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{const s=t.factory();if(s&&!(s instanceof ky)&&typeof s.then=="function"){const r=++this.pendingBackendInitId,o=s.then(i=>r<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(r<this.pendingBackendInitId||(this.pendingBackendInit=null,Ts(`Initialization of backend ${e} failed`),Ts(i.stack||i.message)),!1));return this.pendingBackendInit=o,{success:o,asyncInit:!0}}else return this.registry[e]=s,{success:!0,asyncInit:!1}}catch(s){return Ts(`Initialization of backend ${e} failed`),Ts(s.stack||s.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,t)=>this.registryFactory[t].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){const e=this.getSortedBackends();for(let t=0;t<e.length;t++){const s=e[t],{success:r,asyncInit:o}=this.initializeBackend(s);if(o||r)return{name:s,asyncInit:o}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,t){const s=this.state.tensorInfo.get(t),r=s.backend,o=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),s.backend=e,e.move(t,o,s.shape,s.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,t){let s=null;if(t==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");t=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof t!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=e}let r;return this.scopedRun(()=>this.startScope(s),()=>this.endScope(r),()=>(r=t(),r instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),r))}scopedRun(e,t,s){e();try{const r=s();return t(),r}catch(r){throw t(),r}}nextTensorId(){return ml.nextTensorId++}nextVariableId(){return ml.nextVariableId++}clone(e){const t=Y.runKernel(Au,{x:e}),s={x:e},r=i=>({x:()=>{const a="float32",l={x:i},u={dtype:a};return Y.runKernel(yu,l,u)}}),o=[];return this.addTapeNode(this.state.activeScope.name,s,[t],r,o,{}),t}runKernel(e,t,s){if(this.backendName==null&&this.backend,!(Nk(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:t,attrs:s})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,t,s){const r=this.backend.numDataIds();let o=0;s.forEach(l=>{o+=l.dtype==="complex64"?3:1});const i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=r-t-o-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let t,s=[];const r=this.isTapeOn(),o=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l;const u=j0(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(j0(e)){const{kernelName:x,inputs:w,attrs:v}=e;this.backendName==null&&this.backend;const b=Nk(x,this.backendName);O(b!=null,()=>`Cannot find registered kernel '${x}' for backend '${this.backendName}'`),a=()=>{const C=this.backend.numDataIds();l=b.kernelFunc({inputs:w,attrs:v,backend:this.backend});const $=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(x,C,$);const S=$.map(T=>T.rank!=null?T:this.makeTensorFromTensorInfo(T));if(r){const T=this.getTensorsForGradient(x,w,S);s=this.saveTensorsForBackwardMode(T)}return S}}else{const{forwardFunc:x}=e,w=v=>{r&&(s=v.map(b=>this.keep(this.clone(b))))};a=()=>{const v=this.backend.numDataIds();l=this.tidy(()=>x(this.backend,w));const b=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,v,b),b}}const{inputs:d,attrs:f}=e,p=j0(e)?null:e.backwardsFunc;let g;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?t=a():(g=this.profiler.profileKernel(u,d,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(g),t=g.outputs)}),r&&this.addTapeNode(u,d,t,p,s,f),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-o,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(d).map(x=>d[x]!=null?d[x].shape:null),outputShapes:t.map(x=>x.shape),kernelTimeMs:g.timeMs,extraInfo:g.extraInfo}),Array.isArray(l)?t:t[0]}saveTensorsForBackwardMode(e){return e.map(s=>this.keep(this.clone(s)))}getTensorsForGradient(e,t,s){const r=Ek(e);if(r!=null){const o=r.inputsToSave||[],i=r.outputsToSave||[];let a;r.saveAllInputs?(O(Array.isArray(t),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(t).map(u=>t[u])):a=o.map(u=>t[u]);const l=s.filter((u,d)=>i[d]);return a.concat(l)}return[]}makeTensor(e,t,s,r){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");s=s||"float32",r=r||this.backend;let o=e;s==="string"&&uu(e[0])&&(o=e.map(l=>Ko(l)));const i=r.write(o,t,s),a=new rn(t,s,i,this.nextTensorId());if(this.trackTensor(a,r),s==="string"){const l=this.state.tensorInfo.get(i),u=G3(o);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,t,s,r){s=s||"float32";const o={dataId:e,shape:t,dtype:s};return this.makeTensorFromTensorInfo(o,r)}makeTensorFromTensorInfo(e,t){const{dataId:s,shape:r,dtype:o}=e,i=new rn(r,o,s,this.nextTensorId());return this.trackTensor(i,t),i}makeVariable(e,t=!0,s,r){s=s||this.nextVariableId().toString(),r!=null&&r!==e.dtype&&(e=e.cast(r));const o=new Df(e,t,s,this.nextTensorId());if(this.state.registeredVariables[o.name]!=null)throw new Error(`Variable with name ${o.name} was already registered`);return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o}trackTensor(e,t){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let s=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(s=e.size*Nf(e.dtype)),this.state.numBytes+=s,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:s})),e instanceof Df||this.track(e)}incRef(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}removeDataId(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;const t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){const s=e.size*Nf(e.dtype);this.state.numBytes-=s}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}disposeVariables(){for(const e in this.state.registeredVariables){const t=this.state.registeredVariables[e];this.disposeVariable(t)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){const e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;const t=this.state.numBytes,s=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(r=>r.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-t,this.state.activeProfile.newTensors=this.state.numTensors-s;for(const r of this.state.activeProfile.kernels)r.kernelTimeMs=await r.kernelTimeMs,r.extraInfo=await r.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,t,s,r,o,i){const a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:s,saved:o},l=Ek(e);l!=null&&(r=l.gradFunc),r!=null&&(a.gradient=u=>(u=u.map((d,f)=>{if(d==null){const p=s[f],g=Fn(p.size,p.dtype);return this.makeTensor(g,p.shape,p.dtype)}return d}),r(u.length>1?u:u[0],o,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){const t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}endScope(e){const t=BI(e),s=new Set(t.map(o=>o.id));for(let o=0;o<this.state.activeScope.track.length;o++){const i=this.state.activeScope.track[o];!i.kept&&!s.has(i.id)&&i.dispose()}const r=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],t.forEach(o=>{!o.kept&&o.scopeId===r.id&&this.track(o)})}gradients(e,t,s,r=!1){if(O(t.length>0,()=>"gradients() received an empty list of xs."),s!=null&&s.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${s.dtype}'`);const o=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));O(o instanceof rn,()=>"The result y returned by f() must be a tensor.");const i=gM(this.state.activeTape,t,o);if(!r&&i.length===0&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{const a={};a[o.id]=s??SM(o.shape),xM(a,i,u=>this.tidy(u),IM);const l=t.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(const d of u.saved)d.dispose()}),this.state.activeTape=null),{value:o,grads:l}})}customGrad(e){return O($x(e),()=>"The f passed in customGrad(f) must be a function."),(...t)=>{O(t.every(a=>a instanceof rn),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let s;const r={};t.forEach((a,l)=>{r[l]=a});const o=(a,l)=>(s=e(...t,l),O(s.value instanceof rn,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),O($x(s.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),s.value),i=(a,l)=>{const u=s.gradFunc(a,l),d=Array.isArray(u)?u:[u];O(d.length===t.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),O(d.every(p=>p instanceof rn),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");const f={};return d.forEach((p,g)=>{f[g]=()=>p}),f};return this.runKernelFunc({forwardFunc:o,backwardsFunc:i,inputs:r})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}async time(e){const t=Jn(),s=await this.backend.time(e);return s.wallMs=Jn()-t,s}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ok;for(const e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}ml.nextTensorId=0;ml.nextVariableId=0;function SM(n){const e=Ty(ce(n),"float32");return Y.makeTensor(e,n,"float32")}function WI(){const n=lI();if(n._tfengine==null){const e=new X3(n);n._tfengine=new ml(e)}return Q3(n._tfengine.ENV),vM(()=>n._tfengine),n._tfengine}const Y=WI();function IM(n,e){const t={a:n,b:e};return Y.runKernel(El,t)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $M(){return typeof navigator<"u"&&navigator!=null}function UI(n){if(n||$M()){if(n||(n=navigator),n.product==="ReactNative")return!0;const e=n.userAgent||n.vendor||(typeof window<"u"?window.opera:"");if(!e){const t=n;return t.userAgentData&&t.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function GI(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ss=ie();ss.registerFlag("DEBUG",()=>!1,n=>{n&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});ss.registerFlag("IS_BROWSER",()=>GI());ss.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");ss.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));ss.registerFlag("IS_SAFARI",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Safari/.test(navigator.userAgent)&&/Apple/.test(navigator.vendor));ss.registerFlag("PROD",()=>!1);ss.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>ss.getBool("DEBUG"));ss.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);ss.registerFlag("IS_TEST",()=>!1);ss.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>ss.getBool("DEBUG"));ss.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);ss.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);ss.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ih(n,e){let t=n;if(Qs(n))return e==="string"?[]:[n.length];if(PI(n)){const r=n.channels||"RGBA";return[n.height,n.width*r.length]}else if(LI(n))return[n.buffer.size/(e==null?4:Nf(e))];if(!Array.isArray(n))return[];const s=[];for(;Array.isArray(t)||Qs(t)&&e!=="string";)s.push(t.length),t=t[0];return Array.isArray(n)&&ie().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&HI(n,s,[]),s}function HI(n,e,t){if(t=t||[],!Array.isArray(n)&&!Qs(n)){O(e.length===0,()=>`Element arr[${t.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}O(e.length>0,()=>`Element arr[${t.join("][")}] should be a primitive, but is an array of ${n.length} elements`),O(n.length===e[0],()=>`Element arr[${t.join("][")}] should have ${e[0]} elements, but has ${n.length} elements`);const s=e.slice(1);for(let r=0;r<n.length;++r)HI(n[r],s,t.concat(r))}function zk(n,e,t,s){if(n!=="string_or_numeric"){if(n==null)throw new Error("Expected dtype cannot be null.");if(n!=="numeric"&&n!==e||n==="numeric"&&e==="string")throw new Error(`Argument '${t}' passed to '${s}' must be ${n} tensor, but got ${e} tensor`)}}function P(n,e,t,s="numeric"){if(n instanceof le())return zk(s,n.dtype,e,t),n;let r=Tl(n);if(r!=="string"&&["bool","int32","float32"].indexOf(s)>=0&&(r=s),zk(s,r,e,t),n==null||!Qs(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string"){const l=n==null?"null":n.constructor.name;throw new Error(`Argument '${e}' passed to '${t}' must be a Tensor or TensorLike, but got '${l}'`)}const o=ih(n,r);!Qs(n)&&!Array.isArray(n)&&(n=[n]);const a=r!=="string"?ha(n,r):Yi(n,[],!0);return Y.makeTensor(a,o,r)}function jI(n,e,t,s="numeric"){if(!Array.isArray(n))throw new Error(`Argument ${e} passed to ${t} must be a \`Tensor[]\` or \`TensorLike[]\``);return n.map((o,i)=>P(o,`${e}[${i}]`,t,s))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TM="__op";function ee(n){const e=Object.keys(n);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let t=e[0];const s=n[t];t.endsWith("_")&&(t=t.substring(0,t.length-1)),t=t+TM;const r=(...o)=>{Y.startScope(t);try{const i=s(...o);return Ny(i)&&console.error("Cannot return a Promise inside of tidy."),Y.endScope(i),i}catch(i){throw Y.endScope(null),i}};return Object.defineProperty(r,"name",{value:t,configurable:!0}),r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NM(n,e){const t=P(n,"real","complex"),s=P(e,"imag","complex");Iy(t.shape,s.shape,`real and imag shapes, ${t.shape} and ${s.shape}, must match in call to tf.complex().`);const r={real:t,imag:s};return Y.runKernel(My,r)}const Qi=ee({complex_:NM});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ah(n,e,t,s){if(s==null)s=Tl(n);else if(s==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(LI(n)||PI(n)){if(s!=="float32"&&s!=="int32")throw new Error(`Creating tensor from GPU data only supports 'float32'|'int32' dtype, while the dtype is ${s}.`);return Y.backend.createTensorFromGPUData(n,e||t,s)}if(!Qs(n)&&!Array.isArray(n)&&typeof n!="number"&&typeof n!="boolean"&&typeof n!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){xo(e);const r=ce(e),o=ce(t);O(r===o,()=>`Based on the provided shape, [${e}], the tensor should have ${r} values but has ${o}`);for(let i=0;i<t.length;++i){const a=t[i],l=i===t.length-1?a!==ce(e.slice(i)):!0;O(t[i]===e[i]||!l,()=>`Error creating a new Tensor. Inferred shape (${t}) does not match the provided shape (${e}). `)}}return!Qs(n)&&!Array.isArray(n)&&(n=[n]),e=e||t,n=s!=="string"?ha(n,s):Yi(n,[],!0),Y.makeTensor(n,e,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uc(n,e,t){const s=ih(n,t);return ah(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _f={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};class ii{static join(e){return new ii(e).slice()}constructor(e){if(this.shards=[],this.previousShardIndex=0,e==null||(e instanceof Array||(e=[e]),e=e.map(s=>Qs(s)?s.buffer:s),e.length===0))return;this.bufferUniformSize=e[0].byteLength;let t=0;for(let s=0;s<e.length;s++){const r=e[s];s!==e.length-1&&r.byteLength!==this.bufferUniformSize&&(this.bufferUniformSize=void 0);const o=t+r.byteLength;this.shards.push({buffer:r,start:t,end:o}),t=o}this.shards.length===0&&(this.byteLength=0),this.byteLength=this.shards[this.shards.length-1].end}slice(e=0,t=this.byteLength){if(this.shards.length===0)return new ArrayBuffer(0);if(e=isNaN(Number(e))?0:e,t=isNaN(Number(t))?0:t,e=Math.max(0,e),t=Math.min(this.byteLength,t),t<=e)return new ArrayBuffer(0);const s=this.findShardForByte(e);if(s===-1)throw new Error(`Could not find start shard for byte ${e}`);const r=t-e,o=new ArrayBuffer(r),i=new Uint8Array(o);let a=0;for(let l=s;l<this.shards.length;l++){const u=this.shards[l],f=e+a-u.start,p=a,x=Math.min(t,u.end)-u.start,w=new Uint8Array(u.buffer,f,x-f);if(i.set(w,p),a+=w.length,t<u.end)break}return o}findShardForByte(e){if(this.shards.length===0||e<0||e>=this.byteLength)return-1;if(this.bufferUniformSize!=null)return this.previousShardIndex=Math.floor(e/this.bufferUniformSize),this.previousShardIndex;function t(r){return e<r.start?-1:e>=r.end?1:0}if(t(this.shards[this.previousShardIndex])===0)return this.previousShardIndex;const s=EM(this.shards,t);return s===-1?-1:(this.previousShardIndex=s,this.previousShardIndex)}}function EM(n,e){let t=0,s=n.length;for(;t<=s;){const r=Math.floor((s-t)/2)+t,o=e(n[r]);if(o===0)return r;o<0?s=r:t=r+1}return-1}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rr(){return Y}function Mk(){return Y.memory()}function se(n,e){return Y.tidy(n,e)}function Ye(n){BI(n).forEach(t=>t.dispose())}function Pr(n){return Y.keep(n)}function XI(n,e,t=1){return Y.registerBackend(n,e,t)}function RM(){return Y.backend}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gl=4;async function Pk(n,e){const t=[],s=[],r=Array.isArray(n)?n.map(i=>i.name):Object.keys(n);for(let i=0;i<r.length;++i){const a=r[i],l=Array.isArray(n)?n[i].tensor:n[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);const u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){const d=new Promise(async f=>{const p=await l.bytes(),g=p.reduce((v,b)=>v+b.length,0)+gl*p.length,x=new Uint8Array(g);let w=0;for(let v=0;v<p.length;v++){const b=p[v],C=new Uint8Array(new Uint32Array([b.length]).buffer);x.set(C,w),w+=gl,x.set(b,w),w+=b.length}f(x)});s.push(d)}else s.push(l.data());e!=null&&(u.group=e),t.push(u)}const o=await Promise.all(s);return{data:FM(o),specs:t}}function AM(n,e){const t=new ii(n),s={};let r=0;for(const o of e){const i=DM(o,(a,l)=>t.slice(r+a,r+l));s[o.name]=_M(o,t.slice(r,r+i)),r+=i}return s}function DM(n,e){const t=ce(n.shape);let s;if("quantization"in n){const r=n.quantization;s=_f[r.dtype]}else if(n.dtype==="string"){let r=0;for(let o=0;o<t;o++)r+=gl+new Uint32Array(e(r,r+gl))[0];return r}else s=_f[n.dtype];return t*s}function _M(n,e){const t=n.name,s=n.dtype,r=n.shape,o=ce(r);let i,a=0;if("quantization"in n){const l=n.quantization;if(l.dtype==="uint8"||l.dtype==="uint16"){if(!("min"in l&&"scale"in l))throw new Error(`Weight ${n.name} with quantization ${l.dtype} doesn't have corresponding metadata min and scale.`)}else if(l.dtype==="float16"){if(s!=="float32")throw new Error(`Weight ${n.name} is quantized with ${l.dtype} which only supports weights of type float32 not ${s}.`)}else throw new Error(`Weight ${n.name} has unknown quantization dtype ${l.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);const u=_f[l.dtype],d=l.dtype==="uint8"?new Uint8Array(e):new Uint16Array(e);if(s==="float32")if(l.dtype==="uint8"||l.dtype==="uint16"){i=new Float32Array(d.length);for(let f=0;f<d.length;f++){const p=d[f];i[f]=p*l.scale+l.min}}else if(l.dtype==="float16")i=GM()(d);else throw new Error(`Unsupported quantization type ${l.dtype} for weight type float32.`);else if(s==="int32"){if(l.dtype!=="uint8"&&l.dtype!=="uint16")throw new Error(`Unsupported quantization type ${l.dtype} for weight type int32.`);i=new Int32Array(d.length);for(let f=0;f<d.length;f++){const p=d[f];i[f]=Math.round(p*l.scale+l.min)}}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=o*u}else if(s==="string"){const l=ce(n.shape);i=[];for(let u=0;u<l;u++){const d=new Uint32Array(e.slice(a,a+gl))[0];a+=gl;const f=new Uint8Array(e.slice(a,a+d));i.push(f),a+=d}}else{const l=_f[s];if(s==="float32")i=new Float32Array(e);else if(s==="int32")i=new Int32Array(e);else if(s==="bool")i=new Uint8Array(e);else if(s==="complex64"){i=new Float32Array(e);const u=new Float32Array(i.length/2),d=new Float32Array(i.length/2);for(let x=0;x<u.length;x++)u[x]=i[x*2],d[x]=i[x*2+1];const f=Uc(u,r,"float32"),p=Uc(d,r,"float32"),g=Qi(f,p);return f.dispose(),p.dispose(),g}else throw new Error(`Unsupported dtype in weight '${t}': ${s}`);a+=o*l}return Uc(i,r,s)}function FM(n){if(n===null)throw new Error(`Invalid input value: ${JSON.stringify(n)}`);let e=0;const t=[];n.forEach(o=>{if(e+=o.byteLength,t.push(o.byteLength===o.buffer.byteLength?o:new o.constructor(o)),!(o instanceof Float32Array||o instanceof Int32Array||o instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${o.constructor.name}`)});const s=new Uint8Array(e);let r=0;return t.forEach(o=>{s.set(new Uint8Array(o.buffer),r),r+=o.byteLength}),s.buffer}const y1=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function Lk(n){return y1?Buffer.byteLength(n,"utf8"):new Blob([n]).size}function OM(n){if(y1)return Buffer.from(n).toString("base64");const e=new Uint8Array(n);let t="";for(let s=0,r=e.length;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function zM(n){if(y1){const s=Buffer.from(n,"base64");return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength)}const e=atob(n),t=new Uint8Array(e.length);for(let s=0;s<e.length;++s)t.set([e.charCodeAt(s)],s);return t.buffer}function MM(n){return ii.join(n)}function PM(n,e){const t={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy,weightsManifest:e};return n.signature!=null&&(t.signature=n.signature),n.userDefinedMetadata!=null&&(t.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(t.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(t.initializerSignature=n.initializerSignature),n.trainingConfig!=null&&(t.trainingConfig=n.trainingConfig),t}function LM(n,e,t){const s={modelTopology:n.modelTopology,format:n.format,generatedBy:n.generatedBy,convertedBy:n.convertedBy};if(n.trainingConfig!=null&&(s.trainingConfig=n.trainingConfig),n.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!t)throw new Error("modelJSON has weightsManifest but weightData is null");s.weightSpecs=e,s.weightData=t}return n.signature!=null&&(s.signature=n.signature),n.userDefinedMetadata!=null&&(s.userDefinedMetadata=n.userDefinedMetadata),n.modelInitializer!=null&&(s.modelInitializer=n.modelInitializer),n.initializerSignature!=null&&(s.initializerSignature=n.initializerSignature),s}async function BM(n,e){let t,s;return n.weightsManifest!=null&&([t,s]=await e(n.weightsManifest)),LM(n,t,s)}function w1(n){if(n.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:n.modelTopology==null?0:Lk(JSON.stringify(n.modelTopology)),weightSpecsBytes:n.weightSpecs==null?0:Lk(JSON.stringify(n.weightSpecs)),weightDataBytes:n.weightData==null?0:new ii(n.weightData).byteLength}}function Bk(n){const e=[];for(const t of n)e.push(...t.weights);return e}function VM(){const n=t=>{let s=t<<13,r=0;for(;(s&8388608)===0;)r-=8388608,s<<=1;return s&=-8388609,r+=947912704,s|r},e=new Uint32Array(2048);e[0]=0;for(let t=1;t<1024;t++)e[t]=n(t);for(let t=1024;t<2048;t++)e[t]=939524096+(t-1024<<13);return e}function WM(){const n=new Uint32Array(64);n[0]=0,n[31]=1199570944,n[32]=2147483648,n[63]=3347054592;for(let e=1;e<31;e++)n[e]=e<<23;for(let e=33;e<63;e++)n[e]=2147483648+(e-32<<23);return n}function UM(){const n=new Uint32Array(64);for(let e=0;e<64;e++)n[e]=1024;return n[0]=n[32]=0,n}function GM(){const n=VM(),e=WM(),t=UM();return s=>{const r=new ArrayBuffer(4*s.length),o=new Uint32Array(r);for(let i=0;i<s.length;i++){const a=s[i],l=n[t[a>>10]+(a&1023)]+e[a>>10];o[i]=l}return new Float32Array(r)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pn{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return pn.instance==null&&(pn.instance=new pn),pn.instance}static registerSaveRouter(e){pn.getInstance().saveRouters.push(e)}static registerLoadRouter(e){pn.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return pn.getHandlers(e,"save")}static getLoadHandlers(e,t){return pn.getHandlers(e,"load",t)}static getHandlers(e,t,s){const r=[];return(t==="load"?pn.getInstance().loadRouters:pn.getInstance().saveRouters).forEach(i=>{const a=i(e,s);a!==null&&r.push(a)}),r}}const HM=n=>pn.getSaveHandlers(n),jM=(n,e)=>pn.getLoadHandlers(n,e);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zx="tensorflowjs",Mx=1,Bi="models_store",Uo="model_info_store";function KI(){if(!ie().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const n=typeof window>"u"?self:window,e=n.indexedDB||n.mozIndexedDB||n.webkitIndexedDB||n.msIndexedDB||n.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Px(n){const e=n.result;e.createObjectStore(Bi,{keyPath:"modelPath"}),e.createObjectStore(Uo,{keyPath:"modelPath"})}class Zi{constructor(e){if(this.indexedDB=KI(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,t){return new Promise((s,r)=>{const o=this.indexedDB.open(zx,Mx);o.onupgradeneeded=()=>Px(o),o.onsuccess=()=>{const i=o.result;if(t==null){const a=i.transaction(Bi,"readonly"),u=a.objectStore(Bi).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return i.close(),r(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));s(u.result.modelArtifacts)},u.onerror=d=>(i.close(),r(u.error)),a.oncomplete=()=>i.close()}else{t.weightData=ii.join(t.weightData);const a=w1(t),l=i.transaction(Uo,"readwrite");let u=l.objectStore(Uo),d;try{d=u.put({modelPath:this.modelPath,modelArtifactsInfo:a})}catch(p){return r(p)}let f;d.onsuccess=()=>{f=i.transaction(Bi,"readwrite");const p=f.objectStore(Bi);let g;try{g=p.put({modelPath:this.modelPath,modelArtifacts:t,modelArtifactsInfo:a})}catch(x){return r(x)}g.onsuccess=()=>s({modelArtifactsInfo:a}),g.onerror=x=>{u=l.objectStore(Uo);const w=u.delete(this.modelPath);w.onsuccess=()=>(i.close(),r(g.error)),w.onerror=v=>(i.close(),r(g.error))}},d.onerror=p=>(i.close(),r(d.error)),l.oncomplete=()=>{f==null?i.close():f.oncomplete=()=>i.close()}}},o.onerror=i=>r(o.error)})}}Zi.URL_SCHEME="indexeddb://";const qI=n=>ie().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Zi.URL_SCHEME)?XM(n.slice(Zi.URL_SCHEME.length)):null;pn.registerSaveRouter(qI);pn.registerLoadRouter(qI);function XM(n){return new Zi(n)}function KM(n){return n.startsWith(Zi.URL_SCHEME)?n.slice(Zi.URL_SCHEME.length):n}class qM{constructor(){this.indexedDB=KI()}async listModels(){return new Promise((e,t)=>{const s=this.indexedDB.open(zx,Mx);s.onupgradeneeded=()=>Px(s),s.onsuccess=()=>{const r=s.result,o=r.transaction(Uo,"readonly"),a=o.objectStore(Uo).getAll();a.onsuccess=()=>{const l={};for(const u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(r.close(),t(a.error)),o.oncomplete=()=>r.close()},s.onerror=r=>t(s.error)})}async removeModel(e){return e=KM(e),new Promise((t,s)=>{const r=this.indexedDB.open(zx,Mx);r.onupgradeneeded=()=>Px(r),r.onsuccess=()=>{const o=r.result,i=o.transaction(Uo,"readwrite"),a=i.objectStore(Uo),l=a.get(e);let u;l.onsuccess=()=>{if(l.result==null)return o.close(),s(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{const d=a.delete(e),f=()=>{u=o.transaction(Bi,"readwrite");const g=u.objectStore(Bi).delete(e);g.onsuccess=()=>t(l.result.modelArtifactsInfo),g.onerror=x=>s(l.error)};d.onsuccess=f,d.onerror=p=>(f(),o.close(),s(l.error))}},l.onerror=d=>(o.close(),s(l.error)),i.oncomplete=()=>{u==null?o.close():u.oncomplete=()=>o.close()}},r.onerror=o=>s(r.error)})}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const co="/",Ja="tensorflowjs_models",YI="info",YM="model_topology",QM="weight_specs",ZM="weight_data",JM="model_metadata";function QI(n){return{info:[Ja,n,YI].join(co),topology:[Ja,n,YM].join(co),weightSpecs:[Ja,n,QM].join(co),weightData:[Ja,n,ZM].join(co),modelMetadata:[Ja,n,JM].join(co)}}function ZI(n){for(const e of Object.values(n))window.localStorage.removeItem(e)}function eP(n){const e=n.split(co);if(e.length<3)throw new Error(`Invalid key format: ${n}`);return e.slice(1,e.length-1).join(co)}function tP(n){return n.startsWith(Ji.URL_SCHEME)?n.slice(Ji.URL_SCHEME.length):n}class Ji{constructor(e){if(!ie().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=QI(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const t=JSON.stringify(e.modelTopology),s=JSON.stringify(e.weightSpecs),r=w1(e),o=ii.join(e.weightData);try{this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,t),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,OM(o));const i={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),{modelArtifactsInfo:r}}catch{throw ZI(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${r.modelTopologyBytes}, weightSpecsBytes=${r.weightSpecsBytes}, weightDataBytes=${r.weightDataBytes}.`)}}}async load(){const e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const t={},s=JSON.parse(this.LS.getItem(this.keys.topology));if(s==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);t.modelTopology=s;const r=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(r==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);t.weightSpecs=r;const o=this.LS.getItem(this.keys.modelMetadata);if(o!=null){const a=JSON.parse(o);t.format=a.format,t.generatedBy=a.generatedBy,t.convertedBy=a.convertedBy,a.signature!=null&&(t.signature=a.signature),a.userDefinedMetadata!=null&&(t.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(t.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(t.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(t.trainingConfig=a.trainingConfig)}const i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return t.weightData=zM(i),t}}Ji.URL_SCHEME="localstorage://";const JI=n=>ie().getBool("IS_BROWSER")&&!Array.isArray(n)&&n.startsWith(Ji.URL_SCHEME)?nP(n.slice(Ji.URL_SCHEME.length)):null;pn.registerSaveRouter(JI);pn.registerLoadRouter(JI);function nP(n){return new Ji(n)}class sP{constructor(){O(ie().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),O(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){const e={},t=Ja+co,s=co+YI;for(let r=0;r<this.LS.length;++r){const o=this.LS.key(r);if(o.startsWith(t)&&o.endsWith(s)){const i=eP(o);e[i]=JSON.parse(this.LS.getItem(o))}}return e}async removeModel(e){e=tP(e);const t=QI(e);if(this.LS.getItem(t.info)==null)throw new Error(`Cannot find model at path '${e}'`);const s=JSON.parse(this.LS.getItem(t.info));return ZI(t),s}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vk="://";class Ar{constructor(){this.managers={}}static getInstance(){return Ar.instance==null&&(Ar.instance=new Ar),Ar.instance}static registerManager(e,t){O(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Vk)&&(e=e.slice(0,e.indexOf(Vk))),O(e.length>0,()=>"scheme must not be an empty string.");const s=Ar.getInstance();O(s.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),s.managers[e]=t}static getManager(e){const t=Ar.getInstance().managers[e];if(t==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return t}static getSchemes(){return Object.keys(Ar.getInstance().managers)}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rP{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,t){return fetch(e,t)}now(){return performance.now()}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${t}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,t){return new TextDecoder(t).decode(e)}setTimeoutCustom(e,t){if(typeof window>"u"||!ie().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,t);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},t),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",s=>{if(s.source===window&&s.data.name===this.messageName){s.stopPropagation();const r=this.functionRefs[s.data.index];r(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}isTypedArray(e){return DI(e)}}if(ie().get("IS_BROWSER")){ie().setPlatform("browser",new rP);try{Ar.registerManager(Ji.URL_SCHEME,new sP)}catch{}try{Ar.registerManager(Zi.URL_SCHEME,new qM)}catch{}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oP={importFetch:()=>require("node-fetch")};let X0;class iP{constructor(){this.util=require("util"),this.textEncoder=new this.util.TextEncoder}fetch(e,t){return ie().global.fetch!=null?ie().global.fetch(e,t):(X0==null&&(X0=oP.importFetch()),X0(e,t))}now(){const e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,t){if(t!=="utf-8"&&t!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${t}`);return this.textEncoder.encode(e)}decode(e,t){return e.length===0?"":new this.util.TextDecoder(t).decode(e)}isTypedArray(e){return this.util.types.isFloat32Array(e)||this.util.types.isInt32Array(e)||this.util.types.isUint8Array(e)||this.util.types.isUint8ClampedArray(e)}}ie().get("IS_NODE")&&!ie().get("IS_BROWSER")&&ie().setPlatform("node",new iP);/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ze(n,e="float32",t){return e=e||"float32",xo(n),new Tn(n,e,t)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aP(n,e){const t=P(n,"x","cast");if(!U3(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&t.dtype!=="string"||e!=="string"&&t.dtype==="string")throw new Error("Only strings can be casted to strings");const s={x:t},r={dtype:e};return Y.runKernel(yu,s,r)}const Ie=ee({cast_:aP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lP(n){const t={x:P(n,"x","clone","string_or_numeric")};return Y.runKernel(Au,t)}const Hi=ee({clone_:lP});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cP(n,e=!1){console.log(n.toString(e))}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */WI();const uP={buffer:Ze,cast:Ie,clone:Hi,print:cP};bM(uP);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hP(n,e){let t=P(n,"a","add"),s=P(e,"b","add");[t,s]=Xt(t,s);const r={a:t,b:s};return Y.runKernel(El,r)}const ye=ee({add_:hP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dP(n,e){let t=P(n,"a","floorDiv"),s=P(e,"b","floorDiv");[t,s]=Xt(t,s);const r={a:t,b:s};return Y.runKernel(Eu,r)}const e$=ee({floorDiv_:dP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fP(n,e){let t=P(n,"a","div"),s=P(e,"b","div");if([t,s]=Xt(t,s),t.dtype==="int32"&&s.dtype==="int32")return e$(t,s);const r={a:t,b:s},o={};return Y.runKernel(ku,r,o)}const Be=ee({div_:fP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pP(n,e){let t=P(n,"a","mul"),s=P(e,"b","mul");[t,s]=Xt(t,s);const r={a:t,b:s};return Y.runKernel(Bu,r)}const j=ee({mul_:pP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mP(n){const e=P(n,"x","abs");if(e.dtype==="complex64"){const t={x:e};return Y.runKernel(vp,t)}else{const t={x:e};return Y.runKernel(fp,t)}}const Un=ee({abs_:mP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gP(n){const t={x:P(n,"x","acos")};return Y.runKernel(hu,t)}const xP=ee({acos_:gP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yP(n){const t={x:P(n,"x","acosh")};return Y.runKernel(du,t)}const wP=ee({acosh_:yP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vP(n,e=null,t=!1){const r={x:P(n,"x","all","bool")},o={axis:e,keepDims:t};return Y.runKernel(Ay,r,o)}const t$=ee({all_:vP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bP(n,e=null,t=!1){const r={x:P(n,"x","any","bool")},o={axis:e,keepDims:t};return Y.runKernel(Dy,r,o)}const Lx=ee({any_:bP});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function CP(n,e=0){const s={x:P(n,"x","argMax")},r={axis:e};return Y.runKernel(pp,s,r)}const Kc=ee({argMax_:CP});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kP(n,e=0){const s={x:P(n,"x","argMin")},r={axis:e};return Y.runKernel(mp,s,r)}const SP=ee({argMin_:kP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function IP(n){const t={x:P(n,"x","asin")};return Y.runKernel(fu,t)}const $P=ee({asin_:IP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TP(n){const t={x:P(n,"x","asinh")};return Y.runKernel(pu,t)}const NP=ee({asinh_:TP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EP(n){const t={x:P(n,"x","atan")};return Y.runKernel(mu,t)}const RP=ee({atan_:EP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AP(n,e){let t=P(n,"a","atan2"),s=P(e,"b","atan2");[t,s]=Xt(t,s);const r={a:t,b:s};return Y.runKernel(xu,r)}const DP=ee({atan2_:AP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _P(n){const t={x:P(n,"x","atanh")};return Y.runKernel(gu,t)}const FP=ee({atanh_:_P});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lh(n,e,t,s,r="NHWC",o){const i=n[3],a=[...e,i],l=wo(r);return Nn(n,a,t,o,s,null,null,l)}function Js(n,e,t,s,r,o,i="channelsLast"){const[a,l]=qc(e);let u;if(i==="channelsLast")u=[a,l,n[3],n[3]];else if(i==="channelsFirst")u=[a,l,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return Nn(n,u,t,s,r,o,!1,i)}function yo(n,e,t,s,r,o,i="NDHWC"){const[a,l,u]=Bx(e);let d,f;if(i==="NDHWC")f="channelsLast",d=[a,l,u,n[4],n[4]];else if(i==="NCDHW")f="channelsFirst",d=[a,l,u,n[1],n[1]];else throw new Error(`Unknown dataFormat ${i}`);return ai(n,d,t,s,r,!1,f,o)}function Nn(n,e,t,s,r,o,i=!1,a="channelsLast"){let[l,u,d,f]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,d,f]=n;else if(a==="channelsFirst")[l,f,u,d]=n;else throw new Error(`Unknown dataFormat ${a}`);const[p,g,,x]=e,[w,v]=qc(t),[b,C]=qc(s),$=ol(p,b),S=ol(g,C),{padInfo:T,outHeight:E,outWidth:A}=MP(r,u,d,w,v,$,S,o,a),F=i?x*f:x;let D;return a==="channelsFirst"?D=[l,F,E,A]:a==="channelsLast"&&(D=[l,E,A,F]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:d,inChannels:f,outHeight:E,outWidth:A,outChannels:F,padInfo:T,strideHeight:w,strideWidth:v,filterHeight:p,filterWidth:g,effectiveFilterHeight:$,effectiveFilterWidth:S,dilationHeight:b,dilationWidth:C,inShape:n,outShape:D,filterShape:e}}function ai(n,e,t,s,r,o=!1,i="channelsLast",a){let[l,u,d,f,p]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[l,u,d,f,p]=n;else if(i==="channelsFirst")[l,p,u,d,f]=n;else throw new Error(`Unknown dataFormat ${i}`);const[g,x,w,,v]=e,[b,C,$]=Bx(t),[S,T,E]=Bx(s),A=ol(g,S),F=ol(x,T),D=ol(w,E),{padInfo:_,outDepth:N,outHeight:L,outWidth:G}=PP(r,u,d,f,b,C,$,A,F,D,a),Q=o?v*p:v;let K;return i==="channelsFirst"?K=[l,Q,N,L,G]:i==="channelsLast"&&(K=[l,N,L,G,Q]),{batchSize:l,dataFormat:i,inDepth:u,inHeight:d,inWidth:f,inChannels:p,outDepth:N,outHeight:L,outWidth:G,outChannels:Q,padInfo:_,strideDepth:b,strideHeight:C,strideWidth:$,filterDepth:g,filterHeight:x,filterWidth:w,effectiveFilterDepth:A,effectiveFilterHeight:F,effectiveFilterWidth:D,dilationDepth:S,dilationHeight:T,dilationWidth:E,inShape:n,outShape:K,filterShape:e}}function OP(n,e,t,s,r){s==null&&(s=v1(n,e,t));const o=n[0],i=n[1],a=Yc((o-e+2*s)/t+1,r),l=Yc((i-e+2*s)/t+1,r);return[a,l]}function zP(n,e,t,s,r,o){r==null&&(r=v1(n,e[0],s[0]));const i=[0,0,0,t];for(let a=0;a<3;a++)n[a]+2*r>=e[a]&&(i[a]=Yc((n[a]-e[a]+2*r)/s[a]+1,o));return i}function v1(n,e,t,s=1){const r=ol(e,s);return Math.floor((n[0]*(t-1)-t+r)/2)}function qc(n){return typeof n=="number"?[n,n,n]:n.length===2?[n[0],n[1],1]:n}function Bx(n){return typeof n=="number"?[n,n,n]:n}function ol(n,e){return e<=1?n:n+(n-1)*(e-1)}function MP(n,e,t,s,r,o,i,a,l){let u,d,f;if(typeof n=="number"){u={top:n,bottom:n,left:n,right:n,type:n===0?"VALID":"NUMBER"};const g=OP([e,t],o,s,n,a);d=g[0],f=g[1]}else if(n==="same"){d=Math.ceil(e/s),f=Math.ceil(t/r);const p=Math.max(0,(d-1)*s+o-e),g=Math.max(0,(f-1)*r+i-t),x=Math.floor(p/2),w=p-x,v=Math.floor(g/2),b=g-v;u={top:x,bottom:w,left:v,right:b,type:"SAME"}}else if(n==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},d=Math.ceil((e-o+1)/s),f=Math.ceil((t-i+1)/r);else if(typeof n=="object"){const p=l==="channelsLast"?n[1][0]:n[2][0],g=l==="channelsLast"?n[1][1]:n[2][1],x=l==="channelsLast"?n[2][0]:n[3][0],w=l==="channelsLast"?n[2][1]:n[3][1];u={top:p,bottom:g,left:x,right:w,type:p===0&&g===0&&x===0&&w===0?"VALID":"EXPLICIT"},d=Yc((e-o+p+g)/s+1,a),f=Yc((t-i+x+w)/r+1,a)}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:u,outHeight:d,outWidth:f}}function PP(n,e,t,s,r,o,i,a,l,u,d){let f,p,g,x;if(n==="valid"&&(n=0),typeof n=="number"){f={top:n,bottom:n,left:n,right:n,front:n,back:n,type:n===0?"VALID":"NUMBER"};const v=zP([e,t,s,1],[a,l,u],1,[r,o,i],n,d);p=v[0],g=v[1],x=v[2]}else if(n==="same"){p=Math.ceil(e/r),g=Math.ceil(t/o),x=Math.ceil(s/i);const w=(p-1)*r+a-e,v=(g-1)*o+l-t,b=(x-1)*i+u-s,C=Math.floor(w/2),$=w-C,S=Math.floor(v/2),T=v-S,E=Math.floor(b/2),A=b-E;f={top:S,bottom:T,left:E,right:A,front:C,back:$,type:"SAME"}}else throw Error(`Unknown padding parameter: ${n}`);return{padInfo:f,outDepth:p,outHeight:g,outWidth:x}}function Yc(n,e){if(!e)return Math.trunc(n);switch(e){case"round":return Math.round(n);case"ceil":return Math.ceil(n);case"floor":return Math.floor(n);default:throw new Error(`Unknown roundingMode ${e}`)}}function ea(n){const[e,t,s]=qc(n);return e===1&&t===1&&s===1}function zn(n,e){return ea(n)||ea(e)}function ta(n){return qc(n).every(e=>e>0)}function wo(n){if(n==="NHWC")return"channelsLast";if(n==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${n}`)}function os(n,e,t){if(t!=null){if(typeof e=="string")throw Error(`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);if(typeof e=="number")O(pl(e),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${e}.`);else if(typeof e=="object")e.forEach(s=>{s.forEach(r=>{O(pl(r),()=>`Error in ${n}: pad must be an integer when using dimRoundingMode ${t} but got pad ${r}.`)})});else throw Error(`Error in ${n}: Unknown padding parameter: ${e}`)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LP(n,e){const s={x:P(n,"x","reshape","string_or_numeric")},r={shape:e};return Y.runKernel(em,s,r)}const J=ee({reshape_:LP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BP(n,e,t,s,r){const o=P(n,"x","avgPool","float32"),i=1;O(zn(t,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`);let a=o,l=!1;o.rank===3&&(l=!0,a=J(o,[1,o.shape[0],o.shape[1],o.shape[2]])),O(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),os("avgPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r};let f=Y.runKernel(gp,u,d);return f=Ie(f,o.dtype),l?J(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const b1=ee({avgPool_:BP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VP(n,e,t,s,r,o="NDHWC"){const i=P(n,"x","avgPool3d","float32");let a=i,l=!1;i.rank===4&&(l=!0,a=J(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),O(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),O(o==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),O(typeof t=="number"&&t>0||Array.isArray(t)&&t[0]>0&&t[1]>0&&t[2]>0,()=>`Error in avgPool3d: Stride must be > 0, but got '${t}'`),os("avgPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o};let f=Y.runKernel(xp,u,d);return f=Ie(f,a.dtype),l?J(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const WP=ee({avgPool3d_:VP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UP(n,e=0){O(n.length>=1,()=>"Pass at least one tensor to concat");const t=jI(n,"tensors","concat","string_or_numeric");if(t[0].dtype==="complex64"&&t.forEach(o=>{if(o.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${o.dtype}. `)}),t.length===1)return Hi(t[0]);const s=t,r={axis:e};return Y.runKernel(bp,s,r)}const ns=ee({concat_:UP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GP(n,e,t=!1,s=!1){let r=P(n,"a","matMul"),o=P(e,"b","matMul");[r,o]=Xt(r,o);const i={a:r,b:o},a={transposeA:t,transposeB:s};return Y.runKernel(yp,i,a)}const ft=ee({matMul_:GP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HP(n){const t={x:P(n,"x","sigmoid","float32")};return Y.runKernel(Qu,t)}const Rl=ee({sigmoid_:HP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jP(n,e,t){const s=P(n,"x","slice","string_or_numeric");if(s.rank===0)throw new Error("Slicing scalar is not possible");const r={x:s},o={begin:e,size:t};return Y.runKernel(om,r,o)}const $t=ee({slice_:jP});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XP(n){const t={x:P(n,"x","tanh","float32")};return Y.runKernel(sh,t)}const pm=ee({tanh_:XP});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KP(n,e,t){const s=P(n,"x","batchToSpaceND"),r=e.reduce((a,l)=>a*l);O(s.rank>=1+e.length,()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`),O(t.length===e.length,()=>`crops.length is ${t.length} but should be equal to blockShape.length  ${e.length}`),O(s.shape[0]%r===0,()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${r}`);const o={x:s},i={blockShape:e,crops:t};return Y.runKernel(wp,o,i)}const C1=ee({batchToSpaceND_:KP});function qP(n){let e;return n.rank===0||n.rank===1?e=J(n,[1,1,1,n.size]):n.rank===2?e=J(n,[1,1,n.shape[0],n.shape[1]]):n.rank===3?e=J(n,[1,n.shape[0],n.shape[1],n.shape[2]]):e=n,e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YP(n,e,t,s,r,o){o==null&&(o=.001);const i=P(n,"x","batchNorm"),a=P(e,"mean","batchNorm"),l=P(t,"variance","batchNorm");let u;r!=null&&(u=P(r,"scale","batchNorm"));let d;s!=null&&(d=P(s,"offset","batchNorm")),O(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),O(d==null||a.rank===d.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),O(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");const p={x:qP(i),scale:u,offset:d,mean:a,variance:l},g={varianceEpsilon:o},x=Y.runKernel(Rp,p,g);return J(x,i.shape)}const mm=ee({batchNorm_:YP});function QP(n,e,t,s,r,o){const i=P(n,"x","batchNorm"),a=P(e,"mean","batchNorm"),l=P(t,"variance","batchNorm");let u;r!=null&&(u=P(r,"scale","batchNorm"));let d;return s!=null&&(d=P(s,"offset","batchNorm")),O(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),O(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),O(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&O(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),d!=null&&O(d.rank===2||d.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${d.rank}.`),mm(i,a,l,d,u,o)}const ZP=ee({batchNorm2d_:QP});function JP(n,e,t,s,r,o){const i=P(n,"x","batchNorm"),a=P(e,"mean","batchNorm"),l=P(t,"variance","batchNorm");let u;r!=null&&(u=P(r,"scale","batchNorm"));let d;return s!=null&&(d=P(s,"offset","batchNorm")),O(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),O(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),O(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&O(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),d!=null&&O(d.rank===3||d.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${d.rank}.`),mm(i,a,l,d,u,o)}const eL=ee({batchNorm3d_:JP});function tL(n,e,t,s,r,o){const i=P(n,"x","batchNorm"),a=P(e,"mean","batchNorm"),l=P(t,"variance","batchNorm");let u;r!=null&&(u=P(r,"scale","batchNorm"));let d;return s!=null&&(d=P(s,"offset","batchNorm")),O(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),O(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),O(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&O(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),d!=null&&O(d.rank===4||d.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${d.rank}.`),mm(i,a,l,d,u,o)}const nL=ee({batchNorm4d_:tL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sL(n,e,t){const s=P(n,"x","bincount"),r=P(e,"weights","bincount");O(s.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${s.dtype}`),O(t>=0,()=>`size must be non-negative, but got ${t}.`),O(r.size===s.size||r.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${s.shape}, weights shape: ${r.shape}.`);const o={x:s,weights:r},i={size:t};return Y.runKernel(Oy,o,i)}const rL=ee({bincount_:sL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oL(n,e){let t=P(n,"broadcastTo","x");const s=t.shape;if(xo(e),e.length<t.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${t.rank}.`);if(e.length>t.rank){const u=t.shape.slice();for(;u.length<e.length;)u.unshift(1);t=J(t,u)}const r=t.shape,o=Array.from(e);for(let u=e.length-1;u>=0;u--)if(r[u]===e[u])o[u]=1;else if(t.shape[u]!==1)throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);if(o.map((u,d)=>u>1?d:-1).filter(u=>u>=0).length===0)return Hi(t);const a={x:t},l={reps:o};return Y.runKernel(rh,a,l)}const Gc=ee({broadcastTo_:oL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iL(n){const t={x:P(n,"x","ceil","float32")};return Y.runKernel(wu,t)}const aL=ee({ceil_:iL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gm(n,e,t){xo(n),t=t||Tl(e);const s={shape:n,value:e,dtype:t};return Y.runKernel(Yy,{},s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lL(n,e,t){const s=P(n,"x","clipByValue");if(O(e<=t,()=>`Error in clip: min (${e}) must be less than or equal to max (${t}).`),e===t)return gm(s.shape,e,s.dtype);const r={x:s},o={clipValueMin:e,clipValueMax:t};return Y.runKernel(vu,r,o)}const Rs=ee({clipByValue_:lL});function cL(n){return ns(n,0)}const uL=ee({concat1d_:cL});function hL(n,e){return ns(n,e)}const dL=ee({concat2d_:hL});function fL(n,e){return ns(n,e)}const pL=ee({concat3d_:fL});function mL(n,e){return ns(n,e)}const gL=ee({concat4d_:mL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xL(n,e,t,s,r="NHWC",o=[1,1],i){const a=P(n,"x","conv2d","float32"),l=P(e,"filter","conv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=J(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),O(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),os("conv2d",s,i);const f=r==="NHWC"?u.shape[3]:u.shape[1];O(f===l.shape[2],()=>`Error in conv2d: depth of input (${f}) must match input depth for filter ${l.shape[2]}.`),O(zn(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),O(ta(o),()=>"Error in conv2D: Dilated rates should be larger than 0."),O(ta(t),()=>"Error in conv2D: Strides should be larger than 0.");const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},x=Y.runKernel(Cp,p,g);return d?J(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const na=ee({conv2d_:xL});function yL(n,e,t,s,r="NWC",o=1,i){const a=P(n,"x","conv1d"),l=P(e,"filter","conv1d");let u=a,d=!1;a.rank===2&&(d=!0,u=J(a,[1,a.shape[0],a.shape[1]])),O(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),O(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),os("conv1d",s,i),O(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),O(zn(t,o),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${t} and dilation '${o}'`),O(ta(o),()=>"Error in conv1D: Dilated rates should be larger than 0."),O(ta(t),()=>"Error in conv1D: Stride should be larger than 0."),O(r==="NWC",()=>`Error in conv1d: got dataFormat of ${r} but only NWC is currently supported.`);const f=J(l,[1,l.shape[0],l.shape[1],l.shape[2]]),p=J(u,[u.shape[0],1,u.shape[1],u.shape[2]]),v=na(p,f,[1,t],s,"NHWC",[1,o],i);return d?J(v,[v.shape[2],v.shape[3]]):J(v,[v.shape[0],v.shape[2],v.shape[3]])}const n$=ee({conv1d_:yL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wL(n,e,t,s,r,o="NHWC",i){O(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let a=n,l=e,u=!1;e.rank===3&&(u=!0,l=J(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,n[0],n[1],n[2]]),O(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),O(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),O(t.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${t.rank}`);const d=o==="NHWC"?a[3]:a[1],f=o==="NHWC"?l.shape[3]:l.shape[1];O(d===t.shape[2],()=>`Error in conv2dDerInput: depth of input (${d}) must match input depth for filter ${t.shape[2]}.`),O(f===t.shape[3],()=>`Error in conv2dDerInput: depth of output (${f}) must match output depth for filter ${t.shape[3]}.`),os("conv2dDerInput",r,i);const p={dy:l,filter:t},g={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,inputShape:a},x=Y.runKernel(kp,p,g);return u?J(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const k1=ee({conv2DBackpropInput_:wL});function vL(n,e,t,s,r,o){const i=P(n,"x","conv2dTranspose"),a=P(e,"filter","conv2dTranspose");return k1(t,i,a,s,r,"NHWC",o)}const s$=ee({conv2dTranspose_:vL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bL(n,e,t,s,r="NDHWC",o=[1,1,1]){const i=P(n,"x","conv3d"),a=P(e,"filter","conv3d");let l=i,u=!1;i.rank===4&&(u=!0,l=J(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),O(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),O(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),O(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),O(zn(t,o),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`),O(r==="NDHWC",()=>`Error in conv3d: got dataFormat of ${r} but only NDHWC is currently supported.`),O(ta(o),()=>"Error in conv3D: Dilated rates should be larger than 0."),O(ta(t),()=>"Error in conv3D: Strides should be larger than 0.");const d={x:l,filter:a},f={strides:t,pad:s,dataFormat:r,dilations:o},p=Y.runKernel(Sp,d,f);return u?J(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const CL=ee({conv3d_:bL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kL(n,e,t,s,r){O(n.length===e.rank,()=>`Length of inShape (${n.length}) and rank of dy (${e.rank}) must match`);let o=n,i=e,a=!1;e.rank===4&&(a=!0,i=J(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),o=[1,n[0],n[1],n[2],n[3]]);const l=o[4],u=i.shape[4];O(o.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${o.length}.`),O(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),O(t.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${t.rank}`),O(l===t.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${t.shape[3]}.`),O(u===t.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${t.shape[4]}.`);const d={dy:i,filter:t},f={pad:r,strides:s,inputShape:o},p=Y.runKernel(By,d,f);return a?J(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const r$=ee({conv3DBackpropInput_:kL});function SL(n,e,t,s,r){const o=P(n,"x","conv3dTranspose"),i=P(e,"filter","conv3dTranspose");return r$(t,o,i,s,r)}const IL=ee({conv3dTranspose_:SL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $L(n){const t={x:P(n,"x","cos","float32")};return Y.runKernel(bu,t)}const S1=ee({cos_:$L});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TL(n){const t={x:P(n,"x","cosh","float32")};return Y.runKernel(Cu,t)}const o$=ee({cosh_:TL});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NL(n,e=0,t=!1,s=!1){const o={x:P(n,"x","cumprod")},i={axis:e,exclusive:t,reverse:s};return Y.runKernel(Vy,o,i)}const Vx=ee({cumprod_:NL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EL(n,e=0,t=!1,s=!1){const o={x:P(n,"x","cumsum")},i={axis:e,exclusive:t,reverse:s};return Y.runKernel(Ip,o,i)}const i$=ee({cumsum_:EL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RL(n,e,t,s=!1){const r=P(n,"x","denseBincount"),o=P(e,"weights","denseBincount");O(r.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${r.dtype}`),O(r.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${r.rank}.`),O(t>=0,()=>`size must be non-negative, but got ${t}.`),O(o.size===r.size||o.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${r.shape}, weights shape: ${o.shape}.`);const i={x:r,weights:o},a={size:t,binaryOutput:s};return Y.runKernel(Uy,i,a)}const Wk=ee({denseBincount_:RL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AL(n,e,t="NHWC"){const s=P(n,"x","depthToSpace","float32"),r=t==="NHWC"?s.shape[1]:s.shape[2],o=t==="NHWC"?s.shape[2]:s.shape[3],i=t==="NHWC"?s.shape[3]:s.shape[1];O(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),O(r*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${r} and ${e}  for depthToSpace with input shape
    ${s.shape}`),O(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e} for depthToSpace with input shape
        ${s.shape}`),O(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${s.shape}`);const a={x:s},l={blockSize:e,dataFormat:t};return Y.runKernel(Gy,a,l)}const DL=ee({depthToSpace_:AL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _L(n,e,t,s,r="NHWC",o=[1,1],i){const a=P(n,"x","depthwiseConv2d","float32"),l=P(e,"filter","depthwiseConv2d","float32");let u=a,d=!1;a.rank===3&&(d=!0,u=J(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),O(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);const f=r==="NHWC"?u.shape[3]:u.shape[1];O(f===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${f}) must match the inChannels dimension in filter ${l.shape[2]}.`),os("depthwiseConv2d",s,i);const p={x:u,filter:l},g={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i},x=Y.runKernel($p,p,g);return d?J(x,[x.shape[1],x.shape[2],x.shape[3]]):x}const I1=ee({depthwiseConv2d_:_L});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FL(n,e,t,s,r=[1,1],o="NHWC"){const i=P(n,"x","dilation2d"),a=P(e,"filter","dilation2d");O(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),O(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),O(o==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${o}`);let l=i,u=!1;i.rank===3&&(l=J(i,[1,i.shape[0],i.shape[1],i.shape[2]]),u=!0),O(l.shape[3]===a.shape[2],()=>`Error in dilation2d:  input and filter must have the same depth: ${l.shape[3]} vs ${a.shape[2]}`);const d={x:l,filter:a},f={strides:t,pad:s,dilations:r},p=Y.runKernel(Tp,d,f);return u?J(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const OL=ee({dilation2d_:FL});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xl(n,e){const t=n.length,s=[];for(let r=0;r<t;r++){const o=t-1-r,i=n[o]||1;(e[e.length-1-r]||1)>1&&i===1&&s.unshift(o)}return s}function un(n,e){const t=[];for(let s=0;s<e.length;s++){const r=n[n.length-s-1],o=e.length-s-1,i=e[o];(r==null||r===1&&i>1)&&t.unshift(o)}return t}function Ke(n,e){const t=Math.max(n.length,e.length),s=new Array(t);for(let r=0;r<t;r++){let o=n[n.length-r-1];o==null&&(o=1);let i=e[e.length-r-1];if(i==null&&(i=1),o===1)s[t-r-1]=i;else if(i===1)s[t-r-1]=o;else if(o!==i){const a=`Operands could not be broadcast together with shapes ${n} and ${e}.`;throw Error(a)}else s[t-r-1]=o}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zL(n,e){let t=P(n,"a","equal","string_or_numeric"),s=P(e,"b","equal","string_or_numeric");[t,s]=Xt(t,s),Ke(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(Np,r)}const Gr=ee({equal_:zL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ML(n,e,t){const s=P(e,"a","where"),r=P(t,"b","where"),o=P(n,"condition","where","bool"),i=Ke(Ke(o.shape,s.shape),r.shape),a=Gc(o,i),l=Gc(s,i),u=Gc(r,i),d={condition:a,t:l,e:u};return Y.runKernel(rm,d)}const Xn=ee({where_:ML});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PL(n){const t={x:P(n,"x","zerosLike")};return Y.runKernel(dm,t)}const it=ee({zerosLike_:PL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LL(n,e){let t=P(n,"a","div"),s=P(e,"b","div");[t,s]=Xt(t,s);const r=Be(t,s),o=it(r),i=Gr(s,o);return Xn(i,o,r)}const BL=ee({divNoNan_:LL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VL(n,e){const t=P(n,"t1","dot"),s=P(e,"t2","dot");O((t.rank===1||t.rank===2)&&(s.rank===1||s.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${t.rank} and ${s.rank}.`);const r=t.rank===1?t.size:t.shape[1],o=s.rank===1?s.size:s.shape[0];if(O(r===o,()=>`Error in dot: inner dimensions of inputs must match, but got ${r} and ${o}.`),t.rank===1&&s.rank===1){const i=J(t,[1,-1]),a=J(s,[-1,1]),l=ft(i,a);return J(l,[])}else if(t.rank===1&&s.rank===2){const i=J(t,[1,-1]),a=J(s,[s.shape[0],s.shape[1]]),l=ft(i,a);return J(l,[l.size])}else if(t.rank===2&&s.rank===1){const i=J(s,[-1,1]),a=ft(t,i);return J(a,[a.size])}else{const i=J(s,[s.shape[0],s.shape[1]]);return ft(t,i)}}const WL=ee({dot_:VL});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UL(n,...e){const t=e.map((r,o)=>P(r,`tensors${o}`,"einsum")),s={equation:n};return Y.runKernel(Xy,t,s)}const Tc=ee({einsum_:UL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GL(n){const t={x:P(n,"x","elu","float32")};return Y.runKernel(Su,t)}const xm=ee({elu_:GL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HL(n){let e=P(n,"x","erf");O(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=Ie(e,"float32"));const t={x:e};return Y.runKernel(Iu,t)}const a$=ee({erf_:HL});/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $1(n,e){for(let t=0;t<n.length;++t)if(n[n.length-t-1]!==e-1-t)return!1;return!0}function l$(n,e,t){const s=n.length+e.length,r=[];let o=0,i=0;for(let a=0;a<s;a++)t.indexOf(a)===-1?r.push(n[o++]):r.push(e[i++]);return r}function wn(n,e){const t=[],s=n.length;for(let o=0;o<s;o++)e.indexOf(o)===-1&&t.push(n[o]);const r=e.map(o=>n[o]);return[t,r]}function tn(n,e){const t=e.map(s=>1);return l$(n,t,e)}function En(n,e,t){O($1(e,t),()=>`${n} supports only inner-most axes for now. Got axes ${e} and rank-${t} input.`)}function Bt(n,e){if($1(n,e))return null;const t=[];for(let s=0;s<e;++s)n.indexOf(s)===-1&&t.push(s);return n.forEach(s=>t.push(s)),t}function li(n){return n.map((e,t)=>[t,e]).sort((e,t)=>e[1]-t[1]).map(e=>e[0])}function Kt(n,e){const t=[];for(let s=e-n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jL(n,e=null,t=!1){const r={x:P(n,"x","max")},o={reductionIndices:e,keepDims:t};return Y.runKernel(Bp,r,o)}const yr=ee({max_:jL});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XL(n,e=null,t=!1){const r={x:P(n,"x","min")},o={axis:e,keepDims:t};return Y.runKernel(Gp,r,o)}const Ff=ee({min_:XL});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KL(n,e){let t=P(n,"base","pow"),s=P(e,"exp","pow");[t,s]=Xt(t,s);const r={a:t,b:s};return Y.runKernel(Vu,r)}const sa=ee({pow_:KL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pt(n,e){if((Qs(n)&&e!=="string"||Array.isArray(n))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Qs(n)&&!(n instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return ah(n,[],[],e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qL(n){const t={x:P(n,"x","sqrt","float32")};return Y.runKernel(Ju,t)}const On=ee({sqrt_:qL});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YL(n){const e=P(n,"x","square"),t={};return Y.runKernel("Square",{x:e},t)}const At=ee({square_:YL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QL(n,e=null,t=!1){let s=P(n,"x","sum");s.dtype==="bool"&&(s=Ie(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return Y.runKernel(im,r,o)}const Me=ee({sum_:QL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZL(n,e="euclidean",t=null,s=!1){n=P(n,"x","norm");const r=c$(n,e,t);let o=r.shape;if(s){const i=Je(t,n.shape);o=tn(r.shape,i)}return J(r,o)}function c$(n,e,t=null){if(n.rank===0)return Un(n);if(n.rank!==1&&t===null)return c$(J(n,[-1]),e,t);if(n.rank===1||typeof t=="number"||Array.isArray(t)&&t.length===1){if(e===1)return Me(Un(n),t);if(e===1/0)return yr(Un(n),t);if(e===-1/0)return Ff(Un(n),t);if(e==="euclidean"||e===2)return On(Me(sa(Un(n),pt(2,"int32")),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(t)&&t.length===2){if(e===1)return yr(Me(Un(n),t[0]),t[1]-1);if(e===1/0)return yr(Me(Un(n),t[1]),t[0]);if(e===-1/0)return Ff(Me(Un(n),t[1]),t[0]);if(e==="fro"||e==="euclidean")return On(Me(At(n),t));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${t}`)}const ym=ee({norm_:ZL});/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JL(n,e=null,t=!1){return ym(n,"euclidean",e,t)}const e4=ee({euclideanNorm_:JL});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function t4(n){const t={x:P(n,"x","exp")};return Y.runKernel($u,t)}const Hr=ee({exp_:t4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n4(n,e=0){const t=P(n,"x","expandDims","string_or_numeric");O(e<=t.rank,()=>"Axis must be <= rank of the tensor");const s={input:t},r={dim:e};return Y.runKernel(Ep,s,r)}const es=ee({expandDims_:n4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function s4(n){const t={x:P(n,"x","expm1")};return Y.runKernel(Tu,t)}const r4=ee({expm1_:s4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function o4(n,e){const t=P(n,"x","tile","string_or_numeric");O(t.rank===e.length,()=>`Error in transpose: rank of input ${t.rank} must match length of reps ${e}.`);const s={x:t},r={reps:e};return Y.runKernel(rh,s,r)}const mr=ee({tile_:o4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i4(n,e,t,s="float32"){e==null&&(e=n);const r=Ze([n,e],s),o=n<=e?n:e;for(let a=0;a<o;++a)r.set(1,a,a);const i=J(r.toTensor(),[n,e]);if(t==null)return i;if(t.length===1)return mr(es(i,0),[t[0],1,1]);if(t.length===2)return mr(es(es(i,0),0),[t[0],t[1],1,1]);if(t.length===3)return mr(es(es(es(i,0),0),0),[t[0],t[1],t[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${t.length}D.`)}const u$=ee({eye_:i4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function a4(n){const t={x:P(n,"x","floor","float32")};return Y.runKernel(Nu,t)}const wm=ee({floor_:a4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l4(n,e,t=0,s=0){const r=P(n,"x","gather"),o=P(e,"indices","gather","int32"),i={x:r,indices:o},a={axis:t,batchDims:s};return Y.runKernel(Ap,i,a)}const T1=ee({gather_:l4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function c4(n,e){let t=P(n,"a","greater","string_or_numeric"),s=P(e,"b","greater","string_or_numeric");[t,s]=Xt(t,s),Ke(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(Dp,r)}const As=ee({greater_:c4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u4(n,e){let t=P(n,"a","greaterEqual","string_or_numeric"),s=P(e,"b","greaterEqual","string_or_numeric");[t,s]=Xt(t,s),Ke(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(Ru,r)}const da=ee({greaterEqual_:u4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function h4(n){const t={input:P(n,"input","imag")};return Y.runKernel(Jy,t)}const N1=ee({imag_:h4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d4(n){const t={x:P(n,"x","isFinite")};return Y.runKernel(Du,t)}const f4=ee({isFinite_:d4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p4(n){const t={x:P(n,"x","isInf")};return Y.runKernel(_u,t)}const m4=ee({isInf_:p4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function g4(n){const t={x:P(n,"x","isNaN")};return Y.runKernel(Fu,t)}const x4=ee({isNaN_:g4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function y4(n,e=.2){const s={x:P(n,"x","leakyRelu")},r={alpha:e};return Y.runKernel(_p,s,r)}const E1=ee({leakyRelu_:y4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function w4(n,e){let t=P(n,"a","less","string_or_numeric"),s=P(e,"b","less","string_or_numeric");[t,s]=Xt(t,s),Ke(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(Fp,r)}const Of=ee({less_:w4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v4(n,e){let t=P(n,"a","lessEqual","string_or_numeric"),s=P(e,"b","lessEqual","string_or_numeric");[t,s]=Xt(t,s),Ke(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(Op,r)}const Al=ee({lessEqual_:v4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function b4(n,e=5,t=1,s=1,r=.5){const o=P(n,"x","localResponseNormalization");O(o.rank===4||o.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${o.rank}.`),O(pl(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=o,a=!1;o.rank===3&&(a=!0,i=J(o,[1,o.shape[0],o.shape[1],o.shape[2]]));const l={x:i},u={depthRadius:e,bias:t,alpha:s,beta:r},d=Y.runKernel(Lp,l,u);return a?J(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const C4=ee({localResponseNormalization_:b4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function k4(n){const t={x:P(n,"x","log","float32")};return Y.runKernel(Ou,t)}const jr=ee({log_:k4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S4(n){const t={x:P(n,"x","log1p")};return Y.runKernel(zu,t)}const h$=ee({log1p_:S4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function I4(n,e){O($x(n),()=>"The f passed in variableGrads(f) must be a function"),O(e==null||Array.isArray(e)&&e.every(u=>u instanceof Df),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");const t=e!=null;if(!t){e=[];for(const u in Y.registeredVariables)e.push(Y.registeredVariables[u])}const s=t?e.filter(u=>!u.trainable):null,r=e.length;e=e.filter(u=>u.trainable),O(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${r} variables is trainable.`);const o=!0,{value:i,grads:a}=Y.gradients(n,e,null,o);O(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),O(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);const l={};return e.forEach((u,d)=>{a[d]!=null&&(l[u.name]=a[d])}),s!=null&&s.forEach(u=>l[u.name]=null),{value:i,grads:l}}function yl(n){return Y.customGrad(n)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $4(n){const t={x:P(n,"x","neg")};return Y.runKernel(jp,t)}const jt=ee({neg_:$4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function T4(n){const t={x:P(n,"x","softplus")};return Y.runKernel(Zu,t)}const ch=ee({softplus_:T4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N4(n){const e=P(n,"x","logSigmoid");return yl(s=>({value:jt(ch(jt(s))),gradFunc:i=>j(i,Rl(jt(s)))}))(e)}const E4=ee({logSigmoid_:N4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function R4(n,e){let t=P(n,"a","sub"),s=P(e,"b","sub");[t,s]=Xt(t,s);const r={a:t,b:s};return Y.runKernel(th,r)}const Ge=ee({sub_:R4});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A4(n,e=-1){const t=P(n,"logits","logSoftmax");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and axis was ${e}`);return yl((r,o)=>{const a=yr(r,e,!0),l=Ge(r,a),u=Ge(Ie(l,"float32"),jr(Me(Hr(l),e,!0)));return o([u]),{value:u,gradFunc:(f,p)=>{const[g]=p,x=!0,w=Hr(g);return Ge(f,j(Me(f,e,x),w))}}})(t)}const d$=ee({logSoftmax_:A4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function D4(n,e=null,t=!1){const s=P(n,"x","logSumExp"),r=Je(e,s.shape),o=yr(s,r,!0),i=Ge(s,o),a=Hr(i),l=Me(a,r),u=jr(l),d=ye(J(o,u.shape),u);if(t){const f=tn(d.shape,r);return J(d,f)}return d}const f$=ee({logSumExp_:D4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _4(n,e){const t=P(n,"a","logicalAnd","bool"),s=P(e,"b","logicalAnd","bool");Ke(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(zp,r)}const fo=ee({logicalAnd_:_4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function F4(n){const t={x:P(n,"x","logicalNot","bool")};return Y.runKernel(Mp,t)}const R1=ee({logicalNot_:F4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O4(n,e){const t=P(n,"a","logicalOr","bool"),s=P(e,"b","logicalOr","bool");Ke(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(Pp,r)}const p$=ee({logicalOr_:O4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function z4(n,e){const t=P(n,"a","logicalXor","bool"),s=P(e,"b","logicalXor","bool");return Ke(t.shape,s.shape),fo(p$(n,e),R1(fo(n,e)))}const M4=ee({logicalXor_:z4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function P4(n,e,t,s,r){const o=P(n,"x","maxPool"),i=1;let a=o,l=!1;o.rank===3&&(l=!0,a=J(o,[1,o.shape[0],o.shape[1],o.shape[2]])),O(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),O(zn(t,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${t} and dilations '${i}'`),os("maxPool",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r},f=Y.runKernel(Vp,u,d);return l?J(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const A1=ee({maxPool_:P4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function L4(n,e=[1,1,1],t,s,r,o="NDHWC"){const i=P(n,"x","maxPool3d");let a=i,l=!1;i.rank===4&&(l=!0,a=J(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),O(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),O(o==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${o}`),os("maxPool3d",s,r);const u={x:a},d={filterSize:e,strides:t,pad:s,dimRoundingMode:r,dataFormat:o},f=Y.runKernel(Wp,u,d);return l?J(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const B4=ee({maxPool3d_:L4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V4(n,e){let t=P(n,"a","maximum"),s=P(e,"b","maximum");[t,s]=Xt(t,s),t.dtype==="bool"&&(t=Ie(t,"int32"),s=Ie(s,"int32")),Ke(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(Mu,r)}const ci=ee({maximum_:V4});/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function W4(n,e=null,t=!1){const r={x:P(n,"x","mean")},o={axis:e,keepDims:t};return Y.runKernel(Up,r,o)}const Jt=ee({mean_:W4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gn(n,e="float32"){if(xo(n),e==="complex64"){const s=gn(n,"float32"),r=gn(n,"float32");return Qi(s,r)}const t=Fn(ce(n),e);return Y.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ui(n,e="float32"){if(xo(n),e==="complex64"){const s=ui(n,"float32"),r=gn(n,"float32");return Qi(s,r)}const t=Ty(ce(n),e);return Y.makeTensor(t,n,e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U4(n,e){let t=P(n,"a","minimum"),s=P(e,"b","minimum");[t,s]=Xt(t,s),t.dtype==="bool"&&(t=Ie(t,"int32"),s=Ie(s,"int32")),Ke(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(Pu,r)}const Qc=ee({minimum_:U4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G4(n,e,t){O(t==="reflect"||t==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${t}.`);const s=P(n,"x","mirrorPad");if(s.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");O(e.length===s.rank,()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`);const r=t==="reflect"?1:0;for(let a=0;a<s.rank;a++)O(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),O(e[a][0]>=0&&e[a][0]<=s.shape[a]-r&&e[a][1]>=0&&e[a][1]<=s.shape[a]-r,()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-r} or less than 0 for input of shape ${s.shape}`);const o={paddings:e,mode:t},i={x:s};return Y.runKernel(Hp,i,o)}const H4=ee({mirrorPad_:G4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function j4(n,e){let t=P(n,"a","mod"),s=P(e,"b","mod");[t,s]=Xt(t,s);const r={a:t,b:s};return Y.runKernel(Lu,r)}const X4=ee({mod_:j4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function K4(n,e=null,t=!1){n=P(n,"x","moments");const s=Je(e,n.shape),r=Jt(n,s,t);let o=r.shape;t||(o=tn(r.shape,s));const i=At(Ge(Ie(n,"float32"),J(r,o))),a=Jt(i,s,t);return{mean:r,variance:a}}const D1=ee({moments_:K4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q4(n,e){let t=P(n,"a","notEqual","string_or_numeric"),s=P(e,"b","notEqual","string_or_numeric");[t,s]=Xt(t,s),Ke(t.shape,s.shape);const r={a:t,b:s};return Y.runKernel(Xp,r)}const zf=ee({notEqual_:q4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Y4(n,e,t=1,s=0,r="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i={indices:P(n,"indices","oneHot","int32")},a={dtype:r,depth:e,onValue:t,offValue:s};return Y.runKernel(qp,i,a)}const m$=ee({oneHot_:Y4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Q4(n){const t={x:P(n,"x","onesLike")};return Y.runKernel(Kp,t)}const Zs=ee({onesLike_:Q4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Z4(n,e,t=0){const s=P(n,"x","pad");if(s.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const r={paddings:e,constantValue:t},o={x:s};return Y.runKernel(Qp,o,r)}const _1=ee({pad_:Z4});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function J4(n,e,t){const s=P(n,"x","spaceToBatchND");O(s.rank>=1+e.length,()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`),O(t.length===e.length,()=>`paddings.shape[0] ${t.length} must be equal to [blockShape] ${e.length}`),O(s.shape.reduce((i,a,l)=>l>0&&l<=e.length?i&&(a+t[l-1][0]+t[l-1][1])%e[l-1]===0:i,!0),()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${t.toString()} must be divisible by blockShapes ${e.toString()}`);const r={x:s},o={blockShape:e,paddings:t};return Y.runKernel(am,r,o)}const F1=ee({spaceToBatchND_:J4});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eB(n,e,t,s,r,o,i){r==null&&(r=[1,1]),o==null&&(o=1),s===0&&(s="valid");const a=P(n,"x","maxPool");let l=a,u=!1;a.rank===3&&(u=!0,l=J(a,[1,a.shape[0],a.shape[1],a.shape[2]])),O(zn(o,r),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${o} and dilations '${r}'`);const d=Js(l.shape,e,o,r,s),f=[d.dilationHeight,d.dilationWidth];let p;s==="same"?p=nB([d.filterHeight,d.filterWidth],f):p=[[0,0],[0,0]];const g=f[0]===1&&f[1]===1,[x,w]=tB([d.inHeight,d.inWidth],f,p),v=g?s:"valid",b=g?l:F1(l,f,x),$=(t==="avg"?()=>b1(b,e,o,v,i):()=>A1(b,e,o,v,i))(),S=g?$:C1($,f,w);return u?J(S,[S.shape[1],S.shape[2],S.shape[3]]):S}function tB(n,e,t){const s=t.map(d=>d[0]),r=t.map(d=>d[1]),o=n.concat(s,r),i=e.map((d,f)=>(d-o[f]%d)%d),a=r.map((d,f)=>d+i[f]),l=e.map((d,f)=>[s[f],a[f]]),u=e.map((d,f)=>[0,i[f]]);return[l,u]}function nB(n,e){const s=n.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),r=s.map(i=>Math.floor(i/2)),o=s.map((i,a)=>i-r[a]);return s.map((i,a)=>[r[a],o[a]])}const sB=ee({pool_:eB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rB(n,e){const t=P(n,"x","prelu"),s=P(e,"alpha","prelu"),r={x:t,alpha:s};return Y.runKernel(Zp,r)}const O1=ee({prelu_:rB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oB(n,e=null,t=!1){let s=P(n,"x","prod");s.dtype==="bool"&&(s=Ie(s,"int32"));const r={x:s},o={axis:e,keepDims:t};return Y.runKernel(Jp,r,o)}const iB=ee({prod_:oB});var hf={exports:{}},aB=hf.exports,Uk;function lB(){return Uk||(Uk=1,function(n){(function(e,t,s){function r(l){var u=this,d=a();u.next=function(){var f=2091639*u.s0+u.c*23283064365386963e-26;return u.s0=u.s1,u.s1=u.s2,u.s2=f-(u.c=f|0)},u.c=1,u.s0=d(" "),u.s1=d(" "),u.s2=d(" "),u.s0-=d(l),u.s0<0&&(u.s0+=1),u.s1-=d(l),u.s1<0&&(u.s1+=1),u.s2-=d(l),u.s2<0&&(u.s2+=1),d=null}function o(l,u){return u.c=l.c,u.s0=l.s0,u.s1=l.s1,u.s2=l.s2,u}function i(l,u){var d=new r(l),f=u&&u.state,p=d.next;return p.int32=function(){return d.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,f&&(typeof f=="object"&&o(f,d),p.state=function(){return o(d,{})}),p}function a(){var l=4022871197,u=function(d){d=String(d);for(var f=0;f<d.length;f++){l+=d.charCodeAt(f);var p=.02519603282416938*l;l=p>>>0,p-=l,p*=l,l=p>>>0,p-=l,l+=p*4294967296}return(l>>>0)*23283064365386963e-26};return u}t&&t.exports?t.exports=i:this.alea=i})(aB,n)}(hf)),hf.exports}var df={exports:{}},cB=df.exports,Gk;function uB(){return Gk||(Gk=1,function(n){(function(e,t,s){function r(a){var l=this,u="";l.x=0,l.y=0,l.z=0,l.w=0,l.next=function(){var f=l.x^l.x<<11;return l.x=l.y,l.y=l.z,l.z=l.w,l.w^=l.w>>>19^f^f>>>8},a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l}function i(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&o(d,u),f.state=function(){return o(u,{})}),f}t&&t.exports?t.exports=i:this.xor128=i})(cB,n)}(df)),df.exports}var ff={exports:{}},hB=ff.exports,Hk;function dB(){return Hk||(Hk=1,function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.x^l.x>>>2;return l.x=l.y,l.y=l.z,l.z=l.w,l.w=l.v,(l.d=l.d+362437|0)+(l.v=l.v^l.v<<4^(f^f<<1))|0},l.x=0,l.y=0,l.z=0,l.w=0,l.v=0,a===(a|0)?l.x=a:u+=a;for(var d=0;d<u.length+64;d++)l.x^=u.charCodeAt(d)|0,d==u.length&&(l.d=l.x<<10^l.x>>>4),l.next()}function o(a,l){return l.x=a.x,l.y=a.y,l.z=a.z,l.w=a.w,l.v=a.v,l.d=a.d,l}function i(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&o(d,u),f.state=function(){return o(u,{})}),f}t&&t.exports?t.exports=i:this.xorwow=i})(hB,n)}(ff)),ff.exports}var pf={exports:{}},fB=pf.exports,jk;function pB(){return jk||(jk=1,function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.x,f=l.i,p,g;return p=d[f],p^=p>>>7,g=p^p<<24,p=d[f+1&7],g^=p^p>>>10,p=d[f+3&7],g^=p^p>>>3,p=d[f+4&7],g^=p^p<<7,p=d[f+7&7],p=p^p<<13,g^=p^p<<9,d[f]=g,l.i=f+1&7,g};function u(d,f){var p,g=[];if(f===(f|0))g[0]=f;else for(f=""+f,p=0;p<f.length;++p)g[p&7]=g[p&7]<<15^f.charCodeAt(p)+g[p+1&7]<<13;for(;g.length<8;)g.push(0);for(p=0;p<8&&g[p]===0;++p);for(p==8?g[7]=-1:g[p],d.x=g,d.i=0,p=256;p>0;--p)d.next()}u(l,a)}function o(a,l){return l.x=a.x.slice(),l.i=a.i,l}function i(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(d.x&&o(d,u),f.state=function(){return o(u,{})}),f}t&&t.exports?t.exports=i:this.xorshift7=i})(fB,n)}(pf)),pf.exports}var mf={exports:{}},mB=mf.exports,Xk;function gB(){return Xk||(Xk=1,function(n){(function(e,t,s){function r(a){var l=this;l.next=function(){var d=l.w,f=l.X,p=l.i,g,x;return l.w=d=d+1640531527|0,x=f[p+34&127],g=f[p=p+1&127],x^=x<<13,g^=g<<17,x^=x>>>15,g^=g>>>12,x=f[p]=x^g,l.i=p,x+(d^d>>>16)|0};function u(d,f){var p,g,x,w,v,b=[],C=128;for(f===(f|0)?(g=f,f=null):(f=f+"\0",g=0,C=Math.max(C,f.length)),x=0,w=-32;w<C;++w)f&&(g^=f.charCodeAt((w+32)%f.length)),w===0&&(v=g),g^=g<<10,g^=g>>>15,g^=g<<4,g^=g>>>13,w>=0&&(v=v+1640531527|0,p=b[w&127]^=g+v,x=p==0?x+1:0);for(x>=128&&(b[(f&&f.length||0)&127]=-1),x=127,w=4*128;w>0;--w)g=b[x+34&127],p=b[x=x+1&127],g^=g<<13,p^=p<<17,g^=g>>>15,p^=p>>>12,b[x]=g^p;d.w=v,d.X=b,d.i=x}u(l,a)}function o(a,l){return l.i=a.i,l.w=a.w,l.X=a.X.slice(),l}function i(a,l){a==null&&(a=+new Date);var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(d.X&&o(d,u),f.state=function(){return o(u,{})}),f}t&&t.exports?t.exports=i:this.xor4096=i})(mB,n)}(mf)),mf.exports}var gf={exports:{}},xB=gf.exports,Kk;function yB(){return Kk||(Kk=1,function(n){(function(e,t,s){function r(a){var l=this,u="";l.next=function(){var f=l.b,p=l.c,g=l.d,x=l.a;return f=f<<25^f>>>7^p,p=p-g|0,g=g<<24^g>>>8^x,x=x-f|0,l.b=f=f<<20^f>>>12^p,l.c=p=p-g|0,l.d=g<<16^p>>>16^x,l.a=x-f|0},l.a=0,l.b=0,l.c=-1640531527,l.d=1367130551,a===Math.floor(a)?(l.a=a/4294967296|0,l.b=a|0):u+=a;for(var d=0;d<u.length+20;d++)l.b^=u.charCodeAt(d)|0,l.next()}function o(a,l){return l.a=a.a,l.b=a.b,l.c=a.c,l.d=a.d,l}function i(a,l){var u=new r(a),d=l&&l.state,f=function(){return(u.next()>>>0)/4294967296};return f.double=function(){do var p=u.next()>>>11,g=(u.next()>>>0)/4294967296,x=(p+g)/(1<<21);while(x===0);return x},f.int32=u.next,f.quick=f,d&&(typeof d=="object"&&o(d,u),f.state=function(){return o(u,{})}),f}t&&t.exports?t.exports=i:this.tychei=i})(xB,n)}(gf)),gf.exports}var xf={exports:{}};const wB={},vB=Object.freeze(Object.defineProperty({__proto__:null,default:wB},Symbol.toStringTag,{value:"Module"})),bB=J_(vB);var CB=xf.exports,qk;function kB(){return qk||(qk=1,function(n){(function(e,t,s){var r=256,o=6,i=52,a="random",l=s.pow(r,o),u=s.pow(2,i),d=u*2,f=r-1,p;function g(S,T,E){var A=[];T=T==!0?{entropy:!0}:T||{};var F=b(v(T.entropy?[S,$(t)]:S??C(),3),A),D=new x(A),_=function(){for(var N=D.g(o),L=l,G=0;N<u;)N=(N+G)*r,L*=r,G=D.g(1);for(;N>=d;)N/=2,L/=2,G>>>=1;return(N+G)/L};return _.int32=function(){return D.g(4)|0},_.quick=function(){return D.g(4)/4294967296},_.double=_,b($(D.S),t),(T.pass||E||function(N,L,G,Q){return Q&&(Q.S&&w(Q,D),N.state=function(){return w(D,{})}),G?(s[a]=N,L):N})(_,F,"global"in T?T.global:this==s,T.state)}function x(S){var T,E=S.length,A=this,F=0,D=A.i=A.j=0,_=A.S=[];for(E||(S=[E++]);F<r;)_[F]=F++;for(F=0;F<r;F++)_[F]=_[D=f&D+S[F%E]+(T=_[F])],_[D]=T;(A.g=function(N){for(var L,G=0,Q=A.i,K=A.j,Z=A.S;N--;)L=Z[Q=f&Q+1],G=G*r+Z[f&(Z[Q]=Z[K=f&K+L])+(Z[K]=L)];return A.i=Q,A.j=K,G})(r)}function w(S,T){return T.i=S.i,T.j=S.j,T.S=S.S.slice(),T}function v(S,T){var E=[],A=typeof S,F;if(T&&A=="object")for(F in S)try{E.push(v(S[F],T-1))}catch{}return E.length?E:A=="string"?S:S+"\0"}function b(S,T){for(var E=S+"",A,F=0;F<E.length;)T[f&F]=f&(A^=T[f&F]*19)+E.charCodeAt(F++);return $(T)}function C(){try{var S;return p&&(S=p.randomBytes)?S=S(r):(S=new Uint8Array(r),(e.crypto||e.msCrypto).getRandomValues(S)),$(S)}catch{var T=e.navigator,E=T&&T.plugins;return[+new Date,e,E,e.screen,$(t)]}}function $(S){return String.fromCharCode.apply(0,S)}if(b(s.random(),t),n.exports){n.exports=g;try{p=bB}catch{}}else s["seed"+a]=g})(typeof self<"u"?self:CB,[],Math)}(xf)),xf.exports}var K0,Yk;function SB(){if(Yk)return K0;Yk=1;var n=lB(),e=uB(),t=dB(),s=pB(),r=gB(),o=yB(),i=kB();return i.alea=n,i.xor128=e,i.xorwow=t,i.xorshift7=s,i.xor4096=r,i.tychei=o,K0=i,K0}var z1=SB();/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class g${constructor(e,t,s,r,o){this.mean=e,this.stdDev=t,this.dtype=s,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);const i=o||Math.random();this.random=z1.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){const r=this.nextVal;return this.nextVal=NaN,r}let e,t,s=!1;for(;!s;){let r,o,i;do r=2*this.random()-1,o=2*this.random()-1,i=r*r+o*o;while(i>=1||i===0);const a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*r*a,t=this.mean+this.stdDev*o*a,(!this.truncated||this.isValidTruncated(e))&&(s=!0)}return(!this.truncated||this.isValidTruncated(t))&&(this.nextVal=this.convertValue(t)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}}class IB{constructor(e=0,t=1,s,r){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=t-e,this.dtype=s,r==null&&(r=Math.random()),typeof r=="number"&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${t} <= 1 and dtype is not float`);this.random=z1.alea(r)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $B(n,e=0,t=1,s,r){if(xo(n),s!=null&&s==="bool")throw new Error(`Unsupported data type ${s}`);const o=new g$(e,t,s,!1,r),i=Ze(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const TB=ee({randomNormal_:$B});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NB(n,e=0,t=1,s="float32",r){xo(n);const o=Ze(n,s),i=new IB(e,t,null,r);for(let a=0;a<o.values.length;a++)o.values[a]=i.nextValue();return o.toTensor()}const uh=ee({randomUniform_:NB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zc(n,e,t=1,s="float32"){if(t===0)throw new Error("Cannot have a step of zero");const r={start:n,stop:e,step:t,dtype:s};return Y.runKernel(i1,{},r)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EB(n){const t={input:P(n,"input","real")};return Y.runKernel(a1,t)}const Mf=ee({real_:EB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RB(n){const t={x:P(n,"x","reciprocal")};return Y.runKernel(Wu,t)}const AB=ee({reciprocal_:RB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DB(n){const t={x:P(n,"x","relu")};return Y.runKernel(Uu,t)}const fa=ee({relu_:DB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _B(n){const t={x:P(n,"x","relu6")};return Y.runKernel(Gu,t)}const x$=ee({relu6_:_B});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FB(n,e){const s={x:P(n,"x","reverse")},r={dims:e};return Y.runKernel(sm,s,r)}const ra=ee({reverse_:FB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OB(n){const t={x:P(n,"x","round")};return Y.runKernel(Hu,t)}const y$=ee({round_:OB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zB(n){const t={x:P(n,"x","rsqrt","float32")};return Y.runKernel(ju,t)}const w$=ee({rsqrt_:zB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MB(n){const t={x:P(n,"x","selu")};return Y.runKernel(Xu,t)}const v$=ee({selu_:MB});function PB(n,e,t,s,r,o=[1,1],i="NHWC"){const a=P(n,"x","separableConv2d"),l=P(e,"depthwiseFilter","separableConv2d"),u=P(t,"pointwiseFilter","separableConv2d");let d=a,f=!1;if(a.rank===3&&(f=!0,d=J(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");O(d.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${d.rank}.`),O(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),O(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),O(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),O(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);const p=l.shape[2],g=l.shape[3];O(u.shape[2]===p*g,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*g}, but got ${u.shape[2]}.`);const x=I1(d,l,s,r,i,o),v=na(x,u,1,"valid",i);return f?J(v,[v.shape[1],v.shape[2],v.shape[3]]):v}const b$=ee({separableConv2d_:PB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LB(n){const t={x:P(n,"x","sign")};return Y.runKernel(Yu,t)}const BB=ee({sign_:LB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VB(n){const t={x:P(n,"x","sin","float32")};return Y.runKernel(Ku,t)}const C$=ee({sin_:VB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WB(n){const t={x:P(n,"x","sinh")};return Y.runKernel(qu,t)}const k$=ee({sinh_:WB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UB(n,e,t){const s=P(n,"x","slice1d");return O(s.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`),$t(s,[e],[t])}const M1=ee({slice1d_:UB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GB(n,e,t){const s=P(n,"x","slice2d");return O(s.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`),$t(s,e,t)}const S$=ee({slice2d_:GB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function HB(n,e,t){const s=P(n,"x","slice3d");return O(s.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`),$t(s,e,t)}const P1=ee({slice3d_:HB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jB(n,e,t){const s=P(n,"x","slice4d");return O(s.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`),$t(s,e,t)}const Pf=ee({slice4d_:jB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XB(n,e=-1){const t=P(n,"logits","softmax","float32");if(e===-1&&(e=t.rank-1),e!==t.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${t.rank} and dim was ${e}`);const s={logits:t},r={dim:e};return Y.runKernel(cm,s,r)}const L1=ee({softmax_:XB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KB(n){O(n.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${n.dtype}.`);const e={input:n};return Y.runKernel(qy,e)}const I$=ee({fft_:KB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qB(n){O(n.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${n.dtype}.`);const e={input:n};return Y.runKernel(Zy,e)}const Wx=ee({ifft_:qB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YB(n){const e=n.shape[n.shape.length-1],t=n.size/e;let s;if(e<=2){const r=J(n,[t,e]);s=Wx(r)}else{const r=[t,2*(e-1)],o=J(Mf(n),[t,e]),i=J(N1(n),[t,e]),a=ra($t(o,[0,1],[t,e-2]),1),l=j(ra($t(i,[0,1],[t,e-2]),1),pt(-1)),u=ns([o,a],1),d=ns([i,l],1),f=J(Qi(u,d),[r[0],r[1]]);s=Wx(f)}if(s=Mf(s),n.rank===3&&n.shape[0]!==0){const r=s,o=n.shape[0];s=J(s,[o,s.shape[0]/o,s.shape[1]]),r.dispose()}return s}const QB=ee({irfft_:YB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZB(n,e,t=0){const r={x:P(n,"x","split")},o={numOrSizeSplits:e,axis:t};return Y.runKernel(lm,r,o)}const Es=ee({split_:ZB});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JB(n,e){O(n.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${n.dtype}`);let t=n.shape[n.shape.length-1];const s=n.size/t;let r;if(e!=null&&e<t){const x=n.shape.map(v=>0),w=n.shape.map(v=>v);w[n.shape.length-1]=e,r=$t(n,x,w),t=e}else if(e!=null&&e>t){const x=n.shape.map(w=>w);x[n.shape.length-1]=e-t,r=ns([n,gn(x)],n.shape.length-1),t=e}else r=n;const o=it(r),i=J(Qi(r,o),[s,t]),a=I$(i),l=Math.floor(t/2)+1,u=Mf(a),d=N1(a),f=Es(u,[l,t-l],u.shape.length-1),p=Es(d,[l,t-l],d.shape.length-1),g=r.shape.slice();return g[r.shape.length-1]=l,J(Qi(f[0],p[0]),g)}const eV=ee({rfft_:JB});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tV(n,e){let t=P(n,"a","squaredDifference"),s=P(e,"b","squaredDifference");[t,s]=Xt(t,s),Ke(t.shape,s.shape);const r={a:t,b:s},o={};return Y.runKernel(eh,r,o)}const nV=ee({squaredDifference_:tV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sV(n,e){const t=P(n,"x","squeeze","string_or_numeric");return J(t,ri(t.shape,e).newShape)}const hh=ee({squeeze_:sV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rV(n,e=0){const t=jI(n,"tensors","stack","string_or_numeric");O(t.length>=1,()=>"Pass at least one tensor to tf.stack"),t.length>0&&O(e<=t[0].rank,()=>"Axis must be <= rank of the tensor");const s=t,r={axis:e};return Y.runKernel(Yp,s,r)}const po=ee({stack_:rV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oV(n,e=0){const s={x:P(n,"x","step")},r={alpha:e};return Y.runKernel(oh,s,r)}const dh=ee({step_:oV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iV(n,e,t,s,r=0,o=0,i=0,a=0,l=0){const d={x:P(n,"x","stridedSlice","string_or_numeric")},f={begin:e,end:t,strides:s,beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};return Y.runKernel(d1,d,f)}const aV=ee({stridedSlice_:iV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lV(n){const t={x:P(n,"x","tan","float32")};return Y.runKernel(nh,t)}const cV=ee({tan_:lV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ms(n,e){$y(n);const t=ih(n,e);if(t.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return ah(n,null,t,e)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function q0(n,e,t){if($y(n),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");const s=ih(n,t);if(s.length!==2&&s.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return ah(n,e,s,t)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ux(n,e,t){$y(n);const s=ih(n,t);if(s.length!==3&&s.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(s.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return ah(n,e,s,t)}function $$(n,e,t){const s=e.rank>1?e.shape[e.rank-1]:1,r=e.rank>1?e.rank-1:1,o=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${t.shape}, indices.shape: ${e.shape}, shape: ${n}, sliceDim: ${s}, and batchDim: ${r}.`;if(t.rank<r)throw new Error(o+` update.rank < ${r}. `);if(n.length<s+(t.rank-r))throw new Error(o+` Output shape length < ${s+(t.rank-r)}`);if(t.rank!==r+n.length-s)throw new Error(o+` update.rank != ${r+n.length-s}`);for(let i=0;i<r;++i)if(t.shape[i]!==e.shape[i])throw new Error(o+` updates.shape[${i}] (${t.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<t.rank-r;++i)if(t.shape[i+r]!==n[i+s])throw new Error(o+` updates.shape[${i+r}] (${t.shape[i+r]}) != shape[${i+r}] (${n[i+r]})`)}function uV(n,e,t){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(n.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${n.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(t.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${t}`);if(t.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(n.size===0)throw new Error(`Updates specified for empty output. updates shape: ${n.shape}`)}$$(t,e,n)}function pa(n,e,t){const s=e.shape.length,r=s>1?e.shape[s-1]:1,o=t.length;let i=1;for(let f=r;f<o;++f)i*=t[f];const a=r<1?1:r,l=ce(e.shape)/a,u=[...ze(t.slice(0,r)),1],d=ce(t);return{sliceRank:r,numUpdates:l,sliceSize:i,strides:u,outputSize:d}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hV(n,e=1,t=!0){const s=P(n,"x","topk");if(s.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");const r=s.shape[s.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>r)throw new Error(`'k' passed to topk() must be <= the last dimension (${r}) but got ${e}`);const o={x:s},i={k:e,sorted:t},[a,l]=Y.runKernel(f1,o,i);return{values:a,indices:l}}const dV=ee({topk_:hV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fV(n,e=0,t=1,s,r){if(xo(n),s!=null&&s==="bool")throw new Error("Unsupported data type $ { dtype }");const o=new g$(e,t,s,!0,r),i=Ze(n,s);for(let a=0;a<i.values.length;a++)i.values[a]=o.nextValue();return i.toTensor()}const T$=ee({truncatedNormal_:fV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pV(n,e=0){const t=P(n,"x","unique","string_or_numeric");O(t.rank>0,()=>"The input tensor must be at least 1D");const s={x:t},r={axis:e},[o,i]=Y.runKernel(m1,s,r);return{values:o,indices:i}}const mV=ee({unique_:pV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gV(n,e,t){const s=P(n,"x","unsortedSegmentSum"),r=P(e,"segmentIds","unsortedSegmentSum","int32");O(pl(t),()=>"numSegments must be of dtype int");const o={x:s,segmentIds:r},i={numSegments:t};return Y.runKernel(hm,o,i)}const N$=ee({unsortedSegmentSum_:gV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xV(n,e=0){const t=P(n,"x","unstack","string_or_numeric");O(e>=-t.shape.length&&e<t.shape.length,()=>`Axis = ${e} is not in [-${t.shape.length}, ${t.shape.length})`);const s={value:t},r={axis:e};return Y.runKernel(um,s,r)}const oa=ee({unstack_:xV});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yV(n,e=!0,t,s){return Y.makeVariable(n,e,t,s)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function E$(n,e){const t=[];for(let o=0;o<e.length;o++)e[o]&&t.push(o);const s=Ze(n,"int32"),r=Ze([t.length,n.length],"int32");for(let o=0;o<t.length;o++){const i=s.indexToLoc(t[o]),a=o*n.length;r.values.set(i,a)}return r.toTensor()}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wV(n,e,t){const s=P(n,"x","transpose");if(e==null&&(e=s.shape.map((i,a)=>a).reverse()),O(s.rank===e.length,()=>`Error in transpose: rank of input ${s.rank} must match length of perm ${e}.`),e.forEach(i=>{O(i>=0&&i<s.rank,()=>`All entries in 'perm' must be between 0 and ${s.rank-1} but got ${e}`)}),s.rank<=1)return s.clone();const r={x:s},o={perm:e};return s.dtype==="complex64"?se(()=>{let i=Mf(s),a=N1(s);return i=Y.runKernel(rl,{x:i},o),a=Y.runKernel(rl,{x:a},o),t&&(a=jt(a)),Qi(i,a)}):Y.runKernel(rl,r,o)}const ot=ee({transpose_:wV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vV(n,e){if(e==null)return n.shape.slice();if(mt(n.shape,e))return e;if(n.shape.length===e.length){const t=[];for(let s=0;s<n.shape.length;s++)e[s]==null&&n.shape[s]!=null?t.push(n.shape[s]):t.push(e[s]);return t}return e}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bV(n,e,t,s){const r=P(n,"x","dropout");if(O(r.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${r.dtype} tensor instead.`),O(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return n instanceof rn?r.clone():r;const o=vV(r,t),i=1-e,a=Be(wm(ye(uh(o,0,1,"float32",s),i)),i);return j(r,a)}const CV=ee({dropout_:bV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kV(n,e,t,s,r,o="NHWC",i){let a=n;n.rank===3&&(a=J(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=J(e,[1,e.shape[0],e.shape[1],e.shape[2]])),O(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),O(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),O(t.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${t}.`);const u=o==="NHWC"?a.shape[3]:a.shape[1],d=o==="NHWC"?l.shape[3]:l.shape[1];O(u===t[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${t[2]}.`),O(d===t[3],()=>`Error in conv2dDerFilter: depth of dy (${d}) must match output depth for filter (${t[3]}).`),os("conv2dDerFilter",r,i);const f={x:a,dy:l},p={strides:s,pad:r,dataFormat:o,dimRoundingMode:i,filterShape:t};return Y.runKernel(Py,f,p)}const B1=ee({conv2DBackpropFilter_:kV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function V1(n,e,t){if(t==null||t==="linear")return n;if(t==="relu")return j(n,dh(e));throw new Error(`Cannot compute gradient for fused activation ${t}.`)}function W1(n,e){let t=e;const s=un(n.shape,e.shape);return s.length>0&&(t=Me(t,s)),J(t,n.shape)}function U1(n,e,t,s){if(e==="linear")return n;if(e==="relu")return fa(n);if(e==="elu")return xm(n);if(e==="relu6")return x$(n);if(e==="prelu")return O1(n,t);if(e==="leakyrelu")return E1(n,s);if(e==="sigmoid")return Rl(n);throw new Error(`Unknown fused activation ${e}.`)}const G1=(n,e)=>!(n>0)||e==="linear";/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SV({x:n,filter:e,strides:t,pad:s,dataFormat:r="NHWC",dilations:o=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:d}){if(l=l||"linear",G1(Y.state.gradientDepth,l)===!1){O(r==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${r} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let E=na(n,e,t,s,r,o,i);return a!=null&&(E=ye(E,a)),U1(E,l,u,d)}const f=P(n,"x","conv2d","float32"),p=P(e,"filter","conv2d","float32");let g=f,x=!1;f.rank===3&&(x=!0,g=J(f,[1,f.shape[0],f.shape[1],f.shape[2]])),O(g.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${g.rank}.`),O(p.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`),os("fused conv2d",s,i);const w=r==="NHWC"?g.shape[3]:g.shape[1];O(p.shape[2]===w,()=>`Error in conv2d: depth of input (${w}) must match input depth for filter ${p.shape[2]}.`),O(zn(t,o),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${t} and dilations '${o}'`);const v=Nn(g.shape,p.shape,t,o,s,i);let b;a!=null&&(b=P(a,"bias","fused conv2d"),[b]=Xt(b,f),r==="NHWC"?Ke(v.outShape,b.shape):(O(b.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${b.shape.length}.`),O(b.shape.length===0||b.shape[0]===v.outChannels||b.shape[0]===1,()=>`Error in fused conv2d: bias shape (${b.shape}) is not compatible with the number of output channels (${v.outChannels})`)));let C;if(u!=null){const E=u.shape;if(O(E.length<=1||E.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${E.length}.`),E.length===1)O(E[0]===1||E[0]===v.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${E}) is not compatible with the number of output channels (${v.outChannels}).`);else if(E.length===3)try{Ke(E,v.outShape)}catch{const F=`Error in fused conv2d: PReLU activation weights (${E}) is not compatible with the output shape of the conv2d (${v.outShape}).`;throw Error(F)}C=P(u,"prelu weights","fused conv2d")}const $=(E,A)=>{O(r==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${r} but only NHWC is currently supported.`);const[F,D,_,N]=A,L=V1(E,_,l);O(ea(o),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`);const G=k1(D.shape,L,F,t,s),Q=B1(D,L,F.shape,t,s),K=[G,Q];if(N!=null){const Z=W1(N,L);K.push(Z)}return K},S={x:g,filter:p,bias:b,preluActivationWeights:C},T={strides:t,pad:s,dataFormat:r,dilations:o,dimRoundingMode:i,activation:l,leakyreluAlpha:d};return a==null?yl((A,F,D)=>{let _=Y.runKernel(Rf,S,T);return D([F,A,_]),x&&(_=J(_,[_.shape[1],_.shape[2],_.shape[3]])),{value:_,gradFunc:$}})(g,p):yl((A,F,D,_)=>{let N=Y.runKernel(Rf,S,T);return _([F,A,N,D]),x&&(N=J(N,[N.shape[1],N.shape[2],N.shape[3]])),{value:N,gradFunc:$}})(g,p,b)}const IV=ee({fusedConv2d_:SV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $V(n,e,t,s,r,o=[1,1],i){let a=n;n.rank===3&&(a=J(n,[1,n.shape[0],n.shape[1],n.shape[2]]));let l=e;l.rank===3&&(l=J(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={x:a,dy:l},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,filterShape:t};return Y.runKernel(Hy,u,d)}const TV=ee({depthwiseConv2dNativeBackpropFilter_:$V});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NV(n,e,t,s,r,o=[1,1],i){let a=e,l=!1;e.rank===3&&(l=!0,a=J(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const u={dy:a,filter:t},d={strides:s,pad:r,dimRoundingMode:i,dilations:o,inputShape:n},f=Y.runKernel(jy,u,d);return l?J(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const EV=ee({depthwiseConv2dNativeBackpropInput_:NV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RV({a:n,b:e,transposeA:t=!1,transposeB:s=!1,bias:r,activation:o="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(G1(Y.state.gradientDepth,o)===!1){let N=ft(n,e,t,s);return r!=null&&(N=ye(N,r)),U1(N,o,i,a)}let l=P(n,"a","fused matMul"),u=P(e,"b","fused matMul");[l,u]=Xt(l,u);const d=t?l.shape[l.rank-2]:l.shape[l.rank-1],f=s?u.shape[u.rank-1]:u.shape[u.rank-2],p=t?l.shape[l.rank-1]:l.shape[l.rank-2],g=s?u.shape[u.rank-2]:u.shape[u.rank-1],x=l.shape.slice(0,-2),w=u.shape.slice(0,-2),v=ce(x),b=ce(w);O(d===f,()=>`Error in fused matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${t} and transposeB=${s} must match.`);const $=Ke(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([p,g]),S=t?J(l,[v,d,p]):J(l,[v,p,d]),T=s?J(u,[b,g,f]):J(u,[b,f,g]);let E;r!=null&&(E=P(r,"bias","fused matMul"),[E]=Xt(E,l),Ke($,E.shape));let A;i!=null&&(A=P(i,"prelu weights","fused matMul"));const F=(N,L)=>{const[G,Q,K,Z]=L,te=V1(J(N,K.shape),K,o);let B,H;if(!t&&!s?(B=ft(te,Q,!1,!0),H=ft(G,te,!0,!1)):!t&&s?(B=ft(te,Q,!1,!1),H=ft(te,G,!0,!1)):t&&!s?(B=ft(Q,te,!1,!0),H=ft(G,te,!1,!1)):(B=ft(Q,te,!0,!0),H=ft(te,G,!0,!0)),r!=null){const X=W1(Z,te);return[B,H,X]}else return[B,H]},D={a:S,b:T,bias:E,preluActivationWeights:A},_={transposeA:t,transposeB:s,activation:o,leakyreluAlpha:a};return r==null?yl((L,G,Q)=>{const K=Y.runKernel(Ef,D,_);return Q([L,G,K]),{value:J(K,$),gradFunc:F}})(S,T):yl((L,G,Q,K)=>{const Z=Y.runKernel(Ef,D,_);return K([L,G,Z,Q]),{value:J(Z,$),gradFunc:F}})(S,T,E)}const Qk=ee({fusedMatMul_:RV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AV(n,e,t,s,r="bilinear",o=0){const i=P(n,"image","cropAndResize"),a=P(e,"boxes","cropAndResize","float32"),l=P(t,"boxInd","cropAndResize","int32"),u=a.shape[0];O(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),O(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),O(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),O(s.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`),O(s[0]>=1&&s[1]>=1,()=>`cropSize must be atleast [1,1], but was ${s}`),O(r==="bilinear"||r==="nearest",()=>`method must be bilinear or nearest, but was ${r}`);const d={image:i,boxes:a,boxInd:l},f={method:r,extrapolationValue:o,cropSize:s};return Y.runKernel(Wy,d,f)}const DV=ee({cropAndResize_:AV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _V(n){const e=P(n,"image","flipLeftRight","float32");O(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);const t={image:e};return Y.runKernel(Qy,t,{})}const FV=ee({flipLeftRight_:_V});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OV(n){const e=P(n,"image","grayscaleToRGB"),t=e.rank-1,s=e.shape[t];O(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),O(s===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${s}.`);const r=new Array(e.rank);return r.fill(1,0,t),r[t]=3,mr(e,r)}const zV=ee({grayscaleToRGB_:OV});/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function MV(n){const e=P(n,"image","RGBToGrayscale"),t=e.rank-1,s=e.shape[t];O(e.rank>=2,()=>`Error in RGBToGrayscale: images must be at least rank 2, but got rank ${e.rank}.`),O(s===3,()=>`Error in RGBToGrayscale: last dimension of an RGB image should be size 3, but got size ${s}.`);const r=e.dtype,o=Ie(e,"float32"),i=ms([.2989,.587,.114]);let a;switch(e.rank){case 2:a=Tc("ij,j->i",o,i);break;case 3:a=Tc("ijk,k->ij",o,i);break;case 4:a=Tc("ijkl,l->ijk",o,i);break;case 5:a=Tc("ijklm,m->ijkl",o,i);break;case 6:a=Tc("ijklmn,n->ijklm",o,i);break;default:throw new Error("Not a valid tensor rank.")}return a=es(a,-1),Ie(a,r)}const PV=ee({rgbToGrayscale_:MV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LV(n,e,t=0,s=.5){const r=P(n,"image","rotateWithOffset","float32");O(r.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${r.rank}.`);const o={image:r},i={radians:e,fillValue:t,center:s};return Y.runKernel(g1,o,i)}const BV=ee({rotateWithOffset_:LV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dl(n,e,t,s,r,o){s==null&&(s=.5),r==null&&(r=Number.NEGATIVE_INFINITY),o==null&&(o=0);const i=n.shape[0];return t=Math.min(t,i),O(0<=s&&s<=1,()=>`iouThreshold must be in [0, 1], but was '${s}'`),O(n.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${n.rank}'`),O(n.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${n.shape[1]}`),O(e.rank===1,()=>"scores must be a 1D tensor"),O(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),O(0<=o&&o<=1,()=>`softNmsSigma must be in [0, 1], but was '${o}'`),{maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VV(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=P(n,"boxes","nonMaxSuppression","float32"),i=P(e,"scores","nonMaxSuppression","float32"),a=Dl(o,i,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l={maxOutputSize:t,iouThreshold:s,scoreThreshold:r};return Y.runKernel(s1,{boxes:o,scores:i},l)}const WV=ee({nonMaxSuppression_:VV});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UV(n,e,t){const s=GV(n,e,t),r=s<0?-(s+1):s;n.splice(r,0,e)}function GV(n,e,t){return jV(n,e,t||HV)}function HV(n,e){return n>e?1:n<e?-1:0}function jV(n,e,t){let s=0,r=n.length,o=0,i=!1;for(;s<r;){o=s+(r-s>>>1);const a=t(e,n[o]);a>0?s=o+1:(r=o,i=!a)}return i?s:-s-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H1(n,e,t,s,r){return K1(n,e,t,s,r,0)}function j1(n,e,t,s,r,o){return K1(n,e,t,s,r,0,!1,o,!0)}function X1(n,e,t,s,r,o){return K1(n,e,t,s,r,o,!0)}function K1(n,e,t,s,r,o,i=!1,a=!1,l=!1){const u=[];for(let v=0;v<e.length;v++)e[v]>r&&u.push({score:e[v],boxIndex:v,suppressBeginIndex:0});u.sort(Zk);const d=o>0?-.5/o:0,f=[],p=[];for(;f.length<t&&u.length>0;){const v=u.pop(),{score:b,boxIndex:C,suppressBeginIndex:$}=v;if(b<r)break;let S=!1;for(let T=f.length-1;T>=$;--T){const E=XV(n,C,f[T]);if(E>=s){S=!0;break}if(v.score=v.score*KV(s,d,E),v.score<=r)break}v.suppressBeginIndex=f.length,S||(v.score===b?(f.push(C),p.push(v.score)):v.score>r&&UV(u,v,Zk))}const g=f.length,x=t-g;a&&x>0&&(f.push(...new Array(x).fill(0)),p.push(...new Array(x).fill(0)));const w={selectedIndices:f};return i&&(w.selectedScores=p),l&&(w.validOutputs=g),w}function XV(n,e,t){const s=n.subarray(e*4,e*4+4),r=n.subarray(t*4,t*4+4),o=Math.min(s[0],s[2]),i=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),l=Math.max(s[1],s[3]),u=Math.min(r[0],r[2]),d=Math.min(r[1],r[3]),f=Math.max(r[0],r[2]),p=Math.max(r[1],r[3]),g=(a-o)*(l-i),x=(f-u)*(p-d);if(g<=0||x<=0)return 0;const w=Math.max(o,u),v=Math.max(i,d),b=Math.min(a,f),C=Math.min(l,p),$=Math.max(b-w,0)*Math.max(C-v,0);return $/(g+x-$)}function KV(n,e,t){const s=Math.exp(e*t*t);return t<=n?s:0}function Zk(n,e){return n.score-e.score||n.score===e.score&&e.boxIndex-n.boxIndex}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function qV(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY){const o=P(n,"boxes","nonMaxSuppressionAsync"),i=P(e,"scores","nonMaxSuppressionAsync"),a=Dl(o,i,t,s,r);t=a.maxOutputSize,s=a.iouThreshold,r=a.scoreThreshold;const l=await Promise.all([o.data(),i.data()]),u=l[0],d=l[1],{selectedIndices:f}=H1(u,d,t,s,r);return o!==n&&o.dispose(),i!==e&&i.dispose(),ms(f,"int32")}const YV=qV;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QV(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=P(n,"boxes","nonMaxSuppression"),a=P(e,"scores","nonMaxSuppression"),l=Dl(i,a,t,s,r,o);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const u={boxes:i,scores:a},d={maxOutputSize:t,iouThreshold:s,scoreThreshold:r,softNmsSigma:o},f=Y.runKernel(o1,u,d);return{selectedIndices:f[0],selectedScores:f[1]}}const ZV=ee({nonMaxSuppressionWithScore_:QV});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function JV(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=0){const i=P(n,"boxes","nonMaxSuppressionAsync"),a=P(e,"scores","nonMaxSuppressionAsync"),l=Dl(i,a,t,s,r,o);t=l.maxOutputSize,s=l.iouThreshold,r=l.scoreThreshold,o=l.softNmsSigma;const u=await Promise.all([i.data(),a.data()]),d=u[0],f=u[1],{selectedIndices:p,selectedScores:g}=X1(d,f,t,s,r,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:ms(p,"int32"),selectedScores:ms(g)}}const eW=JV;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tW(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=P(n,"boxes","nonMaxSuppression"),a=P(e,"scores","nonMaxSuppression"),l=Dl(i,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,p={boxes:i,scores:a},g={maxOutputSize:u,iouThreshold:d,scoreThreshold:f,padToMaxOutputSize:o},x=Y.runKernel(r1,p,g);return{selectedIndices:x[0],validOutputs:x[1]}}const nW=ee({nonMaxSuppressionPadded_:tW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function sW(n,e,t,s=.5,r=Number.NEGATIVE_INFINITY,o=!1){const i=P(n,"boxes","nonMaxSuppressionAsync"),a=P(e,"scores","nonMaxSuppressionAsync"),l=Dl(i,a,t,s,r,null),u=l.maxOutputSize,d=l.iouThreshold,f=l.scoreThreshold,[p,g]=await Promise.all([i.data(),a.data()]),{selectedIndices:x,validOutputs:w}=j1(p,g,u,d,f,o);return i!==n&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:ms(x,"int32"),validOutputs:pt(w,"int32")}}const rW=sW;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oW(n,e,t=!1,s=!1){const r=P(n,"images","resizeBilinear");O(r.rank===3||r.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${r.rank}.`),O(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),O(s===!1||t===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=J(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:t,halfPixelCenters:s,size:e},u=Y.runKernel(nm,a,l);return i?J(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const R$=ee({resizeBilinear_:oW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iW(n,e,t=!1,s=!1){const r=P(n,"images","resizeNearestNeighbor");O(r.rank===3||r.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${r.rank}.`),O(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),O(r.dtype==="float32"||r.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),O(s===!1||t===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let o=r,i=!1;r.rank===3&&(i=!0,o=J(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const a={images:o},l={alignCorners:t,halfPixelCenters:s,size:e},u=Y.runKernel(tm,a,l);return i?J(u,[u.shape[1],u.shape[2],u.shape[3]]):u}const A$=ee({resizeNearestNeighbor_:iW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aW(n,e="binary",t=!1,s=.5){const r=P(n,"image","threshold"),o=.2989,i=.587,a=.114,l=r.shape[0]*r.shape[1];let u=j(ms([s]),255),d,f,p,g;if(O(r.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${r.rank}.`),O(r.shape[2]===3||r.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${r.shape[2]}.`),O(r.dtype==="int32"||r.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${r.dtype}.`),O(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),r.shape[2]===3){[d,f,p]=Es(r,[1,1,1],-1);const v=j(d,o),b=j(f,i),C=j(p,a);g=ye(ye(v,b),C)}else g=n;if(e==="otsu"){const v=rL(Ie(y$(g),"int32"),Uc([]),256);u=lW(v,l)}const x=t?Al(g,u):As(g,u);return Ie(j(x,255),"int32")}function lW(n,e){let t=ms([-1]),s=ms([0]),r=ms([0]),o,i,a,l,u,d;for(let f=0;f<n.size-1;f++){o=$t(n,0,f+1),i=$t(n,f+1),u=Be(Me(o),e),d=Be(Me(i),e);const p=Me(j(o,Zc(0,o.size)));a=Be(p,Me(o));const g=gm(i.shape,o.size),x=ye(Zc(0,i.size),g),w=j(i,x);l=Be(Me(w),Me(i));const v=Ge(a,l),b=Ge(a,l),C=j(u,d);r=j(j(C,v),b);const $=As(r,s);s=Xn($,r,s),t=Xn($,ms([f]),t)}return t}const cW=ee({threshold_:aW});/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uW(n,e,t="nearest",s="constant",r=0,o){const i=P(n,"image","transform","float32"),a=P(e,"transforms","transform","float32");O(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),O(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),O(o==null||o.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${o}.`);const l={image:i,transforms:a},u={interpolation:t,fillMode:s,fillValue:r,outputShape:o};return Y.runKernel(p1,l,u)}const hW=ee({transform_:uW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function dW(n,e,t){const s=P(n,"a","bandPart");O(s.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`);const r=s.shape,[o,i]=s.shape.slice(-2);let a,l;typeof e=="number"?(O(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),O(e<=o,()=>`bandPart(): numLower (${e}) must not be greater than the number of rows (${o}).`),a=P(e<0?o:e,"numLower","bandPart")):(O(e.dtype==="int32",()=>"bandPart(): numLower's dtype must be an int32."),a=Xn(Of(e,0),o,Qc(e,o))),typeof t=="number"?(O(t%1===0,()=>`bandPart(): numUpper must be an integer, got ${t}.`),O(t<=i,()=>`bandPart(): numUpper (${t}) must not be greater than the number of columns (${i}).`),l=P(t<0?i:t,"numUpper","bandPart")):(O(t.dtype==="int32",()=>"bandPart(): numUpper's dtype must be an int32."),l=Xn(Of(t,0),i,Qc(t,i)));const u=J(Zc(0,o,1,"int32"),[-1,1]),d=Zc(0,i,1,"int32"),f=Ge(u,d),p=fo(Al(f,a),da(f,jt(l))),g=gn([o,i],s.dtype);return J(po(oa(J(s,[-1,o,i])).map(x=>Xn(p,x,g))),r)}const fW=ee({bandPart_:dW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pW(n){let e;if(Array.isArray(n)){e=!1,O(n!=null&&n.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");const r=n[0].shape[0];for(let o=1;o<n.length;++o)O(n[o].shape[0]===r,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${n[o].shape[0]} vs. ${r})`)}else e=!0,n=Es(n,n.shape[0],0).map(r=>hh(r,[0]));O(n.length<=n[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${n.length}) exceeds number of dimensions (${n[0].shape[0]}).`);const t=[],s=n;for(let r=0;r<n.length;++r)t.push(Y.tidy(()=>{let o=s[r];if(r>0)for(let i=0;i<r;++i){const a=j(Me(j(t[i],o)),t[i]);o=Ge(o,a)}return Be(o,ym(o,"euclidean"))}));return e?po(t,0):t}const mW=ee({gramSchmidt_:pW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gW(n,e=!1){if(O(n.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${n.rank}`),n.rank===2)return Jk(n,e);{const t=n.shape.slice(0,n.shape.length-2).reduce((l,u)=>l*u),s=oa(J(n,[t,n.shape[n.shape.length-2],n.shape[n.shape.length-1]]),0),r=[],o=[];s.forEach(l=>{const[u,d]=Jk(l,e);r.push(u),o.push(d)});const i=J(po(r,0),n.shape),a=J(po(o,0),n.shape);return[i,a]}}function Jk(n,e=!1){return Y.tidy(()=>{O(n.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${n.shape.length}D Tensor.`);const t=n.shape[0],s=n.shape[1];let r=u$(t),o=Hi(n);const i=q0([[1]],[1,1]);let a=Hi(i);const l=t>=s?s:t;for(let u=0;u<l;++u){const d=o,f=a,p=r;[a,o,r]=Y.tidy(()=>{const g=$t(o,[u,u],[t-u,1]),x=ym(g),w=$t(o,[u,u],[1,1]),v=Xn(As(w,0),q0([[-1]]),q0([[1]])),b=Ge(w,j(v,x)),C=Be(g,b);C.shape[0]===1?a=Hi(i):a=ns([i,$t(C,[1,0],[C.shape[0]-1,C.shape[1]])],0);const $=jt(Be(ft(v,b),x)),S=$t(o,[u,0],[t-u,s]),T=j($,a),E=ot(a);if(u===0)o=Ge(S,ft(T,ft(E,S)));else{const D=Ge(S,ft(T,ft(E,S)));o=ns([$t(o,[0,0],[u,s]),D],0)}const A=ot(T),F=$t(r,[0,u],[t,r.shape[1]-u]);if(u===0)r=Ge(F,ft(ft(F,a),A));else{const D=Ge(F,ft(ft(F,a),A));r=ns([$t(r,[0,0],[t,u]),D],1)}return[a,o,r]}),Ye([d,f,p])}return!e&&t>s&&(r=$t(r,[0,0],[t,s]),o=$t(o,[0,0],[s,s])),[r,o]})}const xW=ee({qr_:gW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uo={flipLeftRight:FV,grayscaleToRGB:zV,resizeNearestNeighbor:A$,resizeBilinear:R$,rgbToGrayscale:PV,rotateWithOffset:BV,cropAndResize:DV,nonMaxSuppression:WV,nonMaxSuppressionAsync:YV,nonMaxSuppressionWithScore:ZV,nonMaxSuppressionWithScoreAsync:eW,nonMaxSuppressionPadded:nW,nonMaxSuppressionPaddedAsync:rW,threshold:cW,transform:hW},yW={bandPart:fW,gramSchmidt:mW,qr:xW};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wW=new Map,vW=new Map;class _l{getClassName(){return this.constructor.className}static fromConfig(e,t){return new e(t)}}class Hs{constructor(){this.classNameMap={}}static getMap(){return Hs.instance==null&&(Hs.instance=new Hs),Hs.instance}static register(e){Hs.getMap().classNameMap[e.className]=[e,e.fromConfig]}}function fe(n,e,t){O(n.className!=null,()=>"Class being registered does not have the static className property defined."),O(typeof n.className=="string",()=>"className is required to be a string, but got type "+typeof n.className),O(n.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),typeof e>"u"&&(e="Custom"),typeof t>"u"&&(t=n.className);const s=t,r=e+">"+s;return Hs.register(n),wW.set(r,n),vW.set(n,r),n}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hi extends _l{minimize(e,t=!1,s){const{value:r,grads:o}=this.computeGradients(e,s);if(s!=null){const i=s.map(a=>({name:a.name,tensor:o[a.name]}));this.applyGradients(i)}else this.applyGradients(o);return Ye(o),t?r:(r.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,t){return I4(e,t)}dispose(){this.iterations_!=null&&Ye(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:pt(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}}Object.defineProperty(hi,Symbol.hasInstance,{value:n=>n.minimize!=null&&n.computeGradients!=null&&n.applyGradients!=null});/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class D$ extends hi{static get className(){return"Adadelta"}constructor(e,t,s=null){super(),this.learningRate=e,this.rho=t,this.epsilon=s,this.accumulatedGrads=[],this.accumulatedUpdates=[],s==null&&(this.epsilon=Y.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Y.registeredVariables[s],i=!1;this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accum_grad`,variable:se(()=>it(o).variable(i))}),this.accumulatedUpdates[r]==null&&(this.accumulatedUpdates[r]={originalName:`${s}/accum_var`,variable:se(()=>it(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedGrads[r].variable,u=this.accumulatedUpdates[r].variable;se(()=>{const d=ye(j(l,this.rho),j(At(a),1-this.rho)),f=j(Be(On(ye(u,this.epsilon)),On(ye(l,this.epsilon))),a),p=ye(j(u,this.rho),j(At(f),1-this.rho));l.assign(d),u.assign(p);const g=ye(j(f,-this.learningRate),o);o.assign(g)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Ye(this.accumulatedGrads.map(e=>e.variable)),Ye(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){const e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=e.length/2,s=!1;this.accumulatedGrads=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedUpdates=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _$ extends hi{static get className(){return"Adagrad"}constructor(e,t=.1){super(),this.learningRate=e,this.initialAccumulatorValue=t,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Y.registeredVariables[s];this.accumulatedGrads[r]==null&&(this.accumulatedGrads[r]={originalName:`${s}/accumulator`,variable:se(()=>gm(o.shape,this.initialAccumulatorValue).variable(!1))});const i=Array.isArray(e)?e[r].tensor:e[s];if(i==null)return;const a=this.accumulatedGrads[r].variable;se(()=>{const l=ye(a,At(i));a.assign(l);const u=ye(j(Be(i,On(ye(l,Y.backend.epsilon()))),-this.learningRate),o);o.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Ye(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulatedGrads=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class F$ extends hi{static get className(){return"Adam"}constructor(e,t,s,r=null){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],se(()=>{this.accBeta1=pt(t).variable(),this.accBeta2=pt(s).variable()}),r==null&&(this.epsilon=Y.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);se(()=>{const s=Ge(1,this.accBeta1),r=Ge(1,this.accBeta2);t.forEach((o,i)=>{const a=Y.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:se(()=>it(a).variable(l))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${o}/v`,variable:se(()=>it(a).variable(l))});const u=Array.isArray(e)?e[i].tensor:e[o];if(u==null)return;const d=this.accumulatedFirstMoment[i].variable,f=this.accumulatedSecondMoment[i].variable,p=ye(j(d,this.beta1),j(u,1-this.beta1)),g=ye(j(f,this.beta2),j(At(u),1-this.beta2)),x=Be(p,s),w=Be(g,r);d.assign(p),f.assign(g);const v=ye(j(Be(x,ye(On(w),this.epsilon)),-this.learningRate),a);a.assign(v)}),this.accBeta1.assign(j(this.accBeta1,this.beta1)),this.accBeta2.assign(j(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Ye(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Ye(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e),se(()=>{this.accBeta1.assign(sa(this.beta1,this.iterations_+1)),this.accBeta2.assign(sa(this.beta2,this.iterations_+1))});const t=e.length/2,s=!1;this.accumulatedFirstMoment=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedSecondMoment=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class O$ extends hi{static get className(){return"Adamax"}constructor(e,t,s,r=null,o=0){super(),this.learningRate=e,this.beta1=t,this.beta2=s,this.epsilon=r,this.decay=o,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],se(()=>{this.iteration=pt(0).variable(),this.accBeta1=pt(t).variable()}),r==null&&(this.epsilon=Y.backend.epsilon())}applyGradients(e){const t=Array.isArray(e)?e.map(s=>s.name):Object.keys(e);se(()=>{const s=Ge(1,this.accBeta1),r=Be(-this.learningRate,ye(j(this.iteration,this.decay),1));t.forEach((o,i)=>{const a=Y.registeredVariables[o],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${o}/m`,variable:it(a).variable(l)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${o}/v`,variable:it(a).variable(l)});const u=Array.isArray(e)?e[i].tensor:e[o];if(u==null)return;const d=this.accumulatedFirstMoment[i].variable,f=this.accumulatedWeightedInfNorm[i].variable,p=ye(j(d,this.beta1),j(u,1-this.beta1)),g=j(f,this.beta2),x=Un(u),w=ci(g,x);d.assign(p),f.assign(w);const v=ye(j(Be(r,s),Be(p,ye(w,this.epsilon))),a);a.assign(v)}),this.iteration.assign(ye(this.iteration,1)),this.accBeta1.assign(j(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Ye(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Ye(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class q1 extends hi{static get className(){return"SGD"}constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Array.isArray(e)?e[r].tensor:e[s];if(o==null)return;const i=Y.registeredVariables[s];se(()=>{const a=ye(j(this.c,o),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Pr(pt(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,t){return new e(t.learningRate)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class z$ extends q1{static get className(){return"Momentum"}constructor(e,t,s=!1){super(e),this.learningRate=e,this.momentum=t,this.useNesterov=s,this.accumulations=[],this.m=pt(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Y.registeredVariables[s];this.accumulations[r]==null&&(this.accumulations[r]={originalName:`${s}/momentum`,variable:se(()=>it(o).variable(!1))});const i=this.accumulations[r].variable,a=Array.isArray(e)?e[r].tensor:e[s];a!=null&&se(()=>{let l;const u=ye(j(this.m,i),a);this.useNesterov?l=ye(j(this.c,ye(a,j(u,this.m))),o):l=ye(j(this.c,u),o),i.assign(u),o.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Ye(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=!1;this.accumulations=e.map(s=>({originalName:s.name,variable:s.tensor.variable(t)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class M$ extends hi{static get className(){return"RMSProp"}constructor(e,t=.9,s=0,r=null,o=!1){if(super(),this.learningRate=e,this.decay=t,this.momentum=s,this.epsilon=r,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=o,r==null&&(this.epsilon=Y.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(s=>s.name):Object.keys(e)).forEach((s,r)=>{const o=Y.registeredVariables[s],i=!1;this.accumulatedMeanSquares[r]==null&&(this.accumulatedMeanSquares[r]={originalName:`${s}/rms`,variable:se(()=>it(o).variable(i))}),this.accumulatedMoments[r]==null&&(this.accumulatedMoments[r]={originalName:`${s}/momentum`,variable:se(()=>it(o).variable(i))}),this.accumulatedMeanGrads[r]==null&&this.centered&&(this.accumulatedMeanGrads[r]={originalName:`${s}/mg`,variable:se(()=>it(o).variable(i))});const a=Array.isArray(e)?e[r].tensor:e[s];if(a==null)return;const l=this.accumulatedMeanSquares[r].variable,u=this.accumulatedMoments[r].variable;se(()=>{const d=ye(j(l,this.decay),j(At(a),1-this.decay));if(this.centered){const f=this.accumulatedMeanGrads[r].variable,p=ye(j(f,this.decay),j(a,1-this.decay)),g=Be(j(a,this.learningRate),On(Ge(d,ye(At(p),this.epsilon)))),x=ye(j(u,this.momentum),g);l.assign(d),f.assign(p),u.assign(x);const w=Ge(o,x);o.assign(w)}else{const f=ye(j(l,this.decay),j(At(a),1-this.decay)),p=ye(j(u,this.momentum),Be(j(a,this.learningRate),On(ye(f,this.epsilon))));l.assign(f),u.assign(p);const g=Ge(o,p);o.assign(g)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Ye(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Ye(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Ye(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){const e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(t=>({name:t.originalName,tensor:t.variable})))}async setWeights(e){e=await this.extractIterations(e);const t=this.centered?e.length/3:e.length/2,s=!1;this.accumulatedMeanSquares=e.slice(0,t).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.accumulatedMoments=e.slice(t,t*2).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})),this.centered&&(this.accumulatedMeanGrads=e.slice(t*2,t*3).map(r=>({originalName:r.name,variable:r.tensor.variable(s)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bW=[D$,_$,F$,O$,z$,M$,q1];function CW(){for(const n of bW)fe(n)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eS(n,e,t,s){i(n),t=t??0,s=s??1,a(t,s);let r=0;const o=l=>(l.then(u=>{const d=t+ ++r/n.length*(s-t);return e(d),u}),l);function i(l){O(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){O(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),O(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),O(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(n.map(o))}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */async function kW(n,e){e==null&&(e={});const t=e.fetchFunc==null?ie().platform.fetch:e.fetchFunc,s=n.map(f=>t(f,e.requestInit,{isBinary:!0})),a=(e.onProgress==null?await Promise.all(s):await eS(s,e.onProgress,0,.5)).map(f=>f.arrayBuffer());return e.onProgress==null?await Promise.all(a):await eS(a,e.onProgress,.5,1)}function SW(n,e){var t;const s=e.fetchFunc==null?ie().platform.fetch:e.fetchFunc;let r=0,o;return(t=e.onProgress)===null||t===void 0||t.call(e,0),new ReadableStream({pull:async i=>{for(var a;r<n.length;){o||(o=(await s(n[r],e.requestInit,{isBinary:!0})).body.getReader());const{done:l,value:u}=await o.read();if(l){r++,o=void 0,(a=e.onProgress)===null||a===void 0||a.call(e,r/n.length);continue}i.enqueue(u);return}i.close()}})}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IW="application/octet-stream",$W="application/json";class Y1{constructor(e,t){if(this.DEFAULT_METHOD="POST",t==null&&(t={}),this.weightPathPrefix=t.weightPathPrefix,this.weightUrlConverter=t.weightUrlConverter,t.fetchFunc!=null?(O(typeof t.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=t.fetchFunc):this.fetch=ie().platform.fetch,O(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&O(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,t.requestInit!=null&&t.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=t.requestInit||{},this.loadOptions=t}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const t=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);t.body=new FormData;const s=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],r=PM(e,s);if(t.body.append("model.json",new Blob([JSON.stringify(r)],{type:$W}),"model.json"),e.weightData!=null){const i=ii.join(e.weightData);t.body.append("model.weights.bin",new Blob([i],{type:IW}),"model.weights.bin")}const o=await this.fetch(this.path,t);if(o.ok)return{modelArtifactsInfo:w1(e),responses:[o]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${o.status}.`)}async loadModelJSON(){const e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let t;try{t=await e.json()}catch{let i=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?i+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":i+=" Please make sure the server is serving valid JSON for this request.",new Error(i)}const s=t.modelTopology,r=t.weightsManifest;if(s==null&&r==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return t}async load(){if(this.loadOptions.streamWeights)return this.loadStream();const e=await this.loadModelJSON();return BM(e,t=>this.loadWeights(t))}async loadStream(){const e=await this.loadModelJSON(),t=await this.getWeightUrls(e.weightsManifest),s=Bk(e.weightsManifest),r=()=>SW(t,this.loadOptions);return Object.assign(Object.assign({},e),{weightSpecs:s,getWeightStream:r})}async getWeightUrls(e){const t=Array.isArray(this.path)?this.path[1]:this.path,[s,r]=TW(t),o=this.weightPathPrefix||s,i=[],a=[];for(const l of e)for(const u of l.paths)this.weightUrlConverter!=null?a.push(this.weightUrlConverter(u)):i.push(o+u+r);return this.weightUrlConverter&&i.push(...await Promise.all(a)),i}async loadWeights(e){const t=await this.getWeightUrls(e),s=Bk(e),r=await kW(t,this.loadOptions);return[s,r]}}Y1.URL_SCHEME_REGEX=/^https?:\/\//;function TW(n){const e=n.lastIndexOf("/"),t=n.lastIndexOf("?"),s=n.substring(0,e),r=t>e?n.substring(t):"";return[s+"/",r]}function tS(n){return n.match(Y1.URL_SCHEME_REGEX)!=null}const P$=(n,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let t=!0;if(Array.isArray(n)?t=n.every(s=>tS(s)):t=tS(n),t)return L$(n,e)}return null};pn.registerSaveRouter(P$);pn.registerLoadRouter(P$);function L$(n,e){return new Y1(n,e)}function NW(n,e){return L$(n,e)}function Q1(n,e){const t=n.shape.length,s=e.shape.length;if(t<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${t}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>t)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${t}`);if(ce(n.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${n.shape}.`);const r=e.shape,o=r[r.length-1];let i=1;for(let f=0;f<r.length-1;++f)i*=r[f];const a=n.shape,l=r.slice();l.pop();let u=1;for(let f=o;f<t;++f)u*=a[f],l.push(a[f]);const d=[...ze(n.shape).map(f=>f/u),1].slice(0,o);return[l,i,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gx=-2,EW=-1;function Z1(n,e,t){const s=n.shape.length;O(s===e.length,()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`),O(s===t.length,()=>`Error in slice${s}D: Length of size ${t} must match the rank of the array (${s}).`);for(let r=0;r<s;++r)O(e[r]+t[r]<=n.shape[r],()=>`Error in slice${s}D: begin[${r}] + size[${r}] (${e[r]+t[r]}) would overflow input.shape[${r}] (${n.shape[r]})`)}function RW(n){const e=[];let t=0;for(;n>0;)n&1&&e.push(t),n/=2,t++;return e}function J1(n,e,t){const s=[];for(let r=0;r<n.length;r++)s[r]=Math.ceil((e[r]-n[r])/t[r]);return s}function B$(n,e,t,s){const r=[...n];for(let o=r.length;o<s.length;o++)r.push(1);for(let o=0;o<t;o++)o===0?r[e]=1:(r.splice(e,0,1),r.pop());return r}function V$(n,e,t){return t<=n?t:t-(e-1)}function W$(n,e){const t=[];for(let s=0;s<n;s++)t.push(e+s);return t}function AW(n,e,t,s,r,o,i,a,l){const u=n.length;let d=new Array(u),f=new Array(u),p=new Array(u);if(e.length&&t>0){const g=e[0],x=t+1;d=U$(i,g,x,s,n),f=G$(a,g,x,r,n),p=B$(o,g,x,n)}else for(let g=0;g<u;g++)d[g]=j$(i,s,o,n,g,l),f[g]=X$(a,r,o,n,g,l),p[g]=H$(o,g,l);return{begin:d,end:f,strides:p}}function U$(n,e,t,s,r){const o=[...r],i=W$(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=0;else{const l=V$(e,t,a);let u=s[l];n&1<<l&&(u=0),o[a]=u}return o}function G$(n,e,t,s,r){const o=[...r],i=W$(t,e);for(let a=0;a<o.length;a++)if(i.indexOf(a)>-1)o[a]=Number.MAX_SAFE_INTEGER;else{const l=V$(e,t,a);let u=s[l];n&1<<l&&(u=Number.MAX_SAFE_INTEGER),o[a]=u}for(let a=0;a<o.length;a++){const l=r[a];o[a]<0&&(o[a]+=l),o[a]=qi(0,o[a],r[a])}return o}function H$(n,e,t){let s=n[e];return(t&1<<e||s==null)&&(s=1),s}function j$(n,e,t,s,r,o){let i=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);const l=s[r];return i<0&&(i+=l),i=qi(0,i,l-1),i}function X$(n,e,t,s,r,o){let i=e[r];const a=t[r]||1;(n&1<<r||o&1<<r||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);const l=s[r];return i<0&&(i+=l),a>0?i=qi(0,i,l):i=qi(-1,i,l-1),i}function ew(n,e,t){let s=t.length;for(let r=0;r<t.length;r++)if(t[r]>1){s=r;break}for(let r=s+1;r<t.length;r++)if(e[r]>0||t[r]!==n[r])return!1;return!0}function tw(n,e){let t=n.length>0?n[n.length-1]:1;for(let s=0;s<n.length-1;s++)t+=n[s]*e[s];return t}function vm(n,e,t){let s;const r=n.shape.length;typeof e=="number"?s=[e,...new Array(r-1).fill(0)]:e.length<r?s=e.concat(new Array(r-e.length).fill(0)):s=e.slice(),s.forEach(i=>{O(i!==-1,()=>"slice() does not support negative begin indexing.")});let o;return t==null?o=new Array(r).fill(-1):typeof t=="number"?o=[t,...new Array(r-1).fill(-1)]:t.length<r?o=t.concat(new Array(r-t.length).fill(-1)):o=t,o=o.map((i,a)=>i>=0?i:(O(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),n.shape[a]-s[a])),[s,o]}function nw(n,e,t,s,r,o,i,a,l){let u;if(s==null?(u=new Array(e.length),u.fill(1)):u=s,i!=null&&(i&i-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let d=!1;const f={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:t.slice(),strides:u.slice(),beginMask:r,endMask:o,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};for(let $=0;$<f.dims;$++)d&&(1<<$&a)!==0&&f.numAddAxisAfterEllipsis++,1<<$&i&&(d=!0);d||(f.ellipsisMask|=1<<f.dims,f.dims++);const p={dims:n.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};DW(f,p);let g=!0,x=!0,w=!0;const v=[],b=[];for(let $=0;$<n.length;++$){if(p.strides[$]===0)throw Error(`strides[${$}] must be non-zero`);const S=!!(p.shrinkAxisMask&1<<$),T=n[$];if(T===-1){v.push(S?1:-1);continue}const E=[p.beginMask&1<<$,p.endMask&1<<$],A=[p.strides[$]>0?0:-1,p.strides[$]>0?T:T-1];if(S&&p.strides[$]<=0)throw Error("only stride 1 allowed on non-range indexing.");w=w&&p.strides[$]===1;const F=!!(p.beginMask&1<<$&&p.endMask&1<<$);if(p.beginValid&&p.endValid){if(S){const L=p.begin[$]<0?T+p.begin[$]:p.begin[$];if(p.begin[$]=L,p.end[$]=p.begin[$]+1,L<0||L>=T)throw Error(`slice index ${p.begin[$]} of dimension ${$} out of bounds.`)}else p.begin[$]=nS(p.begin[$],0,p.strides[$],T,E,A),p.end[$]=nS(p.end[$],1,p.strides[$],T,E,A);const N=p.strides[$]===1&&p.begin[$]===0&&p.end[$]===T;g=g&&N,x=x&&($===0&&p.strides[$]===1||N)}else g=g&&p.strides[$]===1&&F,x=x&&($===0&&p.strides[$]===1||F);let D,_=!1;if(p.beginValid&&p.endValid?(D=p.end[$]-p.begin[$],_=!0):S?(D=1,_=!0):F&&T>=0&&(p.strides[$]<0?D=-T:D=T,_=!0),_){let N;D===0||D<0!=p.strides[$]<0?N=0:N=Math.trunc(D/p.strides[$])+(D%p.strides[$]!==0?1:0),v.push(N)}else v.push(-1)}for(let $=0;$<p.finalShapeGatherIndices.length;++$){const S=p.finalShapeGatherIndices[$];S>=0?b.push(v[S]):S===Gx&&b.push(1)}return{finalShapeSparse:b.filter(($,S)=>p.finalShapeGatherIndices[S]!==Gx),finalShape:b,isIdentity:g,sliceDim0:x,isSimpleSlice:w,begin:p.begin,end:p.end,strides:p.strides}}function DW(n,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let t=0;e.beginValid=n.begin!=null,e.endValid=n.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let s=0;s<n.dims;s++)if(1<<s&n.ellipsisMask){const r=Math.min(e.dims-(n.dims-s)+1+n.numAddAxisAfterEllipsis,e.dims);for(;t<r;t++)e.begin[t]=0,e.end[t]=0,e.strides[t]=1,e.beginMask|=1<<t,e.endMask|=1<<t,e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[t]=s}else if(1<<s&n.newAxisMask)e.finalShapeGatherIndices.push(Gx),e.finalShapeGatherIndicesSparse.push(-1);else{if(t===e.begin.length)throw Error(`Index out of range using input dim ${t}; input has only ${e.dims} dims, ${e.begin.length}.`);n.begin!=null&&(e.begin[t]=n.begin[s]),n.end!=null&&(e.end[t]=n.end[s]),e.strides[t]=n.strides[s],n.beginMask&1<<s&&(e.beginMask|=1<<t),n.endMask&1<<s&&(e.endMask|=1<<t),n.shrinkAxisMask&1<<s?(e.finalShapeGatherIndices.push(EW),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<t):(e.finalShapeGatherIndices.push(t),e.finalShapeGatherIndicesSparse.push(s)),e.inputShapeGatherIndicesSparse[t]=s,t++}}function nS(n,e,t,s,r,o){if(r[e])return t>0?o[e]:o[e+1&1];{const i=n<0?s+n:n;return i<o[0]?o[0]:i>o[1]?o[1]:i}}const _W=Object.freeze(Object.defineProperty({__proto__:null,assertParamsValid:Z1,computeFlatOffset:tw,computeOutShape:J1,getNormalizedAxes:AW,isSliceContinous:ew,maskToAxes:RW,parseSliceParams:vm,sliceInfo:nw,startForAxis:j$,startIndicesWithElidedDims:U$,stopForAxis:X$,stopIndicesWithElidedDims:G$,stridesForAxis:H$,stridesWithElidedDims:B$},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class FW{static sgd(e){return new q1(e)}static momentum(e,t,s=!1){return new z$(e,t,s)}static rmsprop(e,t=.9,s=0,r=null,o=!1){return new M$(e,t,s,r,o)}static adam(e=.001,t=.9,s=.999,r=null){return new F$(e,t,s,r)}static adadelta(e=.001,t=.95,s=null){return new D$(e,t,s)}static adamax(e=.002,t=.9,s=.999,r=null,o=0){return new O$(e,t,s,r,o)}static adagrad(e,t=.1){return new _$(e,t)}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fi=FW;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OW=typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:n=>n();function K$(){return new Promise(n=>OW(()=>n()))}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sw(n,e){const t=n[0].length;n.forEach((r,o)=>{O(r.length===t,()=>`Error in concat${t}D: rank of tensors[${o}] must be the same as the rank of the rest (${t})`)}),O(e>=0&&e<t,()=>`Error in concat${t}D: axis must be between 0 and ${t-1}.`);const s=n[0];n.forEach((r,o)=>{for(let i=0;i<t;i++)O(i===e||r[i]===s[i],()=>`Error in concat${t}D: Shape of tensors[${o}] (${r}) does not match the shape of the rest (${s}) along the non-concatenated axis ${o}.`)})}function Lr(n,e){const t=n[0].slice();for(let s=1;s<n.length;s++)t[e]+=n[s][e];return t}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var fr;(function(n){n[n.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",n[n.VALUE_ROWIDS=1]="VALUE_ROWIDS",n[n.ROW_LENGTHS=2]="ROW_LENGTHS",n[n.ROW_SPLITS=3]="ROW_SPLITS",n[n.ROW_LIMITS=4]="ROW_LIMITS",n[n.ROW_STARTS=5]="ROW_STARTS"})(fr||(fr={}));function q$(n,e,t){let s=new Array;if(t==null&&e==null)return s;if(e==null)for(;s.length<n+t.length;)s.push(-1);else s=e.slice();if(t==null)return s;if(n+t.length!==s.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${n+t.length}, but shape.rank = ${s.length}`);for(let r=1;r<t.length;++r){const o=t[r],i=s[s.length-t.length+r],a=s[i];if(o>=0)if(a>=0){if(a!==o)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${r+n}] = ${o} but shape[${r+n}] = ${a}`)}else s[i]=o}return s}function Y$(n){const e={FIRST_DIM_SIZE:fr.FIRST_DIM_SIZE,VALUE_ROWIDS:fr.VALUE_ROWIDS,ROW_LENGTHS:fr.ROW_LENGTHS,ROW_SPLITS:fr.ROW_SPLITS,ROW_LIMITS:fr.ROW_LIMITS,ROW_STARTS:fr.ROW_STARTS},t=[];for(const s of n)if(s in e)t.push(e[s]);else break;return t}function Q$(n){return n.length===0?0:n[0]===fr.FIRST_DIM_SIZE?n.length-1:n.length}function Z$(n,e){if(n==null||e==null)return;const t=n.length,s=e.length;if(t>=s)throw new Error(`defaultValue.shape=${n} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${t} must be less than ragged tensor input flatValues.rank = ${s})`);for(let r=0;r<Math.min(t,s-1);++r){const o=n[r],i=e[r+1];if(o>=0&&i>=0&&o!==1&&o!==i)throw new Error(`defaultValue.shape=${n}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${r-n.length}] = ${o} but ragged tensor input.flatValues.shape[${r-n.length}] = ${i}`)}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rw=30;function bm(n){return n<=rw?n:Tx(n,Math.floor(Math.sqrt(n)))}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ow(n,e,t){const s=t*(typeof n=="number"?n:n[0]),r=e*(typeof n=="number"?n:n[1]);return[s,r]}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fh(n,e,t,s=!0){let r=[];if(s)r=r.concat(e.slice(0)),r.push(n[0]/t),r=r.concat(n.slice(1));else{r=r.concat(n[0]);const o=e.length;for(let i=0;i<o;++i)r=r.concat([n[i+1]/e[i],e[i]]);r=r.concat(n.slice(o+1))}return r}function ph(n,e,t=!0){const s=[];if(t){s.push(e);for(let r=e+1;r<n;++r)r<=2*e?(s.push(r),s.push(r-(e+1))):s.push(r)}else{const r=[],o=[];for(let i=1;i<n;++i)i>=e*2+1||i%2===1?o.push(i):r.push(i);s.push(...r),s.push(0),s.push(...o)}return s}function mh(n,e,t,s=!0){const r=[];s?r.push(n[0]/t):r.push(n[0]*t);for(let o=1;o<n.length;++o)o<=e.length?s?r.push(e[o-1]*n[o]):r.push(n[o]/e[o-1]):r.push(n[o]);return r}function iw(n,e){const t=[0];for(let s=0;s<e;++s)t.push(n[s][0]);return t}function aw(n,e,t){const s=n.slice(0,1);for(let r=0;r<t;++r)s.push(n[r+1]-e[r][0]-e[r][1]);return s}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cm=1.7580993408473768,km=1.0507009873554805;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lw=.3275911,cw=.254829592,uw=-.284496736,hw=1.421413741,dw=-1.453152027,fw=1.061405429;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mo(n,e){if(n.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${n.length}, imag: ${e.length}.`);const t=new Float32Array(n.length*2);for(let s=0;s<t.length;s+=2)t[s]=n[s/2],t[s+1]=e[s/2];return t}function J$(n){const e=new Float32Array(n.length/2),t=new Float32Array(n.length/2);for(let s=0;s<n.length;s+=2)e[s/2]=n[s],t[s/2]=n[s+1];return{real:e,imag:t}}function eT(n){const e=Math.ceil(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=0;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function tT(n){const e=Math.floor(n.length/4),t=new Float32Array(e),s=new Float32Array(e);for(let r=2;r<n.length;r+=4)t[Math.floor(r/4)]=n[r],s[Math.floor(r/4)]=n[r+1];return{real:t,imag:s}}function pw(n,e){const t=n[e*2],s=n[e*2+1];return{real:t,imag:s}}function nT(n,e,t,s){n[s*2]=e,n[s*2+1]=t}function sT(n,e){const t=new Float32Array(n/2),s=new Float32Array(n/2);for(let r=0;r<Math.ceil(n/2);r++){const o=(e?2:-2)*Math.PI*(r/n);t[r]=Math.cos(o),s[r]=Math.sin(o)}return{real:t,imag:s}}function rT(n,e,t){const s=(t?2:-2)*Math.PI*(n/e),r=Math.cos(s),o=Math.sin(s);return{real:r,imag:o}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Y0="->",zW=/->/g,sS=",",rS="...";function mw(n,e){n=n.replace(/\s/g,"");const t=(n.length-n.replace(zW,"").length)/Y0.length;if(t<1)throw new Error("Equations without an arrow are not supported.");if(t>1)throw new Error(`Equation must contain exactly one arrow ("${Y0}").`);const[s,r]=n.split(Y0);O(s.indexOf(rS)===-1,()=>`The ellipsis notation ("${rS}") is not supported yet.`);const o=s.split(sS),i=o.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");const a=[];for(let p=0;p<r.length;++p){const g=r[p];if(!o.some(x=>x.indexOf(g)!==-1))throw new Error(`Output subscripts contain the label ${g} not present in the input subscripts.`);a.indexOf(g)===-1&&a.push(g)}for(let p=0;p<s.length;++p){const g=s[p];a.indexOf(g)===-1&&g!==sS&&a.push(g)}const l=new Array(o.length);for(let p=0;p<i;++p){if(new Set(o[p].split("")).size!==o[p].length)throw new Error(`Found duplicate axes in input component ${o[p]}. Support for duplicate axes in input is not implemented yet.`);l[p]=[];for(let g=0;g<o[p].length;++g)l[p].push(a.indexOf(o[p][g]))}const u=a.length,d=r.length,f=[];for(let p=d;p<u;++p)f.push(p);return{allDims:a,summedDims:f,idDims:l}}function gw(n,e){let t=new Array(n);t.fill(-1);for(let r=0;r<e.length;++r)t[e[r]]=r;const s=[];for(let r=0;r<n;++r)t[r]===-1&&s.push(r);return t=t.filter(r=>r!==-1),{permutationIndices:t,expandDims:s}}function xw(n,e,t){const s=new Array(n);for(let r=0;r<t.length;++r){const o=t[r].shape;for(let i=0;i<e[r].length;++i)s[e[r][i]]===void 0?s[e[r][i]]=o[i]:O(s[e[r][i]]===o[i],()=>`Expected dimension ${s[e[r][i]]} at axis ${i} of input shaped ${JSON.stringify(o)}, but got dimension ${o[i]}`)}}function yw(n,e){const t=n,s=[];let r=0;n.length===0&&t.push(-1),r=n.length+1;for(let i=0;i<r;++i)s.push([]);const o=[];for(let i=0;i<t.length;++i){const a=t[i],l=MW(e,a);for(const u of l)o.indexOf(u)===-1&&(s[i].push(u),o.push(u))}return{path:t,steps:s}}function ww(n){return n.every((e,t)=>e===t)}function MW(n,e){const t=[];for(let s=0;s<n.length;++s)(n[s].length===0||n[s].indexOf(e)!==-1||e===-1)&&t.push(s);return t}function vw(n,e,t=0){let s=[];if(typeof e=="number")O(n.shape[t]%e===0,()=>"Number of splits must evenly divide the axis."),s=new Array(e).fill(n.shape[t]/e);else{const r=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);O(r<=1,()=>"There should be only one negative value in split array.");const o=e.indexOf(-1);if(o!==-1){const i=e.reduce((a,l)=>l>0?a+l:a);e[o]=n.shape[t]-i}O(n.shape[t]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),s=e}return s}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oT(n){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${n}`}function iT(n,e){return`indices(${n}, 0) is invalid: ${e} < 0`}function aT(n,e,t){return`indices(${n}, 0) is invalid: ${e} >= ${t}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lT(n,e){return`only one output dimension may be -1, not both ${n} and ${e}`}function cT(n,e){return`size ${n} must be non-negative, not ${e}`}function uT(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function hT(n,e){const t=ce(n),s=ce(e);return`Input to reshape is a SparseTensor with ${t}
  dense values, but the requested shape requires a multiple of ${s}. inputShape=${n} outputShape= ${e}`}function dT(n,e){const t=ce(n),s=ce(e);return`Input to reshape is a tensor with ${t} dense values, but the requested shape has ${s}. inputShape=${n} outputShape=${e}`}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hx(){return"segment ids must be >= 0"}function fT(){return"segment ids are not increasing"}function pT(n,e){return`Segment id ${n} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function mT(n,e,t){return`Bad: indices[${n}] == ${e} out of range [0, ${t})`}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gT(n,e){let t=!1,s;for(n<=rw?(s=n,t=!0):s=Tx(n,Math.floor(Math.sqrt(n)));!t;)s>e||s===n?t=!0:s=Tx(n,s+1);return s}function xT(n,e,t){const s=[],r=n.length;for(let o=0;o<r;o++)o!==e?s.push(n[o]):s.push(t);return s}function bw(n,e,t,s){const r=e.shape.length,o=n.shape.length;if(s!==0&&(s<-r||s>r))throw new Error(`Expect batchDims in the range of [-${r}, ${r}], but got ${s}`);if(s<0&&(s+=r),s>o)throw new Error(`batchDims (${s}) must be less than rank(x) (
    ${o}).`);if(t<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${t}).`);for(let f=0;f<s;++f)if(n.shape[f]!==e.shape[f])throw new Error(`x.shape[${f}]: ${n.shape[f]} should be equal to indices.shape[${f}]: ${e.shape[f]}.`);const i=n.shape[t],a=[];let l=1,u=1,d=1;for(let f=0;f<s;++f)a.push(n.shape[f]),l*=n.shape[f];for(let f=s;f<t;f++)a.push(n.shape[f]),u*=n.shape[f];for(let f=s;f<r;f++)a.push(e.shape[f]);for(let f=t+1;f<o;f++)a.push(n.shape[f]),d*=n.shape[f];return{batchSize:l,sliceSize:d,outerSize:u,dimSize:i,outputShape:a}}const PW=Object.freeze(Object.defineProperty({__proto__:null,collectGatherOpShapeInfo:bw,computeOutShape:xT,segOpComputeOptimalWindowSize:gT},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function go(n){try{return n.map(e=>Qo(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function yT(n){return n.map(e=>Ko(e))}const LW=Object.freeze(Object.defineProperty({__proto__:null,ERF_A1:cw,ERF_A2:uw,ERF_A3:hw,ERF_A4:dw,ERF_A5:fw,ERF_P:lw,PARALLELIZE_THRESHOLD:rw,get RowPartitionType(){return fr},SELU_SCALE:km,SELU_SCALEALPHA:Cm,applyActivation:U1,assertAndGetBroadcastShape:Ke,assertAxesAreInnerMostDims:En,assertParamsConsistent:sw,assignToTypedArray:nT,axesAreInnerMostDims:$1,calculateShapes:pa,checkEinsumDimSizes:xw,checkPadOnDimRoundingMode:os,combineLocations:l$,combineRaggedTensorToTensorShapes:q$,complexWithEvenIndex:eT,complexWithOddIndex:tT,computeConv2DInfo:Nn,computeConv3DInfo:ai,computeDefaultPad:v1,computeDilation2DInfo:lh,computeOptimalWindowSize:bm,computeOutAndReduceShapes:wn,computeOutShape:Lr,computePool2DInfo:Js,computePool3DInfo:yo,convertConv2DDataFormat:wo,decodeEinsumEquation:mw,eitherStridesOrDilationsAreOne:zn,expandShapeToKeepDim:tn,exponent:rT,exponents:sT,fromStringArrayToUint8:yT,fromUint8ToStringArray:go,getAxesPermutation:Bt,getBroadcastDims:xl,getComplexWithIndex:pw,getEinsumComputePath:yw,getEinsumPermutation:gw,getFusedBiasGradient:W1,getFusedDyActivation:V1,getImageCenter:ow,getInnerMostAxes:Kt,getPermuted:ph,getRaggedRank:Q$,getReductionAxes:un,getReshaped:fh,getReshapedPermuted:mh,getRowPartitionTypesHelper:Y$,getSliceBeginCoords:iw,getSliceSize:aw,getSparseFillEmptyRowsIndicesDenseShapeMismatch:oT,getSparseFillEmptyRowsNegativeIndexErrorMessage:iT,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:aT,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:uT,getSparseReshapeInputOutputMismatchErrorMessage:dT,getSparseReshapeInputOutputMultipleErrorMessage:hT,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:lT,getSparseReshapeNegativeOutputDimErrorMessage:cT,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:mT,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:Hx,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:fT,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:pT,getUndoAxesPermutation:li,isIdentityPermutation:ww,log:sM,mergeRealAndImagArrays:mo,prepareAndValidate:Q1,prepareSplitSize:vw,segment_util:PW,shouldFuse:G1,slice_util:_W,splitRealAndImagArrays:J$,stridesOrDilationsArePositive:ta,tupleValuesAreOne:ea,upcastType:xs,validateDefaultValueShape:Z$,validateInput:uV,validateUpdateShape:$$,warn:Ts},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */CW();/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wT={kernelName:fp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,dh(Ie(t,"float32"),-1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BW={kernelName:hu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=At(Ie(t,"float32")),r=On(Ge(pt(1),s));return jt(Be(n,r))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VW={kernelName:du,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=On(Ge(At(Ie(t,"float32")),1));return Be(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WW={kernelName:El,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ke(t.shape,s.shape);return{a:()=>{let a=n;const l=un(t.shape,r);return l.length>0&&(a=Me(a,l)),J(a,t.shape)},b:()=>{let a=n;const l=un(s.shape,r);return l.length>0&&(a=Me(a,l)),J(a,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UW={kernelName:Ry,saveAllInputs:!0,gradFunc:(n,e)=>{const t={};return e.forEach((s,r)=>{t[r]=()=>n.clone()}),t}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GW={kernelName:pp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>it(t)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HW={kernelName:mp,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>it(t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jW={kernelName:fu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Be(n,On(Ge(pt(1),At(Ie(t,"float32")))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XW={kernelName:pu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=On(ye(pt(1),At(Ie(t,"float32"))));return Be(n,s)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KW={kernelName:xu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ke(t.shape,s.shape);return{a:()=>{const a=ye(At(t),At(s));let l=j(n,Be(s,a));const u=un(t.shape,r);return u.length>0&&(l=Me(l,u)),J(l,t.shape)},b:()=>{const a=ye(At(t),At(s));let l=jt(j(n,Be(t,a)));const u=un(s.shape,r);return u.length>0&&(l=Me(l,u)),J(l,s.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qW={kernelName:mu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Be(n,ye(At(Ie(t,"float32")),1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YW={kernelName:gu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Be(n,Ge(pt(1),At(Ie(t,"float32"))))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QW(n,e,t,s,r,o){const i=P(n,"dy","avgPool3dGrad"),a=P(e,"input","avgPool3dGrad");let l=i,u=a,d=!1;a.rank===4&&(d=!0,l=J(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),u=J(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),O(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),O(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),os("avgPool3dGrad",r,o);const f={dy:l,input:u},p={filterSize:t,strides:s,pad:r,dimRoundingMode:o},g=Y.runKernel(Fy,f,p);return d?J(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}const ZW=ee({avgPool3dGrad_:QW});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JW={kernelName:xp,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i,dimRoundingMode:a}=t;return{x:()=>ZW(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eU(n,e,t,s,r){const o=P(n,"dy","avgPoolGrad"),i=P(e,"input","avgPoolGrad");O(i.rank===o.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${o.rank})`);let a=i,l=o,u=!1;i.rank===3&&(u=!0,a=J(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=J(o,[1,o.shape[0],o.shape[1],o.shape[2]])),O(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),O(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);const d={dy:l,input:a},f={filterSize:t,strides:s,pad:r},p=Y.runKernel(_y,d,f);return u?J(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const tU=ee({avgPoolGrad_:eU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nU={kernelName:gp,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{filterSize:r,strides:o,pad:i}=t;return{x:()=>tU(n,s,r,o,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sU={kernelName:yp,inputsToSave:["a","b"],gradFunc:(n,e,t)=>{const[s,r]=e,{transposeA:o,transposeB:i}=t;return!o&&!i?{a:()=>ft(n,r,!1,!0),b:()=>ft(s,n,!0,!1)}:!o&&i?{a:()=>ft(n,r,!1,!1),b:()=>ft(n,s,!0,!1)}:o&&!i?{a:()=>ft(r,n,!1,!0),b:()=>ft(s,n,!1,!1)}:{a:()=>ft(r,n,!0,!0),b:()=>ft(n,s,!0,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rU={kernelName:wp,gradFunc:(n,e,t)=>{const{blockShape:s,crops:r}=t;return{x:()=>F1(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oU={kernelName:J3,gradFunc:(n,e,t)=>{const s=t,r=s.inputShape,o=s.shape,i=Array.from(o);for(let l=r.length-1;l>=0;l--)if(r[l]===o[l])i[l]=1;else if(r[l]!==1)throw new Error(`broadcastTo(): [${r}] cannot be broadcast to [${o}].`);const a=[];for(let l=0;l<i.length;l++)i[l]>1&&a.push(l);return{x:()=>Me(n,a,!0)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iU={kernelName:yu,gradFunc:n=>({x:()=>n.clone()})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aU={kernelName:wu,gradFunc:n=>({x:()=>it(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lU={kernelName:vu,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{clipValueMin:r,clipValueMax:o}=t;return{x:()=>Xn(fo(da(s,r),Al(s,o)),n,it(n))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cU={kernelName:vp,inputsToSave:["x"],gradFunc:wT.gradFunc};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uU={kernelName:bp,saveAllInputs:!0,gradFunc:(n,e,t)=>{const s=e.map(l=>l.shape),{axis:r}=t,o=Je(r,e[0].shape)[0],i=s.map(l=>l[o]);return Es(n,i,o).map(l=>()=>l)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hU={kernelName:Cp,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{dilations:o,strides:i,pad:a,dataFormat:l}=t;return O(ea(o),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${o}'`),{x:()=>k1(s.shape,n,r,i,a,l),filter:()=>B1(s,n,r.shape,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dU={kernelName:kp,inputsToSave:["dy","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,{strides:o,pad:i,dataFormat:a,dimRoundingMode:l}=t;return{dy:()=>na(n,r,o,i,a,1,l),filter:()=>B1(n,s,r.shape,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fU(n,e,t,s,r){let o=n;n.rank===4&&(o=J(n,[1,n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));let i=e;i.rank===4&&(i=J(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),O(o.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${o.shape}.`),O(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),O(t.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${t}.`),O(o.shape[4]===t[3],()=>`Error in conv3dDerFilter: depth of input ${o.shape[4]}) must match input depth in filter (${t[3]}.`),O(i.shape[4]===t[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${t[4]}).`);const a={x:o,dy:i},l={strides:s,pad:r,filterShape:t};return Y.runKernel(Ly,a,l)}const pU=ee({conv3DBackpropFilter_:fU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mU={kernelName:Sp,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o}=t;O(ea(s),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);const[i,a]=e;return{x:()=>r$(i.shape,n,a,r,o),filter:()=>pU(i,n,a.shape,r,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gU={kernelName:bu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(jt(C$(Ie(t,"float32"))),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xU={kernelName:Cu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(k$(Ie(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yU={kernelName:Ip,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r,exclusive:o,reverse:i}=t;return{x:()=>{const a=Bt([r],s.rank);let l=i$(n,r,o,!i);return a!=null&&(l=ot(l,a)),l}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wU={kernelName:$p,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const{dilations:s,strides:r,pad:o,dimRoundingMode:i}=t,a=s??[1,1];O(ea(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);const[l,u]=e;return O(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),O(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),O(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),O(zn(r,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${r} and dilations '${a}'.`),os("depthwiseConv2d",o,i),{x:()=>EV(l.shape,n,u,r,o,a,i),filter:()=>TV(l,n,u.shape,r,o,a,i)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vU={kernelName:Tp,inputsToSave:["x","filter"],gradFunc:(n,e,t)=>{const[s,r]=e,o={x:s,filter:r,dy:n},i={x:s,filter:r,dy:n};return{x:()=>Y.runKernel(Nx,o,t),filter:()=>Y.runKernel(Ex,i,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bU={kernelName:Su,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e,s={dy:n,y:t};return{x:()=>Y.runKernel(Ky,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CU={kernelName:Iu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=j(Hr(jt(At(t))),2/Math.sqrt(Math.PI));return{x:()=>j(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kU={kernelName:$u,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SU={kernelName:Ep,inputsToSave:["input"],gradFunc:(n,e)=>{const[t]=e;return{input:()=>J(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IU={kernelName:Tu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,Hr(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $U={kernelName:Nu,gradFunc:n=>({x:()=>it(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TU={kernelName:Eu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ke(t.shape,s.shape);return{a:()=>{const a=Be(n,Ie(s,"float32")),l=un(t.shape,r);return l.length>0?J(Me(a,l),t.shape):a},b:()=>{let a=j(n,Ie(t,"float32"));const l=un(s.shape,r);l.length>0&&(a=J(Me(a,l),s.shape));const u=At(s);return jt(Be(a,Ie(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NU={kernelName:Rp,inputsToSave:["x","mean","variance","scale"],gradFunc:(n,e,t)=>{const{varianceEpsilon:s}=t,[r,o,i,a]=e,l=a??pt(1),u=un(o.shape,r.shape),d=[];if(o.rank===1){for(let S=0;S<r.shape.length-1;++S)d.push(r.shape[S]);d.push(1)}const f=Ge(r,o),p=j(n,l),g=w$(ye(i,pt(s))),x=j(j(j(g,g),g),pt(-.5));return{x:()=>o.rank===1?J(j(j(n,mr(J(g,[1,1,1,o.shape[0]]),d)),l),r.shape):J(j(j(n,g),l),r.shape),mean:()=>{let S=j(j(g,pt(-1)),p);return o.rank===1&&(S=Me(S,u)),J(S,o.shape)},variance:()=>{let S=j(j(x,f),p);return o.rank===1&&(S=Me(S,u)),J(S,o.shape)},scale:()=>{const S=j(f,g);let T=j(n,S);return o.rank===1&&(T=Me(T,u)),J(T,o.shape)},offset:()=>{let S=n;return o.rank===1&&(S=Me(S,u)),J(S,o.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EU={kernelName:Ap,inputsToSave:["x","indices"],gradFunc:(n,e,t)=>{const[s,r]=e,{axis:o,batchDims:i}=t,a=Je(o,s.shape)[0],l=(u,d,f)=>()=>{const p=u.shape,g=d.size,x=p.slice(0,a),w=x.length,v=p.slice(o,p.length).slice(1),b=v.length,C=oS(0,w),$=oS(w+1,w+1+b),S=iS([x,[g],v]),T=J(f,S),E=J(d,[g]),A=iS([[w],C,$]),F=ot(T,A);let D=N$(F,E,u.shape[a]);const _=li(A);return D=ot(D,_),D};if(i===1){const u=s.shape[0],d=s.split(u,0);return{x:()=>po(d.map((g,x)=>l(g,r.slice(x,1),n.slice(x,1))())).reshape(s.shape),indices:()=>r}}else return{x:l(s,r,n),indices:()=>r}}};function oS(n,e){const t=[];for(let s=n;s<e;++s)t.push(s);return t}function iS(n){const e=[];for(let t=0;t<n.length;++t)for(let s=0;s<n[t].length;++s)e.push(n[t][s]);return e}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RU={kernelName:Ru,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>it(t),b:()=>it(s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AU={kernelName:Au,gradFunc:n=>({x:()=>Ie(n,"float32")})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DU={kernelName:Du,gradFunc:n=>({x:()=>it(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _U={kernelName:_u,gradFunc:n=>({x:()=>it(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FU={kernelName:Fu,gradFunc:n=>({x:()=>it(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OU={kernelName:_p,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{alpha:r}=t,o=As(s,0);return{x:()=>Xn(o,n,j(n,r))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zU={kernelName:zu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Be(n,ye(t,1))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MU={kernelName:Ou,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Be(n,Ie(t,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PU={kernelName:tM,inputsToSave:[],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;return{logits:()=>{const i=Hr(s);return Ge(n,j(Me(n,r,!0),i))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LU(n,e,t,s=5,r=1,o=1,i=.5){const a={x:n,y:e,dy:t},l={depthRadius:s,bias:r,alpha:o,beta:i};return Y.runKernel(e1,a,l)}const BU=ee({localResponseNormalizationBackprop_:LU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VU={kernelName:Lp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{depthRadius:o,bias:i,alpha:a,beta:l}=t;return{x:()=>BU(s,r,n,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function vT(n,e,t,s){return e.rank<t.rank&&(e=J(e,tn(e.shape,s))),n.rank<t.rank&&(n=J(n,tn(n.shape,s))),{x:()=>j(n,Ie(Gr(t,e),n.dtype))}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const aS={kernelName:Bp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{reductionIndices:r}=s,o=e[0],i=e[1],a=Je(r,o.shape),l=vT(n,i,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WU={kernelName:Mu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>j(n,Ie(da(t,s),"float32")),b:()=>j(n,Ie(Of(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UU(n,e,t,s,r,o,i){const a=P(n,"dy","maxPool3dGrad"),l=P(e,"input","maxPool3dGrad"),u=P(t,"output","maxPool3dGrad");let d=a,f=l,p=u,g=!1;l.rank===4&&(g=!0,d=J(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),f=J(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),p=J(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),O(d.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${d.rank}.`),O(f.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${f.rank}.`),O(p.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${p.rank}.`),os("maxPool3dGrad",o,i);const x={dy:d,input:f,output:p},w={filterSize:s,strides:r,pad:o,dimRoundingMode:i},v=Y.runKernel(n1,x,w);return g?J(v,[v.shape[1],v.shape[2],v.shape[3],v.shape[4]]):v}const GU=ee({maxPool3dGrad_:UU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HU={kernelName:Wp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=t;return{x:()=>GU(n,s,r,o,i,a,l)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jU(n,e,t,s,r,o,i){const a=P(n,"dy","maxPoolGrad"),l=P(e,"input","maxPoolGrad"),u=P(t,"output","maxPoolGrad");O(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),O(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),O(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),os("maxPoolGrad",o,i);const d={dy:a,input:l,output:u},f={filterSize:s,strides:r,pad:o,dimRoundingMode:i};return Y.runKernel(t1,d,f)}const XU=ee({maxPoolGrad_:jU});/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KU={kernelName:Vp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s,r]=e,{filterSize:o,strides:i,pad:a}=t;return{x:()=>XU(n,s,r,o,i,a)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qU={kernelName:Up,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t,o=Je(r,s.shape),a=wn(s.shape,o)[1],l=ce(a);return{x:()=>{const d=s.shape.slice();o.forEach(g=>{d[g]=1});const f=J(n,d);return Be(j(f,ui(s.shape,"float32")),l)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YU={kernelName:Gp,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(n,e,t)=>{const s=t,{axis:r}=s,[o,i]=e,a=Je(r,o.shape),l=vT(n,i,o,a);return{x:()=>l.x()}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QU={kernelName:Pu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e;return{a:()=>j(n,Ie(Al(t,s),"float32")),b:()=>j(n,Ie(As(t,s),"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZU={kernelName:Hp,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>$t(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JU={kernelName:Lu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ke(t.shape,s.shape);return{a:()=>{const a=un(t.shape,r);return a.length>0?J(Me(n,a),t.shape):n},b:()=>{const a=j(n,jt(wm(Be(t,s)))),l=un(s.shape,r);return l.length>0?J(Me(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eG={kernelName:Bu,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ke(t.shape,s.shape);return{a:()=>{const a=j(n,Ie(s,"float32")),l=un(t.shape,r);return l.length>0?J(Me(a,l),t.shape):a},b:()=>{const a=j(n,Ie(t,"float32")),l=un(s.shape,r);return l.length>0?J(Me(a,l),s.shape):a}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tG={kernelName:jp,gradFunc:n=>({x:()=>jt(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nG={kernelName:qp,inputsToSave:["indices"],gradFunc:(n,e)=>{const t=e[0];return{indices:()=>gn(t.shape,"float32")}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sG={kernelName:Kp,gradFunc:n=>({x:()=>it(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rG={kernelName:Yp,saveAllInputs:!0,gradFunc:(n,e,t)=>{const{axis:s}=t;return oa(n,s).map(o=>()=>o)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lS={kernelName:Qp,inputsToSave:["x"],gradFunc:(n,e,t)=>{const s=e[0],{paddings:r}=t,o=r.map(i=>i[0]);return{x:()=>$t(n,o,s.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oG={kernelName:Vu,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(n,e)=>{const[t,s,r]=e,o=t,i=s,a=Ke(o.shape,i.shape);return{a:()=>{const d=Ie(i,"float32");let f=j(n,j(d,sa(o,Ge(d,pt(1)))));const p=un(o.shape,a);return p.length>0&&(f=Me(f,p)),J(f,o.shape)},b:()=>{const d=As(o,0),f=Xn(d,jr(o),it(o));let p=j(n,j(r,f));const g=un(i.shape,a);return g.length>0&&(p=Me(p,g)),J(p,i.shape)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iG={kernelName:Zp,inputsToSave:["x","alpha"],gradFunc:(n,e)=>{const[t,s]=e,r=As(t,0);return{x:()=>Xn(r,n,j(n,s)),alpha:()=>{let o=Xn(r,it(n),j(n,t));const i=un(s.shape,n.shape);return i.length>0&&(o=Me(o,i)),J(o,s.shape)}}}};/**
 * @license
 * Copyright 2022 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aG(n,e,t){const s=n.shape.slice();s[t]=1;const r=J(e,s),o=Vx(n,t,!0,!1),i=Vx(n,t,!0,!0),a=j(o,i);return j(r,a)}function lG(n,e,t){const s=n.shape.length,r=s-t.length,o=Bt(t,s);let i=n;o!=null&&(i=ot(n,o));const a=i.shape.slice(),u=a.splice(s-t.length,t.length).reduce((p,g)=>p*g,1);a.push(u);const d=i.reshape(a);let f=aG(d,e,r);if(f=f.reshape(i.shape),o!=null){const p=li(o);f=ot(f,p)}return f}const cG={kernelName:Jp,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{axis:r}=t;let o=[];return r==null?o=s.shape.map((i,a)=>a):typeof r=="number"?o=[r]:o=r,{x:()=>lG(s,n,o)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uG={kernelName:ku,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ke(t.shape,s.shape);return{a:()=>{const a=Be(n,Ie(s,"float32")),l=un(t.shape,r);return l.length>0?J(Me(a,l),t.shape):a},b:()=>{let a=j(n,Ie(t,"float32"));const l=un(s.shape,r);l.length>0&&(a=J(Me(a,l),s.shape));const u=At(s);return jt(Be(a,Ie(u,"float32")))}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hG={kernelName:Wu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Be(n,jt(At(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dG={kernelName:Gu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e,s=j(Al(t,6),dh(t));return{x:()=>j(n,Ie(s,"float32"))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fG={kernelName:Uu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,Ie(dh(t),"float32"))}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pG={kernelName:em,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>J(n,t.shape)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mG={kernelName:nm,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>Y.runKernel(c1,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gG={kernelName:tm,inputsToSave:["images"],gradFunc:(n,e,t)=>{const[s]=e,r={dy:n,images:s};return{images:()=>Y.runKernel(l1,r,t)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const xG={kernelName:sm,gradFunc:(n,e,t)=>{const{dims:s}=t,r=Je(s,n.shape);return{x:()=>ra(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yG={kernelName:Hu,gradFunc:n=>({x:()=>it(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wG={kernelName:ju,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>jt(Be(n,j(sa(t,1.5),2)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vG={kernelName:rm,inputsToSave:["condition"],gradFunc:(n,e)=>{const[t]=e;return{condition:()=>Ie(it(t),"float32"),t:()=>j(n,Ie(t,n.dtype)),e:()=>j(n,Ie(R1(t),n.dtype))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bG={kernelName:Xu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>{const s=As(t,pt(0)),r=pt(Cm),o=pt(km),i=j(n,o),a=j(j(n,r),Hr(Ie(t,"float32")));return Xn(s,i,a)}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const CG={kernelName:Qu,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,j(t,Ge(pt(1),t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kG={kernelName:Yu,gradFunc:n=>({x:()=>it(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const SG={kernelName:Ku,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(S1(Ie(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IG={kernelName:qu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(o$(Ie(t,"float32")),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const $G={kernelName:om,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{begin:r,size:o}=t,i=s.shape,[a,l]=vm(s,r,o),u=[];for(let d=0;d<n.rank;d++)u.push([a[d],i[d]-a[d]-l[d]]);return{x:()=>_1(n,u)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TG={kernelName:cm,outputsToSave:[!0],gradFunc:(n,e,t)=>{const[s]=e,{dim:r}=t,o=!0,i=j(n,s);return{logits:()=>Ge(i,j(Me(i,[r],o),s))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const NG={kernelName:Zu,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,Rl(t))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const cS={kernelName:am,gradFunc:(n,e,t)=>{const{blockShape:s,paddings:r}=t;return{x:()=>C1(n,s,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uS={kernelName:lm,gradFunc:(n,e,t)=>{const{axis:s}=t;return{x:()=>ns(n,s)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EG={kernelName:Ju,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Be(n,j(On(Ie(t,"float32")),2))}}};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RG={kernelName:u1,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(n,j(Ie(t,"float32"),2))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AG={kernelName:eh,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=pt(2);return{a:()=>j(n,j(r,Ge(t,s))),b:()=>j(n,j(r,Ge(s,t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const DG={kernelName:oh,gradFunc:n=>({x:()=>it(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _G={kernelName:th,inputsToSave:["a","b"],gradFunc:(n,e)=>{const[t,s]=e,r=Ke(t.shape,s.shape);return{a:()=>{let a=n;const l=un(t.shape,r);return l.length>0&&(a=Me(a,l)),J(a,t.shape)},b:()=>{let a=n;const l=un(s.shape,r);return l.length>0&&(a=Me(a,l)),J(jt(a),s.shape)}}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FG={kernelName:im,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,r=s.shape.slice(),{axis:o}=t;Je(o,s.shape).forEach(u=>{r[u]=1});const a=J(n,r),l=j(a,ui(s.shape,"float32"));return{x:()=>l}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OG={kernelName:nh,inputsToSave:["x"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>Be(n,At(S1(t)))}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zG={kernelName:sh,outputsToSave:[!0],gradFunc:(n,e)=>{const[t]=e;return{x:()=>j(Ge(pt(1),At(t)),n)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MG={kernelName:rh,inputsToSave:["x"],gradFunc:(n,e,t)=>{const[s]=e,{reps:r}=t;return{x:()=>{let i=it(s);if(s.rank===1)for(let a=0;a<r[0];++a)i=ye(i,$t(n,[a*s.shape[0]],[s.shape[0]]));else if(s.rank===2)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)i=ye(i,$t(n,[a*s.shape[0],l*s.shape[1]],[s.shape[0],s.shape[1]]));else if(s.rank===3)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)i=ye(i,$t(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else if(s.rank===4)for(let a=0;a<r[0];++a)for(let l=0;l<r[1];++l)for(let u=0;u<r[2];++u)for(let d=0;d<r[3];++d)i=ye(i,$t(n,[a*s.shape[0],l*s.shape[1],u*s.shape[2],d*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);return i}}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PG={kernelName:rl,gradFunc:(n,e,t)=>{const s=t,{perm:r}=s,o=li(r);return{x:()=>ot(n,o)}}};/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const LG={kernelName:um,gradFunc:(n,e,t)=>{const s=t,{axis:r}=s;return{value:()=>po(n,r)}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BG={kernelName:hm,inputsToSave:["segmentIds"],gradFunc:(n,e)=>{const[t]=e;return{x:()=>VG(n,t)}}};function VG(n,e){const t=ci(e,it(e)),s=T1(n,t);let r=da(e,pt(0,"int32"));const o=s.rank-r.rank;for(let a=0;a<o;++a)r=es(r,a+1);r=fo(r,ui(s.shape,"bool"));const i=it(s);return Xn(r,s,i)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WG={kernelName:dm,gradFunc:n=>({x:()=>it(n)})};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UG=[wT,BW,VW,WW,UW,GW,HW,jW,XW,KW,qW,YW,JW,nU,sU,rU,oU,iU,aU,lU,cU,uU,dU,hU,mU,gU,xU,yU,wU,vU,uG,bU,CU,kU,SU,IU,TU,$U,NU,EU,RU,AU,DU,_U,FU,OU,zU,MU,PU,VU,aS,aS,WU,HU,KU,qU,YU,QU,ZU,JU,eG,tG,nG,sG,rG,lS,lS,oG,iG,cG,hG,dG,fG,pG,mG,gG,xG,yG,wG,vG,bG,CG,kG,SG,IG,$G,TG,NG,cS,cS,uS,uS,EG,AG,RG,DG,_G,FG,OG,zG,MG,PG,LG,BG,WG];for(const n of UG)rM(n);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.abs=function(){return this.throwIfDisposed(),Un(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.acos=function(){return this.throwIfDisposed(),xP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.acosh=function(){return this.throwIfDisposed(),wP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.add=function(n){return this.throwIfDisposed(),ye(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.all=function(n,e){return this.throwIfDisposed(),t$(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.any=function(n,e){return this.throwIfDisposed(),Lx(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.argMax=function(n){return this.throwIfDisposed(),Kc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.argMin=function(n){return this.throwIfDisposed(),SP(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.asScalar=function(){return this.throwIfDisposed(),O(this.size===1,()=>"The array must have only 1 element."),J(this,[])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.asType=function(n){return this.throwIfDisposed(),Ie(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.as1D=function(){return this.throwIfDisposed(),J(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.as2D=function(n,e){return this.throwIfDisposed(),J(this,[n,e])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.as3D=function(n,e,t){return this.throwIfDisposed(),J(this,[n,e,t])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.as4D=function(n,e,t,s){return this.throwIfDisposed(),J(this,[n,e,t,s])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.as5D=function(n,e,t,s,r){return this.throwIfDisposed(),J(this,[n,e,t,s,r])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.asin=function(){return this.throwIfDisposed(),$P(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.asinh=function(){return this.throwIfDisposed(),NP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.atan=function(){return this.throwIfDisposed(),RP(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.atan2=function(n){return this.throwIfDisposed(),DP(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.atanh=function(){return this.throwIfDisposed(),FP(this)};le().prototype.avgPool=function(n,e,t,s){return this.throwIfDisposed(),b1(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.batchToSpaceND=function(n,e){return this.throwIfDisposed(),C1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.batchNorm=function(n,e,t,s,r){return this.throwIfDisposed(),mm(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.broadcastTo=function(n){return this.throwIfDisposed(),Gc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.cast=function(n){return this.throwIfDisposed(),Ie(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.ceil=function(){return this.throwIfDisposed(),aL(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.clipByValue=function(n,e){return this.throwIfDisposed(),Rs(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.concat=function(n,e){return this.throwIfDisposed(),n instanceof rn&&(n=[n]),ns([this,...n],e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.conv1d=function(n,e,t,s,r,o){return this.throwIfDisposed(),n$(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.conv2dTranspose=function(n,e,t,s,r){return this.throwIfDisposed(),s$(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.conv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),na(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.cos=function(){return this.throwIfDisposed(),S1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.cosh=function(){return this.throwIfDisposed(),o$(this)};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the 'License');
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an 'AS IS' BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.cumprod=function(n,e,t){return this.throwIfDisposed(),Vx(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.cumsum=function(n,e,t){return this.throwIfDisposed(),i$(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.depthToSpace=function(n,e){return this.throwIfDisposed(),DL(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.depthwiseConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),I1(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.dilation2d=function(n,e,t,s,r){return this.throwIfDisposed(),OL(this,n,e,t,s,r)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.divNoNan=function(n){return this.throwIfDisposed(),BL(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.div=function(n){return this.throwIfDisposed(),Be(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.dot=function(n){return this.throwIfDisposed(),WL(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.elu=function(){return this.throwIfDisposed(),xm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.equal=function(n){return this.throwIfDisposed(),Gr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.erf=function(){return this.throwIfDisposed(),a$(this)};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.euclideanNorm=function(n,e){return this.throwIfDisposed(),e4(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.exp=function(){return this.throwIfDisposed(),Hr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.expandDims=function(n){return this.throwIfDisposed(),es(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.expm1=function(){return this.throwIfDisposed(),r4(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.fft=function(){return this.throwIfDisposed(),I$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.flatten=function(){return this.throwIfDisposed(),J(this,[this.size])};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.floor=function(){return this.throwIfDisposed(),wm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.floorDiv=function(n){return this.throwIfDisposed(),e$(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.gather=function(n,e,t){return this.throwIfDisposed(),T1(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.greaterEqual=function(n){return this.throwIfDisposed(),da(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.greater=function(n){return this.throwIfDisposed(),As(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.ifft=function(){return this.throwIfDisposed(),Wx(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.irfft=function(){return this.throwIfDisposed(),QB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.isFinite=function(){return this.throwIfDisposed(),f4(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.isInf=function(){return this.throwIfDisposed(),m4(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.isNaN=function(){return this.throwIfDisposed(),x4(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.leakyRelu=function(n){return this.throwIfDisposed(),E1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.lessEqual=function(n){return this.throwIfDisposed(),Al(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.less=function(n){return this.throwIfDisposed(),Of(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.localResponseNormalization=function(n,e,t,s){return this.throwIfDisposed(),C4(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logSigmoid=function(){return this.throwIfDisposed(),E4(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logSoftmax=function(n){return this.throwIfDisposed(),d$(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logSumExp=function(n,e){return this.throwIfDisposed(),f$(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.log=function(){return this.throwIfDisposed(),jr(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.log1p=function(){return this.throwIfDisposed(),h$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logicalAnd=function(n){return this.throwIfDisposed(),fo(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logicalNot=function(){return this.throwIfDisposed(),R1(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logicalOr=function(n){return this.throwIfDisposed(),p$(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.logicalXor=function(n){return this.throwIfDisposed(),M4(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.matMul=function(n,e,t){return this.throwIfDisposed(),ft(this,n,e,t)};le().prototype.maxPool=function(n,e,t,s){return this.throwIfDisposed(),A1(this,n,e,t,s)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.max=function(n,e){return this.throwIfDisposed(),yr(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.maximum=function(n){return this.throwIfDisposed(),ci(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.mean=function(n,e){return this.throwIfDisposed(),Jt(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.min=function(n,e){return this.throwIfDisposed(),Ff(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.minimum=function(n){return this.throwIfDisposed(),Qc(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.mirrorPad=function(n,e){return this.throwIfDisposed(),H4(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.mod=function(n){return this.throwIfDisposed(),X4(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.mul=function(n){return this.throwIfDisposed(),j(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.neg=function(){return this.throwIfDisposed(),jt(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.norm=function(n,e,t){return this.throwIfDisposed(),ym(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.notEqual=function(n){return this.throwIfDisposed(),zf(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.oneHot=function(n,e=1,t=0){return this.throwIfDisposed(),m$(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.onesLike=function(){return this.throwIfDisposed(),Zs(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.pad=function(n,e){return this.throwIfDisposed(),_1(this,n,e)};le().prototype.pool=function(n,e,t,s,r,o){return this.throwIfDisposed(),sB(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.pow=function(n){return this.throwIfDisposed(),sa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.prelu=function(n){return this.throwIfDisposed(),O1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.prod=function(n,e){return this.throwIfDisposed(),iB(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.reciprocal=function(){return this.throwIfDisposed(),AB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.relu=function(){return this.throwIfDisposed(),fa(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.relu6=function(){return this.throwIfDisposed(),x$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.reshapeAs=function(n){return this.throwIfDisposed(),J(this,n.shape)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.reshape=function(n){return this.throwIfDisposed(),J(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.resizeBilinear=function(n,e,t){return this.throwIfDisposed(),R$(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.resizeNearestNeighbor=function(n,e,t){return this.throwIfDisposed(),A$(this,n,e,t)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.reverse=function(n){return this.throwIfDisposed(),ra(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.rfft=function(){return this.throwIfDisposed(),eV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.round=function(){return this.throwIfDisposed(),y$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.rsqrt=function(){return this.throwIfDisposed(),w$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.selu=function(){return this.throwIfDisposed(),v$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.separableConv2d=function(n,e,t,s,r,o){return this.throwIfDisposed(),b$(this,n,e,t,s,r,o)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sigmoid=function(){return this.throwIfDisposed(),Rl(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sign=function(){return this.throwIfDisposed(),BB(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sin=function(){return this.throwIfDisposed(),C$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sinh=function(){return this.throwIfDisposed(),k$(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.slice=function(n,e){return this.throwIfDisposed(),$t(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.softmax=function(n){return this.throwIfDisposed(),L1(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.softplus=function(){return this.throwIfDisposed(),ch(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.spaceToBatchND=function(n,e){return this.throwIfDisposed(),F1(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.split=function(n,e){return this.throwIfDisposed(),Es(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sqrt=function(){return this.throwIfDisposed(),On(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.square=function(){return this.throwIfDisposed(),At(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.squaredDifference=function(n){return this.throwIfDisposed(),nV(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.squeeze=function(n){return this.throwIfDisposed(),hh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.stack=function(n,e){this.throwIfDisposed();const t=n instanceof rn?[this,n]:[this,...n];return po(t,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.step=function(n){return this.throwIfDisposed(),dh(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.stridedSlice=function(n,e,t,s,r,o,i,a){return this.throwIfDisposed(),aV(this,n,e,t,s,r,o,i,a)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sub=function(n){return this.throwIfDisposed(),Ge(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.sum=function(n,e){return this.throwIfDisposed(),Me(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.tan=function(){return this.throwIfDisposed(),cV(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.tanh=function(){return this.throwIfDisposed(),pm(this)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.tile=function(n){return this.throwIfDisposed(),mr(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.toBool=function(){return this.throwIfDisposed(),Ie(this,"bool")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.toFloat=function(){return this.throwIfDisposed(),Ie(this,"float32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.toInt=function(){return this.throwIfDisposed(),Ie(this,"int32")};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.topk=function(n,e){return this.throwIfDisposed(),dV(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.transpose=function(n){return this.throwIfDisposed(),ot(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.unique=function(n){return this.throwIfDisposed(),mV(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.unsortedSegmentSum=function(n,e){return this.throwIfDisposed(),N$(this,n,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.unstack=function(n){return this.throwIfDisposed(),oa(this,n)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.where=function(n,e){return this.throwIfDisposed(),Xn(n,this,e)};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */le().prototype.zerosLike=function(){return this.throwIfDisposed(),it(this)};/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _r extends Error{constructor(e){super(e),Object.setPrototypeOf(this,_r.prototype)}}class js extends Error{constructor(e){super(e),Object.setPrototypeOf(this,js.prototype)}}class U extends Error{constructor(e){super(e),Object.setPrototypeOf(this,U.prototype)}}class qe extends Error{constructor(e){super(e),Object.setPrototypeOf(this,qe.prototype)}}class Cw extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Cw.prototype)}}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bT{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}put(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){const s=this.cache.keys().next().value;this.cache.delete(s)}this.cache.set(e,t)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let t=0;t<this.maxEntries-e;t++){const s=this.cache.keys().next().value;this.cache.delete(s)}this.maxEntries=e}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ia(n,e){if(Array.isArray(n)){let t=[];for(let s=0;s<e;s++)t=t.concat(n);return t}else{const t=new Array(e);return t.fill(n),t}}function Fr(n,e){if(!n)throw new Cw(e)}function hS(n,e){let t=0;for(const s of n)s===e&&t++;return t}function ts(n){return n.length===1?n[0]:n}function xt(n){return Array.isArray(n)?n:[n]}function lo(n){const t=n.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return t[0]!=="_"?t:"private"+t}function Mi(n){return n.length<=1||n.indexOf("_")===-1?n:n.replace(/[_]+(\w|$)/g,(e,t)=>t.toUpperCase())}let Vs={};function kw(n){if(n==null)return null;const e={};return e.className=n.getClassName(),e.config=n.getConfig(),e}function jx(n){if(!(n==null||typeof n!="object"))if(Array.isArray(n))n.forEach(e=>jx(e));else{const e=Object.keys(n);for(const t of e){const s=n[t];s!=null&&typeof s=="object"&&(!Array.isArray(s)&&s.type==="ndarray"&&typeof s.value=="number"?n[t]=s.value:jx(s))}}}function gh(n,e={},t={},s="object",r=!1){if(typeof n=="string"){const o=n;let i;if(o in t)i=t[o];else if(o in Vs)i=Vs[o];else if(i=e[o],i==null)throw new U(`Unknown ${s}: ${n}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{const o=n;if(o.className==null||o.config==null)throw new U(`${s}: Improper config format: ${JSON.stringify(o)}.
'className' and 'config' must set.`);const i=o.className;let a,l;if(i in t?[a,l]=t[i]:i in Vs?[a,l]=Vs.className:i in e&&([a,l]=e[i]),a==null)throw new U(`Unknown ${s}: ${i}. This may be due to one of the following reasons:
1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){const u={};for(const g of Object.keys(Vs))u[g]=Vs[g];for(const g of Object.keys(t))u[g]=t[g];const d=o.config;d.customObjects=u;const f=Object.assign({},Vs);for(const g of Object.keys(t))Vs[g]=t[g];jx(o.config);const p=l(a,o.config,t,r);return Vs=Object.assign({},f),p}else{const u=Object.assign({},Vs);for(const f of Object.keys(t))Vs[f]=t[f];const d=new a(o.config);return Vs=Object.assign({},u),d}}}function GG(n,e){return n<e?-1:n>e?1:0}function Wd(n,e){return-1*GG(n,e)}function qo(n){if(n==null)return n;const e=[];for(const t of n)e.indexOf(t)===-1&&e.push(t);return e}function HG(n){if(n==null)throw new U(`Invalid value in obj: ${JSON.stringify(n)}`);for(const e in n)if(n.hasOwnProperty(e))return!1;return!0}function ma(n,e,t){if(t!=null&&n.indexOf(t)<0)throw new U(`${t} is not a valid ${e}.  Valid values are ${n} or null/undefined.`)}function Sw(n,e,t=0,s=1/0){return Fr(t>=0),Fr(s>=t),Array.isArray(n)&&n.length>=t&&n.length<=s&&n.every(r=>typeof r===e)}function xn(n,e){Array.isArray(n)?(O(n.length>0,()=>`${e} is unexpectedly an empty array.`),n.forEach((t,s)=>xn(t,`element ${s+1} of ${e}`))):O(Number.isInteger(n)&&n>0,()=>`Expected ${e} to be a positive integer, but got ${CT(n)}.`)}function CT(n){return n===null?"null":Array.isArray(n)?"["+n.map(e=>CT(e)).join(",")+"]":typeof n=="string"?`"${n}"`:`${n}`}function jG(n,e,t){let s=t!=null?t():Jn(),r;return(...i)=>{const a=t!=null?t():Jn();return a-s<e||(s=a,r=n(...i)),r}}function kT(n){return n==="relu"?"relu":n==="linear"?"linear":n==="elu"?"elu":null}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let XG=0;function ST(){return XG++}const Ud={};function Sm(n=""){return n in Ud||(Ud[n]=0),Ud[n]+=1,n+Ud[n].toString()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const KG=["channelsFirst","channelsLast"],qG=["nearest","bilinear"],YG=["valid","same","causal"],QG=["max","avg"],ZG=["sum","mul","concat","ave"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const Xa=new Map;function qt(n){ma(KG,"DataFormat",n)}function JG(n){ma(qG,"InterpolationFormat",n)}function Ds(n){ma(YG,"PaddingMode",n)}function IT(n){ma(QG,"PoolMode",n)}const Hc=[],dS="/";function ji(n,e){Hc.push(n);try{const t=e();return Hc.pop(),t}catch(t){throw Hc.pop(),t}}function e5(){return Hc.length===0?"":Hc.join(dS)+dS}function $T(n){if(!NT(n))throw new Error("Not a valid tensor name: '"+n+"'");return e5()+n}function TT(n){if(!NT(n))throw new Error("Not a valid tensor name: '"+n+"'");Xa.has(n)||Xa.set(n,0);const e=Xa.get(n);if(Xa.set(n,Xa.get(n)+1),e>0){const t=`${n}_${e}`;return Xa.set(t,1),t}else return n}const t5=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function NT(n){return!!n.match(t5)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function n5(n){return n===parseInt(n.toString(),10)}function Yo(n,e,t){e==null&&(e=0),t==null&&(t=n.length);let s=1;for(let r=e;r<t;++r)s*=n[r];return s}function wl(n){if(n.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s<e&&(e=s)}return e}function Zo(n){if(n.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let t=0;t<n.length;t++){const s=n[t];s>e&&(e=s)}return e}function vr(n,e){if(e<n)throw new U(`end (${e}) < begin (${n}) is forbidden.`);const t=[];for(let s=n;s<e;++s)t.push(s);return t}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Q0;function on(){return Q0==null&&(Q0=RM().epsilon()),Q0}function br(){return"channelsLast"}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Br(n,e){return Ie(n,e)}function xh(n,e=-1){const t=n.shape.slice();return e<0&&(e=t.length+e+1),t.splice(e,0,1),J(n,t)}function s5(n,e){return se(()=>{if(n.shape.length!==2)throw new U(`repeat() expects a rank-2 tensor, but received a rank-${n.shape.length} tensor.`);const t=xh(n,1);return Xx(t,[1,e,1])})}function r5(n){const e=[Yo(n.shape)];return J(n,e)}function o5(n){if(n.rank<=1)throw new U(`batchFlatten requires a minimum rank of 2. Got rank: ${n.rank}.`);const e=[n.shape[0],Yo(n.shape,1)];return J(n,e)}function Xi(n,e,t){return se(()=>{switch(n.rank){case 1:return M1(n,e,t);case 2:return S$(n,[e,0],[t,n.shape[1]]);case 3:return P1(n,[e,0,0],[t,n.shape[1],n.shape[2]]);case 4:return Pf(n,[e,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3]]);case 5:return $t(n,[e,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4]]);case 6:return $t(n,[e,0,0,0,0,0],[t,n.shape[1],n.shape[2],n.shape[3],n.shape[4],n.shape[5]]);default:throw new U(`sliceAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Z0(n,e,t){return se(()=>{switch(n.rank){case 1:return M1(n,e,t);case 2:return S$(n,[0,e],[n.shape[0],t]);case 3:return P1(n,[0,0,e],[n.shape[0],n.shape[1],t]);case 4:return Pf(n,[0,0,0,e],[n.shape[0],n.shape[1],n.shape[2],t]);default:throw new U(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Gd(n,e,t,s){return se(()=>{switch(n.rank){case 1:return M1(n,e,t);case 2:switch(s){case 1:return Xi(n,e,t);case 2:return Z0(n,e,t);default:throw new U(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Xi(n,e,t);case 2:return P1(n,[0,e,0],[n.shape[0],t,n.shape[2]]);case 3:return Z0(n,e,t);default:throw new U(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Xi(n,e,t);case 2:return Pf(n,[0,e,0,0],[n.shape[0],t,n.shape[2],n.shape[3]]);case 3:return Pf(n,[0,0,e,0],[n.shape[0],n.shape[1],t,n.shape[3]]);case 4:return Z0(n,e,t);default:throw new U(`The axis is not within the rank of the tensor ${s}`)}default:throw new U(`sliceAlongLastAxis() received an unsupported tensor rank: ${n.rank}`)}})}function Iw(n,e=-1){let t;return e<0&&(t=n[0].rank,t!==0?e=t:e=0),e===n[0].rank&&(e=-1),ns(n,e)}function fS(n,e){switch(n.rank){case 1:return uL([n,e]);case 2:return dL([n,e],0);case 3:return pL([n,e],0);case 4:return gL([n,e],0);default:throw new U(`concatAlongFirstAxis() received an unsupported tensor rank: ${n.rank}`)}}function Xx(n,e){if(Array.isArray(e)||(e=[e]),n.rank!==e.length)throw new U(`The length of input n (${e.length}) does not match the number of dimensions in input x (${n.rank})`);return mr(n,e)}function Im(n,e=0,t=1,s,r){return TB(n,e,t,s,r)}function Vr(n,e,t,s){if(n.rank<2||e.rank<2)throw new qe(`dot requires both inputs to be rank >= 2 but got x shape = ${n.shape} and y shape = ${e.shape}`);if(e.rank>=3){const r=n.shape.slice(-1)[0],o=e.shape.slice(-2)[0];if(r!==o)throw new qe(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${n.shape} and  y shape = ${e.shape}`)}if(n.rank===2&&e.rank===2)return Qk({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Kx(n.rank,s,br()):null,activation:t});{const r=n.shape.slice(),o=r.pop();n=J(n,[-1,o]);const i=e.shape.slice(),a=i.pop(),l=i.pop(),u=[...i,a],d=Array.from({length:e.rank},(x,w)=>w===0?e.rank-2:w<=e.rank-2?w-1:w);e=J(ot(e,d),[l,-1]);const f=[...r,...u];return J(Qk({a:n,b:e,transposeA:!1,transposeB:!1,bias:s?Kx(n.rank,s,br()):null,activation:t}),f)}}function ET(n,e,t){return se(()=>(Array.isArray(e)?e=ms(e,"int32"):e=Ie(e,"int32"),T1(n,e,t)))}function yh(n){return j(n,n)}function Kx(n,e,t){const s=e.shape;if(e.rank!==1&&e.rank!==n)throw new U(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${n}`);if(n===5){if(t==="channelsFirst")return s.length===1?J(e,[1,s[0],1,1,1]):J(e,[1,s[3],s[0],s[1],s[2]]);if(t==="channelsLast")return s.length===1?J(e,[1,1,1,1,s[0]]):J(e,[1].concat(s))}else if(n===4){if(t==="channelsFirst")return s.length===1?J(e,[1,s[0],1,1]):J(e,[1,s[2],s[0],s[1]]);if(t==="channelsLast")return s.length===1?J(e,[1,1,1,s[0]]):J(e,[1].concat(s))}else if(n===3){if(t==="channelsFirst")return s.length===1?J(e,[1,s[0],1]):J(e,[1,s[1],s[0]]);if(t==="channelsLast")return s.length===1?J(e,[1,1,s[0]]):J(e,[1].concat(s))}else if(n<3)return e;throw new U(`Unsupported input rank by biasAdd: ${e.rank}`)}function kr(n,e,t){return se(()=>(t==null&&(t=br()),qt(t),ye(n,Kx(n.rank,e,t))))}function i5(n,e=1){if(e!==1)throw new qe(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return xm(n)}function a5(n){return se(()=>Be(n,ye(Un(n),1)))}function RT(n,e,t,s){return se(()=>CV(n,e,t,s))}function l5(n){return se(()=>{const e=ye(.5,j(.2,n));return Rs(e,0,1)})}function wh(n,e,t=!1){return t?n():e()}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const c5=["fanIn","fanOut","fanAvg"],u5=["normal","uniform","truncatedNormal"];/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function h5(n){ma(c5,"FanMode",n)}function d5(n){ma(u5,"Distribution",n)}class er extends _l{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class AT extends er{apply(e,t){return gn(e,t)}}AT.className="Zeros";fe(AT);class $w extends er{apply(e,t){return ui(e,t)}}$w.className="Ones";fe($w);class DT extends er{constructor(e){if(super(),typeof e!="object")throw new U(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new U(`config must have value set but got ${e}`);this.value=e.value}apply(e,t){return se(()=>j(pt(this.value),ui(e,t)))}getConfig(){return{value:this.value}}}DT.className="Constant";fe(DT);class _T extends er{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,t){return uh(e,this.minval,this.maxval,t,this.seed)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}_T.className="RandomUniform";fe(_T);class FT extends er{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new qe(`randomNormal does not support dType ${t}.`);return Im(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}FT.className="RandomNormal";fe(FT);class OT extends er{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,t){if(t=t||"float32",t!=="float32"&&t!=="int32")throw new qe(`truncatedNormal does not support dType ${t}.`);return T$(e,this.mean,this.stddev,t,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}OT.className="TruncatedNormal";fe(OT);class zT extends er{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,t){return se(()=>{if(e.length!==2||e[0]!==e[1])throw new U("Identity matrix initializer can only be used for 2D square matrices.");return j(this.gain,u$(e[0]))})}getConfig(){return{gain:this.gain}}}zT.className="Identity";fe(zT);function f5(n,e="channelsLast"){let t,s;if(qt(e),n.length===2)t=n[0],s=n[1];else if([3,4,5].indexOf(n.length)!==-1){if(e==="channelsFirst"){const r=Yo(n,2);t=n[1]*r,s=n[0]*r}else if(e==="channelsLast"){const r=Yo(n,0,n.length-2);t=n[n.length-2]*r,s=n[n.length-1]*r}}else{const r=Yo(n);t=Math.sqrt(r),s=Math.sqrt(r)}return[t,s]}class ys extends er{constructor(e){if(super(),e.scale<0)throw new U(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,h5(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,d5(this.distribution),this.seed=e.seed}apply(e,t){const s=f5(e),r=s[0],o=s[1];let i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,r):this.mode==="fanOut"?i/=Math.max(1,o):i/=Math.max(1,(r+o)/2),this.distribution==="normal"){const a=Math.sqrt(i);if(t=t||"float32",t!=="float32"&&t!=="int32")throw new qe(`${this.getClassName()} does not support dType ${t}.`);return T$(e,0,a,t,this.seed)}else{const a=Math.sqrt(3*i);return uh(e,-a,a,t,this.seed)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}ys.className="VarianceScaling";fe(ys);class Tw extends ys{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return ys.className}}Tw.className="GlorotUniform";fe(Tw);class Nw extends ys{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return ys.className}}Nw.className="GlorotNormal";fe(Nw);class Ew extends ys{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return ys.className}}Ew.className="HeNormal";fe(Ew);class Rw extends ys{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return ys.className}}Rw.className="HeUniform";fe(Rw);class Aw extends ys{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return ys.className}}Aw.className="LeCunNormal";fe(Aw);class Dw extends ys{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return ys.className}}Dw.className="LeCunUniform";fe(Dw);class MT extends er{constructor(e){super(),this.DEFAULT_GAIN=1,this.ELEMENTS_WARN_SLOW=2e3,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed}apply(e,t){return se(()=>{if(e.length<2)throw new qe("Shape must be at least 2D.");if(t!=="int32"&&t!=="float32"&&t!==void 0)throw new TypeError(`Unsupported data type ${t}.`);t=t;const s=ce(e.slice(0,-1)),r=e[e.length-1],o=s*r;o>this.ELEMENTS_WARN_SLOW&&console.warn(`Orthogonal initializer is being called on a matrix with more than ${this.ELEMENTS_WARN_SLOW} (${o}) elements: Slowness may result.`);const i=[Math.max(r,s),Math.min(r,s)],a=Im(i,0,1,t,this.seed),l=yW.qr(a,!1);let u=l[0];const f=l[1].flatten().stridedSlice([0],[Math.min(r,s)*Math.min(r,s)],[Math.min(r,s)+1]);return u=j(u,f.sign()),s<r&&(u=u.transpose()),j(pt(this.gain),u.reshape(e))})}getConfig(){return{gain:this.gain,seed:this.seed}}}MT.className="Orthogonal";fe(MT);const pS={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function mS(n,e={}){return gh(n,Hs.getMap().classNameMap,e,"initializer")}function Lt(n){return kw(n)}function zt(n){if(typeof n=="string"){const e=n in pS?pS[n]:n;if(e==="GlorotNormal")return new Nw;if(e==="GlorotUniform")return new Tw;if(e==="HeNormal")return new Ew;if(e==="HeUniform")return new Rw;if(e==="LeCunNormal")return new Aw;if(e==="LeCunUniform")return new Dw;{const t={};return t.className=e,t.config={},mS(t)}}else return n instanceof er?n:mS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function qx(n){return Array.isArray(n)&&Array.isArray(n[0])}function Lf(n){return n.length===0?[]:Array.isArray(n[0])?n:[n]}function He(n){let e;if(Array.isArray(n)){if(n.length!==1)throw new U(`Expected Tensor length to be 1; got ${n.length}`);e=n[0]}else e=n;return e}function ct(n){if(Array.isArray(n)&&Array.isArray(n[0])){if(n.length===1)return n=n,n[0];throw new U(`Expected exactly 1 Shape; got ${n.length}`)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Bf(n){let e=0;for(const t of n)t.shape.length===0?e+=1:e+=t.shape.reduce((s,r)=>s*r);return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const gS="Variable";class p5{constructor(e,t="float32",s=gS,r=!0,o=null){this.dtype=t??"float32",this.shape=e.shape,this.id=ST(),s=s??gS,this.originalName=$T(s),this.name=TT(this.originalName),this.trainable_=r,this.constraint=o,this.val=yV(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),m5(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}}function m5(n,e){if(n.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(n.shape)+" vs. "+JSON.stringify(e.shape))}function Yx(n){return n.map(e=>e.read())}function _w(n){n.forEach(e=>{e[0].write(e[1])})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class an{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}}class Xr{constructor(e,t,s,r,o,i,a){this.dtype=e,this.shape=t,this.sourceLayer=s,this.inputs=r,this.callArgs=o,this.outputTensorIndex=a,this.id=ST(),i!=null&&(this.originalName=$T(i),this.name=TT(this.originalName)),this.rank=t.length}}let g5=0;class $m{constructor(e,t){this.callArgs=t,this.id=g5++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(const s of e.inboundLayers)s!=null&&s.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){const e=[];for(const t of this.inboundLayers)t!=null?e.push(t.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let x5=0;class et extends _l{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=x5++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let t=e.name;if(!t){const s=this.getClassName();t=lo(s)+"_"+Sm(s)}if(this.name=t,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let s;if(e.batchInputShape!=null)s=e.batchInputShape;else if(e.inputShape!=null){let o=null;e.batchSize!=null&&(o=e.batchSize),s=[o].concat(e.inputShape)}this.batchInputShape=s;let r=e.dtype;r==null&&(r=e.inputDType),r==null&&(r="float32"),this.dtype=r}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,t){return e.name+"_ib-"+t.toString()}getNodeAtIndex(e,t){if(this.inboundNodes.length===0)throw new js(`The layer has never been called and thus has no defined ${t}.`);if(this.inboundNodes.length<=e)throw new U(`Asked to get ${t} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return ts(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return ts(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new _r(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new _r(`Layer ${this.name} is not connected, no input to return.`);return ts(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new _r(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new _r(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return ts(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(t=>t.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){const t=xt(e);if(this.inputSpec==null||this.inputSpec.length===0)return;const s=xt(this.inputSpec);if(t.length!==s.length)throw new U(`Layer ${this.name} expects ${s.length} inputs, but it received ${t.length} input tensors. Input received: ${e}`);for(let r=0;r<t.length;r++){const o=t[r],i=s[r];if(i==null)continue;const a=o.rank;if(i.ndim!=null&&a!==i.ndim)throw new U(`Input ${r} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${a}`);if(i.maxNDim!=null&&a>i.maxNDim)throw new U(`Input ${r} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${a}`);if(i.minNDim!=null&&a<i.minNDim)throw new U(`Input ${r} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${a}.`);if(i.dtype!=null&&o.dtype!==i.dtype)throw new U(`Input ${r} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${o.dtype}.`);if(i.axes){const l=o.shape;for(const u in i.axes){const d=Number(u),f=i.axes[u],p=d>=0?l[d]:l[l.length+d];if(f!=null&&[f,null].indexOf(p)===-1)throw new U(`Input ${r} is incompatible with layer ${this.name}: expected axis ${d} of input shape to have value ${f} but got shape ${l}.`)}}if(i.shape!=null)for(let l=0;l<i.shape.length;++l){const u=i.shape[l],d=o.shape[l];if(u!=null&&d!=null&&u!==d)throw new U(`Input ${r} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${o.shape}.`)}}}call(e,t){return e}invokeCallHook(e,t){this._callHook!=null&&this._callHook(e,t)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,t){t=t||{},this.assertNotDisposed();const s=xt(e),r=v5(e),o=b5(e);if(r===o)throw new U("Arguments to apply() must be all SymbolicTensors or all Tensors");return ji(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);const i=[];for(const a of xt(e))i.push(a.shape);this.build(ts(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&o&&(this._refCount=1)}if(this.assertInputCompatibility(e),o){let i=this.call(e,t);this.supportsMasking&&this.setMaskMetadata(e,i);const a=xt(i),l=[];for(let u of a)s.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(i=ts(l),this.activityRegularizer!=null)throw new qe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{const i=y5(e),a=this.computeOutputShape(i);let l;const u=w5(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((d,f)=>new Xr(u,d,this,xt(e),t,this.name,f)):l=new Xr(u,a,this,xt(e),t,this.name),this.addInboundNode(e,l,null,null,i,a,t),this._refCount++,this.activityRegularizer!=null)throw new qe("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let t=!1;this.batchInputShape.forEach((s,r)=>{s!=null&&e[r]!=null&&e[r]!==s&&(t=!0)}),t&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new _r(`The layer ${this.name} has never been called and thus has no defined output shape.`);const e=[];for(const t of this.inboundNodes){const s=JSON.stringify(t.outputShapes);e.indexOf(s)===-1&&e.push(s)}if(e.length===1){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&t.length===1?t[0]:t}else throw new _r(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new js(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Bf(this.weights)}build(e){this.built=!0}getWeights(e=!1){return Yx(e?this.trainableWeights:this.weights)}setWeights(e){se(()=>{const t=this.weights;if(t.length!==e.length)throw new U(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${t.length} weights. Provided weights: ${e}...`);if(t.length===0)return;const s=[],r=Yx(t);for(let o=0;o<r.length;++o){const i=r[o],a=t[o],l=e[o];if(!mt(i.shape,l.shape))throw new U(`Layer weight shape ${i.shape} not compatible with provided weight shape ${l.shape}`);s.push([a,l])}_w(s)})}addWeight(e,t,s,r,o,i,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new U(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),s==null&&(s="float32"),this.fastWeightInitDuringBuild&&(r=l!=null?l():zt("zeros"));const u=r.apply(t,s),d=new p5(u,s,e,i,a);return u.dispose(),o!=null&&this.addLoss(()=>o.apply(d.read())),i==null&&(i=!0),i?this._trainableWeights.push(d):this._nonTrainableWeights.push(d),d}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=xt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,t){if(!this.supportsMasking){if(t!=null)if(Array.isArray(t))t.forEach(s=>{if(s!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return t}setMaskMetadata(e,t,s){if(!this.supportsMasking)return;const r=this.computeMask(e,s),o=xt(t),i=xt(r);if(o.length!==i.length)throw new Error(`${this.name} outputs ${o.length} tensors but ${o.length} masks for those tensors`);for(let a=0;a<o.length;a++)o[a].kerasMask=i[a]}addInboundNode(e,t,s,r,o,i,a=null){const l=xt(e);t=xt(t),s=xt(s),r=xt(r),o=Lf(o),i=Lf(i);const u=[],d=[],f=[];for(const p of l)u.push(p.sourceLayer),d.push(p.nodeIndex),f.push(p.tensorIndex);new $m({outboundLayer:this,inboundLayers:u,nodeIndices:d,tensorIndices:f,inputTensors:l,outputTensors:t,inputMasks:s,outputMasks:r,inputShapes:o,outputShapes:i},a);for(let p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}getConfig(){const e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}function y5(n){n=xt(n);const e=[];for(const t of n)e.push(t.shape);return ts(e)}function w5(n){return"float32"}function PT(n,e,t){if((e==null||t!=null&&t>0)&&(e=n.sourceLayer,t=n.nodeIndex),e.inboundNodes.length===0)return[n];{const s=e.inboundNodes[t];if(s.inboundLayers.length===0)return s.inputTensors;{const r=[];for(let o=0;o<s.inboundLayers.length;o++){const i=s.inputTensors[o],a=s.inboundLayers[o],l=s.nodeIndices[o],u=PT(i,a,l);for(const d of u)r.indexOf(d)===-1&&r.push(d)}return r}}}function v5(n){let e=!0;for(const t of xt(n))if(!(t instanceof Xr)){e=!1;break}return e}function b5(n){let e=!0;for(const t of xt(n))if(t instanceof Xr){e=!1;break}return e}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class vh extends et{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:Sm("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new U("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let t=e.batchInputShape;if(t==null){if(e.inputShape==null)throw new U("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");t=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new U("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const s=e.dtype||"float32";this.batchInputShape=t,this.dtype=s,this.inputSpec=[{shape:t}];const r=new Xr(this.dtype,this.batchInputShape,this,[],{},this.name);r.nodeIndex=0,r.tensorIndex=0,new $m({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[r],outputTensors:[r],inputMasks:[null],outputMasks:[null],inputShapes:[t],outputShapes:[t]})}apply(e,t){throw new U(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}vh.className="InputLayer";fe(vh);function C5(n){if(n.batchShape==null&&n.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(n.batchShape!=null&&n.shape!=null)throw new U("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=n.batchShape;n.shape!=null&&e==null&&(e=[null].concat(n.shape));let t=n.dtype;return t==null&&(t="float32"),new vh({batchInputShape:e,name:n.name,dtype:t,sparse:n.sparse}).inboundNodes[0].outputTensors[0]}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function k5(n,e){if(n.dtype==null||n.dtype===e.dtype)return e;try{return Ie(e,n.dtype)}catch{throw new U(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${n.name}' (${n.dtype}).`)}}class Go{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Go)for(const t in e.id2Value)this.id2Value[t]=e.id2Value[t],t in e.id2Mask&&(this.id2Mask[t]=e.id2Mask[t]);else{if(e==null)return;for(const t of e)this.add(t.key,t.value)}}add(e,t,s){if(this.id2Value[e.id]==null)this.id2Value[e.id]=k5(e,t),this.name2Id[e.name]=e.id,s!=null&&(this.id2Mask[e.id]=s);else throw new U(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Xr){if(this.id2Value[e.id]==null)throw new U(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{const t=this.name2Id[e];if(t==null)throw new U(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[t]}}getMask(e){if(e instanceof Xr){if(this.id2Value[e.id]==null)throw new U(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{const t=this.name2Id[e];if(t==null)throw new U(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[t]}}disposeMasks(){this.id2Mask!=null&&Ye(this.id2Mask)}}const Vf=new bT,Wf=new bT;function S5(n){Vf!=null&&Vf.setMaxEntries(n),Wf!=null&&Wf.setMaxEntries(n)}function Pc(n,e,t,s){const r=t==null?!1:t.training,o=Array.isArray(n),i=o?n:[n],a=i.map(x=>x.name),l=[],u=e.names();for(const x of a)u.indexOf(x)!==-1?l.push(e.getValue(x)):l.push(null);const d=a.join(",")+"|"+e.names().sort().join(",");let f=Vf.get(d),p;if(f==null){const x=I5(i,e);f=x.sorted,p=x.recipientCounts,Vf.put(d,f),Wf.put(d,p)}p={},r||Object.assign(p,Wf.get(d));const g=new Go(e);for(let x=0;x<f.length;++x){const w=f[x],v=w.sourceLayer;if(v instanceof vh)continue;const b=[],C=[],$=[];let S=!1;for(const D of w.inputs){const _=g.getValue(D),N=g.getMask(D);b.push(_),C.push(N),N!=null&&(S=!0),r||(p[D.name]--,p[D.name]===0&&!e.hasKey(D)&&a.indexOf(D.name)===-1&&!_.isDisposed&&D.sourceLayer.stateful!==!0&&$.push(_))}S&&(t=t||{},t.mask=C[0]);const T=xt(v.apply(b,t));let E=null;v.supportsMasking&&(E=v.computeMask(b,C));const A=T5(w),F=Array.isArray(A)?A:[A];for(let D=0;D<F.length;++D){g.hasKey(F[D])||g.add(F[D],T[D],Array.isArray(E)?E[0]:E);const _=a.indexOf(F[D].name);_!==-1&&(l[_]=T[D])}r||Ye($)}return g.disposeMasks(),o?l:l[0]}function I5(n,e){O(n!=null&&n.length>0,()=>"Expected at least one fetch, got none");let t=[],s={};if(n.length===1){const r=xS(n[0],e);t=r.sorted,s=r.recipientMap}else{const r=new Set;for(const o of n){const{sorted:i,recipientMap:a}=xS(o,e);for(const l of i)r.has(l.name)||(t.push(l),r.add(l.name));for(const l in a)s[l]==null&&(s[l]=new Set),a[l].forEach(u=>s[l].add(u))}}return{sorted:t,recipientCounts:$5(s)}}function $5(n){const e={};for(const t in n)e[t]=n[t].size;return e}function xS(n,e){const t=new Set,s=[],r={};for(const a of e.names())t.add(a);const o=[],i=[];for(o.push(n);o.length>0;){const a=o[o.length-1];if(t.has(a.name)){o.pop();continue}const l=i[i.length-1]===o.length-1;if(a.inputs.length===0||l)o.pop(),s.push(a),t.add(a.name),l&&i.pop();else{i.push(o.length-1);for(const u of a.inputs)r[u.name]==null&&(r[u.name]=new Set),r[u.name].add(a.name),!t.has(u.name)&&o.push(u)}}return{sorted:s,recipientMap:r}}function T5(n){let e;if(n.sourceLayer.inboundNodes.length===1)e=n.sourceLayer.output;else{let t=null;for(let s=0;s<n.sourceLayer.inboundNodes.length;++s)for(const r of n.sourceLayer.inboundNodes[s].outputTensors)if(r.id===n.id){t=s;break}e=n.sourceLayer.getOutputAt(t)}return e}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const N5=ie();N5.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,S5);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Fw(n,e){return se(()=>On(Me(j(n,n),e,!0)))}class bh extends _l{getConfig(){return{}}}class LT extends bh{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return se(()=>{const t=Fw(e,this.axis),s=Rs(t,0,this.maxValue);return j(e,Be(s,ye(on(),t)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}LT.className="MaxNorm";fe(LT);class BT extends bh{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return se(()=>Be(e,ye(on(),Fw(e,this.axis))))}getConfig(){return{axis:this.axis}}}BT.className="UnitNorm";fe(BT);class VT extends bh{apply(e){return fa(e)}}VT.className="NonNeg";fe(VT);class WT extends bh{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return se(()=>{const t=Fw(e,this.axis),s=ye(j(this.rate,Rs(t,this.minValue,this.maxValue)),j(1-this.rate,t));return j(e,Be(s,ye(on(),t)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}WT.className="MinMaxNorm";fe(WT);const yS={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function ln(n){return kw(n)}function wS(n,e={}){return gh(n,Hs.getMap().classNameMap,e,"constraint")}function cn(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in yS?yS[n]:n,config:{}};return wS(t)}else return n instanceof bh?n:wS(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function Ri(n){if(n==null)return;const e=[],t=[],s=[];for(const r in n){const o=n[r];if(typeof o!="number"){const i=o;e.push(i.data()),t.push(r),s.push(i)}}if(e.length>0){const r=await Promise.all(e);for(let o=0;o<r.length;++o)n[t[o]]=r[o][0];Ye(s)}}function UT(n){if(n!=null)for(const e in n){const t=n[e];typeof t!="number"&&t.dispose()}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var vS;(function(n){n[n.SILENT=0]="SILENT",n[n.VERBOSE=1]="VERBOSE"})(vS||(vS={}));const E5=125;class Jc{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,t){}async onEpochEnd(e,t){}async onBatchBegin(e,t){}async onBatchEnd(e,t){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}}class R5{constructor(e,t=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=t}append(e){this.callbacks.push(e)}setParams(e){for(const t of this.callbacks)t.setParams(e)}setModel(e){for(const t of this.callbacks)t.setModel(e)}async onEpochBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochBegin(e,t)}async onEpochEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onEpochEnd(e,t)}async onBatchBegin(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchBegin(e,t)}async onBatchEnd(e,t){t==null&&(t={});for(const s of this.callbacks)await s.onBatchEnd(e,t)}async onTrainBegin(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(const t of this.callbacks)await t.onTrainEnd(e)}}class A5 extends Jc{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,t){t==null&&(t={});const s=t.size==null?0:t.size;this.seen+=s;for(const r in t){const o=t[r];if(typeof o=="number")this.totals.hasOwnProperty(r)||(this.totals[r]=0),this.totals[r]=this.totals[r]+o*s;else{let i;r in this.totals?i=this.totals[r]:this.totals[r]=0;const a=se(()=>ye(this.totals[r],j(o,s)));this.totals[r]=a,i!=null&&i.dispose()}}}async onEpochEnd(e,t){if(t!=null)for(const s of this.params.metrics)this.totals[s]!=null&&(typeof this.totals[s]=="number"?t[s]=this.totals[s]/this.seen:se(()=>{const r=j(Be(1,this.seen),this.totals[s]);t[s]=r,this.totals[s].dispose(),Pr(t[s])}))}}class D5 extends Jc{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,t){t==null&&(t={}),this.epoch.push(e);for(const s in t)this.history[s]==null&&(this.history[s]=[]),this.history[s].push(t[s])}async syncData(){const e=[],t=[],s=[];for(const o in this.history){const i=this.history[o];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){const l=i[a];e.push(l.data()),t.push(o),s.push(a)}}const r=await Promise.all(e);for(let o=0;o<r.length;++o)this.history[t[o]][s[o]].dispose(),this.history[t[o]][s[o]]=r[o][0]}}class _5 extends Jc{constructor(e,t){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||K$,this.yieldEvery=t||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=E5),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");Ix(this.yieldEvery)&&(this.maybeWait=jG(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,t,s){const r=[];this.yield!=null&&(await Ri(s),r.push(this.yield(e,t,s))),r.push(this.nextFrameFunc()),await Promise.all(r)}async onEpochBegin(e,t){this.currentEpoch=e,this.epochBegin!=null&&(await Ri(t),await this.epochBegin(e,t))}async onEpochEnd(e,t){const s=[];this.epochEnd!=null&&(await Ri(t),s.push(this.epochEnd(e,t))),this.yieldEvery==="epoch"&&s.push(this.nextFrameFunc()),await Promise.all(s)}async onBatchBegin(e,t){this.batchBegin!=null&&(await Ri(t),await this.batchBegin(e,t))}async onBatchEnd(e,t){const s=[];this.batchEnd!=null&&(await Ri(t),s.push(this.batchEnd(e,t))),this.yieldEvery==="batch"?s.push(this.nextFrameFunc()):Ix(this.yieldEvery)&&s.push(this.maybeWait(this.currentEpoch,e,t)),await Promise.all(s)}async onTrainBegin(e){this.trainBegin!=null&&(await Ri(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await Ri(e),await this.trainEnd(e))}}function GT(n,e){return n==null&&(n={}),n instanceof Jc?[n]:Array.isArray(n)&&n[0]instanceof Jc?n:xt(n).map(s=>new _5(s,e))}class Us{constructor(){}static registerCallbackConstructor(e,t){O(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),Us.checkForDuplicate(t),Us.constructors[e]==null&&(Us.constructors[e]=[]),Us.constructors[e].push(t)}static checkForDuplicate(e){for(const t in Us.constructors)Us.constructors[+t].forEach(r=>{if(r===e)throw new U("Duplicate callback constructor.")})}static clear(){Us.constructors={}}static createCallbacks(e){const t=[];for(const s in Us.constructors){const r=+s;e>=r&&t.push(...Us.constructors[r])}return t.map(s=>new s)}}Us.constructors={};function HT(n,e,t,s,r,o,i,a,l){const u=new D5,d=[new A5,...Us.createCallbacks(e)];n!=null&&d.push(...n),d.push(u);const f=new R5(d);return f.setParams({epochs:t,initialEpoch:s,samples:r,steps:o,batchSize:i,verbose:e,doValidation:a,metrics:l}),{callbackList:f,history:u}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Wr(n,e={},t=!1){return gh(n,Hs.getMap().classNameMap,e,"layer",t)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Uf(n,e){return se(()=>{n.dtype!=="float32"&&(n=Ie(n,"float32"));const t=Me(yh(n),e,!0),s=gm(t.shape,on()),r=On(ci(t,s));return Be(n,r)})}function Tm(n,e){return se(()=>Jt(yh(Ge(e,n)),-1))}function Ow(n,e){return se(()=>Jt(Un(Ge(e,n)),-1))}function zw(n,e){return se(()=>{const t=Ge(n,e),s=Rs(Un(n),on(),Number.MAX_VALUE),r=Un(Be(t,s));return j(100,Jt(r,-1))})}function F5(n,e){return se(()=>{const t=Rs(e,on(),Number.MAX_VALUE),s=jr(ye(1,t)),r=Rs(n,on(),Number.MAX_VALUE),o=jr(ye(1,r));return Jt(yh(Ge(s,o)),-1)})}function O5(n,e){return se(()=>{const t=ci(0,Ge(1,j(n,e)));return Jt(yh(t),-1)})}function z5(n,e){return se(()=>{const t=ci(0,Ge(1,j(n,e)));return Jt(t,-1)})}function M5(n,e){return se(()=>{const t=Me(j(n,e),-1),s=yr(j(Ge(1,n),e),-1);return ci(0,ye(1,Ge(s,t)))})}function P5(n,e){return se(()=>{const t=Math.log(2),s=Ge(e,n),r=Ge(ye(s,ch(j(-2,s))),t);return Jt(r,-1)})}function eu(n,e,t=!1){return se(()=>{if(t)e=L1(e);else{const s=Me(e,e.shape.length-1,!0);e=Be(e,s)}return e=Rs(e,on(),1-on()),jt(Me(j(Ie(n,"float32"),jr(e)),e.shape.length-1))})}function Gf(n,e,t=!1){return se(()=>{const s=Ie(wm(r5(n)),"int32");e=Rs(e,on(),1-on());const r=e.shape,o=J(m$(s,r[r.length-1]),r);return eu(o,e,t)})}function L5(n,e){if(!mt(n.shape,e.shape))throw new U(`logits and labels must have the same shape, but got shapes ${JSON.stringify(n.shape)} and ${JSON.stringify(e.shape)}`);return se(()=>{const t=fa(e),s=jt(Un(e));return ye(Ge(t,j(e,n)),h$(Hr(s)))})}function Nm(n,e){return se(()=>{let t;return t=Rs(e,on(),1-on()),t=jr(Be(t,Ge(1,t))),Jt(L5(n,t),-1)})}function B5(n,e){return se(()=>{const t=Rs(n,on(),1),s=Rs(e,on(),1);return Me(j(n,jr(Be(t,s))),-1)})}function V5(n,e){return se(()=>{const t=jr(ye(on(),e));return Jt(Ge(e,j(n,t)),-1)})}function jT(n,e){return se(()=>{const t=Uf(n,-1),s=Uf(e,-1),r=j(t,s);return jt(Me(r,-1))})}const Hf={meanSquaredError:Tm,meanAbsoluteError:Ow,meanAbsolutePercentageError:zw,meanSquaredLogarithmicError:F5,squaredHinge:O5,hinge:z5,categoricalHinge:M5,logcosh:P5,categoricalCrossentropy:eu,sparseCategoricalCrossentropy:Gf,binaryCrossentropy:Nm,kullbackLeiblerDivergence:B5,poisson:V5,cosineProximity:jT};function J0(n){if(typeof n=="string"){if(n in Hf)return Hf[n];let e=`Unknown loss ${n}`;throw n.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${n}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new U(e)}else return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function XT(n,e){return se(()=>{const t=j(.5,Zs(e)),s=Br(As(e,t),n.dtype);return Jt(Gr(n,s),-1)})}function KT(n,e){return se(()=>Br(Gr(Kc(n,-1),Kc(e,-1)),"float32"))}function W5(n,e){return se(()=>Ie(Me(fo(Gr(n,1),Gr(e,1))),"float32"))}function U5(n,e){return se(()=>Ie(Me(fo(Gr(n,0),Gr(e,1))),"float32"))}function G5(n,e){return se(()=>{const t=W5(n,e),s=U5(n,e),r=ye(t,s);return Ie(Xn(As(r,0),Be(t,r),0),"float32")})}function H5(n,e){return Nm(n,e)}function j5(n,e){return n.rank===e.rank&&(n=hh(n,[n.rank-1])),e=Kc(e,-1),e.dtype!==n.dtype&&(e=Ie(e,n.dtype)),Ie(Gr(n,e),"float32")}const X5=Tm,K5=Tm,q5=Ow,Y5=Ow,Q5=zw,Z5=zw,qT=eu,J5=jT,YT=Gf,jf={binaryAccuracy:XT,categoricalAccuracy:KT,precision:G5,categoricalCrossentropy:qT,sparseCategoricalCrossentropy:YT,mse:X5,MSE:K5,mae:q5,MAE:Y5,mape:Q5,MAPE:Z5,cosine:J5};function e6(n){if(typeof n=="string"&&n in jf)return jf[n];if(typeof n!="string"&&n!=null)return n;throw new U(`Unknown metric ${n}`)}function Hd(n){if(Fr(n!==null,`Unknown LossOrMetricFn ${n}`),typeof n=="string")return n;{let e;for(const t of Object.keys(Hf))if(Hf[t]===n){e=t;break}if(e!==void 0)return e;for(const t of Object.keys(jf))if(jf[t]===n){e=t;break}return e!==void 0?e:n.name}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function t6(n){const e={Adagrad:()=>Fi.adagrad(.01),Adadelta:()=>Fi.adadelta(1,.95,on()),Adam:()=>Fi.adam(.001,.9,.999,on()),Adamax:()=>Fi.adamax(.002,.9,.999,on(),0),RMSProp:()=>Fi.rmsprop(.001,.9,0,on()),SGD:()=>Fi.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,n in e)return e[n]();throw new U(`Unknown Optimizer ${n}`)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const bS=1*1024*1024;function CS(n,e,t=!1){if(n==null||typeof n!="object"||Object.getPrototypeOf(n)!==Object.prototype||!Qx(n))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(t){const s=JSON.stringify(n);s.length>bS&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${s.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${bS}.`)}}function Qx(n){if(n===null)return!0;if(typeof n=="object")if(Object.getPrototypeOf(n)===Object.prototype){const e=Object.keys(n);for(const t of e)if(typeof t!="string"||!Qx(n[t]))return!1;return!0}else if(Array.isArray(n)){for(const e of n)if(!Qx(e))return!1;return!0}else return!1;else{const e=typeof n;return e==="string"||e==="number"||e==="boolean"}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function n6(n,e,t,s=console.log){const r=r6(n),o=["Layer (type)","Input Shape","Output shape","Param #"];r?(e=e||90,t=t||[.32,.61,.89,1]):(e=e||115,t=t||[.24,.48,.7,.8,1]),t[t.length-1]<=1&&(t=t.map(d=>Math.floor(e*d)));let i;if(!r){o.push("Receives inputs"),i=[];for(const d in n.nodesByDepth)i.push(...n.nodesByDepth[d])}s("_".repeat(e)),Xf(o,t,s),s("=".repeat(e));const a=n.layers;for(let d=0;d<a.length;++d)r?o6(a[d],t,s):i6(a[d],t,i,s),s((d===a.length-1?"=":"_").repeat(e));n.checkTrainableWeightsConsistency();const l=s6(n),u=Bf(n.nonTrainableWeights);s(`Total params: ${l+u}`),s(`Trainable params: ${l}`),s(`Non-trainable params: ${u}`),s("_".repeat(e))}function s6(n){let e;return n.collectedTrainableWeights!=null?e=Bf(n.collectedTrainableWeights):e=Bf(n.trainableWeights),e}function r6(n){let e=!0;const t=[],s=[];for(const r in n.nodesByDepth)t.push(n.nodesByDepth[r]);for(const r of t){if(r.length>1||r.length===1&&r[0].inboundLayers.length>1){e=!1;break}s.push(...r)}if(e)for(const r of n.layers){let o=!1;for(const i of r.inboundNodes)if(s.indexOf(i)!==-1)if(o){e=!1;break}else o=!0;if(!e)break}return e}function Xf(n,e,t=console.log){let s="";for(let r=0;r<n.length;++r)r>0&&(s=s.slice(0,s.length-1)+" "),s+=n[r],s=s.slice(0,e[r]),s+=" ".repeat(e[r]-s.length);t(s)}function o6(n,e,t){let s,r;try{r=n.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{r="multiple"}try{s=JSON.stringify(n.outputShape)}catch{s="multiple"}const o=n.name,i=n.getClassName(),a=[`${o} (${i})`,r,s,n.countParams().toString()];Xf(a,e,t)}function i6(n,e,t,s){let r,o;try{o=n.inboundNodes.map(f=>JSON.stringify(f.inputShapes)).join(",")}catch{o="multiple"}try{r=JSON.stringify(n.outputShape)}catch{r="multiple"}const i=[];for(const f of n.inboundNodes)if(!(t!=null&&t.length>0&&t.indexOf(f)===-1))for(let p=0;p<f.inboundLayers.length;++p){const g=f.inboundLayers[p].name,x=f.nodeIndices[p],w=f.tensorIndices[p];i.push(`${g}[${x}][${w}]`)}const a=n.name,l=n.getClassName(),u=i.length===0?"":i[0],d=[`${a} (${l})`,o,r,n.countParams().toString(),u];Xf(d,e,s);for(let f=1;f<i.length;++f)Xf(["","","","",i[f]],e,s)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function QT(n,e,t){return(n==="inboundNodes"||n==="outputLayers"||n==="inputLayers")&&e===0&&typeof t=="string"}function Kf(n,e){if(n===null)return null;if(typeof n=="string")return Mi(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];QT(e,r,o)?t.push(o):t.push(Kf(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s];if(s==="name"&&typeof r=="string")t[s]=r;else{const o=Mi(s);t[o]=Kf(r,o)}}return t}}function Zx(n,e){if(n==null)return null;if(typeof n=="string")return lo(n);if(typeof n=="number"||typeof n=="boolean")return n;if(n instanceof Array){const t=[],s=n.length;for(let r=0;r<s;++r){const o=n[r];QT(e,r,o)?t.push(o):t.push(Zx(o,e))}return t}else{const t={};for(const s of Object.keys(n)){const r=n[s],o=lo(s);(s==="name"||s==="className")&&typeof r=="string"?t[o]=r:t[o]=Zx(r,s)}return t}}/** @license See the LICENSE file. */const ZT="4.21.0";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const a6=n=>{const e=Object.keys(n);if(e.length===0)return!1;const t=e[0].split("/");return!isNaN(parseInt(t[t.length-1],10))};class hr extends et{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){const C=this.getClassName().toLowerCase();this.name=Sm(C)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],qo(this.inputs).length!==this.inputs.length)throw new U(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(C=>C.name)}`);qo(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(C=>C.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const C of this.outputs){const $=C.sourceLayer,S=C.nodeIndex,T=C.tensorIndex;this.outputLayers.push($),this.outputLayersNodeIndices.push(S),this.outputLayersTensorIndices.push(T)}for(const C of this.inputs){const $=C.sourceLayer,S=C.nodeIndex,T=C.tensorIndex;Fr(S===0,"input layer has >1 nodes"),Fr(T===0,"input layer has >1 tensors"),this.inputLayers.push($),this.inputLayersNodeIndices.push(S),this.inputLayersTensorIndices.push(T)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let C=0;C<this.inputLayers.length;C++){const $=this.inputLayers[C];if(!($ instanceof vh))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${C} (0-based) originates from layer type ${$.getClassName()}.`);this.inputNames.push($.name),this.feedInputShapes.push($.batchInputShape),this.feedInputNames.push($.name)}for(const C of this.outputLayers)this.outputNames.push(C.name);this.internalInputShapes=this.inputs.map(C=>C.shape),this.internalOutputShapes=this.outputs.map(C=>C.shape);const t={},s={},r={},o={},i={},a=[],l=(C,$,S,T,E,A)=>{(T==null||E==null||A==null)&&(T=C.sourceLayer,E=C.nodeIndex,A=C.tensorIndex);const F=T.inboundNodes[E];if(S.indexOf(F)!==-1)throw new js(`The tensor ${C.name} at layer "${T.name}" is part of a cycle.`);if($.indexOf(F)!==-1)return;this.containerNodes.add(hr.nodeKey(T,E)),T.id in i||(i[T.id]=Object.keys(i).length),S.indexOf(F)===-1&&S.push(F);const D=F.inboundLayers.length;for(let _=0;_<D;_++){const N=F.inputTensors[_],L=F.inboundLayers[_],G=F.nodeIndices[_],Q=F.tensorIndices[_];l(N,$,S,L,G,Q)}for($.push(F);S.indexOf(F)>=0;)S.splice(S.indexOf(F),1);a.push(F)},u=[],d=[];for(const C of this.outputs)l(C,u,d);const f=a.slice().reverse();for(const C of f){s[C.id]=C,C.id in t||(t[C.id]=0);let $=t[C.id];const S=r[C.outboundLayer.id]==null?0:r[C.outboundLayer.id];$=Math.max($,S),r[C.outboundLayer.id]=$,o[C.outboundLayer.id]=C.outboundLayer,t[C.id]=$;for(let T=0;T<C.inboundLayers.length;T++){const E=C.inboundLayers[T],A=C.nodeIndices[T],F=E.inboundNodes[A],D=t[F.id]==null?0:t[F.id];t[F.id]=Math.max($+1,D),s[F.id]=F}}const p={};for(const C in t){const $=t[C];$ in p||(p[$]=[]),p[$].push(s[C])}const g={};for(const C in r){const $=r[C];$ in g||(g[$]=[]),g[$].push(o[C])}let x=Object.keys(g).map(C=>parseInt(C,10)).sort(Wd);this.layers=[];for(const C of x){const $=g[C];$.sort((S,T)=>{const E=i[S.id],A=i[T.id];return E<A?-1:E>A?1:0});for(const S of $)S instanceof hr&&this.internalContainerRefs.push(S),this.layers.push(S)}this.layersByDepth=g,x=Object.keys(p).map(C=>parseInt(C,10)).sort(Wd);const w=this.inputs.slice(),v=[];for(const C of x)for(const $ of p[C]){const S=$.outboundLayer;if(S!=null){for(const T of $.inputTensors)if(w.indexOf(T)===-1)throw new js(`Graph disconnected: cannot obtain value for tensor ${T} at layer "${S.name}". The following previous layers were accessed without issue: ${v}`);for(const T of $.outputTensors)w.push(T);v.push(S.name)}}this.nodesByDepth=p;const b=this.layers.map(C=>C.name);for(const C of b){const $=b.filter(S=>S===C).length;if($!==1)throw new js(`The name "${C}" is used ${$} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(b))}this.outboundNodes=[],this.inboundNodes=[],new $m({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(C=>null),outputMasks:this.outputs.map(C=>null),inputShapes:this.inputs.map(C=>C.shape),outputShapes:this.outputs.map(C=>C.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(const t of this.layers)e.numDisposedVariables+=t.dispose().numDisposedVariables;for(const t of this.internalContainerRefs)e.numDisposedVariables+=t.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(t=>{t._trainableWeights.forEach(s=>s.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new U("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(const t of this.layers)e=e.concat(t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.layers)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.layers)t.push(...s.trainableWeights);return t.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,t=!0){const s={};let r=0;const o=a6(e);o&&this.parseWeights(e);for(const a of this.layers)for(const[l,u]of a.weights.entries()){const d=o?`${u.name.split("/").slice(0,-1).join("/")+"/"}${l}`:u.originalName;if(s[d]!=null)throw new U(`Duplicate weight name: ${d}`);s[d]=u,r++}const i=[];for(const a in e){let l=a;if(s[a]==null){const u=a.split("/");l=u.slice(0,-2).concat([u[u.length-1]]).join("/")}if(s[l]!=null)i.push([s[l],e[a]]);else if(t)throw new U(`Provided weight data has no target variable: ${a}`);delete s[l]}if(t){const a=[];for(const l in s)a.push(l);if(a.length>0)throw new U(`${a.length} of ${r} weights are not set: ${a}`)}_w(i)}parseWeights(e){for(const t in Object.keys(e)){const s=t.split("/"),r=["vars","layer_checkpoint_dependencies"],o=s.map(i=>i.startsWith("_")?i.slice(1):i).filter(i=>!r.includes(i)).join("/");o!==t&&(e[o]=e[t],delete e[t])}}updatedConfig(){const e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion=`tfjs-layers ${ZT}`,t.backend="TensorFlow.js",t}toJSON(e,t=!0){const s=Zx(this.updatedConfig());return t?JSON.stringify(s):s}call(e,t){return se(()=>{e=xt(e);const s=new Go;for(let r=0;r<this.inputs.length;++r)s.add(this.inputs[r],e[r]);return Pc(this.outputs,s,t)})}computeMask(e,t){return se(()=>{e=xt(e);let s;return t==null?s=ia(null,e.length):s=xt(t),this.runInternalGraph(e,s)[1]})}computeOutputShape(e){const t=Lf(e);if(t.length!==this.inputLayers.length)throw new U(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);const s={};for(let a=0;a<t.length;a++){const l=this.inputLayers[a],u=t[a],d=l.name+"_0_0";s[d]=u}const r=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Wd);if(r.length>1)for(const a of r){const l=this.nodesByDepth[a];for(const u of l){const d=u.outboundLayer;if(this.inputLayers.map(w=>w.id).indexOf(d.id)!==-1)continue;const f=[];for(let w=0;w<u.inboundLayers.length;w++){const v=u.inboundLayers[w],b=u.nodeIndices[w],C=u.tensorIndices[w],$=`${v.name}_${b}_${C}`,S=s[$];f.push(S)}const p=d.computeOutputShape(ts(f)),g=Lf(p),x=d.inboundNodes.indexOf(u);for(let w=0;w<g.length;w++){const v=`${d.name}_${x}_${w}`;s[v]=g[w]}}}const o=[],i=[];for(let a=0;a<this.outputLayers.length;a++){const l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],d=this.outputLayersTensorIndices[a],f=`${l.name}_${u}_${d}`;i.push(f)}for(let a=0;a<i.length;a++){const l=i[a];Fr(l in s),o.push(s[l])}return ts(o)}runInternalGraph(e,t){t==null&&(t=ia(null,e.length));const s={};for(let l=0;l<this.inputs.length;++l){const u=this.inputs[l],d=e[l],f=t[l];s[u.id]=[d,f]}const r=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Wd);for(const l of r){const u=this.nodesByDepth[l];for(const d of u){const f=d.outboundLayer,p=d.inputTensors,g=d.outputTensors,x=new Array;for(const w of p)w.id in s&&x.push(s[w.id]);if(x.length===p.length){let w={},v,b,C,$;if(d.callArgs!=null&&(w=d.callArgs),x.length===1){const[S,T]=x[0];w.mask==null&&(w.mask=T),C=xt(f.call(S,w)),$=xt(f.computeMask(S,T)),v=[S],b=[T]}else v=x.map(S=>S[0]),b=x.map(S=>S[1]),w.mask==null&&(w.mask=b),C=xt(f.call(v,w)),$=xt(f.computeMask(v,b));if(f.activityRegularizer)throw new qe("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let S=0;S<g.length;++S){const T=g[S],E=C[S],A=$[S];s[T.id]=[E,A]}}}}const o=[],i=[],a=[];for(const l of this.outputs){Fr(l.id in s,`Could not compute output ${l.name} : ${l.id}`);const[u,d]=s[l.id];a.push(u.shape),o.push(u),i.push(d)}return[o,i,a]}buildNodeConversionMap(e){const t={};let s;for(const r of this.layers){s=r instanceof hr?1:0;for(let o=0;o<r.inboundNodes.length;o++){const i=hr.nodeKey(r,o);this.containerNodes.has(i)&&(t[i]=s,s+=1)}}return t}getLayer(e,t){if(t!=null)return this.findLayer(t);if(e==null)throw new U("Provide either a layer name or layer index");if(typeof e=="number")return this.findLayer(e);for(const s of this.layers)if(s.name===e)return s;throw new U(`No such layer: ${e}`)}findLayer(e){if(this.layers.length<=e)throw new U(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}calculateLosses(){return se(()=>{const e=[];for(const t of this.layers)for(let s=0;s<t.inboundNodes.length;++s){const r=hr.nodeKey(t,s);this.containerNodes.has(r)&&e.push(...t.calculateLosses())}return e})}getConfig(){const e={name:this.name},t=this.buildNodeConversionMap(this.layers),s=[];for(const i of this.layers){const a=i.getClassName(),l=i.getConfig(),u=[];for(let f=0;f<i.inboundNodes.length;f++){const p=i.inboundNodes[f],g=hr.nodeKey(i,f);let x={};if(this.containerNodes.has(g)){if(p.callArgs)try{JSON.stringify(p.callArgs),x=p.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${p.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),x={}}if(p.inboundLayers.length>0){const w=[];for(let v=0;v<p.inboundLayers.length;v++){const b=p.inboundLayers[v],C=p.nodeIndices[v],$=p.tensorIndices[v],S=hr.nodeKey(b,C);let T=t[S];T==null&&(T=0),w.push([b.name,T,$,x])}u.push(w)}}}const d={};d.name=i.name,d.className=a,d.config=l,d.inboundNodes=u,s.push(d)}e.layers=s;const r=[];for(let i=0;i<this.inputLayers.length;i++){const a=this.inputLayers[i],l=this.inputLayersNodeIndices[i],u=hr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.inputLayersTensorIndices[i];r.push([a.name,d,f])}e.inputLayers=r;const o=[];for(let i=0;i<this.outputLayers.length;i++){const a=this.outputLayers[i],l=this.outputLayersNodeIndices[i],u=hr.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let d=t[u];d==null&&(d=0);const f=this.outputLayersTensorIndices[i];o.push([a.name,d,f])}return e.outputLayers=o,e}static fromConfig(e,t,s={},r=!1){const o={},i={};function a(v,b){v.name in i?i[v.name].push(b):i[v.name]=[b]}function l(v,b){const C=[];let $;for(const S of b){const T=S[0],E=S[1],A=S[2];if($=S[3]==null?{}:S[3],!(T in o)){a(v,b);return}const F=o[T];if(F.inboundNodes.length<=E){a(v,b);return}const D=F.inboundNodes[E];C.push(D.outputTensors[A])}C.length>0&&v.apply(ts(C),$)}function u(v){const b=v.name,C=Wr(v,t.customObjects!=null?t.customObjects:{});C.setFastWeightInitDuringBuild(r),o[b]=C,v.inboundNodes.forEach(S=>{if(!(S instanceof Array))throw new U(`Corrupted configuration, expected array for nodeData: ${S}`);a(C,S)})}const d=t.name,f=t.layers;for(const v of f)u(v);for(;!HG(i);)for(const v of f){const b=o[v.name];if(b.name in i){const C=i[b.name];delete i[b.name];for(const $ of C)l(b,$)}}const p=[],g=[],x=t.inputLayers;for(const v of x){const b=v[0],C=v[1],$=v[2];Fr(b in o);const T=o[b].inboundNodes[C].outputTensors;p.push(T[$])}const w=t.outputLayers;for(const v of w){const b=v[0],C=v[1],$=v[2];Fr(b in o);const T=o[b].inboundNodes[C].outputTensors;g.push(T[$])}return new e({inputs:p,outputs:g,name:d})}get stateful(){if(this._stateful)throw new U("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const e of this.layers)if(e.stateful)return!0;return!1}resetStates(){se(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function l6(n,e,t){const s=e.length;if(n==null||Array.isArray(n)&&n.length===0)return e.map(r=>null);if(s===1)return Array.isArray(n)&&n.length===1?n:typeof n=="object"&&e[0]in n?[n[e[0]]]:[n];if(Array.isArray(n)){if(n.length!==s)throw new Error(`Provided ${t} is an array of ${n.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return n}else if(typeof n=="object"&&Object.keys(n).length>0&&typeof n[Object.keys(n)[0]]=="object"){const r=[];return e.forEach(o=>{o in n?r.push(n[o]):r.push(null)}),r}else throw new Error(`The model has multiple (${s}) outputs, so ${t} must be either an array with ${s} elements or an object with ${e} keys. Provided ${t} not understood: ${JSON.stringify(n)}`)}function JT(n,e){return l6(n,e,"classWeight")}async function eN(n,e,t,s){if(t!=null){const r=se(()=>{if(n.shape.length===1)return Hi(n);if(n.shape.length===2){if(n.shape[1]>1)return Kc(n,1);if(n.shape[1]===1)return J(n,[n.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${n.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${n.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),o=Array.from(await r.data());Ye(r);const i=[];return o.forEach(a=>{if(t[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(t[a])}),ms(i,"float32")}else return null}function c6(n,e){return j(n,e)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const u6=32;function tN(n,e){let t,s;const r=e;t=r.xs,s=r.ys,O(t!=null&&s!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);const o=kS("input",n.inputNames,t),i=kS("output",n.outputNames,s),a=o[0].shape[0];O(o.length===n.inputs.length,()=>`LayersModel has ${n.inputs.length} inputs, but the dataset provides ${o.length} inputs.  (Expected input keys: ${JSON.stringify(n.inputNames)})`),O(i.length===n.outputs.length,()=>`LayersModel has ${n.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(n.outputNames)})`);for(let l=0;l<o.length;l++)O(o[l].shape[0]===a,()=>`Batch size mismatch: input ${n.inputNames[l]} has ${o[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);for(let l=0;l<i.length;l++)O(i[l].shape[0]===a,()=>`Batch size mismatch: output ${n.outputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${n.inputNames[0]}.`);return{xs:o,ys:i}}function kS(n,e,t){if(t instanceof rn)return[t];if(Array.isArray(t))return O(t.length===e.length,()=>`Received an array of ${t.length} Tensors, but expected ${e.length} to match the ${n} keys ${e}.`),t;{const s=[];for(const r of e){if(t[r]==null)throw new U(`The feature data generated by the dataset lacks the required ${n} key '${r}'.`);s.push(t[r])}return s}}function h6(n){if(n.length===3)throw new qe("Validation with sample weights is not implemented yet.");return{xs:n[0],ys:n[1]}}async function d6(n,e,t){const s=t.batchesPerEpoch!=null;if(O(n.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),O(t!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),O(t.epochs!=null&&t.epochs>0&&Number.isInteger(t.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${t.epochs}`),O(!s||t.batchesPerEpoch>0&&Number.isInteger(t.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${t.batchesPerEpoch}`),O(t.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),n.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");n.isTraining=!0;try{const r=t.validationData!=null;let o,i;if(r)if(SS(t.validationData))O(t.validationBatches==null||t.validationBatches>0&&Number.isInteger(t.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${t.validationBatches}`);else{const v=h6(t.validationData);o=v.xs,i=v.ys}const a=n.makeTrainFunction(),l=n.getDedupedMetricsNames();let u;r?u=l.slice().concat(l.map(v=>"val_"+v)):u=l.slice();const d=GT(t.callbacks,t.yieldEvery),f=t.verbose==null?1:t.verbose,{callbackList:p,history:g}=HT(d,f,t.epochs,null,null,f6(e,t),null,r,u);p.setModel(n),n.history=g,await p.onTrainBegin(),n.stopTraining_=!1;let x=t.initialEpoch==null?0:t.initialEpoch,w=await e.iterator();for(;x<t.epochs;){const v={};await p.onEpochBegin(x);let b=0,C=0;for(s||(w=await e.iterator());!s||b<t.batchesPerEpoch;){const $=await w.next();if(s&&$.done){console.warn(`You provided \`batchesPerEpoch\` as ${t.batchesPerEpoch}, but your dataset iterator ran out of data after ${b} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${t.batchesPerEpoch*t.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if($.value!=null){const{xs:S,ys:T}=tN(n,$.value),E={};E.batch=C,E.size=S[0].shape[0],await p.onBatchBegin(C,E);const A=[];if(t.classWeight!=null){const _=JT(t.classWeight,n.outputNames);for(let N=0;N<_.length;++N)A.push(await eN(T[N],null,_[N]))}const F=S.concat(T).concat(A),D=a(F);Ye(F);for(let _=0;_<l.length;++_){const N=l[_],L=D[_];E[N]=L,Pr(L)}await p.onBatchEnd(C,E),UT(E),C++,b++}if(s?b>=t.batchesPerEpoch:$.done){if(r){let S;SS(t.validationData)?S=xt(await n.evaluateDataset(t.validationData,{batches:t.validationBatches})):S=xt(n.evaluate(o,i,{batchSize:t.validationBatchSize==null?u6:t.validationBatchSize,verbose:0}));for(let T=0;T<n.metricsNames.length;++T)v[`val_${n.metricsNames[T]}`]=S[T]}break}if(n.stopTraining_)break}if(await p.onEpochEnd(x,v),x++,n.stopTraining_)break}return await p.onTrainEnd(),await n.history.syncData(),n.history}finally{n.isTraining=!1}}function f6(n,e){let t=null;return e.batchesPerEpoch!=null?t=e.batchesPerEpoch:Number.isFinite(n.size)&&(t=n.size),t}function SS(n){return typeof n.iterator=="function"}function p6(n){return typeof n.next=="function"}async function m6(n,e,t){t=t||{};const s=t.batches!=null,r=n.testFunction;let o=[];if(t.verbose>0)throw new qe("Verbose mode is not implemented yet.");O(!s||t.batches>0&&Number.isInteger(t.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(t.batches)}`);const i=p6(e)?e:await e.iterator();let a=0,l=0;for(;!s||l<t.batches;){const u=await i.next();if(o=se(()=>{if(u.value){const{xs:d,ys:f}=tN(n,u.value),p=d.concat(f),g=se(()=>r(p));if(Ye(p),l===0)for(let w=0;w<g.length;++w)o.push(pt(0));const x=p[0].shape[0];for(let w=0;w<g.length;++w){const v=g[w],b=o[w];o[w]=se(()=>ye(o[w],j(x,v))),l>0&&Ye(b)}Ye(g),a+=x,++l}return o}),u.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${t.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<o.length;++u){const d=o[u];o[u]=Be(o[u],a),Ye(d)}return ts(o)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ex(n){O(n>0&&Number.isInteger(n),()=>`batchSize is required to be a positive integer, but got ${n}`)}function Nc(n,e,t){return n==null?[null]:Array.isArray(n)?n.map(s=>Xi(s,e,t-e)):Xi(n,e,t-e)}function Jx(n,e){return se(()=>n==null?null:Array.isArray(n)?n.map(t=>Jx(t,e)):ET(n,e.dtype==="int32"?e:Ie(e,"int32")))}function tx(n,e){const t=[];let s=0,r=null;for(;s<n;)r=s+e,r>=n&&(r=n),t.push([s,r]),s=r;return t}function nN(n){const e=[];n instanceof rn&&(n=[n]);for(let t=0;t<n.length;++t){const s=n[t];if(s.rank===1)e.push(xh(s,1));else{if(s.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function ur(n,e){if(n==null)return;const t=[];if(e instanceof rn)t.push(e.id);else if(Array.isArray(e))e.forEach(r=>t.push(r.id));else if(e!=null)for(const r in e){const o=e[r];t.push(o.id)}const s=[];if(n instanceof rn)t.indexOf(n.id)===-1&&s.push(n);else if(Array.isArray(n))n.forEach(r=>{t.indexOf(r.id)===-1&&s.push(r)});else if(n!=null)for(const r in n){const o=n[r];t.indexOf(o.id)===-1&&s.push(o)}s.forEach(r=>{r.isDisposed||r.dispose()})}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function g6(n){return n instanceof rn}function ey(n){return Array.isArray(n)}function IS(n){return!g6(n)&&!ey(n)}function $S(n,e,t,s=!0,r=""){if(e==null||e.length===0){if(n!=null){let i=!1;if(ey(n)&&n.length>0)i=!0;else if(IS(n)){for(const a in n)if(n.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new U(`Error when checking model ${r} expected no data, but got ${n}`)}return[]}if(n==null)return e.map(i=>null);let o;if(IS(n)){n=n,o=[];for(const i of e){if(n[i]==null)throw new U(`No data provided for "${i}". Need data for each key in: ${e}`);o.push(n[i])}}else if(ey(n)){if(n=n,n.length!==e.length)throw new U(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${n}`);o=n}else{if(n=n,e.length>1)throw new U(`The model ${r} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${n.shape}`);o=[n]}if(o=nN(o),t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new U(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<t[i].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[i][l];if(d!=null&&d>=0&&u!==d)throw new U(`${r} expected a batch of elements where each example has shape [${t[i].slice(1,t[i].length)}] (i.e.,tensor shape [*,${t[i].slice(1,t[i].length)}]) but the ${r} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return o}function x6(n,e,t){const s=qo(n.map(o=>o.shape[0]));s.sort();const r=qo(e.map(o=>o.shape[0]));if(r.sort(),s.length>1)throw new U(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(n.map(o=>o.shape))}`);if(r.length>1)throw new U(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(o=>o.shape))}`);if(s.length>0&&r.length>0&&!mt(s,r))throw new U(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${r[0]} target sample(s).`)}function y6(n,e,t){const s=[Tm,Nm,eu];for(let r=0;r<n.length;++r){const o=n[r],i=e[r],a=t[r];if(i!=null){if(i===eu&&o.shape[o.shape.length-1]===1)throw new U(`You are passing a target array of shape ${o.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(s.indexOf(i)!==-1){const l=o.shape.slice(1),u=a.slice(1);for(let d=0;d<l.length;++d){const f=l[d],p=u[d];if(p!=null&&f!==p)throw new U(`A target Tensor with shape ${o.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function TS(n,e,t,s=!0,r=""){let o;if(Array.isArray(n)){if(n.length!==e.length)throw new U(`Error when checking model ${r}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${n.length} Tensors(s).`);o=n}else{if(e.length>1)throw new U(`The model expects ${e.length} ${r} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(n.shape)}.`);o=[n]}if(t!=null)for(let i=0;i<e.length;++i){if(t[i]==null)continue;const a=o[i];if(a.shape.length!==t[i].length)throw new U(`Error when checking ${r}: expected ${e[i]} to have ${t[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<t[i].length;++l){if(l===0&&!s)continue;const u=a.shape[l],d=t[i][l];if(d!=null&&d!==u)throw new U(`Error when checking ${r}: expected ${e[i]} to have shape ${JSON.stringify(t[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function w6(n,e){if(n==null||Array.isArray(n)&&n.length===0)return e.map(s=>[]);let t;if(typeof n=="string"||typeof n=="function")t=[n];else if(Array.isArray(n)||typeof n=="object")t=n;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${n}`);if(Array.isArray(t))return e.map(s=>t);{const s=[];for(const r of e){let o=t.hasOwnProperty(r)?t[r]:[];Array.isArray(o)||(o=[o]),s.push(o)}return s}}const v6="layers-model";class il extends hr{constructor(e){super(e),this.isTraining=!1}summary(e,t,s=console.log){if(!this.built)throw new U("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");n6(this,e,t,s)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=t6(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof hi))throw new U("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let t=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(const i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new U(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(const i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),t.push(J0(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new U(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);t=e.loss.map(a=>J0(a))}else{const i=J0(e.loss);this.outputs.forEach(a=>{t.push(i)})}this.lossFunctions=t,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){const a=this.internalOutputShapes[i],l=this.outputNames[i];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}const s=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ji("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});const r=w6(e.metrics,this.outputNames),o=(i,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,i])};ji("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(s.indexOf(i)!==-1)continue;const a=r[i];(u=>{const d="";let f,p,g;for(const x of u){if(typeof x=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(x)!==-1){const v=this.internalOutputShapes[i];v[v.length-1]===1||this.lossFunctions[i]===Nm?["accuracy","acc"].indexOf(x)!==-1?p=XT:["crossentropy","ce"].indexOf(x)!==-1&&(p=H5):this.lossFunctions[i]===Gf?["accuracy","acc"].indexOf(x)!==-1?p=j5:["crossentropy","ce"].indexOf(x)!==-1&&(p=YT):["accuracy","acc"].indexOf(x)!==-1?p=KT:["crossentropy","ce"].indexOf(x)!==-1&&(p=qT);let b;["accuracy","acc"].indexOf(x)!==-1?b="acc":["crossentropy","ce"].indexOf(x)!==-1&&(b="ce"),g=p,f=d+b}else g=e6(x),f=d+Hd(x);let w;ji(f,()=>{w=g}),o(i,f,w)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,t,s={}){const r=s.batchSize==null?32:s.batchSize;ex(r);const i=this.standardizeUserDataXY(e,t,!0,r);try{const a=i[0].concat(i[1]);this.makeTestFunction();const l=this.testFunction,u=this.testLoop(l,a,r,s.verbose,s.steps);return ts(u)}finally{ur(i[0],e),ur(i[1],t)}}async evaluateDataset(e,t){return this.makeTestFunction(),m6(this,e,t)}checkNumSamples(e,t,s,r="steps"){let o;if(s!=null){if(o=null,t!=null)throw new U(`If ${r} is set, batchSize must be null or undefined.Got batchSize = ${t}`)}else if(e!=null)Array.isArray(e)?o=e[0].shape[0]:o=e.shape[0];else throw new U(`Either the input data should have a defined shape, or ${r} shoud be specified.`);return o}execute(e,t){if(Array.isArray(t)&&t.length===0)throw new U("`outputs` is an empty Array, which is not allowed.");const s=Array.isArray(t),r=s?t:[t],o=this.retrieveSymbolicTensors(r),i=new Go;if(e instanceof rn&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new U(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)i.add(this.inputs[l],e[l])}else for(const l of this.inputs){const u=e[l.name];if(u==null)throw new U(`No value is provided for the model's input ${l.name}`);i.add(l,u)}const a=Pc(o,i);return s?a:a[0]}retrieveSymbolicTensors(e){const t=ia(null,e.length);let s=e.length;for(const r of this.layers){const o=Array.isArray(r.output)?r.output:[r.output],i=o.map(a=>a.name);for(let a=0;a<e.length;++a){const l=i.indexOf(e[a]);if(l!==-1&&(t[a]=o[l],s--),s===0)break}if(s===0)break}if(s>0){const r=[];throw t.forEach((o,i)=>{o==null&&r.push(e[i])}),new U(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(r)}`)}return t}predictLoop(e,t=32,s=!1){return se(()=>{const r=this.checkNumSamples(e);if(s)throw new qe("Verbose predictLoop() is not implemented yet.");const o=tx(r,t),i=this.outputs.map(a=>[]);for(let a=0;a<o.length;++a)se(()=>{const u=o[a][0],d=o[a][1],f=Nc(e,u,d),p=[];if(Array.isArray(f))for(let x=0;x<f.length;++x)p.push({key:this.inputs[x],value:f[x]});else p.push({key:this.inputs[0],value:f});const g=new Go(p);return Pc(this.outputs,g)}).forEach((u,d)=>i[d].push(u));return ts(i.map(a=>ns(a,0)))})}predict(e,t={}){const s=nN(e);TS(s,this.inputNames,this.feedInputShapes,!1);try{const r=t.batchSize==null?32:t.batchSize;return ex(r),this.predictLoop(s,r)}finally{ur(s,e)}}predictOnBatch(e){TS(e,this.inputNames,this.feedInputShapes,!0);const t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}standardizeUserDataXY(e,t,s=!0,r){if(this.optimizer_==null)throw new js("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const o=[];for(let i=0;i<this.feedOutputShapes.length;++i){const a=this.feedOutputShapes[i];this.feedLossFns[i]===Gf?o.push(a.slice(0,a.length-1).concat([1])):o.push(a)}if(e=$S(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=$S(t,this.feedOutputNames,o,!1,"target"),x6(e,t),y6(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&r!=null&&r>0&&e[0].shape[0]%r!==0)throw new U(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${r}. Found: ${e[0].shape[0]} sample(s).`);return[e,t]}async standardizeUserData(e,t,s,r,o=!0,i){const[a,l]=this.standardizeUserDataXY(e,t,o,i);if(s!=null)throw new Error("sample weight is not supported yet.");let u=null;if(r!=null){const d=JT(r,this.outputNames);u=[];for(let f=0;f<d.length;++f)u.push(await eN(l[f],null,d[f]))}return[a,l,u]}testLoop(e,t,s,r=0,o){return se(()=>{const i=this.checkNumSamples(t,s,o,"steps"),a=[];if(r>0)throw new qe("Verbose mode is not implemented yet.");if(o!=null)throw new qe("steps mode in testLoop() is not implemented yet");{const l=tx(i,s),u=ms(vr(0,i));for(let d=0;d<l.length;++d){const f=l[d][0],p=l[d][1],g=Xi(u,f,p-f),x=Jx(t,g),w=e(x);if(d===0)for(let v=0;v<w.length;++v)a.push(pt(0));for(let v=0;v<w.length;++v){const b=w[v];a[v]=ye(a[v],j(p-f,b))}}for(let d=0;d<a.length;++d)a[d]=Be(a[d],i)}return a})}getDedupedMetricsNames(){const e=this.metricsNames,t=[];for(let s=0;s<e.length;++s){const r=e[s];let o=r;if(hS(e,r)>1){const i=hS(e.slice(0,s),r);o+=`_${i}`}t.push(o)}return t}makeTrainFunction(){return e=>{const t=[],s=e.slice(0,this.inputs.length),r=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),o=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{const f=[];for(let w=0;w<this.inputs.length;++w)f.push({key:this.inputs[w],value:s[w]});const p=new Go(f),g=Pc(this.outputs,p,{training:!0});let x;for(let w=0;w<this.lossFunctions.length;++w){const v=this.lossFunctions[w];let b=v(r[w],g[w]);o[w]!=null&&(b=c6(b,o[w]));const C=Jt(b);t.push(C),w===0?x=b:x=ye(x,b)}for(let w=0;w<this.metricsTensors.length;++w){let v;if(this.outputs.length>1&&w<this.outputs.length)v=t[w];else{const b=this.metricsTensors[w][0],C=this.metricsTensors[w][1];v=Jt(b(r[C],g[C]))}Pr(v),i.push(v)}return x=Jt(x),this.calculateLosses().forEach(w=>{x=ye(x,w)}),x},l=this.collectedTrainableWeights.map(f=>f.read());return[this.optimizer_.minimize(a,!0,l)].concat(i)}}makeTestFunction(){this.testFunction=e=>se(()=>{const t=[];let s;const r=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let u=0;u<this.inputs.length;++u)i.push({key:this.inputs[u],value:r[u]});const a=new Go(i),l=Pc(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){const d=this.lossFunctions[u],f=Jt(d(o[u],l[u]));u===0?s=f:s=ye(s,f),t.push(s)}for(let u=0;u<this.metricsTensors.length;++u){const d=this.metricsTensors[u][0],f=this.metricsTensors[u][1],p=Jt(d(o[f],l[f]));t.push(p)}return t})}async fit(e,t,s={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let r,o,i,a,l,u,d,f,p;try{const g=s.batchSize==null?32:s.batchSize;ex(g);const w=await this.standardizeUserData(e,t,s.sampleWeight,s.classWeight,!1,g);r=w[0],o=w[1],p=w[2];let v=!1,b;if(s.validationData!=null&&s.validationData.length>0){if(v=!0,s.validationData.length===2)l=s.validationData[0],u=s.validationData[1];else throw s.validationData.length===3?new qe("validationData including sample weights is not supported yet."):new U(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);const _=await this.standardizeUserData(l,u,null,null,!0,g);d=_[0],f=_[1],b=d.concat(f)}else if(s.validationSplit!=null&&s.validationSplit>0&&s.validationSplit<1){v=!0;const D=Math.floor(r[0].shape[0]*(1-s.validationSplit)),_=r[0].shape[0];d=Nc(r,D,_),i=r,r=Nc(r,0,D),f=Nc(o,D,_),a=o,o=Nc(o,0,D),b=d.concat(f)}else s.validationSteps!=null&&(v=!0);const C=r.concat(o).concat(p);this.checkTrainableWeightsConsistency();const $=this.makeTrainFunction(),S=this.getDedupedMetricsNames();let T,E;v?(this.makeTestFunction(),T=this.testFunction,E=S.slice().concat(S.map(D=>"val_"+D))):(T=null,b=[],E=S.slice());const A=GT(s.callbacks,s.yieldEvery);return await this.fitLoop($,C,S,g,s.epochs,s.verbose,A,T,b,s.shuffle,E,s.initialEpoch,null,null)}finally{this.isTraining=!1,ur(r,e),ur(o,t),ur(i,e),ur(a,t),ur(d,l),ur(f,u),p!=null&&Ye(p)}}async fitLoop(e,t,s,r,o,i,a,l,u,d,f,p,g,x){r==null&&(r=32),o==null&&(o=1),d==null&&(d=!0),p==null&&(p=0);let w=!1;if(l!=null&&u!=null&&(w=!0),x!=null&&(w=!0,g==null))throw new U("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const v=this.checkNumSamples(t,r,g,"steps_per_epoch");let b;v!=null&&(b=vr(0,v)),i==null&&(i=1);const{callbackList:C,history:$}=HT(a,i,o,p,v,g,r,w,f);C.setModel(this),this.history=$,await C.onTrainBegin(),this.stopTraining_=!1;for(let S=p;S<o;++S){await C.onEpochBegin(S);const T={};if(g!=null)throw new qe("stepsPerEpoch mode is not implemented yet.");{if(d==="batch")throw new qe("batch shuffling is not implemneted yet");d&&B3(b);const E=ms(b),A=tx(v,r);for(let F=0;F<A.length;++F){const D={};if(await C.onBatchBegin(F,D),se(()=>{const _=A[F][0],N=A[F][1],L=Xi(E,_,N-_);D.batch=F,D.size=N-_;const G=Jx(t,L),Q=e(G);for(let K=0;K<s.length;++K){const Z=s[K],te=Q[K];D[Z]=te,Pr(te)}if(F===A.length-1&&w){const K=this.testLoop(l,u,r);for(let Z=0;Z<s.length;++Z){const te=s[Z],B=K[Z];Pr(B),T["val_"+te]=B}}}),await C.onBatchEnd(F,D),UT(D),this.stopTraining_)break}E.dispose()}if(await C.onEpochEnd(S,T),this.stopTraining_)break}return await C.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,t){return d6(this,e,t)}async trainOnBatch(e,t){const s=await this.standardizeUserData(e,t),r=s[0],o=s[1],a=this.makeTrainFunction()(r.concat(o)),l=[];for(const u of a){const d=await u.data();l.push(d[0])}return Ye(a),ur(s[0],e),ur(s[1],t),ts(l)}getNamedWeights(e){const t=[],s=e!=null&&e.trainableOnly,r=s?this.trainableWeights:this.weights,o=this.getWeights(s);for(let i=0;i<r.length;++i)s&&!r[i].trainable||t.push({name:r[i].originalName,tensor:o[i]});return t}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){const e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){const t=Mk().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-Mk().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=lo(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if(typeof t!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(t=>lo(t))}else{const t=Object.keys(this.loss);e={};const s=this.loss;for(const r of t)if(typeof s[r]=="string")e[r]=lo(s[r]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[lo(Hd(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>lo(Hd(e)));{const e={};for(const t in this.metrics)e[t]=lo(Hd(this.metrics[t]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");const t=Kf(e.optimizer_config),s=Wr(t);let r;if(typeof e.loss=="string")r=Mi(e.loss);else if(Array.isArray(e.loss))r=e.loss.map(i=>Mi(i));else if(e.loss!=null){r={};for(const i in e.loss)r[i]=Mi(e.loss[i])}let o;if(Array.isArray(e.metrics))o=e.metrics.map(i=>Mi(i));else if(e.metrics!=null){o={};for(const i in e.metrics)o[i]=Mi(e.metrics[i])}this.compile({loss:r,metrics:o,optimizer:s})}async save(e,t){if(typeof e=="string"){const u=HM(e);if(u.length===0)throw new U(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new U(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new U("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const s=await Pk(this.getNamedWeights(t)),a={modelTopology:this.toJSON(null,!1),format:v6,generatedBy:`TensorFlow.js tfjs-layers v${ZT}`,convertedBy:null};if((t==null?!1:t.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();const u="optimizer",{data:d,specs:f}=await Pk(await this.optimizer.getWeights(),u);s.specs.push(...f),s.data=MM([s.data,d])}return this.userDefinedMetadata!=null&&(CS(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=s.data,a.weightSpecs=s.specs,e.save(a)}setUserDefinedMetadata(e){CS(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}}il.className="Model";fe(il);class sN extends il{}sN.className="Functional";fe(sN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */async function b6(n,e){if(e==null&&(e={}),typeof n=="string"){const t=jM(n,e);if(t.length===0)t.push(NW(n,e));else if(t.length>1)throw new U(`Found more than one (${t.length}) load handlers for URL '${n}'`);n=t[0]}return C6(n,void 0,e)}async function C6(n,e,t){if(t==null&&(t={}),n.load==null)throw new U("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");const s=await n.load();let r=s.modelTopology;r.model_config!=null&&(r=r.model_config);const o=t.strict==null?!0:t.strict,i=s.weightData!=null&&s.weightSpecs!=null&&o,a=Wr(Kf(r),e,i),l=s.trainingConfig;if(l!=null&&a.loadTrainingConfig(l),s.userDefinedMetadata!=null&&a.setUserDefinedMetadata(s.userDefinedMetadata),s.weightData!=null){if(s.weightSpecs==null)throw new U("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");const{modelWeights:u,optimizerWeights:d}=k6(s.weightData,s.weightSpecs);a.loadWeights(u,o),a.optimizer!=null&&d.length>0&&await a.optimizer.setWeights(d),Ye(u),Ye(d.map(f=>f.tensor))}return a}function k6(n,e){const t=AM(n,e),s={},r=[];return e.forEach(o=>{o.group==="optimizer"?r.push({name:o.name,tensor:t[o.name]}):s[o.name]=t[o.name]}),{modelWeights:s,optimizerWeights:r}}class tu extends il{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:Sm("sequential_"),e.layers!=null)for(const t of e.layers)this.add(t)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(s=>s<0))throw new U(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){const t=e instanceof tu||e instanceof il;let s;if(t){if(s=e,s.outputs.length!==1)throw new U("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(s.inputs.length!==1)throw new U("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new U("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const r=C5({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(r)}if(t)this.outputs=s.outputs,this.inputs=s.inputs;else{if(e.inboundNodes.length!==1)throw new U(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new U("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=PT(this.outputs[0])}this.inboundNodes=[],new $m({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:ia(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(r=>r.shape),outputShapes:this.outputs[0].shape})}else{const r=e.apply(this.outputs[0]);if(Array.isArray(r))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[r],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,t){return this.model==null&&this.build(),this.model.call(e,t)}build(e){if(ct(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new il({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,t,s=console.log){this.built||this.build(),super.summary(e,t,s)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,t,s={}){if(!this.built)throw new js("The model needs to be compiled before being used.");return this.model.evaluate(e,t,s)}async evaluateDataset(e,t){if(!this.built)throw new js("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,t)}predict(e,t={}){return this.model==null&&this.build(),this.model.predict(e,t)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,t,s={}){if(!this.built)throw new js("The model needs to be compiled before being used.");return this.model.fit(e,t,s)}async fitDataset(e,t){if(!this.built)throw new js("The model needs to be compiled before being used.");return this.model.fitDataset(e,t)}async trainOnBatch(e,t){return this.model.trainOnBatch(e,t)}static fromConfig(e,t,s={},r=!1){let o,i={};if(t instanceof Array){if(t[0].className==null||t[0].className==="Merge")throw new U("Legacy serialization format not supported yet.");o=t}else O(t.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),o=t.layers,delete t.layers,i=t;const a=new e(i);if(!(a instanceof tu))throw new qe(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(const l of o){const d=Wr(l,void 0,r);r&&d.setFastWeightInitDuringBuild(!0),a.add(d)}return a}set stopTraining(e){if(this.model==null)throw new U("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new U("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const e=[];for(const t of this.layers){const s={};s.className=t.getClassName(),s.config=t.getConfig(),e.push(s)}return{name:this.name,layers:e}}}tu.className="Sequential";fe(tu);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */let Mn=class extends _l{getConfig(){return{}}};class rN extends Mn{apply(e,t=1){return i5(e,t)}}rN.className="elu";fe(rN);class oN extends Mn{apply(e){return v$(e)}}oN.className="selu";fe(oN);class iN extends Mn{apply(e){return fa(e)}}iN.className="relu";fe(iN);class aN extends Mn{apply(e){return se(()=>Qc(6,fa(e)))}}aN.className="relu6";fe(aN);class lN extends Mn{apply(e){return e}}lN.className="linear";fe(lN);class cN extends Mn{apply(e){return Rl(e)}}cN.className="sigmoid";fe(cN);class uN extends Mn{apply(e){return l5(e)}}uN.className="hardSigmoid";fe(uN);class hN extends Mn{apply(e){return ch(e)}}hN.className="softplus";fe(hN);class dN extends Mn{apply(e){return a5(e)}}dN.className="softsign";fe(dN);class fN extends Mn{apply(e){return pm(e)}}fN.className="tanh";fe(fN);let Mw=class extends Mn{apply(e,t=-1){return L1(e,t)}};Mw.className="softmax";fe(Mw);class pN extends Mn{apply(e,t=-1){return d$(e,t)}}pN.className="logSoftmax";fe(pN);class mN extends Mn{apply(e){return se(()=>se(()=>{const t=Math.sqrt(2),s=j(.5,ye(1,a$(Be(e,t))));return j(e,s)}))}}mN.className="gelu";fe(mN);class gN extends Mn{apply(e){return se(()=>j(.5,j(e,ye(1,pm(j(On(Be(2,Math.PI)),ye(e,j(.044715,sa(e,3)))))))))}}gN.className="gelu_new";fe(gN);class xN extends Mn{apply(e){return se(()=>j(e,pm(ch(e))))}}xN.className="mish";fe(xN);class yN extends Mn{apply(e,t=1){return se(()=>j(Rl(j(e,t)),e))}}yN.className="swish";fe(yN);function Jo(n){return n.getClassName()}function nx(n,e={}){return gh(n,Hs.getMap().classNameMap,e,"activation")}function ei(n){if(n==null){const e={};return e.className="linear",e.config={},nx(e)}if(typeof n=="string"){const e={};return e.className=n,e.config={},nx(e)}else return n instanceof Mn?n:nx(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function S6(n){if(n!=null&&typeof n!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${n}`)}class wN extends _l{}class vN extends wN{constructor(e){super(),S6(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return se(()=>{let t=gn([1]);return this.hasL1&&(t=ye(t,Me(j(this.l1,Un(e))))),this.hasL2&&(t=ye(t,Me(j(this.l2,yh(e))))),J(t,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,t){return new e({l1:t.l1,l2:t.l2})}}vN.className="L1L2";fe(vN);const NS={l1l2:"L1L2"};function St(n){return kw(n)}function ES(n,e={}){return gh(n,Hs.getMap().classNameMap,e,"regularizer")}function Mt(n){if(n==null)return null;if(typeof n=="string"){const t={className:n in NS?NS[n]:n,config:{}};return ES(t)}else return n instanceof wN?n:ES(n)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class bN extends et{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,t){e=He(e);let s=fa(e);return this.maxValue!=null&&(s=Rs(s,0,this.maxValue)),s}computeOutputShape(e){return e}getConfig(){const e={maxValue:this.maxValue},t=super.getConfig();return Object.assign(e,t),e}}bN.className="ReLU";fe(bN);class CN extends et{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=He(e);return E1(s,this.alpha)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}}CN.className="LeakyReLU";fe(CN);class kN extends et{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=zt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=Mt(e.alphaRegularizer),this.alphaConstraint=cn(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new U(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=ct(e);const t=e.slice(1);if(this.sharedAxes!=null)for(const r of this.sharedAxes)t[r-1]=1;this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const s={};if(this.sharedAxes!=null)for(let r=1;r<e.length;++r)s[r]=e[r];this.inputSpec=[new an({ndim:e.length,axes:s})],this.built=!0}call(e,t){return e=He(e),O1(e,this.alpha.read())}getConfig(){const e={alphaInitializer:Lt(this.alphaInitializer),alphaRegularizer:St(this.alphaRegularizer),alphaConstraint:ln(this.alphaConstraint),sharedAxes:this.sharedAxes},t=super.getConfig();return Object.assign(e,t),e}}kN.className="PReLU";fe(kN);let SN=class extends et{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new qe(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,t){const s=He(e);return xm(s)}computeOutputShape(e){return e}getConfig(){const e={alpha:this.alpha},t=super.getConfig();return Object.assign(e,t),e}};SN.className="ELU";fe(SN);class IN extends et{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,t){const s=He(e);return j(s,Ie(As(s,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){const e={theta:this.theta},t=super.getConfig();return Object.assign(e,t),e}}IN.className="ThresholdedReLU";fe(IN);class $N extends et{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new Mw().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,t){return se(()=>{let s=He(e);const r=t.mask;if(r!=null){const o=j(Ge(ui(s.shape),Ie(r,s.dtype)),pt(-1e9));s=ye(s,o)}return this.axis instanceof Array?this.axis.length>1?Hr(Ge(s,f$(s,this.axis,!0))):this.softmax(s,this.axis[0]):this.softmax(s,this.axis)})}computeOutputShape(e){return e}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}$N.className="Softmax";fe($N);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function al(n,e,t){if(typeof n=="number")return ia(n,e);if(n.length!==e)throw new U(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${n.length} elements.`);for(let s=0;s<e;++s){const r=n[s];if(!n5(r))throw new U(`The ${t} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(n)} including a non-integer number ${r}`)}return n}function wr(n,e,t,s,r=1){if(n==null)return n;const o=e+(e-1)*(r-1);let i;return t==="same"?i=n:i=n-o+1,Math.floor((i+s-1)/s)}function Or(n,e,t,s){if(n==null)return null;if(s==="valid")n=n*e+Zo([t-e,0]);else if(s==="same")n=n*e;else throw new U(`Unsupport padding mode: ${s}.`);return n}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function Pw(n,e){return se(()=>(qt(e),e==="channelsFirst"?ot(n,[0,2,3,1]):n))}function TN(n,e){return se(()=>(qt(e),e==="channelsFirst"?ot(n,[0,2,3,4,1]):n))}function I6(n,e,t,s=1,r="valid",o,i=1){return se(()=>{if(o==null&&(o=br()),qt(o),n.shape.length!==3)throw new U(`The input of a conv1dWithBias operation should be 3, but is ${n.shape.length} instead.`);if(e.shape.length!==3)throw new U(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(t!=null&&t.shape.length!==1)throw new U(`The bias for a conv1dWithBias operation should be 1, but is ${t.shape.length} instead`);if(o==="channelsFirst"&&(n=ot(n,[0,2,1])),r==="causal")throw new qe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=n$(n,e,s,r==="same"?"same":"valid","NWC",i);return t!=null&&(a=kr(a,t)),a})}function RS(n,e,t,s=[1,1],r="valid",o,i,a=null){return se(()=>{if(o==null&&(o=br()),qt(o),n.rank!==3&&n.rank!==4)throw new U(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${n.rank}.`);if(e.rank!==3&&e.rank!==4)throw new U(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${n.rank}.`);let l=Pw(n,o);if(r==="causal")throw new qe("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=IV({x:l,filter:e,strides:s,pad:r==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:t,activation:a}),o==="channelsFirst"&&(l=ot(l,[0,3,1,2])),l})}function $6(n,e,t,s=[1,1,1],r="valid",o,i){return se(()=>{if(o==null&&(o=br()),qt(o),n.rank!==4&&n.rank!==5)throw new U(`conv3dWithBias expects input to be of rank 4 or 5, but received ${n.rank}.`);if(e.rank!==4&&e.rank!==5)throw new U(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${n.rank}.`);let a=TN(n,o);if(r==="causal")throw new qe("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=CL(a,e,s,r==="same"?"same":"valid","NDHWC",i),t!=null&&(a=kr(a,t)),o==="channelsFirst"&&(a=ot(a,[0,4,1,2,3])),a})}class Em extends et{constructor(e,t){if(super(t),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",Em.verifyArgs(t),this.rank=e,xn(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new qe(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=al(t.kernelSize,e,"kernelSize"),this.strides=al(t.strides==null?1:t.strides,e,"strides"),this.padding=t.padding==null?"valid":t.padding,Ds(this.padding),this.dataFormat=t.dataFormat==null?"channelsLast":t.dataFormat,qt(this.dataFormat),this.activation=ei(t.activation),this.useBias=t.useBias==null?!0:t.useBias,this.biasInitializer=zt(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=cn(t.biasConstraint),this.biasRegularizer=Mt(t.biasRegularizer),this.activityRegularizer=Mt(t.activityRegularizer),this.dilationRate=al(t.dilationRate==null?1:t.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new U(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new U(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new U(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Fr("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!Sw(e.kernelSize,"number",1,3))throw new U(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){const e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:Jo(this.activation),useBias:this.useBias,biasInitializer:Lt(this.biasInitializer),biasRegularizer:St(this.biasRegularizer),activityRegularizer:St(this.activityRegularizer),biasConstraint:ln(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}class Fl extends Em{constructor(e,t){super(e,t),this.kernel=null,Fl.verifyArgs(t),this.filters=t.filters,xn(this.filters,"filters"),this.kernelInitializer=zt(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=cn(t.kernelConstraint),this.kernelRegularizer=Mt(t.kernelRegularizer)}build(e){e=ct(e);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new U(`The channel dimension of the input should be defined. Found ${e[t]}`);const s=e[t],r=this.kernelSize.concat([s,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[t]:s}}],this.built=!0}call(e,t){return se(()=>{e=He(e);let s;const r=this.bias==null?null:this.bias.read(),o=kT(this.activation.getClassName());if(o!=null&&this.rank===2)s=RS(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate,o);else{if(this.rank===1)s=I6(e,this.kernel.read(),r,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)s=RS(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)s=$6(e,this.kernel.read(),r,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new qe("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(s=this.activation.apply(s))}return s})}computeOutputShape(e){e=ct(e);const t=[],s=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let o=0;o<s.length;++o){const i=wr(s[o],this.kernelSize[o],this.padding,this.strides[o],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[o]);t.push(i)}let r=[e[0]];return this.dataFormat==="channelsLast"?(r=r.concat(t),r.push(this.filters)):(r.push(this.filters),r=r.concat(t)),r}getConfig(){const e={filters:this.filters,kernelInitializer:Lt(this.kernelInitializer),kernelRegularizer:St(this.kernelRegularizer),kernelConstraint:ln(this.kernelConstraint)},t=super.getConfig();return Object.assign(e,t),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new U(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}}class Ch extends Fl{constructor(e){super(2,e),Ch.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Sw(e.kernelSize,"number",1,2))throw new U(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}}Ch.className="Conv2D";fe(Ch);class kh extends Fl{constructor(e){super(3,e),kh.verifyArgs(e)}getConfig(){const e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new U(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}}kh.className="Conv3D";fe(kh);class NN extends Ch{constructor(e){if(super(e),this.inputSpec=[new an({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new U(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=ct(e),e.length!==4)throw new U("Input should have rank 4; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new U("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new an({ndim:4,axes:{[t]:s}})],this.built=!0}call(e,t){return se(()=>{let s=He(e);if(s.shape.length!==4)throw new U(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);const l=r[i],u=r[a],d=this.kernelSize[0],f=this.kernelSize[1],p=this.strides[0],g=this.strides[1],x=Or(l,p,d,this.padding),w=Or(u,g,f,this.padding),v=[o,x,w,this.filters];this.dataFormat!=="channelsLast"&&(s=ot(s,[0,2,3,1]));let b=s$(s,this.kernel.read(),v,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(b=ot(b,[0,3,1,2])),this.bias!=null&&(b=kr(b,this.bias.read(),this.dataFormat)),this.activation!=null&&(b=this.activation.apply(b)),b})}computeOutputShape(e){e=ct(e);const t=e.slice();let s,r,o;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3):(s=3,r=1,o=2);const i=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return t[s]=this.filters,t[r]=Or(t[r],l,i,this.padding),t[o]=Or(t[o],u,a,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}NN.className="Conv2DTranspose";fe(NN);class EN extends kh{constructor(e){if(super(e),this.inputSpec=[new an({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new U(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=ct(e),e.length!==5)throw new U("Input should have rank 5; Received input shape: "+JSON.stringify(e));const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null)throw new U("The channel dimension of the inputs should be defined. Found `None`.");const s=e[t],r=this.kernelSize.concat([this.filters,s]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new an({ndim:5,axes:{[t]:s}})],this.built=!0}call(e,t){return se(()=>{let s=He(e);if(s.shape.length!==5)throw new U(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${s.shape.length}`);const r=s.shape,o=r[0];let i,a,l;this.dataFormat==="channelsFirst"?(l=2,i=3,a=4):(l=1,i=2,a=3);const u=r[l],d=r[i],f=r[a],p=this.kernelSize[0],g=this.kernelSize[1],x=this.kernelSize[2],w=this.strides[0],v=this.strides[1],b=this.strides[2],C=Or(u,w,p,this.padding),$=Or(d,v,g,this.padding),S=Or(f,b,x,this.padding),T=[o,C,$,S,this.filters];this.dataFormat!=="channelsLast"&&(s=ot(s,[0,2,3,4,1]));let E=IL(s,this.kernel.read(),T,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(E=ot(E,[0,4,1,2,3])),this.bias!==null&&(E=kr(E,this.bias.read(),this.dataFormat)),this.activation!==null&&(E=this.activation.apply(E)),E})}computeOutputShape(e){e=ct(e);const t=e.slice();let s,r,o,i;this.dataFormat==="channelsFirst"?(s=1,r=2,o=3,i=4):(s=4,r=1,o=2,i=3);const a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],d=this.strides[0],f=this.strides[1],p=this.strides[2];return t[s]=this.filters,t[r]=Or(t[r],d,a,this.padding),t[o]=Or(t[o],f,l,this.padding),t[i]=Or(t[i],p,u,this.padding),t}getConfig(){const e=super.getConfig();return delete e.dilationRate,e}}EN.className="Conv3DTranspose";fe(EN);class RN extends Fl{constructor(e,t){if(super(e,t),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,t.filters==null)throw new U("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(t.kernelInitializer!=null||t.kernelRegularizer!=null||t.kernelConstraint!=null)throw new U("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(t.padding!=null&&t.padding!=="same"&&t.padding!=="valid")throw new U(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(t.padding)}`);this.depthMultiplier=t.depthMultiplier==null?1:t.depthMultiplier,this.depthwiseInitializer=zt(t.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=Mt(t.depthwiseRegularizer),this.depthwiseConstraint=cn(t.depthwiseConstraint),this.pointwiseInitializer=zt(t.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=Mt(t.pointwiseRegularizer),this.pointwiseConstraint=cn(t.pointwiseConstraint)}build(e){if(e=ct(e),e.length<this.rank+2)throw new U(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);const t=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[t]==null||e[t]<0)throw new U(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[t])}`);const s=e[t],r=this.kernelSize.concat([s,this.depthMultiplier]),o=[];for(let a=0;a<this.rank;++a)o.push(1);o.push(s*this.depthMultiplier,this.filters);const i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",o,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new an({ndim:this.rank+2,axes:{[t]:s}})],this.built=!0}call(e,t){return se(()=>{e=He(e);let s;if(this.rank===1)throw new qe("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=ot(e,[0,2,3,1])),s=b$(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(s=kr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),this.dataFormat==="channelsFirst"&&(s=ot(s,[0,3,1,2])),s})}getConfig(){const e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Lt(this.depthwiseInitializer),e.pointwiseInitializer=Lt(this.pointwiseInitializer),e.depthwiseRegularizer=St(this.depthwiseRegularizer),e.pointwiseRegularizer=St(this.pointwiseRegularizer),e.depthwiseConstraint=ln(this.depthwiseConstraint),e.pointwiseConstraint=ln(this.pointwiseConstraint),e}}RN.className="SeparableConv";class AN extends RN{constructor(e){super(2,e)}}AN.className="SeparableConv2D";fe(AN);class Rm extends Fl{constructor(e){super(1,e),Rm.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){const e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!Sw(e.kernelSize,"number",1,1))throw new U(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}}Rm.className="Conv1D";fe(Rm);class DN extends et{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,t){return se(()=>{if(e=He(e),this.dataFormat==="channelsLast"){const s=Gd(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Gd(s,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{const s=Gd(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Gd(s,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){const e={cropping:this.cropping,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}DN.className="Cropping2D";fe(DN);class _N extends et{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,JG(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){const t=e[2]==null?null:this.size[0]*e[2],s=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],t,s]}else{const t=e[1]==null?null:this.size[0]*e[1],s=e[2]==null?null:this.size[1]*e[2];return[e[0],t,s,e[3]]}}call(e,t){return se(()=>{let s=He(e);const r=s.shape;if(this.dataFormat==="channelsFirst"){s=ot(s,[0,2,3,1]);const o=this.size[0]*r[2],i=this.size[1]*r[3],a=this.interpolation==="nearest"?uo.resizeNearestNeighbor(s,[o,i]):uo.resizeBilinear(s,[o,i]);return ot(a,[0,3,1,2])}else{const o=this.size[0]*r[1],i=this.size[1]*r[2];return this.interpolation==="nearest"?uo.resizeNearestNeighbor(s,[o,i]):uo.resizeBilinear(s,[o,i])}})}getConfig(){const e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}}_N.className="UpSampling2D";fe(_N);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function T6(n,e,t=[1,1],s="valid",r,o){return se(()=>{r==null&&(r=br()),qt(r);let i=Pw(n,r);if(n.rank!==4)throw new U(`Input for depthwiseConv2d is required to be 4-D, but is instead ${n.rank}-D`);if(e.rank!==4)throw new U(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=I1(i,e,t,s==="same"?"same":"valid","NHWC",o),r==="channelsFirst"&&(i=ot(i,[0,3,1,2])),i})}class FN extends Em{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=zt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=cn(e.depthwiseConstraint),this.depthwiseRegularizer=Mt(e.depthwiseRegularizer)}build(e){if(e=ct(e),e.length<4)throw new U(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);const t=this.dataFormat==="channelsFirst"?1:3;if(e[t]==null||e[t]<0)throw new U(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[t]}).`);const s=e[t],r=[this.kernelSize[0],this.kernelSize[1],s,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[s*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return se(()=>{e=He(e);let s=T6(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(s=kr(s,this.bias.read(),this.dataFormat)),this.activation!=null&&(s=this.activation.apply(s)),s})}computeOutputShape(e){e=ct(e);const t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,o=wr(t,this.kernelSize[0],this.padding,this.strides[0]),i=wr(s,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],r,o,i]:[e[0],o,i,r]}getConfig(){const e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Lt(this.depthwiseInitializer),e.depthwiseRegularizer=St(this.depthwiseRegularizer),e.depthwiseConstraint=ln(this.depthwiseRegularizer),e}}FN.className="DepthwiseConv2D";fe(FN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function ON(n,e,t,s){if(Array.isArray(n)){if(e!=null||t!=null)throw new U("When inputs is an array, neither initialState or constants should be provided");s!=null&&(t=n.slice(n.length-s,n.length),n=n.slice(0,n.length-s)),n.length>1&&(e=n.slice(1,n.length)),n=n[0]}function r(o){return o==null||Array.isArray(o)?o:[o]}return e=r(e),t=r(t),{inputs:n,initialState:e,constants:t}}function zN(n,e,t,s=!1,r,o,i=!1,a=!1){return se(()=>{const l=e.shape.length;if(l<3)throw new U(`Input should be at least 3D, but is ${l}D.`);const u=[1,0].concat(vr(2,l));e=ot(e,u),i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),r!=null&&(r=Ie(Ie(r,"bool"),"float32"),r.rank===l-1&&(r=es(r,-1)),r=ot(r,u)),s&&(e=ra(e,0),r!=null&&(r=ra(r,0)));const d=[];let f,p=t;const g=e.shape[0],x=oa(e);let w;r!=null&&(w=oa(r));for(let b=0;b<g;++b){const C=x[b],$=se(()=>n(C,p));if(r==null)f=$[0],p=$[1];else{const S=se(()=>{const T=w[b],E=Ge(Zs(T),T),A=ye(j($[0],T),j(p[0],E)),F=p.map((D,_)=>ye(j($[1][_],T),j(D,E)));return{output:A,newStates:F}});f=S.output,p=S.newStates}a&&d.push(f)}let v;return a&&(v=po(d,1)),[f,v,p]})}class di extends et{constructor(e){super(e);let t;if(e.cell==null)throw new U("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?t=new Vw({cells:e.cell}):t=e.cell,t.stateSize==null)throw new U("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=t,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new an({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return vr(0,e).map(t=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){qx(e)&&(e=e[0]),e=e;let t=this.cell.stateSize;Array.isArray(t)||(t=[t]);const s=t[0];let r;if(this.returnSequences?r=[e[0],e[1],s]:r=[e[0],s],this.returnState){const o=[];for(const i of t)o.push([e[0],i]);return[r].concat(o)}else return r}computeMask(e,t){return se(()=>{Array.isArray(t)&&(t=t[0]);const s=this.returnSequences?t:null;if(this.returnState){const r=this.states.map(o=>null);return[s].concat(r)}else return s})}get states(){if(this.states_==null){const e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[];for(let s=0;s<e;++s)t.push(null);return t}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new qe("Constants support is not implemented in RNN yet.");qx(e)&&(e=e[0]),e=e;const t=this.stateful?e[0]:null,s=e.slice(2);this.inputSpec[0]=new an({shape:[t,null,...s]});const r=[e[0]].concat(e.slice(2));this.cell.build(r);let o;if(Array.isArray(this.cell.stateSize)?o=this.cell.stateSize:o=[this.cell.stateSize],this.stateSpec!=null){if(!mt(this.stateSpec.map(i=>i.shape[i.shape.length-1]),o))throw new U(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=o.map(i=>new an({shape:[null,i]}));this.stateful&&this.resetStates()}resetStates(e,t=!1){se(()=>{if(!this.stateful)throw new _r("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape[0];if(s==null)throw new U("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>gn([s,r])):this.states_=[gn([s,this.cell.stateSize])];else if(e==null)Ye(this.states_),this.keptStates!=null&&(Ye(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(r=>gn([s,r])):this.states_[0]=gn([s,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new U(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t===!0?this.keptStates.push(this.states_.slice()):Ye(this.states_);for(let r=0;r<this.states_.length;++r){const o=e[r],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[r]:this.cell.stateSize,a=[s,i];if(!mt(o.shape,a))throw new U(`State ${r} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${o.shape}`);this.states_[r]=o}}this.states_=this.states_.map(r=>Pr(r.clone()))})}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=ON(e,s,r,this.numConstants);e=o.inputs,s=o.initialState,r=o.constants;let i=[],a=[];if(s!=null){t.initialState=s,i=i.concat(s),this.stateSpec=[];for(const u of s)this.stateSpec.push(new an({shape:u.shape}));a=a.concat(this.stateSpec)}if(r!=null&&(t.constants=r,i=i.concat(r),this.numConstants=r.length),i[0]instanceof Xr){const u=[e].concat(i),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const p=super.apply(u,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return se(()=>{const s=t==null?null:t.mask,r=t==null?null:t.training;let o=t==null?null:t.initialState;e=He(e),o==null&&(this.stateful?o=this.states_:o=this.getInitialState(e));const i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(o.length!==i)throw new U(`RNN Layer has ${i} state(s) but was passed ${o.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const a={training:r},u=zN((x,w)=>{const v=this.cell.call([x].concat(w),a);return[v[0],v.slice(1)]},e,o,this.goBackwards,s,null,this.unroll,this.returnSequences),d=u[0],f=u[1],p=u[2];this.stateful&&this.resetStates(p,r);const g=this.returnSequences?f:d;return this.returnState?[g].concat(p):g})}getInitialState(e){return se(()=>{let t=gn(e.shape);return t=Me(t,[1,2]),t=xh(t),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(s=>s>1?Xx(t,[1,s]):t):this.cell.stateSize>1?[Xx(t,[1,this.cell.stateSize])]:[t]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){const e=super.getConfig(),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(t.numConstants=this.numConstants);const s=this.cell.getConfig();return this.getClassName()===di.className&&(t.cell={className:this.cell.getClassName(),config:s}),Object.assign(Object.assign(Object.assign({},s),e),t)}static fromConfig(e,t,s={}){const r=t.cell,o=Wr(r,s);return new e(Object.assign(t,{cell:o}))}}di.className="RNN";fe(di);class Am extends et{}class Lw extends Am{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,xn(this.units,"units"),this.activation=ei(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=zt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=zt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=zt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Mt(e.kernelRegularizer),this.recurrentRegularizer=Mt(e.recurrentRegularizer),this.biasRegularizer=Mt(e.biasRegularizer),this.kernelConstraint=cn(e.kernelConstraint),this.recurrentConstraint=cn(e.recurrentConstraint),this.biasConstraint=cn(e.biasConstraint),this.dropout=wl([1,Zo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=wl([1,Zo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=ct(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return se(()=>{if(e=e,e.length!==2)throw new U(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let s=e[1];e=e[0];const r=t.training==null?!1:t.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ti({ones:()=>Zs(e),rate:this.dropout,training:r,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ti({ones:()=>Zs(s),rate:this.recurrentDropout,training:r,dropoutFunc:this.dropoutFunc}));let o;const i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?o=Vr(j(e,i),this.kernel.read()):o=Vr(e,this.kernel.read()),this.bias!=null&&(o=kr(o,this.bias.read())),a!=null&&(s=j(s,a));let l=ye(o,Vr(s,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Jo(this.activation),useBias:this.useBias,kernelInitializer:Lt(this.kernelInitializer),recurrentInitializer:Lt(this.recurrentInitializer),biasInitializer:Lt(this.biasInitializer),kernelRegularizer:St(this.kernelRegularizer),recurrentRegularizer:St(this.recurrentRegularizer),biasRegularizer:St(this.biasRegularizer),activityRegularizer:St(this.activityRegularizer),kernelConstraint:ln(this.kernelConstraint),recurrentConstraint:ln(this.recurrentConstraint),biasConstraint:ln(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),t)}}Lw.className="SimpleRNNCell";fe(Lw);class MN extends di{constructor(e){e.cell=new Lw(e),super(e)}call(e,t){return se(()=>{this.cell.dropoutMask!=null&&(Ye(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ye(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return new e(t)}}MN.className="SimpleRNN";fe(MN);class Bw extends Am{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new U("GRUCell does not support reset_after parameter set to true.");this.units=e.units,xn(this.units,"units"),this.activation=ei(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ei(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=zt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=zt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=zt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=Mt(e.kernelRegularizer),this.recurrentRegularizer=Mt(e.recurrentRegularizer),this.biasRegularizer=Mt(e.biasRegularizer),this.kernelConstraint=cn(e.kernelConstraint),this.recurrentConstraint=cn(e.recurrentConstraint),this.biasConstraint=cn(e.biasConstraint),this.dropout=wl([1,Zo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=wl([1,Zo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=ct(e);const t=e[e.length-1];this.kernel=this.addWeight("kernel",[t,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,t){return se(()=>{if(e=e,e.length!==2)throw new U(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training==null?!1:t.training;let r=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ti({ones:()=>Zs(e),rate:this.dropout,training:s,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ti({ones:()=>Zs(r),rate:this.recurrentDropout,training:s,count:3,dropoutFunc:this.dropoutFunc}));const o=this.dropoutMask,i=this.recurrentDropoutMask;let a,l,u;0<this.dropout&&this.dropout<1&&(e=j(e,o[0]));let d=Vr(e,this.kernel.read());this.useBias&&(d=kr(d,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(r=j(r,i[0]));const f=this.recurrentKernel.read(),[p,g]=Es(f,[2*this.units,this.units],f.rank-1),x=Vr(r,p),[w,v,b]=Es(d,3,d.rank-1),[C,$]=Es(x,2,x.rank-1);a=this.recurrentActivation.apply(ye(w,C)),l=this.recurrentActivation.apply(ye(v,$));const S=Vr(j(l,r),g);u=this.activation.apply(ye(b,S));const T=ye(j(a,r),j(ye(1,jt(a)),u));return[T,T]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Jo(this.activation),recurrentActivation:Jo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Lt(this.kernelInitializer),recurrentInitializer:Lt(this.recurrentInitializer),biasInitializer:Lt(this.biasInitializer),kernelRegularizer:St(this.kernelRegularizer),recurrentRegularizer:St(this.recurrentRegularizer),biasRegularizer:St(this.biasRegularizer),activityRegularizer:St(this.activityRegularizer),kernelConstraint:ln(this.kernelConstraint),recurrentConstraint:ln(this.recurrentConstraint),biasConstraint:ln(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),t)}}Bw.className="GRUCell";fe(Bw);class PN extends di{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Bw(e),super(e)}call(e,t){return se(()=>{this.cell.dropoutMask!=null&&(Ye(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ye(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}PN.className="GRU";fe(PN);class Dm extends Am{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,xn(this.units,"units"),this.activation=ei(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=ei(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=zt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=zt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=zt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=Mt(e.kernelRegularizer),this.recurrentRegularizer=Mt(e.recurrentRegularizer),this.biasRegularizer=Mt(e.biasRegularizer),this.kernelConstraint=cn(e.kernelConstraint),this.recurrentConstraint=cn(e.recurrentConstraint),this.biasConstraint=cn(e.biasConstraint),this.dropout=wl([1,Zo([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=wl([1,Zo([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var t;e=ct(e);const s=e[e.length-1];this.kernel=this.addWeight("kernel",[s,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let r;if(this.useBias){if(this.unitForgetBias){const o=this.biasInitializer,i=this.units;r=new(t=class extends er{apply(l,u){const d=o.apply([i]),f=new $w().apply([i]),p=o.apply([i*2]);return fS(fS(d,f),p)}},t.className="CustomInit",t)}else r=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,r,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,t){return se(()=>{const s=t.training==null?!1:t.training;if(e=e,e.length!==3)throw new U(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let r=e[1];const o=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ti({ones:()=>Zs(e),rate:this.dropout,training:s,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ti({ones:()=>Zs(r),rate:this.recurrentDropout,training:s,count:4,dropoutFunc:this.dropoutFunc}));const i=this.dropoutMask,a=this.recurrentDropoutMask;let l,u,d,f;0<this.dropout&&this.dropout<1&&(e=j(e,i[0]));let p=Vr(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(r=j(r,a[0])),p=ye(p,Vr(r,this.recurrentKernel.read())),this.useBias&&(p=kr(p,this.bias.read()));const[g,x,w,v]=Es(p,4,p.rank-1);l=this.recurrentActivation.apply(g),u=this.recurrentActivation.apply(x),d=ye(j(u,o),j(l,this.activation.apply(w))),f=this.recurrentActivation.apply(v);const b=j(f,this.activation.apply(d));return[b,b,d]})}getConfig(){const e=super.getConfig(),t={units:this.units,activation:Jo(this.activation),recurrentActivation:Jo(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Lt(this.kernelInitializer),recurrentInitializer:Lt(this.recurrentInitializer),biasInitializer:Lt(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:St(this.kernelRegularizer),recurrentRegularizer:St(this.recurrentRegularizer),biasRegularizer:St(this.biasRegularizer),activityRegularizer:St(this.activityRegularizer),kernelConstraint:ln(this.kernelConstraint),recurrentConstraint:ln(this.recurrentConstraint),biasConstraint:ln(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),t)}}Dm.className="LSTMCell";fe(Dm);class LN extends di{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Dm(e),super(e)}call(e,t){return se(()=>{this.cell.dropoutMask!=null&&(Ye(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ye(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}static fromConfig(e,t){return t.implmentation===0&&(t.implementation=1),new e(t)}}LN.className="LSTM";fe(LN);class Vw extends Am{constructor(e){super(e),this.cells=e.cells}get stateSize(){const e=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?e.push(...t.stateSize):e.push(t.stateSize);return e}call(e,t){return se(()=>{e=e;let s=e.slice(1);const r=[];for(const a of this.cells.slice().reverse())Array.isArray(a.stateSize)?r.push(s.splice(0,a.stateSize.length)):r.push(s.splice(0,1));r.reverse();const o=[];let i;for(let a=0;a<this.cells.length;++a){const l=this.cells[a];s=r[a],a===0?i=[e[0]].concat(s):i=[i[0]].concat(s),i=l.call(i,t),o.push(i.slice(1))}s=[];for(const a of o.slice().reverse())s.push(...a);return[i[0]].concat(s)})}build(e){qx(e)&&(e=e[0]),e=e;let t;this.cells.forEach((s,r)=>{ji(`RNNCell_${r}`,()=>{s.build(e),Array.isArray(s.stateSize)?t=s.stateSize[0]:t=s.stateSize,e=[e[0],t]})}),this.built=!0}getConfig(){const e=super.getConfig(),t=o=>({className:o.getClassName(),config:o.getConfig()}),r={cells:this.cells.map(t)};return Object.assign(Object.assign({},e),r)}static fromConfig(e,t,s={}){const r=[];for(const o of t.cells)r.push(Wr(o,s));return new e({cells:r})}get trainableWeights(){if(!this.trainable)return[];const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e}get nonTrainableWeights(){const e=[];for(const t of this.cells)e.push(...t.nonTrainableWeights);if(!this.trainable){const t=[];for(const s of this.cells)t.push(...s.trainableWeights);return t.concat(e)}return e}getWeights(){const e=[];for(const t of this.cells)e.push(...t.weights);return Yx(e)}setWeights(e){const t=[];for(const s of this.cells){const r=s.weights.length,o=e.splice(r);for(let i=0;i<s.weights.length;++i)t.push([s.weights[i],o[i]])}_w(t)}}Vw.className="StackedRNNCells";fe(Vw);function ti(n){const{ones:e,rate:t,training:s=!1,count:r=1,dropoutFunc:o}=n,i=()=>o!=null?o(e(),t):RT(e(),t),a=()=>wh(i,e,s);return!r||r<=1?Pr(a().clone()):Array(r).fill(void 0).map(a).map(u=>Pr(u.clone()))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */var N6=function(n,e){var t={};for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&e.indexOf(s)<0&&(t[s]=n[s]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(n);r<s.length;r++)e.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(n,s[r])&&(t[s[r]]=n[s[r]]);return t};class BN extends di{constructor(e){if(e.unroll)throw new qe("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new qe("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new an({ndim:5})]}call(e,t){return se(()=>{if(this.cell.dropoutMask!=null&&(Ye(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Ye(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),t&&t.constants)throw new U("ConvRNN2D cell does not support constants");const s=t==null?null:t.mask,r=t==null?null:t.training,o=t==null?null:t.initialState;return super.call(e,{mask:s,training:r,initialState:o})})}computeOutputShape(e){let t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0],...t.slice(2)]),this.returnState&&(t=[t,...Array(2).fill([e[0],...t.slice(-3)])]),t}getInitialState(e){return se(()=>{const{stateSize:t}=this.cell,s=e.shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)],i=gn(o);return Array.isArray(t)?Array(t.length).fill(i):[i]})}resetStates(e,t=!1){se(()=>{if(!this.stateful)throw new _r("Cannot call resetStates() on an RNN Layer that is not stateful.");const s=this.inputSpec[0].shape,r=this.computeSingleOutputShape(s),o=[r[0],...r.slice(2)];if(s[0]==null)throw new U("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>gn(o)):this.states_=[gn(o)];else if(e==null)Ye(this.states_),this.keptStates!=null&&(Ye(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>gn(o)):this.states_[0]=gn(o);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new U(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);t?this.keptStates.push(this.states_.slice()):Ye(this.states_);for(let a=0;a<this.states_.length;++a){const l=e[a],u=o;if(!mt(l.shape,u))throw new U(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>Pr(a.clone()))})}computeSingleOutputShape(e){const{dataFormat:t,filters:s,kernelSize:r,padding:o,strides:i,dilationRate:a}=this.cell,l=t==="channelsFirst",u=e[l?3:2],d=e[l?4:3],f=wr(u,r[0],o,i[0],a[0]),p=wr(d,r[1],o,i[1],a[1]);return[...e.slice(0,2),...l?[s,f,p]:[f,p,s]]}}BN.className="ConvRNN2D";class Ww extends Dm{constructor(e){const{filters:t,kernelSize:s,strides:r,padding:o,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:t})),this.filters=t,xn(this.filters,"filters"),this.kernelSize=al(s,2,"kernelSize"),this.kernelSize.forEach(l=>xn(l,"kernelSize")),this.strides=al(r||1,2,"strides"),this.strides.forEach(l=>xn(l,"strides")),this.padding=o||"valid",Ds(this.padding),this.dataFormat=i||"channelsLast",qt(this.dataFormat),this.dilationRate=al(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>xn(l,"dilationRate"))}build(e){var t;e=ct(e);const s=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[s]==null)throw new U(`The channel dimension of the input should be defined. Found ${e[s]}`);const r=e[s],o=4,i=this.kernelSize.concat([r,this.filters*o]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const a=this.kernelSize.concat([this.filters,this.filters*o]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){const u=this.biasInitializer,d=this.filters;l=new(t=class extends er{apply(p,g){const x=u.apply([d]),w=ui([d]),v=u.apply([d*2]);return Iw([x,w,v])}},t.className="CustomInit",t)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*o],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,t){return se(()=>{if(e.length!==3)throw new U(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);const s=t.training||!1,r=e[0],o=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=ti({ones:()=>Zs(r),rate:this.dropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const l=this.dropoutMask,u=(X,z,V)=>!z||!z[V]?X:j(z[V],X);let d=u(r,l,0),f=u(r,l,1),p=u(r,l,2),g=u(r,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=ti({ones:()=>Zs(o),rate:this.recurrentDropout,training:s,count:a,dropoutFunc:this.dropoutFunc}));const x=this.recurrentDropoutMask;let w=u(o,x,0),v=u(o,x,1),b=u(o,x,2),C=u(o,x,3);const $=3,[S,T,E,A]=Es(this.kernel.read(),a,$),[F,D,_,N]=this.useBias?Es(this.bias.read(),a):[null,null,null,null];d=this.inputConv(d,S,F,this.padding),f=this.inputConv(f,T,D,this.padding),p=this.inputConv(p,E,_,this.padding),g=this.inputConv(g,A,N,this.padding);const[L,G,Q,K]=Es(this.recurrentKernel.read(),a,$);w=this.recurrentConv(w,L),v=this.recurrentConv(v,G),b=this.recurrentConv(b,Q),C=this.recurrentConv(C,K);const Z=this.recurrentActivation.apply(ye(d,w)),te=this.recurrentActivation.apply(ye(f,v)),B=ye(j(te,i),j(Z,this.activation.apply(ye(p,b)))),H=j(this.recurrentActivation.apply(ye(g,C)),this.activation.apply(B));return[H,H,B]})}getConfig(){const e=super.getConfig(),{units:t}=e,s=N6(e,["units"]),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},s),r)}inputConv(e,t,s,r){const o=na(e,t,this.strides,r||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return s?kr(o,s,this.dataFormat):o}recurrentConv(e,t){return na(e,t,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}}Ww.className="ConvLSTM2DCell";fe(Ww);class VN extends BN{constructor(e){const t=new Ww(e);super(Object.assign(Object.assign({},e),{cell:t}))}static fromConfig(e,t){return new e(t)}}VN.className="ConvLSTM2D";fe(VN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class Uw extends et{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;const t=e.shape,s=[];for(let r=0;r<this.noiseShape.length;++r)s.push(this.noiseShape[r]==null?t[r]:this.noiseShape[r]);return s}call(e,t){return se(()=>{this.invokeCallHook(e,t);const s=He(e);if(0<this.rate&&this.rate<1){const r=t.training==null?!1:t.training,o=this.getNoiseShape(s);return wh(()=>RT(s,this.rate,o,this.seed),()=>s,r)}return e})}getConfig(){const e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=super.getConfig();return Object.assign(e,t),e}dispose(){return super.dispose()}}Uw.className="Dropout";fe(Uw);class WN extends Uw{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){const t=e.shape;return[t[0],1,t[2]]}}WN.className="SpatialDropout1D";fe(WN);class UN extends et{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let t=null;e.batchSize!=null&&(t=e.batchSize),this.batchInputShape=[t,e.inputDim]}this.units=e.units,xn(this.units,"units"),this.activation=ei(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=zt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=zt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=cn(e.kernelConstraint),this.biasConstraint=cn(e.biasConstraint),this.kernelRegularizer=Mt(e.kernelRegularizer),this.biasRegularizer=Mt(e.biasRegularizer),this.activityRegularizer=Mt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=ct(e);const t=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:t}}],this.built=!0}computeOutputShape(e){e=ct(e);const t=e.slice();return t[t.length-1]=this.units,t}call(e,t){return se(()=>{this.invokeCallHook(e,t);const s=He(e),r=kT(this.activation.getClassName());let o;return r!=null?o=Vr(s,this.kernel.read(),r,this.bias?this.bias.read():null):(o=Vr(s,this.kernel.read()),this.bias!=null&&(o=kr(o,this.bias.read())),this.activation!=null&&(o=this.activation.apply(o))),o})}getConfig(){const e={units:this.units,activation:Jo(this.activation),useBias:this.useBias,kernelInitializer:Lt(this.kernelInitializer),biasInitializer:Lt(this.biasInitializer),kernelRegularizer:St(this.kernelRegularizer),biasRegularizer:St(this.biasRegularizer),activityRegularizer:St(this.activityRegularizer),kernelConstraint:ln(this.kernelConstraint),biasConstraint:ln(this.biasConstraint)},t=super.getConfig();return Object.assign(e,t),e}}UN.className="Dense";fe(UN);class GN extends et{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=ct(e);for(const t of e.slice(1))if(t==null)throw new U(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Yo(e,1)]}call(e,t){return se(()=>{this.invokeCallHook(e,t);let s=He(e);if(this.dataFormat==="channelsFirst"&&s.rank>1){const r=[0];for(let o=2;o<s.rank;++o)r.push(o);r.push(1),s=ot(s,r)}return o5(s)})}getConfig(){const e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);const t=super.getConfig();return Object.assign(e,t),e}}GN.className="Flatten";fe(GN);class HN extends et{constructor(e){super(e),this.supportsMasking=!0,this.activation=ei(e.activation)}call(e,t){return se(()=>{this.invokeCallHook(e,t);const s=He(e);return this.activation.apply(s)})}getConfig(){const e={activation:Jo(this.activation)},t=super.getConfig();return Object.assign(e,t),e}}HN.className="Activation";fe(HN);class jN extends et{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,t){return se(()=>(e=He(e),s5(e,this.n)))}getConfig(){const e={n:this.n},t=super.getConfig();return Object.assign(e,t),e}}jN.className="RepeatVector";fe(jN);class XN extends et{constructor(e){super(e),this.targetShape=e.targetShape;for(let t=0;t<this.targetShape.length;++t)this.isUnknown(this.targetShape[t])&&(this.targetShape[t]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,t){const s="Total size of new array must be unchanged.",r=t.slice();let o=1,i=null;for(let l=0;l<r.length;++l){const u=r[l];if(this.isUnknown(u))if(i===null)i=l;else throw new U("Can only specifiy one unknown dimension.");else o*=u}const a=Yo(e);if(i!==null){if(o===0||a%o!==0)throw new U(s);r[i]=a/o}else if(a!==o)throw new U(s);return r}computeOutputShape(e){let t=!1;for(let s=0;s<e.length;++s)if(this.isUnknown(e[s])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,t){return se(()=>{this.invokeCallHook(e,t);const s=He(e),r=s.shape,o=r.slice(0,1).concat(this.fixUnknownDimension(r.slice(1),this.targetShape));return J(s,o)})}getConfig(){const e={targetShape:this.targetShape},t=super.getConfig();return Object.assign(e,t),e}}XN.className="Reshape";fe(XN);class KN extends et{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);const t=vr(1,e.dims.length+1);if(!mt(e.dims.slice().sort(),t))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new an({ndim:this.dims.length+1})]}computeOutputShape(e){e=ct(e);const t=e.slice();return this.dims.forEach((s,r)=>{t[r+1]=e[s]}),t}call(e,t){return ot(He(e),this.dimsIncludingBatch)}getConfig(){const e={dims:this.dims},t=super.getConfig();return Object.assign(e,t),e}}KN.className="Permute";fe(KN);class qN extends et{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={maskValue:this.maskValue};return Object.assign(t,e),t}computeMask(e,t){const s=He(e);return Lx(zf(s,this.maskValue),-1)}call(e,t){return se(()=>{this.invokeCallHook(e,t);const s=He(e),i=Lx(zf(s,this.maskValue),-1,!0);return j(s,Ie(i,s.dtype))})}}qN.className="Masking";fe(qN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class YN extends et{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let t=null;e.batchSize!=null&&(t=e.batchSize),e.inputLength==null?this.batchInputShape=[t,null]:this.batchInputShape=[t].concat(xt(e.inputLength))}this.inputDim=e.inputDim,xn(this.inputDim,"inputDim"),this.outputDim=e.outputDim,xn(this.outputDim,"outputDim"),this.embeddingsInitializer=zt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=Mt(e.embeddingsRegularizer),this.activityRegularizer=Mt(e.activityRegularizer),this.embeddingsConstraint=cn(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,t){return se(()=>this.maskZero?(e=He(e),zf(e,it(e))):null)}computeOutputShape(e){if(e=ct(e),this.inputLength==null)return[...e,this.outputDim];const t=xt(this.inputLength);if(t.length!==e.length-1)throw new U(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let s=0;for(let r=0;r<t.length;++r){const o=t[r],i=e[r+1];if(o!=null&&i!=null&&o!==i)throw new U(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);o==null&&(t[s]=i),s++}}return[e[0],...t,this.outputDim]}call(e,t){return se(()=>{this.invokeCallHook(e,t);let s=He(e);s.dtype!=="int32"&&(s=Br(s,"int32"));const r=ET(this.embeddings.read(),J(s,[s.size]));return J(r,ct(this.computeOutputShape(s.shape)))})}getConfig(){const e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Lt(this.embeddingsInitializer),embeddingsRegularizer:St(this.embeddingsRegularizer),activityRegularizer:St(this.activityRegularizer),embeddingsConstraint:ln(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=super.getConfig();return Object.assign(e,t),e}}YN.className="Embedding";fe(YN);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class ga extends et{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new qe}computeElementwiseOpOutputShape(e,t){if(e==null||t==null)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(t.length===0)return e;const s=e.slice(0,e.length-t.length);for(let r=0;r<t.length;++r){const o=e[e.length-t.length+r],i=t[r];if(o==null||i==null||o<0||i<0)s.push(null);else if(o===1)s.push(i);else if(i===1)s.push(o);else{if(o!==i)throw new U("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));s.push(o)}}return s}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[ct(e)]),e=e,e.length<2)throw new U(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let t=[];for(const o of e)o!=null&&o[0]!==null&&t.push(o[0]);if(t=qo(t),t.length>1)throw new U(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let s=e[0]==null?null:e[0].slice(1);for(let o=1;o<e.length;++o){const i=e[o]==null?null:e[o].slice(1);s=this.computeElementwiseOpOutputShape(s,i)}const r=e.map(o=>o.length);e.indexOf(null)===-1&&qo(r).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,t){return se(()=>{if(e=e,this.reshapeRequired){const s=[],r=e.map(o=>o.rank);if(r.indexOf(null)===-1){const o=Zo(r);for(let i of e){const a=i.rank;for(let l=0;l<o-a;++l)i=xh(i,1);s.push(i)}return this.mergeFunction(s)}else{let o=!1;for(const l of e){const u=l.rank;if(u==null){const d=l.shape,f=d[0],p=d.slice(1).concat([f]);let g=J(l,[f].concat(Yo(d.slice(1))));g=ot(g,[1,0]),g=J(g,p),s.push(g),o=!0}else if(u>1){const d=vr(1,u).concat([0]);s.push(ot(l,d)),o=!0}else s.push(l)}let i=this.mergeFunction(s);const a=i.rank;if(o){if(a==null){const l=i.shape,u=l.length,d=l[u-1],f=[d].concat(l.slice(0,l.length-1));i=J(ot(J(i,[-1,d]),[1,0]),f)}else if(a>1){const l=[a-1].concat(vr(0,a-1));i=ot(i,l)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let t;e[0]==null?t=null:t=e[0].slice(1);for(let r=1;r<e.length;++r){const o=e[r]==null?null:e[r].slice(1);t=this.computeElementwiseOpOutputShape(t,o)}let s=[];for(const r of e)r!=null&&r[0]!==null&&s.push(r[0]);return s=qo(s),s.length===1?t=s.concat(t):t=[null].concat(t),t}computeMask(e,t){return se(()=>{if(t==null)return null;if(!Array.isArray(t))throw new U("`mask` should be an Array");if(!Array.isArray(e))throw new U("`inputs` should be an Array");if(t.length!==e.length)throw new U(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${t.length})`);if(t.every(r=>r==null))return null;t=t.map(r=>r==null?r:es(r,0));let s=t[0];for(let r=1;r<t.length-1;++r)s=fo(s,t[r]);return s})}}class QN extends ga{constructor(e){super(e)}mergeFunction(e){return se(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=ye(t,e[s]);return t})}}QN.className="Add";fe(QN);class ZN extends ga{constructor(e){super(e)}mergeFunction(e){return se(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=j(t,e[s]);return t})}}ZN.className="Multiply";fe(ZN);class JN extends ga{constructor(e){super(e)}mergeFunction(e){return se(()=>{let t=e[0].clone();for(let s=1;s<e.length;++s)t=ye(t,e[s]);return j(1/e.length,t)})}}JN.className="Average";fe(JN);class eE extends ga{constructor(e){super(e)}mergeFunction(e){return se(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=ci(t,e[s]);return t})}}eE.className="Maximum";fe(eE);class tE extends ga{constructor(e){super(e)}mergeFunction(e){return se(()=>{let t=e[0];for(let s=1;s<e.length;++s)t=Qc(t,e[s]);return t})}}tE.className="Minimum";fe(tE);class nE extends ga{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new U("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let t=!0;for(const r of e)if(r!=null){t=!1;break}if(t)return;const s=[];for(let r=0;r<e.length;++r){const o=e[r].slice();o.splice(this.axis,1);let i=!1;for(const a of s)if(mt(a,o)){i=!0;break}i||s.push(o)}if(s.length>1)throw new U("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return se(()=>Iw(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new U("A `Concatenate` layer should be called on a list of inputs.");const t=e,s=t[0].slice(),r=this.axis<0?s.length+this.axis:this.axis;for(const o of t.slice(1)){if(s[r]==null||o[r]==null){s[r]=null;break}s[r]+=o[r]}return s}computeMask(e,t){if(t==null)return null;if(!Array.isArray(t))throw new U("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new U("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new U(`Mismatch in the length of mask (${t.length}) and the legnth of inputs (${e.length})`);return se(()=>{let s=!0;if(t.forEach(i=>{if(i!=null){s=!1;return}}),s)return null;const r=[];for(let i=0;i<e.length;++i)t[i]==null?r.push(Ie(Zs(e[i]),"bool")):t[i].rank<e[i].rank?r.push(es(t[i],-1)):r.push(t[i]);const o=ns(r,this.axis);return t$(o,-1,!1)})}getConfig(){const e={axis:this.axis},t=super.getConfig();return Object.assign(e,t),e}}nE.className="Concatenate";fe(nE);function Ec(n,e){for(;n<0;)n+=e;return n}function E6(n,e,t){if(n.shape.length>3||e.shape.length>3)throw new qe("batchDot is not implemented for tensors of 4D or higher rank yet");if(O(n.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${n.shape.length}`),O(n.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof t=="number"&&(t=[t,t]),n.dtype==="complex64"||e.dtype==="complex64")throw new qe("batchDot is not implemented for complex64-type Tensors yet.");const s=n.shape.length,r=e.shape.length;t==null&&(t=[s-1,r-2]);const o=t;return se(()=>{let i;if(s>r){i=s-r;const l=[];for(let u=0;u<i;++u)l.push(1);e=J(e,e.shape.concat(l))}else if(r>s){i=r-s;const l=[];for(let u=0;u<i;++u)l.push(1);n=J(n,n.shape.concat(l))}else i=0;let a;if(n.shape.length===2&&e.shape.length===2)o[0]===o[1]?a=Me(j(n,e),o[0]):a=Me(j(ot(n,[1,0]),e),o[1]);else{const l=o[0]!==n.shape.length-1,u=o[1]===e.shape.length-1;a=ft(n,e,l,u)}if(i>0){let l;s>r?l=s+r-3:l=s-1;const u=[];for(let d=l;d<l+i;++d)u.push(d);a=hh(a,u)}return a.shape.length===1&&(a=es(a,1)),a})}class sE extends ga{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){O(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0],s=e[1];if(t.length>3||s.length>3)throw new qe("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);if(t[r[0]]!==s[r[1]])throw new U(`Dimension incompatibility: ${t[r[0]]} !== ${s[r[1]]}`)}mergeFunction(e){if(e.length!==2)throw new U(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let t=e[0],s=e[1],r;return Array.isArray(this.axes)?r=this.axes.map((o,i)=>Ec(o,e[i].shape.length)):r=[Ec(this.axes,t.shape.length),Ec(this.axes,s.shape.length)],this.normalize&&(t=Uf(t,r[0]),s=Uf(s,r[1])),E6(t,s,r)}interpretAxes(e,t){let s;return Array.isArray(this.axes)?s=this.axes:s=[Ec(this.axes,e.length),Ec(this.axes,t.length)],s}computeOutputShape(e){O(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");const t=e[0].slice(),s=e[1].slice();if(t.length>3||s.length>3)throw new qe("Dot layer does not support tensors of 4D or higher rank yet.");const r=this.interpretAxes(t,s);t.splice(r[0],1),s.splice(r[1],1),s.splice(0,1);const o=t.concat(s);return o.length===1&&o.push(1),o}computeMask(e,t){return null}getConfig(){const e={axes:this.axes,normalize:this.normalize},t=super.getConfig();return Object.assign(e,t),e}}sE.className="Dot";fe(sE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class rE extends et{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={stddev:this.stddev};return Object.assign(t,e),t}call(e,t){return se(()=>{this.invokeCallHook(e,t);const s=He(e);return wh(()=>ye(Im(s.shape,0,this.stddev),s),()=>s,t.training||!1)})}}rE.className="GaussianNoise";fe(rE);class oE extends et{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return se(()=>{this.invokeCallHook(e,t);const s=He(e);return this.rate>0&&this.rate<1?wh(()=>{const o=Math.sqrt(this.rate/(1-this.rate));return j(s,Im(s.shape,1,o))},()=>s,t.training||!1):s})}}oE.className="GaussianDropout";fe(oE);class iE extends et{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||He(e).shape}computeOutputShape(e){return e}getConfig(){const e=super.getConfig(),t={rate:this.rate};return Object.assign(t,e),t}call(e,t){return se(()=>{if(this.rate<1&&this.rate>0){const s=this._getNoiseShape(e);return wh(()=>{const o=He(e),a=-1.6732632423543772*1.0507009873554805;let l=da(uh(s),this.rate);l=Br(l,"float32");const u=((1-this.rate)*(1+this.rate*a**2))**-.5,d=-u*a*this.rate,f=ye(j(o,l),j(ye(l,-1),a));return ye(j(f,u),d)},()=>He(e),t.training||!1)}return e})}}iE.className="AlphaDropout";fe(iE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function nu(n,e,t,s,r,o=.001){let i;if(n.rank===2)i=ZP(n,e,t,s,r,o);else if(n.rank===3)i=eL(n,e,t,s,r,o);else if(n.rank===4)i=nL(n,e,t,s,r,o);else throw new qe(`batchNormalization is not implemented for array of rank ${n.rank} yet`);return i}function R6(n,e,t,s,r=.001){return se(()=>{const o=D1(n,s),i=o.mean,a=o.variance;return[nu(n,i,a,t,e,r),i,a]})}function A6(n,e,t,s,r=.001){return se(()=>{const o=D1(n,s),i=o.mean,a=o.variance,l=[];for(const x of vr(0,n.rank))s.indexOf(x)!==-1?l.push(1):l.push(n.shape[x]);const u=J(i,l),d=J(a,l),f=e==null?null:J(e,l),p=t==null?null:J(t,l);return[nu(n,u,d,p,f,r),i,a]})}function D6(n,e,t,s,r=.001){return mt(s.slice().sort(),vr(0,n.rank-1))?R6(n,e,t,s,r):A6(n,e,t,s,r)}class aE extends et{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=zt(e.betaInitializer||"zeros"),this.gammaInitializer=zt(e.gammaInitializer||"ones"),this.movingMeanInitializer=zt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=zt(e.movingVarianceInitializer||"ones"),this.betaConstraint=cn(e.betaConstraint),this.gammaConstraint=cn(e.gammaConstraint),this.betaRegularizer=Mt(e.betaRegularizer),this.gammaRegularizer=Mt(e.gammaRegularizer)}build(e){e=ct(e);const t=this.axis>=0?this.axis:this.axis+e.length,s=e[t];if(s==null)throw new U(`Axis ${t} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new an({ndim:e.length,axes:{[t]:s}})];const r=[s];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,t){return se(()=>{const s=t.training==null?!1:t.training,r=He(e),o=r.shape,i=o.length,a=vr(0,i),l=this.axis>=0?this.axis:this.axis+i;a.splice(l,1);const u=ia(1,i);u[l]=o[l];const d=a.slice();d.sort();const f=!mt(d,vr(0,i).slice(0,i-1)),p=()=>{if(f){const C=J(this.movingMean.read(),u),$=J(this.movingVariance.read(),u),S=this.center?J(this.beta.read(),u):null,T=this.scale?J(this.gamma.read(),u):null;return nu(r,C,$,S,T,this.epsilon)}else return nu(r,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!s)return p();const[g,x,w]=D6(r,this.gamma.read(),this.beta.read(),a,this.epsilon),v=(C,$,S)=>{se(()=>{const T=1-S,E=C.read(),A=j(Ge(E,$),T);C.write(Ge(E,A))})};return(()=>{v(this.movingMean,x,this.momentum),v(this.movingVariance,w,this.momentum)})(),g})}getConfig(){const e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Lt(this.betaInitializer),gammaInitializer:Lt(this.gammaInitializer),movingMeanInitializer:Lt(this.movingMeanInitializer),movingVarianceInitializer:Lt(this.movingVarianceInitializer),betaRegularizer:St(this.betaRegularizer),gammaRegularizer:St(this.gammaRegularizer),betaConstraint:ln(this.betaConstraint),gammaConstraint:ln(this.gammaConstraint)},t=super.getConfig();return Object.assign(e,t),e}}aE.className="BatchNormalization";fe(aE);class lE extends et{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=zt(e.betaInitializer||"zeros"),this.gammaInitializer=zt(e.gammaInitializer||"ones"),this.betaRegularizer=Mt(e.betaRegularizer),this.gammaRegularizer=Mt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=ct(e);const t=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let o=0;o<this.axis.length;++o)this.axis[o]<0&&(this.axis[o]+=t);for(const o of this.axis)if(o<0||o>=t)throw new Error(`Invalid axis: ${o}`);if(this.axis.length!==qo(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const s=this.axis.map(o=>e[o]),r=!0;this.scale?this.gamma=this.addWeight("gamma",s,"float32",this.gammaInitializer,this.gammaRegularizer,r):this.gamma=null,this.center?this.beta=this.addWeight("beta",s,"float32",this.betaInitializer,this.betaRegularizer,r):this.beta=null,this.built=!0}call(e,t){const s=He(e),r=s.shape,o=r.length;return se(()=>{let{mean:a,variance:l}=D1(s,this.axis,!0);const u=ia(1,o);for(const w of this.axis)u[w]=r[w];const d=w=>w!=null&&w.shape.length!==o?J(w,u):w;let f=this.scale?d(this.gamma.read()):null,p=this.center?d(this.beta.read()):null;const g=[],x=[];for(let w=0;w<o;++w)this.axis.indexOf(w)!==-1?(g.push(r[w]),x.push(1)):(g.push(1),x.push(r[w]));return a=mr(a,g),l=mr(l,g),f!=null&&(f=mr(f,x)),p!=null&&(p=mr(p,x)),nu(s,a,l,p,f,this.epsilon)})}getConfig(){const e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Lt(this.betaInitializer),gammaInitializer:Lt(this.gammaInitializer),betaRegularizer:St(this.betaRegularizer),gammaRegularizer:St(this.gammaRegularizer)},t=super.getConfig();return Object.assign(e,t),e}}lE.className="LayerNormalization";fe(lE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _6(n,e,t){return se(()=>{if(n.rank!==4)throw new U(`temporalPadding expects input tensor to be 4-D, but received a ${n.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new U("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(t==null&&(t=br()),t!=="channelsLast"&&t!=="channelsFirst")throw new U(`Unknown data format: ${t}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return t==="channelsFirst"?s=[[0,0],[0,0],e[0],e[1]]:s=[[0,0],e[0],e[1],[0,0]],_1(n,s)})}class cE extends et{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?br():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new U(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let t,s;if(typeof e.padding[0]=="number")t=[e.padding[0],e.padding[0]],s=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new U(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(t=e.padding[0],e.padding[1].length!==2)throw new U(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);s=e.padding[1]}this.padding=[t,s]}this.inputSpec=[new an({ndim:4})]}computeOutputShape(e){e=ct(e);let t,s;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?t=e[2]+this.padding[0][0]+this.padding[0][1]:t=null,e[3]!=null&&e[3]>=0?s=e[3]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],e[1],t,s]):(e[1]!=null&&e[1]>=0?t=e[1]+this.padding[0][0]+this.padding[0][1]:t=null,e[2]!=null&&e[2]>=0?s=e[2]+this.padding[1][0]+this.padding[1][1]:s=null,[e[0],t,s,e[3]])}call(e,t){return se(()=>_6(He(e),this.padding,this.dataFormat))}getConfig(){const e={padding:this.padding,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}cE.className="ZeroPadding2D";fe(cE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function _m(n,e,t,s,r,o){return se(()=>{qt(r),IT(o),Ds(s),t==null&&(t=[1,1]),s==null&&(s="valid"),r==null&&(r=br()),o==null&&(o="max"),n=Pw(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=A1(n,e,t,a):i=b1(n,e,t,a),r==="channelsFirst"&&(i=ot(i,[0,3,1,2])),i})}function uE(n,e,t,s,r,o){return se(()=>{qt(r),IT(o),Ds(s),t==null&&(t=[1,1,1]),s==null&&(s="valid"),r==null&&(r=br()),o==null&&(o="max"),n=TN(n,r);let i;const a=s==="same"?"same":"valid";return o==="max"?i=B4(n,e,t,a):i=WP(n,e,t,a),r==="channelsFirst"&&(i=ot(i,[0,4,1,2,3])),i})}class hE extends et{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new U(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(xn(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new U(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);xn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,Ds(this.padding),this.inputSpec=[new an({ndim:3})]}computeOutputShape(e){e=ct(e);const t=wr(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}call(e,t){return se(()=>{this.invokeCallHook(e,t),e=xh(He(e),2);const s=this.poolingFunction(He(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return hh(s,[2])})}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=super.getConfig();return Object.assign(e,t),e}}class dE extends hE{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return qt(o),Ds(r),_m(e,t,s,r,o,"max")}}dE.className="MaxPooling1D";fe(dE);class fE extends hE{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return qt(o),Ds(r),_m(e,t,s,r,o,"avg")}}fE.className="AveragePooling1D";fe(fE);class pE extends et{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new U(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];xn(this.poolSize,"poolSize"),xn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qt(this.dataFormat),Ds(this.padding),this.inputSpec=[new an({ndim:4})]}computeOutputShape(e){e=ct(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2];return t=wr(t,this.poolSize[0],this.padding,this.strides[0]),s=wr(s,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s]:[e[0],t,s,e[3]]}call(e,t){return se(()=>(this.invokeCallHook(e,t),this.poolingFunction(He(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class mE extends pE{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return qt(o),Ds(r),_m(e,t,s,r,o,"max")}}mE.className="MaxPooling2D";fe(mE);class gE extends pE{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return qt(o),Ds(r),_m(e,t,s,r,o,"avg")}}gE.className="AveragePooling2D";fe(gE);class xE extends et{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new U(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];xn(this.poolSize,"poolSize"),xn(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qt(this.dataFormat),Ds(this.padding),this.inputSpec=[new an({ndim:5})]}computeOutputShape(e){e=ct(e);let t=this.dataFormat==="channelsFirst"?e[2]:e[1],s=this.dataFormat==="channelsFirst"?e[3]:e[2],r=this.dataFormat==="channelsFirst"?e[4]:e[3];return t=wr(t,this.poolSize[0],this.padding,this.strides[0]),s=wr(s,this.poolSize[1],this.padding,this.strides[1]),r=wr(r,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],t,s,r]:[e[0],t,s,r,e[4]]}call(e,t){return se(()=>(this.invokeCallHook(e,t),this.poolingFunction(He(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){const e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class yE extends xE{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return qt(o),Ds(r),uE(e,t,s,r,o,"max")}}yE.className="MaxPooling3D";fe(yE);class wE extends xE{constructor(e){super(e)}poolingFunction(e,t,s,r,o){return qt(o),Ds(r),uE(e,t,s,r,o,"avg")}}wE.className="AveragePooling3D";fe(wE);class vE extends et{constructor(e){super(e),this.inputSpec=[new an({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,t){throw new qe}}class bE extends vE{constructor(e){super(e||{})}call(e,t){return se(()=>{const s=He(e);return Jt(s,1)})}}bE.className="GlobalAveragePooling1D";fe(bE);class CE extends vE{constructor(e){super(e||{})}call(e,t){return se(()=>{const s=He(e);return yr(s,1)})}}CE.className="GlobalMaxPooling1D";fe(CE);class kE extends et{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,qt(this.dataFormat),this.inputSpec=[new an({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,t){throw new qe}getConfig(){const e={dataFormat:this.dataFormat},t=super.getConfig();return Object.assign(e,t),e}}class SE extends kE{call(e,t){return se(()=>{const s=He(e);return this.dataFormat==="channelsLast"?Jt(s,[1,2]):Jt(s,[2,3])})}}SE.className="GlobalAveragePooling2D";fe(SE);class IE extends kE{call(e,t){return se(()=>{const s=He(e);return this.dataFormat==="channelsLast"?yr(s,[1,2]):yr(s,[2,3])})}}IE.className="GlobalMaxPooling2D";fe(IE);/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class $E extends et{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){const e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=super.getConfig();return Object.assign(e,t),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,t,s={}){const r=t.layer,o=Wr(r,s);delete t.layer;const i={layer:o};return Object.assign(i,t),new e(i)}}class TE extends $E{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=ct(e),e.length<3)throw new U(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];const t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=ct(e);const t=[e[0]].concat(e.slice(2)),s=this.layer.computeOutputShape(t),r=e[1];return[s[0],r].concat(s.slice(1))}call(e,t){return se(()=>(e=He(e),zN((i,a)=>[He(this.layer.call(i,t)),[]],e,[],!1,null,null,!1,!0)[1]))}}TE.className="TimeDistributed";fe(TE);function F6(n){ma(ZG,"BidirectionalMergeMode",n)}const O6="concat";class NE extends $E{constructor(e){super(e);const t=e.layer.getConfig(),s={};s.className=e.layer.getClassName(),s.config=t,this.forwardLayer=Wr(s),t.goBackwards=t.goBackwards!==!0;const r={};if(r.className=e.layer.getClassName(),r.config=t,this.backwardLayer=Wr(r),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?O6:e.mergeMode,F6(this.mergeMode),e.weights)throw new qe("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){const t=e.length,s=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,s)),this.backwardLayer.setWeights(e.slice(s))}computeOutputShape(e){let t=this.forwardLayer.computeOutputShape(e);Array.isArray(t)&&Array.isArray(t[0])||(t=[t]),t=t;let s,r,o;return this.returnState&&(o=t.slice(1)),s=t[0],s=s,this.mergeMode==="concat"?(s[s.length-1]*=2,r=[s]):this.mergeMode==null?r=[s,s.slice()]:r=[s],this.returnState?this.mergeMode==null?r.concat(o).concat(o.slice()):[s].concat(o).concat(o.slice()):ts(r)}apply(e,t){let s=t==null?null:t.initialState,r=t==null?null:t.constants;t==null&&(t={});const o=ON(e,s,r,this.numConstants);if(e=o.inputs,s=o.initialState,r=o.constants,Array.isArray(e)&&(s=e.slice(1),e=e[0]),(s==null||s.length===0)&&r==null)return super.apply(e,t);const i=[],a=[];if(s!=null){const u=s.length;if(u%2>0)throw new U("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=s,i.push(...s);const d=s.map(f=>new an({shape:f.shape}));this.forwardLayer.stateSpec=d.slice(0,u/2),this.backwardLayer.stateSpec=d.slice(u/2),a.push(...d)}if(r!=null)throw new qe("Support for constants in Bidirectional layers is not implemented yet.");const l=i[0]instanceof Xr;for(const u of i)if(u instanceof Xr!==l)throw new U("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){const u=[e].concat(i),d=this.inputSpec.concat(a),f=this.inputSpec;this.inputSpec=d;const p=super.apply(u,t);return this.inputSpec=f,p}else return super.apply(e,t)}call(e,t){return se(()=>{const s=t.initialState;let r,o;if(s==null)r=this.forwardLayer.call(e,t),o=this.backwardLayer.call(e,t);else{const l=s.slice(0,s.length/2),u=s.slice(s.length/2);r=this.forwardLayer.call(e,Object.assign(t,{initialState:l})),o=this.backwardLayer.call(e,Object.assign(t,{initialState:u}))}let i;this.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(o.slice(1))),r=r[0],o=o[0]),this.returnSequences&&(o=ra(o,1));let a;return this.mergeMode==="concat"?a=Iw([r,o]):this.mergeMode==="sum"?a=ye(r,o):this.mergeMode==="ave"?a=j(.5,ye(r,o)):this.mergeMode==="mul"?a=j(r,o):this.mergeMode==null&&(a=[r,o]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){ji(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),ji(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,t){Array.isArray(t)&&(t=t[0]);let s;if(this.returnSequences?this.mergeMode==null?s=[t,t]:s=t:this.mergeMode==null?s=[null,null]:s=null,this.returnState){const o=this.forwardLayer.states.map(i=>null);return Array.isArray(s)?s.concat(o).concat(o):[s].concat(o).concat(o)}else return s}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){const e={mergeMode:this.mergeMode},t=super.getConfig();return Object.assign(e,t),e}static fromConfig(e,t){const s=Wr(t.layer);if(delete t.layer,t.numConstants!=null)throw new qe("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const r=t;return r.layer=s,new e(r)}}NE.className="Bidirectional";fe(NE);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class EE extends et{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){const e={scale:this.scale,offset:this.offset},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return se(()=>(e=He(e),e.dtype!=="float32"&&(e=Br(e,"float32")),ye(j(e,this.scale),this.offset)))}}EE.className="Rescaling";fe(EE);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const{resizeBilinear:z6,cropAndResize:M6}=uo;class RE extends et{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,t,s,r,o,i,a,l){return se(()=>{let u,d=!1;const f=t/i,p=s/a,g=(r+t)/i,x=(o+s)/a,w=[f,p,g,x],v=[];e.rank===3?(d=!0,u=po([e])):u=e;for(let T=0;T<u.shape[0];T++)v.push(w);const b=Uc(v,[v.length,4]),C=Zc(0,v.length,1,"int32"),S=M6(u,b,C,[r,o],"nearest");return Br(d?He(oa(S)):S,l)})}upsize(e,t,s,r){return se(()=>{const o=z6(e,[t,s]);return Br(o,r)})}call(e,t){return se(()=>{const s=He(e),r=s.dtype,o=s.shape,i=o[o.length-3],a=o[o.length-2];let l=0;i!==this.height&&(l=Math.floor((i-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(s,l,u,this.height,this.width,i,a,r):this.upsize(e,this.height,this.width,r)})}getConfig(){const e={height:this.height,width:this.width},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=ct(e);const t=e.length-3,s=e.length-2;return e[t]=this.height,e[s]=this.width,e}}RE.className="CenterCrop";fe(RE);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function P6(n,e,t,s){let r=He(n);if(r.dtype!=="int32"&&(r=Br(r,"int32")),e==="int")return r;const o=r.shape;if(r.rank===0&&(r=es(r,-1)),e==="oneHot"&&r.shape[r.shape.length-1]!==1&&(r=es(r,-1)),r.rank>2)throw new U(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${o} which would result in output rank ${r.rank}.`);const i=["multiHot","oneHot"].includes(e),a=r;let l;if(typeof s<"u"&&e==="count"?l=Wk(a,s,t,i):l=Wk(a,[],t,i),e!=="tfIdf")return l;if(s)return j(l,s);throw new U("When outputMode is 'tfIdf', weights must be provided.")}/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class AE extends et{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){const e={numTokens:this.numTokens,outputMode:this.outputMode},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){return e=ct(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,t){return se(()=>{e=He(e),e.dtype!=="int32"&&(e=Br(e,"int32"));let s;if(typeof t.countWeights<"u"){if(this.outputMode!=="count")throw new U(`countWeights is not used when outputMode !== count.
              Received countWeights=${t.countWeights}`);s=He(t.countWeights)}const r=yr(e),o=Ff(e),i=As(this.numTokens,r).bufferSync().get(0),a=da(o,0).bufferSync().get(0);if(!(i&&a))throw new U(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return P6(e,this.outputMode,this.numTokens,s)})}}AE.className="CategoryEncoding";fe(AE);/**
 * @license
 * Copyright 2022 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const L6=["bilinear","nearest"],AS=new Set(L6);class DE extends et{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(AS.has(e.interpolation))this.interpolation=e.interpolation;else throw new U(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=!!e.cropToAspectRatio}computeOutputShape(e){e=ct(e);const t=e[2];return[this.height,this.width,t]}getConfig(){const e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},t=super.getConfig();return Object.assign(e,t),e}call(e,t){return se(()=>{const s=[this.height,this.width];if(this.interpolation==="bilinear")return uo.resizeBilinear(e,s,!this.cropToAspectRatio);if(this.interpolation==="nearest")return uo.resizeNearestNeighbor(e,s,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...AS]} are supported`)})}}DE.className="Resizing";fe(DE);/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class _E{constructor(e){this.seed=e}next(){if(this.seed!==void 0)return this.seed++}}_E.className="RandomSeed";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */class FE extends et{constructor(e){super(e),this.randomGenerator=new _E(e.seed)}getConfig(){const e={seed:this.randomGenerator.seed},t=super.getConfig();return Object.assign(e,t),e}}FE.className="BaseRandomLayer";/**
 * @license
 * Copyright 2023 CodeSmith LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */const B6=["bilinear","nearest"],DS=new Set(B6);class OE extends FE{constructor(e){super(e);const{factor:t,interpolation:s="bilinear"}=e;if(this.factor=t,Array.isArray(this.factor)&&this.factor.length===2)this.widthLower=this.factor[0],this.widthUpper=this.factor[1];else if(!Array.isArray(this.factor)&&this.factor>0)this.widthLower=-this.factor,this.widthUpper=this.factor;else throw new U(`Invalid factor: ${this.factor}. Must be positive number or tuple of 2 numbers`);if(this.widthLower<-1||this.widthUpper<-1)throw new U(`factor must have values larger than -1. Got: ${this.factor}`);if(this.widthUpper<this.widthLower)throw new U(`factor cannot have upper bound less than lower bound.
        Got upper bound: ${this.widthUpper}.
        Got lower bound: ${this.widthLower}
      `);if(s)if(DS.has(s))this.interpolation=s;else throw new U(`Invalid interpolation parameter: ${s} is not implemented`)}getConfig(){const e={factor:this.factor,interpolation:this.interpolation},t=super.getConfig();return Object.assign(e,t),e}computeOutputShape(e){e=ct(e);const t=e[2];return[this.imgHeight,-1,t]}call(e,t){return se(()=>{const s=He(e);this.imgHeight=s.shape[s.shape.length-3];const r=s.shape[s.shape.length-2];this.widthFactor=uh([1],1+this.widthLower,1+this.widthUpper,"float32",this.randomGenerator.next());let o=this.widthFactor.dataSync()[0]*r;o=Math.round(o);const i=[this.imgHeight,o];switch(this.interpolation){case"bilinear":return uo.resizeBilinear(e,i);case"nearest":return uo.resizeNearestNeighbor(e,i);default:throw new Error(`Interpolation is ${this.interpolation}
          but only ${[...DS]} are supported`)}})}}OE.className="RandomWidth";fe(OE);/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const V6=ie();V6.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,n=>{n&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var _S;(function(n){n[n.DT_INVALID=0]="DT_INVALID",n[n.DT_FLOAT=1]="DT_FLOAT",n[n.DT_DOUBLE=2]="DT_DOUBLE",n[n.DT_INT32=3]="DT_INT32",n[n.DT_UINT8=4]="DT_UINT8",n[n.DT_INT16=5]="DT_INT16",n[n.DT_INT8=6]="DT_INT8",n[n.DT_STRING=7]="DT_STRING",n[n.DT_COMPLEX64=8]="DT_COMPLEX64",n[n.DT_INT64=9]="DT_INT64",n[n.DT_BOOL=10]="DT_BOOL",n[n.DT_QINT8=11]="DT_QINT8",n[n.DT_QUINT8=12]="DT_QUINT8",n[n.DT_QINT32=13]="DT_QINT32",n[n.DT_BFLOAT16=14]="DT_BFLOAT16",n[n.DT_QINT16=15]="DT_QINT16",n[n.DT_QUINT16=16]="DT_QUINT16",n[n.DT_UINT16=17]="DT_UINT16",n[n.DT_COMPLEX128=18]="DT_COMPLEX128",n[n.DT_HALF=19]="DT_HALF",n[n.DT_RESOURCE=20]="DT_RESOURCE",n[n.DT_VARIANT=21]="DT_VARIANT",n[n.DT_UINT32=22]="DT_UINT32",n[n.DT_UINT64=23]="DT_UINT64",n[n.DT_FLOAT_REF=101]="DT_FLOAT_REF",n[n.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",n[n.DT_INT32_REF=103]="DT_INT32_REF",n[n.DT_UINT8_REF=104]="DT_UINT8_REF",n[n.DT_INT16_REF=105]="DT_INT16_REF",n[n.DT_INT8_REF=106]="DT_INT8_REF",n[n.DT_STRING_REF=107]="DT_STRING_REF",n[n.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",n[n.DT_INT64_REF=109]="DT_INT64_REF",n[n.DT_BOOL_REF=110]="DT_BOOL_REF",n[n.DT_QINT8_REF=111]="DT_QINT8_REF",n[n.DT_QUINT8_REF=112]="DT_QUINT8_REF",n[n.DT_QINT32_REF=113]="DT_QINT32_REF",n[n.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",n[n.DT_QINT16_REF=115]="DT_QINT16_REF",n[n.DT_QUINT16_REF=116]="DT_QUINT16_REF",n[n.DT_UINT16_REF=117]="DT_UINT16_REF",n[n.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",n[n.DT_HALF_REF=119]="DT_HALF_REF",n[n.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",n[n.DT_VARIANT_REF=121]="DT_VARIANT_REF",n[n.DT_UINT32_REF=122]="DT_UINT32_REF",n[n.DT_UINT64_REF=123]="DT_UINT64_REF"})(_S||(_S={}));var FS;(function(n){(function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"})(n.CheckpointFormatVersion||(n.CheckpointFormatVersion={}))})(FS||(FS={}));/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */var OS;(function(n){n[n.FAIL=0]="FAIL",n[n.SHORTEST=1]="SHORTEST",n[n.LONGEST=2]="LONGEST"})(OS||(OS={}));/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ee(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&O(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W6=E$;class Fm extends ky{nextDataId(){return Fm.nextDataId++}constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new nI(this,Rr())}write(e,t,s){this.firstUse&&(this.firstUse=!1,ie().get("IS_NODE")&&Ts(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));const r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:s,refCount:1}),r}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&uu(s[0])){const o=s.map(i=>Ko(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return{dataId:r,shape:e,dtype:t}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){const t=this.data.get(e);t.refCount++}decRef(e){if(this.data.has(e)){const t=this.data.get(e);t.refCount--}}move(e,t,s,r,o){this.data.set(e,{values:t,dtype:r,refCount:o})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){const{dtype:t,complexTensorInfos:s}=this.data.get(e);if(t==="complex64"){const r=this.readSync(s.real.dataId),o=this.readSync(s.imag.dataId);return mo(r,o)}return j3(this.data.get(e).values,t)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Qo(r));return Ze(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ze(e.shape,e.dtype,t)}makeOutput(e,t,s){return Rr().makeTensorFromTensorInfo(this.makeTensorInfo(t,s,e),this)}disposeData(e,t=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;const{complexTensorInfos:s}=this.data.get(e);s!=null&&(this.disposeData(s.real.dataId,!0),this.disposeData(s.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){const t=Jn();return e(),{kernelMs:Jn()-t}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){Ee([e],"where");const t=this.readSync(e.dataId);return W6(e.shape,t)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}Fm.nextDataId=0;/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zE(n){const e=new Float32Array(n.length);for(let t=0;t<n.length;++t)e[t]=Math.abs(n[t]);return e}const U6=n=>{const{x:e}=n.inputs,t=n.backend;Ee(e,"abs");let s=new Float32Array(ce(e.shape));const r=t.data.get(e.dataId).values;return s=zE(r),t.makeOutput(s,e.shape,e.dtype)},G6={kernelName:fp,backendName:"cpu",kernelFunc:U6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yt(n){return(e,t,s,r,o)=>{const i=Ke(e,t),a=i.length,l=ze(i),u=ce(i),d=_n(o,u),f=e.length,p=t.length,g=ze(e),x=ze(t),w=xl(e,i),v=xl(t,i);if(w.length+v.length===0)for(let b=0;b<d.length;++b)d[b]=n(s[b%s.length],r[b%r.length]);else for(let b=0;b<d.length;++b){const C=Nl(b,a,l),$=C.slice(-f);w.forEach(A=>$[A]=0);const S=Mr($,f,g),T=C.slice(-p);v.forEach(A=>T[A]=0);const E=Mr(T,p,x);d[b]=n(s[S],r[E])}return[d,i]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ps(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,a=t.makeTensorInfo(s.shape,"complex64"),l=t.data.get(a.dataId);return l.complexTensorInfos={real:t.makeTensorInfo(s.shape,"float32",o),imag:t.makeTensorInfo(r.shape,"float32",i)},a}const H6={kernelName:My,backendName:"cpu",kernelFunc:ps};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qf(n,e,t="float32"){if(t==="complex64"){const r=qf(n,e,"float32"),o=qf(n,e,"float32");return ps({inputs:{real:r,imag:o},backend:n})}const s=Fn(ce(e),t);return n.makeTensorInfo(e,t,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kr(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const j6={kernelName:Au,backendName:"cpu",kernelFunc:Kr};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aa(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.real,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const X6={kernelName:a1,backendName:"cpu",kernelFunc:aa};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ME(n,e,t,s){if(s==="int32"){const r=Int32Array.from(n);return[e,"int32",r]}if(s==="bool"){const r=ha([0],t),[o,i]=Yt((a,l)=>a!==l?1:0)(e,[],n,r,"bool");return[i,"bool",o]}throw new Error(`Error in Cast: failed to cast ${t} to ${s}`)}function ni(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return Kr({inputs:{x:r},backend:t});const d=qf(t,r.shape,r.dtype),f=ni({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),p=ps({inputs:{real:f,imag:d},backend:t});return t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),p}if(r.dtype==="complex64"){const d=aa({inputs:{input:r},backend:t}),f=ni({inputs:{x:d},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(d),f}if(!rI(r.dtype,o)){const d=Kr({inputs:{x:r},backend:t});return{dataId:d.dataId,shape:d.shape,dtype:o}}const i=t.data.get(r.dataId).values,[a,l,u]=ME(i,r.shape,r.dtype,o);return t.makeTensorInfo(a,l,u)}const K6={kernelName:yu,backendName:"cpu",kernelFunc:ni};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hn(n,e,t,s){return t==null?({inputs:r,backend:o})=>{const{a:i,b:a}=r,l=o;Ee([i,a],n);const u=l.data.get(i.dataId).values,d=l.data.get(a.dataId).values,f=i.dtype==="string"?go(u):u,p=i.dtype==="string"?go(d):d,g=s||i.dtype,[x,w]=e(i.shape,a.shape,f,p,g);return l.makeTensorInfo(w,g,x)}:({inputs:r,backend:o})=>{const{a:i,b:a}=r,l=o;if(i.dtype==="complex64"||a.dtype==="complex64"){const u=ni({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),d=l.data.get(u.dataId),f=d.complexTensorInfos.real,p=d.complexTensorInfos.imag,g=l.data.get(f.dataId).values,x=l.data.get(p.dataId).values,w=ni({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),v=l.data.get(w.dataId),b=v.complexTensorInfos.real,C=v.complexTensorInfos.imag,$=l.data.get(b.dataId).values,S=l.data.get(C.dataId).values,[T,E,A]=t(i.shape,a.shape,g,x,$,S),F=l.makeTensorInfo(A,"float32",T),D=l.makeTensorInfo(A,"float32",E),_=ps({inputs:{real:F,imag:D},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(w),l.disposeIntermediateTensorInfo(F),l.disposeIntermediateTensorInfo(D),_}else{const u=l.data.get(i.dataId).values,d=l.data.get(a.dataId).values,f=s||i.dtype,[p,g]=e(i.shape,a.shape,u,d,f);return l.makeTensorInfo(g,f,p)}}}function Gw(n){return(e,t,s,r,o,i)=>{const a=Ke(e,t),l=ce(a),u=a.length,d=ze(a),f=_n("float32",l),p=_n("float32",l),g=xl(e,a),x=xl(t,a),w=mo(s,r),v=mo(o,i),b=e.length,C=ze(e),$=t.length,S=ze(t);if(g.length+x.length===0)for(let T=0;T<f.length;T++){const E=T%w.length,A=T%v.length,F=n(w[E*2],w[E*2+1],v[A*2],v[A*2+1]);f[T]=F.real,p[T]=F.imag}else for(let T=0;T<f.length;T++){const E=Nl(T,u,d),A=E.slice(-b);g.forEach(L=>A[L]=0);const F=Mr(A,b,C),D=E.slice(-$);x.forEach(L=>D[L]=0);const _=Mr(D,$,S),N=n(w[F*2],w[F*2+1],v[_*2],v[_*2+1]);f[T]=N.real,p[T]=N.imag}return[f,p,a]}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PE=Yt((n,e)=>n+e),q6=Gw((n,e,t,s)=>({real:n+t,imag:e+s})),vl=hn(El,PE,q6),Y6={kernelName:El,backendName:"cpu",kernelFunc:vl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hw(n,e,t,s,r){const o=ce(s),i=Fn(r,t);for(let a=0;a<n.length;a++){const l=n[a];if(l<0)throw new Error("Input x must be non-negative!");l>=r||(o>0?i[l]+=e[a]:i[l]+=1)}return i}function LE(n,e,t,s=!1){const r=n.shape[0],o=n.shape[1],i=Ze([r,t],e.dtype);for(let a=0;a<r;a++)for(let l=0;l<o;l++){const u=n.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=t||(s?i.set(1,a,u):e.size>0?i.set(i.get(a,u)+e.get(a,l),a,u):i.set(i.get(a,u)+1,a,u))}return i}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BE=Yt((n,e)=>n&e),Q6=hn(zy,BE),Z6={kernelName:zy,backendName:"cpu",kernelFunc:Q6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qr(n){return(e,t,s)=>{const r=Ht(t,e.length);for(let o=0;o<e.length;++o)r[o]=n(e[o],s);return r}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yt(n,e,t){const s=qr(e);return fi(n,s,t)}function fi(n,e,t){return({inputs:s,attrs:r,backend:o})=>{const{x:i}=s;Ee(i,n);const a=o,l=a.data.get(i.dataId).values;let u;if(i.dtype==="string"){if(!Array.isArray(l))throw new Error("String tensor's value was not an instance of Array");u=go(l)}else u=l;const d=t||i.dtype,f=e(u,d,r);return a.makeTensorInfo(i.shape,d,f)}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const VE=qr(n=>Math.ceil(n)),J6=fi(wu,VE),eH={kernelName:wu,backendName:"cpu",kernelFunc:J6};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WE(n,e,t,s){const r=Ht(t,ce(e));if(s&&t!=="string"){let o=0;n.forEach(i=>{const a=ce(i.shape);r.set(i.vals,o),o+=a})}else{let o=0;n.forEach(i=>{const a=t==="string"?go(i.vals):i.vals;let l=0;for(let u=0;u<i.shape[0];++u){const d=u*e[1]+o;for(let f=0;f<i.shape[1];++f)r[d+f]=a[l++]}o+=i.shape[1]})}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UE=Yt((n,e)=>n===e?1:0),GE=hn(Np,UE,null,"bool"),tH={kernelName:Np,backendName:"cpu",kernelFunc:GE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HE=qr(n=>Math.exp(n)),jE=fi($u,HE,"float32"),nH={kernelName:$u,backendName:"cpu",kernelFunc:jE};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const XE=qr(n=>Math.expm1(n)),sH=fi(Tu,XE),rH={kernelName:Tu,backendName:"cpu",kernelFunc:sH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KE=qr(n=>Math.floor(n)),oH=fi(Nu,KE),iH={kernelName:Nu,backendName:"cpu",kernelFunc:oH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qE=Yt((n,e)=>Math.floor(n/e)),aH=hn(Eu,qE,null,"int32"),lH={kernelName:Eu,backendName:"cpu",kernelFunc:aH};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YE(n,e,t,s,r,o,i,a,l){const u=Ze([s,o],t);for(let d=0;d<s;d++){const f=[];let p=0;for(let g=0;g<r;g++){const x=n[d*r+g];p+=x*i[g],f.push(x)}if(p<0||p>=l/o)throw new Error(`Invalid indices: ${f} does not index into ${a}`);for(let g=0;g<o;g++)u.values[d*o+g]=e.get(...e.indexToLoc(p*o+g))}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QE(n,e,t){const s=Ze(t,n.dtype);for(let r=0;r<s.size;++r){const i=s.indexToLoc(r).slice(),a=i[0],l=i[2],u=e.locToIndex([a,l]);i[2]=e.values[u];const d=n.locToIndex(i);0<=d&&d<n.values.length&&(s.values[r]=n.values[d])}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZE=Yt((n,e)=>n>e?1:0),cH=hn(Dp,ZE,null,"bool"),uH={kernelName:Dp,backendName:"cpu",kernelFunc:cH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JE=Yt((n,e)=>n>=e?1:0),hH=hn(Ru,JE,null,"bool"),dH={kernelName:Ru,backendName:"cpu",kernelFunc:hH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eR=Yt((n,e)=>n<e?1:0),fH=hn(Fp,eR,null,"bool"),pH={kernelName:Fp,backendName:"cpu",kernelFunc:fH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const tR=Yt((n,e)=>n<=e?1:0),mH=hn(Op,tR,null,"bool"),gH={kernelName:Op,backendName:"cpu",kernelFunc:mH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nR(n,e,t){const s=(e-n)/(t-1),r=Fn(t,"float32");r[0]=n;for(let o=1;o<r.length;o++)r[o]=r[o-1]+s;return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sR=qr(n=>Math.log(n)),xH=fi(Ou,sR),yH={kernelName:Ou,backendName:"cpu",kernelFunc:xH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rR(n,e,t,s){const r=_n(s,ce(t));for(let o=0;o<r.length;++o){const i=o*e;let a=n[i];for(let l=0;l<e;++l){const u=n[i+l];(Number.isNaN(u)||u>a)&&(a=u)}r[o]=a}return r}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oR=Yt((n,e)=>Math.max(n,e)),wH=hn(Mu,oR),vH={kernelName:Mu,backendName:"cpu",kernelFunc:wH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iR=Yt((n,e)=>Math.min(n,e)),bH=hn(Pu,iR),CH={kernelName:Pu,backendName:"cpu",kernelFunc:bH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jw=Yt((n,e)=>n*e),kH=Gw((n,e,t,s)=>({real:n*t-e*s,imag:n*s+e*t})),Om=hn(Bu,jw,kH),SH={kernelName:Bu,backendName:"cpu",kernelFunc:Om};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aR(n,e,t){const s=oi(-1,t);return jw([],e,s,n,t)}function IH(n){const{inputs:e,backend:t}=n,{x:s}=e;Ee(s,"neg");const r=t.data.get(s.dataId).values,[o,i]=aR(r,s.shape,s.dtype);return t.makeTensorInfo(i,s.dtype,o)}const $H={kernelName:jp,backendName:"cpu",kernelFunc:IH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lR=Yt((n,e)=>n!==e?1:0),TH=hn(Xp,lR,null,"bool"),NH={kernelName:Xp,backendName:"cpu",kernelFunc:TH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xw(n,e,t,s,r){const o=e.length,i=ce(e),a=ze(e),l=ze(r),u=_n(t,ce(r));for(let d=0;d<i;++d){const f=Nl(d,o,a),p=new Array(f.length);for(let x=0;x<p.length;x++)p[x]=f[s[x]];const g=Mr(p,o,l);u[g]=n[d]}return u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rs(n){const{inputs:e,attrs:t,backend:s}=n,{x:r}=e,{perm:o}=t;Ee(r,"transpose");const i=r.shape.length,a=new Array(i);for(let f=0;f<a.length;f++)a[f]=r.shape[o[f]];const l=s.data.get(r.dataId).values,u=Xw(l,r.shape,r.dtype,o,a);return{dataId:s.write(u,a,r.dtype),shape:a,dtype:r.dtype}}const EH={kernelName:rl,backendName:"cpu",kernelFunc:rs};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cR(n,e,t,s){const[r,o]=wn(n,s),i=xs(e,"int32"),a=Fn(ce(r),i),l=ce(o);for(let u=0;u<a.length;++u){const d=u*l;let f=1;for(let p=0;p<l;++p)f*=t[d+p];a[u]=f}return{outVals:a,outShape:r,outDtype:i}}function RH(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Ee(r,"prod");const a=r.shape.length,l=Je(o,r.shape),u=Bt(l,a);let d=l,f=r;const p=[];u!=null&&(f=rs({inputs:{x:r},backend:t,attrs:{perm:u}}),p.push(f),d=Kt(d.length,a));const g=t.data.get(f.dataId).values,{outVals:x,outShape:w,outDtype:v}=cR(f.shape,f.dtype,g,d);let b=w;return i&&(b=tn(w,l)),p.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.makeTensorInfo(b,v,x)}const AH={kernelName:Jp,backendName:"cpu",kernelFunc:RH};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DH(n,e,t){n.forEach((s,r)=>{if(s<0||s>=t){const o=Nl(r,e.length,ze(e)).join(",");throw new Error(`indices[${o}] = ${s} is not in [0, ${t})`)}})}function _H(n,e){for(let t=0;t<n.length;++t){const s=n[t],r=t===n.length-1?e:n[t+1].length;if(s.length===0)throw new Error("Ragged splits may not be empty");if(s[0]<0)throw new Error("Ragged splits must be non-negative");if(s[s.length-1]>r)throw new Error("Ragged splits must not point past values");for(let o=1;o<s.length;++o)if(s[o-1]>s[o])throw new Error("Ragged splits must be sorted in ascending order")}}function FH(n,e,t,s){const r=[];let o=0;const i=e.length-1+t.length,a=new Array(i).fill(null).map(()=>[0]);_H(t,s);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];const d=e[u+1];for(let f=1;f<l+1;++f)a[u].push(f*d)}for(let u=0;u<n.length;++u){let d=n[u],f=n[u]+1;for(let p=0;p<t.length;++p){const g=t[p],x=p+e.length-1;if(x>=0){const w=a[x],v=w[w.length-1]-g[d];for(let b=d;b<f;++b)a[x].push(g[b+1]+v)}d=g[d],f=g[f]}f!==d&&(r.push([d,f]),o+=f-d)}return{outSplits:a,valueSlices:r,numValues:o}}function OH(n){const e=[];for(let t=0;t<n.length;++t){const s=n[t].length,r=Ht("int32",s);e.push(r),n[t].forEach((o,i)=>r[i]=o)}return e}function zS(n,e){const t=n.slice(0,e);for(;t.length<e;)t.push(1);for(let s=e;s<n.length;s++)t[e-1]*=n[s];return t}function zH(n,e,t,s,r,o){const i=zS(e,2)[1],a=zS(o,2)[1];let l=0;for(const u of t)for(let d=u[0];d<u[1];++d){for(let f=0;f<s;++f)r[l*a+f]=n[d*i+f];++l}}function MH(n,e,t,s,r){const o=e.slice();o[0]=r;const i=Ht(t,ce(o)),a=n.length,l=a===0?0:a/e[0];return zH(n,e,s,l,i,o),[i,o]}function uR(n,e,t,s,r,o,i,a){if(n.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");const l=e[0][0]-1;if(DH(o,i,l),s.length===0)throw new Error("params.rank must be nonzero");const u=s[0],{outSplits:d,valueSlices:f,numValues:p}=FH(o,i,n,u),g=OH(d),x=MH(t,s,r,f,p);return[g,x[0],x[1]]}/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const MS=2147483647;function hR(n,e,t,s,r,o,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(r.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");const a=e.length===0,l=r.length===0,u=i.length===0,d=[];a||d.push(e[0]),l||d.push(r[0]),u||d.push(i[0]);for(let v=1;v<d.length;++v)if(d[v]!==d[v-1])throw new Error("starts, limits, and deltas must have the same shape");const f=d.length===0?1:d[0],p=Ht("int32",f+1);p[0]=0;for(let v=0;v<f;++v){const b=a?n[0]:n[v],C=l?s[0]:s[v],$=u?o[0]:o[v];if($===0)throw new Error("Requires delta != 0");let S;if($>0&&C<b||$<0&&C>b)S=0;else if(S=Math.ceil(Math.abs((C-b)/$)),S>MS)throw new Error(`Requires ((limit - start) / delta) <= ${MS}`);p[v+1]=p[v]+S}const g=p[f],x=Ht(t,g);let w=0;for(let v=0;v<f;++v){const b=p[v+1]-p[v];let C=a?n[0]:n[v];const $=u?o[0]:o[v];for(let S=0;S<b;++S)x[w++]=C,C+=$}return[p,x]}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var Ws=fr;class Yf{constructor(e,t,s,r,o,i,a,l,u,d){this.shape=e,this.shapeShape=t,this.values=s,this.valuesShape=r,this.valuesDType=o,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=Y$(d),this.raggedRank=Q$(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Ws.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Ws.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){const t=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Ws.VALUE_ROWIDS:return Yf.getMaxWidthValueRowID(t);case Ws.ROW_SPLITS:return Yf.getMaxWidthRowSplit(t);default:throw new Error(`Cannot handle partition type ${Ws[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){const t=e.length;if(t===0||t===1)return 0;let s=0;for(let r=0;r<t-1;++r){const o=e[r+1]-e[r];o>s&&(s=o)}return s}static getMaxWidthValueRowID(e){const t=e.length;if(t===0)return 0;let s=0,r=e[0],o=0;for(let i=1;i<t;++i){const a=e[i];a!==r&&(r=a,o=Math.max(i-s,o),s=i)}return Math.max(t-s,o)}tensorShapeFromTensor(e,t,s=!0){if(t.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return LS(e,s)}calculateOutputSize(e){const t=this.valuesShape,s=this.defaultValueShape;Z$(s,t);const r=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=q$(this.raggedRank,r,t);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,t,s){const r=Math.min(e,s),o=[];let i=0;for(let a=0;a<r;++a,i+=t)o.push(i);for(let a=r;a<e;++a)o.push(-1);return O(o.length===e,()=>"Final length of result must be equal to firstDimension."),o}calculateOutputIndexRowSplit(e,t,s,r){const o=e.length,i=[];for(let a=0;a<o-1;++a){const l=e[a+1]-e[a];let u=Math.min(r,l),d=t[a];d===-1&&(u=0);for(let f=0;f<u;++f)i.push(d),d+=s;for(let f=0;f<l-u;++f)i.push(-1)}if(o>0&&i.length!==e[o-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,t,s,r){const o=e.length,i=[];if(o===0)return[];let a=0,l=e[0];if(l>=t.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${t.length}`);let u=t[l];i.push(u);for(let d=1;d<o;++d){const f=e[d];if(f===l)u>=0&&(++a,a<r?u+=s:u=-1);else{if(a=0,l=f,f>=t.length)throw new Error(`Got nextValueRowId=${f} which is not less than ${t.length}`);u=t[f]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,t,s,r){const o=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case Ws.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(o,t,s,r);case Ws.ROW_SPLITS:if(o.length-1>t.length)throw new Error(`Row partition size is greater than output size: ${o.length-1} > ${t.length}`);return this.calculateOutputIndexRowSplit(o,t,s,r);default:throw new Error(`Unsupported partition type: ${Ws[i]}`)}}getFirstDimensionSize(){const e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");const t=this.rowPartitionTypes[0];switch(t){case Ws.FIRST_DIM_SIZE:return e[0];case Ws.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Ws.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Ws[t]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");const t=this.getFirstDimensionSize(),s=this.calculateOutputSize(t),r=new Array(this.raggedRank+1);r[r.length-1]=1;for(let l=r.length-2;l>=0;--l)r[l]=r[l+1]*s[l+1];const o=LS(s,!1),i=Ht(this.valuesDType,ce(o));if(r[0]*s[0]>0){let l=this.calculateFirstParentOutputIndex(t,r[0],s[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,r[u],s[u]);this.setOutput(this.raggedRank,l,i,o)}return[o,i]}setOutput(e,t,s,r){if(s.length===0)return;const o=this.values,i=s;let a=r.slice();a=a.slice(e+1);const l=ce(a),u=t.length;let d=this.defaultValue;if(d.length!==l&&d.length!==1){const x=this.defaultValueShape;se(()=>{const w=J(d,x);d=Gc(w,a).dataSync()})}let f=0,p=0,g=0;for(let x=0;x<=u;++x){let w=x<u?t[x]:-1;if(w===g){++g;continue}if(p<g){const v=o.subarray(f*l),b=i.subarray(p*l),C=(g-p)*l;PS(b,v,C)}if(x>=u){const v=s.length;w=Math.floor(v/l)}if(w>g)if(this.defaultValue.length===1)i.subarray(g*l,w*l).fill(this.defaultValue[0]),g=w;else for(;w>g;){const v=i.slice(g*l);PS(v,d,l),++g}w<0?(f=x+1,p=g):(f=x,p=g,g=p+1)}}}function PS(n,e,t){for(let s=0;s<t;s++)n[s]=e[s]}function LS(n,e){const t=[];for(let s of n){if(s<0){if(!e)throw new Error(`Dimension ${s} must be >= 0`);if(s<-1)throw new Error(`Dimension ${s} must be >= -1`);s=-1}t.push(s)}return t}function dR(n,e,t,s,r,o,i,a,l,u){return new Yf(n,e,t,s,r,o,i,a,l,u).compute()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fR(n,e,t,s){const r=n===e,o=n<e&&t<0,i=e<n&&t>1;if(r||o||i)return Fn(0,s);const a=Math.abs(Math.ceil((e-n)/t)),l=Fn(a,s);e<n&&t===1&&(t=-1),l[0]=n;for(let u=1;u<l.length;u++)l[u]=l[u-1]+t;return l}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pR=qr(n=>1/Math.sqrt(n)),PH=fi(ju,pR),LH={kernelName:ju,backendName:"cpu",kernelFunc:PH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vi(n,e,t,s,r,o,i,a,l,u){const d=[s/r,r],f=n.values,p=e.values;if(s===0)return Ze(t,e.dtype);const g=l instanceof Tn?l:Ze(d,e.dtype);typeof l=="string"||typeof l=="number"?g.values.fill(l):typeof l=="boolean"&&g.values.fill(+l);for(let x=0;x<o;x++){const w=[];let v=0;for(let b=0;b<i;b++){const C=f[x*i+b];w.push(C),v+=C*a[b]}if(v<0||v>=s/r)throw new Error(`Invalid indices: ${w} does not index into ${t}`);for(let b=0;b<r;b++)u?g.values[v*r+b]+=p[x*r+b]:g.values[v*r+b]=e.rank===0?p[0]:p[x*r+b]}return g}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const BH=qr(n=>1/(1+Math.exp(-n))),mR=yt(Qu,n=>1/(1+Math.exp(-n))),VH={kernelName:Qu,backendName:"cpu",kernelFunc:mR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function gR(n,e,t,s,r){const o=ew(s,e,t),i=ce(t),a=ze(s);if(o){const f=tw(e,a);return r==="string"?n.slice(f,f+i):n.subarray(f,f+i)}const l=r==="string"?go(n):n,u=Ze(s,r,l),d=Ze(t,r);for(let f=0;f<d.size;++f){const p=d.indexToLoc(f),g=p.map((x,w)=>x+e[w]);d.set(u.get(...g),...p)}return r==="string"?yT(d.values):d.values}function la(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s;Ee(r,"slice");const[a,l]=vm(r,o,i);Z1(r,a,l);const u=t.data.get(r.dataId).values,d=gR(u,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,d)}const WH={kernelName:om,backendName:"cpu",kernelFunc:la};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xR(n,e,t,s,r,o,i){const a=e[0],l=o[0],u=new Array(l),d=new Array(a),f=e[1];if(l===0){if(a!==0)throw new Error(oT(a));const v=Ht(t,0),b=Ht(r,0);return[v,[0,f],b,u,d]}let p=!0,g=0;const x=new Array(l).fill(0);for(let v=0;v<a;++v){const b=n[v*f];if(b<0)throw new Error(iT(v,b));if(b>=l)throw new Error(aT(v,b,l));++x[b],p=p&&b>=g,g=b}let w=!0;for(let v=0;v<l;++v){const b=x[v]===0;u[v]=b,w=w&&!b,x[v]=Math.max(x[v],1),v>0&&(x[v]+=x[v-1])}if(w&&p){const v=n,b=s;for(let C=0;C<a;++C)d[C]=C;return[v,[a,f],b,u,d]}else{const v=x[l-1],b=Ht(t,v*f),C=Ht(r,v),$=new Array(l).fill(0);for(let S=0;S<a;++S){const T=n[S*f],E=$[T],A=(T===0?0:x[T-1])+E;$[T]++;for(let F=0;F<f;++F)b[A*f+F]=n[S*f+F];C[A]=s[S],d[S]=A}for(let S=0;S<l;++S)if($[S]===0){const E=S===0?0:x[S-1];b[E*f+0]=S;for(let A=1;A<f;++A)b[E*f+A]=0;C[E]=i}return[b,[v,f],C,u,d]}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yR(n,e,t,s,r){const o=ce(s),i=e[0],a=r.length,l=[];let u=1,d=-1;for(let v=0;v<a;++v){const b=r[v];if(b===-1){if(d!==-1)throw new Error(lT(d,v));d=v,l.push(1)}else{if(b<0)throw new Error(cT(v,b));u*=b,l.push(b)}}if(d!==-1){if(u<=0)throw new Error(uT());const v=Math.trunc(o/u);if(u*v!==o)throw new Error(hT(s,l));l[d]=v}if(ce(l)!==o)throw new Error(dT(s,l));const p=s.length,g=[];if(p>0){g[p-1]=1;for(let v=p-2;v>=0;--v)g[v]=g[v+1]*s[v+1]}const x=[];if(a>0){x[a-1]=1;for(let v=a-2;v>=0;--v)x[v]=x[v+1]*l[v+1]}const w=Ht(t,i*a);for(let v=0;v<i;++v){let b=0;for(let C=0;C<p;++C)b+=n[v*p+C]*g[C];for(let C=0;C<a;++C)w[v*a+C]=Math.trunc(b/x[C]),b%=x[C]}return[w,[i,a],l]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Kw(n,e,t,s,r,o=!1,i=0){const a=s.length,l=[e[0],n.length/e[0]],u=l[1],f=a>0?r[a-1]+1:0;if(f<0)throw new Error(Hx());const p=e.slice();p[0]=f;const g=p.reduce(($,S)=>$*S,1),x=Ht(t,g);if(a===0)return f>0&&x.fill(i),[x,p];if(f<=0)throw new Error(Hx());let w=0,v=1,b=0,C=r[w];for(;;){let $=0;if(v<a){if($=r[v],C===$){++v;continue}if(C>=$)throw new Error(fT())}if(C<0||C>=f)throw new Error(pT(C,f));C>b&&x.fill(i,b*u,C*u);for(let S=w;S<v;++S){const T=s[S];if(T<0||T>=l[0])throw new Error(mT(S,s[S],l[0]));for(let E=0;E<u;E++)x[C*u+E]+=n[T*u+E]}if(o)for(let S=0;S<u;S++)x[C*u+S]/=v-w;if(w=v,++v,b=C+1,C=$,v>a)break}return b<f&&x.fill(i,b*u,f*u),[x,p]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const UH=qr(n=>Math.sqrt(n)),GH=yt(Ju,n=>Math.sqrt(n)),HH={kernelName:Ju,backendName:"cpu",kernelFunc:GH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wR=Yt((n,e)=>{const t=n-e;return t*t}),jH=hn(eh,wR),XH={kernelName:eh,backendName:"cpu",kernelFunc:jH};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vR=qr((n,e)=>{const{pattern:t,replaceGlobal:s,rewrite:r}=e;return n.replace(new RegExp(t,s?"g":""),r)}),KH=fi(h1,vR),qH={kernelName:h1,backendName:"cpu",kernelFunc:KH};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bR(n,e,t,s){const r=Ze(n,e.dtype);for(let o=0;o<r.size;o++){const i=r.indexToLoc(o),a=new Array(i.length);for(let l=0;l<a.length;l++)a[l]=i[l]*t[l]+s[l];r.set(e.get(...a),...i)}return r}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class YH{constructor(e,t,s,r,o,i){this.separator=Ko(e),this.nGramWidths=t,this.leftPad=Ko(s),this.rightPad=Ko(r),this.padWidth=o,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,t){const s=this.getPadWidth(t);return Math.max(0,e+2*s-t+1)}createNGrams(e,t,s,r,o,i){for(let a=0;a<o;++a){const l=this.getPadWidth(i),u=Math.max(0,l-a),d=Math.max(0,l-(o-(a+1))),f=i-(u+d),p=t+(u>0?0:a-l);let g=0;g+=u*this.leftPad.length;for(let C=0;C<f;++C)g+=e[p+C].length;g+=d*this.rightPad.length;const x=u+d+f-1;g+=x*this.separator.length,s[r+a]=new Uint8Array(g);const w=s[r+a];let v=0;const b=C=>C.forEach($=>w[v++]=$);for(let C=0;C<u;++C)b(this.leftPad),b(this.separator);for(let C=0;C<f-1;++C)b(e[p+C]),b(this.separator);if(f>0){b(e[p+f-1]);for(let C=0;C<d;++C)b(this.separator),b(this.rightPad)}else{for(let C=0;C<d-1;++C)b(this.rightPad),b(this.separator);b(this.rightPad)}}}compute(e,t){const s=e.length,r=t.length;if(r>0){let l=t[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<r;++u){let d=t[u]>=l;if(d=d&&t[u]<=s,!d)throw new Error(`Invalid split value ${t[u]}, must be in [${l}, ${s}]`);l=t[u]}if(l!==s)throw new Error(`Last split value must be data size. Expected ${s}, got ${l}`)}const o=r-1,i=Ht("int32",r);if(s===0||r===0){const l=new Array(s);for(let u=0;u<=o;++u)i[u]=0;return[l,i]}i[0]=0;for(let l=1;l<=o;++l){const u=t[l]-t[l-1];let d=0;this.nGramWidths.forEach(f=>{d+=this.getNumNGrams(u,f)}),this.preserveShort&&u>0&&d===0&&(d=1),i[l]=i[l-1]+d}const a=new Array(i[o]);for(let l=0;l<o;++l){const u=t[l];let d=i[l];if(this.nGramWidths.forEach(f=>{const p=t[l+1]-t[l],g=this.getNumNGrams(p,f);this.createNGrams(e,u,a,d,g,f),d+=g}),this.preserveShort&&d===i[l]){const f=t[l+1]-t[l];if(f===0)continue;const p=f+2*this.padWidth;this.createNGrams(e,u,a,d,1,p)}}return[a,i]}}function CR(n,e,t,s,r,o,i,a){return new YH(t,s,r,o,i,a).compute(n,e)}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QH(n,e,t,s){if(!n.length)return;if(e.length===0){for(let o=0;o<n.length;++o)s.push(n.subarray(o,o+1));return}if(e.length===1){const o=e[0];let i=n.indexOf(o);for(;i!==-1;){const a=n.subarray(0,i);(!t||a.length!==0)&&s.push(a),n=n.subarray(i+1),i=n.indexOf(o)}(!t||n.length!==0)&&s.push(n);return}let r=0;for(let o=0;o<n.length+1;o++)if(o===n.length||e.indexOf(n[o])!==-1){const i=n.subarray(r,o);(!t||i.length!==0)&&s.push(i),r=o+1}}function kR(n,e,t){const s=n.length,r=[];let o=0,i=0;const a=new Array(s);for(let p=0;p<s;++p){const g=r.length;QH(n[p],e,t,r);const x=r.length-g;a[p]=x,o+=x,i=Math.max(i,x)}const l=Ht("int32",o*2),u=new Array(o),d=[s,i];let f=0;for(let p=0;p<s;++p)for(let g=0;g<a[p];++g)l[f*2]=p,l[f*2+1]=g,u[f]=r[f],++f;return[l,u,d]}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function SR(n,e){const t=Ht("int32",n.length);for(let s=0;s<n.length;++s)t[s]=hM(n[s]).modulo(e).getLowBitsUnsigned();return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IR=Yt((n,e)=>n-e),ZH=Gw((n,e,t,s)=>({real:n-t,imag:e-s})),qw=hn(th,IR,ZH),JH={kernelName:th,backendName:"cpu",kernelFunc:qw};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $R(n,e){const t=new Array(n.rank);for(let r=0;r<t.length;r++)t[r]=n.shape[r]*e[r];const s=Ze(t,n.dtype);for(let r=0;r<s.values.length;++r){const o=s.indexToLoc(r),i=new Array(n.rank);for(let l=0;l<i.length;l++)i[l]=o[l]%n.shape[l];const a=n.locToIndex(i);s.values[r]=n.values[a]}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Lc=(n,e)=>{const t=e.value-n.value;return t===0?n.index-e.index:t};function TR(n,e,t=0,s=n.length-1){for(;s>t;){if(s-t>600){const a=s-t+1,l=e-t+1,u=Math.log(a),d=.5*Math.exp(2*u/3),f=.5*Math.sqrt(u*d*(a-d)/a)*Math.sign(l-a/2),p=Math.max(t,Math.floor(e-l*d/a+f)),g=Math.min(s,Math.floor(e+(a-l)*d/a+f));TR(n,e,p,g)}const r=n[e];let o=t,i=s;for(Qa(n,t,e),Lc(n[s],r)>0&&Qa(n,t,s);o<i;){for(Qa(n,o,i),o++,i--;Lc(n[o],r)<0;)o=o+1;for(;Lc(n[i],r)>0;)i=i-1}Lc(n[t],r)===0?Qa(n,t,i):(i=i+1,Qa(n,i,s)),i<=e&&(t=i+1),e<=i&&(s=i-1)}}function NR(n,e,t,s,r){const o=e[e.length-1],[i,a]=[n.length/o,o],l=_n(t,i*s),u=_n("int32",i*s);for(let f=0;f<i;f++){const p=f*a,g=n.subarray(p,p+a);let x=new Array(g.length);g.forEach((C,$)=>x[$]={value:C,index:$}),s<x.length&&(TR(x,s),x=x.slice(0,s)),r&&x.sort(Lc);const w=f*s,v=l.subarray(w,w+s),b=u.subarray(w,w+s);for(let C=0;C<s;C++)v[C]=x[C].value,b[C]=x[C].index}const d=e.slice();return d[d.length-1]=s,[Ze(d,t,l),Ze(d,"int32",u)]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ER(n,e,t,s){const r=Je(e,t)[0],o=[1,t[0],1];for(let x=0;x<r;x++)o[0]*=t[x];o[1]=t[r];for(let x=r+1;x<t.length;x++)o[2]*=t[x];const i=new Map,a=new Int32Array(t[r]),l=new Tn(o,s,n),u=[],d=o[0]===1&&o[2]===1;for(let x=0;x<t[r];x++){let w;if(d)w=n[x].toString();else{const b=[];for(let C=0;C<o[0];C++)for(let $=0;$<o[2];$++)b.push(l.get(C,x,$));w=b.join(",")}const v=i.get(w);if(v!=null)a[x]=v;else{const b=i.size;i.set(w,b),a[x]=b,u.push(x)}}const f=o.slice();f[1]=i.size;const p=new Tn(f,s);u.forEach((x,w)=>{for(let v=0;v<o[0];v++)for(let b=0;b<o[2];b++)p.set(l.get(v,x,b),v,w,b)});const g=t.slice();return g[r]=f[1],{outputValues:p.values,outputShape:g,indices:a}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ej=Object.freeze(Object.defineProperty({__proto__:null,addImpl:PE,bincountImpl:Hw,bincountReduceImpl:LE,bitwiseAndImpl:BE,castImpl:ME,ceilImpl:VE,concatImpl:WE,equalImpl:UE,expImpl:HE,expm1Impl:XE,floorDivImpl:qE,floorImpl:KE,gatherNdImpl:YE,gatherV2Impl:QE,greaterEqualImpl:JE,greaterImpl:ZE,lessEqualImpl:tR,lessImpl:eR,linSpaceImpl:nR,logImpl:sR,maxImpl:rR,maximumImpl:oR,minimumImpl:iR,multiplyImpl:jw,negImpl:aR,notEqualImpl:lR,prodImpl:cR,raggedGatherImpl:uR,raggedRangeImpl:hR,raggedTensorToTensorImpl:dR,rangeImpl:fR,rsqrtImpl:pR,scatterImpl:Vi,sigmoidImpl:BH,simpleAbsImpl:zE,sliceImpl:gR,sparseFillEmptyRowsImpl:xR,sparseReshapeImpl:yR,sparseSegmentReductionImpl:Kw,sqrtImpl:UH,squaredDifferenceImpl:wR,staticRegexReplaceImpl:vR,stridedSliceImpl:bR,stringNGramsImpl:CR,stringSplitImpl:kR,stringToHashBucketFastImpl:SR,subImpl:IR,tileImpl:$R,topKImpl:NR,transposeImpl:Xw,uniqueImpl:ER},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */XI("cpu",()=>new Fm,1);/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const RR=yt(Su,n=>n>=0?n:Math.exp(n)-1),tj={kernelName:Su,backendName:"cpu",kernelFunc:RR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AR(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s;Ee([r],"leakyRelu");const i=ce(r.shape),a=t.data.get(r.dataId).values,l=_n("float32",i);for(let u=0;u<a.length;u++)l[u]=a[u]<0?o*a[u]:a[u];return t.makeTensorInfo(r.shape,"float32",l)}const nj={kernelName:_p,backendName:"cpu",kernelFunc:AR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const sj=Yt((n,e)=>n<0?e*n:n);function DR(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e;Ee([s,r],"prelu");const o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,[a,l]=sj(s.shape,r.shape,o,i,"float32");return t.makeTensorInfo(l,"float32",a)}const rj={kernelName:Zp,backendName:"cpu",kernelFunc:DR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _R=yt(Uu,n=>Math.max(0,n)),oj={kernelName:Uu,backendName:"cpu",kernelFunc:_R};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FR=yt(Gu,n=>Math.min(Math.max(0,n),6)),ij={kernelName:Gu,backendName:"cpu",kernelFunc:FR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qf(n,e,t,s,r){if(t==="linear")return Kr({inputs:{x:e},backend:n});if(t==="relu")return _R({inputs:{x:e},backend:n});if(t==="elu")return RR({inputs:{x:e},backend:n});if(t==="relu6")return FR({inputs:{x:e},backend:n});if(t==="prelu")return DR({inputs:{x:e,alpha:s},backend:n});if(t==="leakyrelu")return AR({inputs:{x:e},backend:n,attrs:{alpha:r}});if(t==="sigmoid")return mR({inputs:{x:e},backend:n});throw new Error(`Activation ${t} has not been implemented for the CPU backend.`)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nt(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=ce(r.shape),a=sI(o,i),l=ce(a);O(i===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${r.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),t.incRef(r.dataId);const u=t.data.get(r.dataId);if(u.complexTensorInfos!=null){const d=u.complexTensorInfos.real,f=u.complexTensorInfos.imag;d.shape=a,f.shape=a}return{dataId:r.dataId,shape:a,dtype:r.dtype}}const aj={kernelName:em,backendName:"cpu",kernelFunc:Nt};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function OR(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;Ee([r,o],"matMul");const l=r.shape.length,u=o.shape.length,d=i?r.shape[l-2]:r.shape[l-1],f=a?o.shape[u-1]:o.shape[u-2],p=i?r.shape[l-1]:r.shape[l-2],g=a?o.shape[u-2]:o.shape[u-1],x=r.shape.slice(0,-2),w=o.shape.slice(0,-2),v=ce(x),b=ce(w),$=Ke(r.shape.slice(0,-2),o.shape.slice(0,-2)).concat([p,g]);O(d===f,()=>`Error in matMul: inner shapes (${d}) and (${f}) of Tensors with shapes ${r.shape} and ${o.shape} and transposeA=${i} and transposeB=${a} must match.`);const S=i?[v,d,p]:[v,p,d],T=a?[b,g,f]:[b,f,g],E=Nt({inputs:{x:r},backend:t,attrs:{shape:S}}),A=Nt({inputs:{x:o},backend:t,attrs:{shape:T}}),F=i?E.shape[1]:E.shape[2],D=i?E.shape[2]:E.shape[1],_=a?A.shape[1]:A.shape[2],N=Math.max(v,b),L=t.data.get(E.dataId).values,G=t.data.get(A.dataId).values,Q=ze(E.shape),K=ze(A.shape),[Z,te,B]=i?[Q[0],1,Q[1]]:[Q[0],Q[1],1],[H,X,z]=a?[1,K[1],K[0]]:[K[1],1,K[0]],V=D*_,oe=Ze([N,D,_],E.dtype),ue=oe.values,he=t.blockSize;for(let de=0;de<N;de++){const we=de%v,xe=de%b;for(let be=0;be<D;be+=he){const Te=Math.min(be+he,D);for(let Pe=0;Pe<_;Pe+=he){const Ve=Math.min(Pe+he,_);for(let st=0;st<F;st+=he){const Xe=Math.min(st+he,F);for(let nt=be;nt<Te;nt++)for(let rt=Pe;rt<Ve;rt++){let ut=0;for(let lt=st;lt<Xe;lt++){const vn=L[we*Z+nt*te+lt*B],Et=G[lt*H+rt*X+xe*z];ut+=vn*Et}ue[de*V+(nt*_+rt)]+=ut}}}}}return t.disposeIntermediateTensorInfo(E),t.disposeIntermediateTensorInfo(A),t.makeTensorInfo($,oe.dtype,oe.values)}const lj={kernelName:yp,backendName:"cpu",kernelFunc:OR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cj(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;let p,g,x;const w=[];p=OR({inputs:{a:r,b:o},attrs:{transposeA:l,transposeB:u},backend:t}),i&&(g=vl({inputs:{a:p,b:i},backend:t}),w.push(p),p=g),d&&(x=Qf(t,p,d,a,f),w.push(p),p=x);for(const b of w)t.disposeIntermediateTensorInfo(b);return p}const uj={kernelName:Ef,backendName:"cpu",kernelFunc:cj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const hj=yt(hu,n=>Math.acos(n)),dj={kernelName:hu,backendName:"cpu",kernelFunc:hj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fj=yt(du,n=>Math.acosh(n)),pj={kernelName:du,backendName:"cpu",kernelFunc:fj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mj(n){const{inputs:e,backend:t}=n,s=e;Ee(e,"addN");const r=s.map(a=>t.data.get(a.dataId).values),o=Ze(s[0].shape,s[0].dtype),i=o.values;for(let a=0;a<s.length;a++){const l=r[a];for(let u=0;u<i.length;u++)i[u]+=l[u]}return t.makeTensorInfo(o.shape,o.dtype,o.values)}const gj={kernelName:Ry,backendName:"cpu",kernelFunc:mj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xj(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Ee(r,"all");const a=Je(o,r.shape);let l=a;const u=Bt(l,r.shape.length);let d=r;u!=null&&(d=rs({inputs:{x:r},backend:t,attrs:{perm:u}}),l=Kt(l.length,r.shape.length)),En("all",l,d.shape.length);const[f,p]=wn(d.shape,l),g=ce(p),x=Fn(ce(f),d.dtype),w=t.data.get(d.dataId).values;for(let b=0;b<x.length;++b){const C=b*g;let $=w[C];for(let S=0;S<g;++S){const T=w[C+S];$=$&&T}x[b]=$}u!=null&&t.disposeIntermediateTensorInfo(d);const v=t.makeTensorInfo(f,d.dtype,x);if(i){const b=tn(f,a),C=Nt({inputs:{x:v},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(v),C}return v}const yj={kernelName:Ay,backendName:"cpu",kernelFunc:xj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wj(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Ee(r,"any");const a=Je(o,r.shape);let l=a;const u=Bt(l,r.shape.length);let d=r;u!=null&&(d=rs({inputs:{x:r},backend:t,attrs:{perm:u}}),l=Kt(l.length,r.shape.length)),En("any",l,d.shape.length);const[f,p]=wn(d.shape,l),g=ce(p),x=Fn(ce(f),d.dtype),w=t.data.get(d.dataId).values;for(let b=0;b<x.length;++b){const C=b*g;let $=w[C];for(let S=0;S<g;++S){const T=w[C+S];$=$||T}x[b]=$}u!=null&&t.disposeIntermediateTensorInfo(d);const v=t.makeTensorInfo(f,d.dtype,x);if(i){const b=tn(f,a),C=Nt({inputs:{x:v},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(v),C}return v}const vj={kernelName:Dy,backendName:"cpu",kernelFunc:wj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bj(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;Ee(r,"argMax");let i=Je(o,r.shape);const a=Bt(i,r.shape.length);let l=r;const u=[];a!=null&&(l=rs({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),i=Kt(i.length,l.shape.length)),i=[i[0]],En("argMax",i,l.shape.length);const[d,f]=wn(l.shape,i),p=ce(d),g=Fn(p,"int32"),x=ce(f),w=t.data.get(l.dataId).values;for(let v=0;v<g.length;++v){const b=v*x;let C=w[b],$=0;for(let S=0;S<x;++S){const T=w[b+S];T>C&&(C=T,$=S)}g[v]=$}return u.forEach(v=>t.disposeIntermediateTensorInfo(v)),t.makeTensorInfo(d,"int32",g)}const Cj={kernelName:pp,backendName:"cpu",kernelFunc:bj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kj(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;Ee(r,"argMin");let i=Je(o,r.shape);const a=Bt(i,r.shape.length);let l=r;const u=[];a!=null&&(l=rs({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),i=Kt(i.length,l.shape.length)),i=[i[0]],En("argMin",i,l.shape.length);const[d,f]=wn(l.shape,i),p=ce(d),g=Fn(p,"int32"),x=ce(f),w=t.data.get(l.dataId).values;for(let v=0;v<g.length;++v){const b=v*x;let C=w[b],$=0;for(let S=0;S<x;++S){const T=w[b+S];T<C&&(C=T,$=S)}g[v]=$}return u.forEach(v=>t.disposeIntermediateTensorInfo(v)),t.makeTensorInfo(d,"int32",g)}const Sj={kernelName:mp,backendName:"cpu",kernelFunc:kj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ij=yt(fu,n=>Math.asin(n)),$j={kernelName:fu,backendName:"cpu",kernelFunc:Ij};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Tj=yt(pu,n=>Math.asinh(n)),Nj={kernelName:pu,backendName:"cpu",kernelFunc:Tj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ej=yt(mu,n=>Math.atan(n)),Rj={kernelName:mu,backendName:"cpu",kernelFunc:Ej};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Aj=Yt((n,e)=>Math.atan2(n,e)),Dj=hn(xu,Aj),_j={kernelName:xu,backendName:"cpu",kernelFunc:Dj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fj=yt(gu,n=>Math.atanh(n)),Oj={kernelName:gu,backendName:"cpu",kernelFunc:Fj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yw(n,e,t,s,r,o){const i=r.strideHeight,a=r.strideWidth,l=r.dilationHeight,u=r.dilationWidth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=r.padInfo.top,g=r.padInfo.left,x=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,w=Ze(r.outShape,t),v=w.values,b=r.outShape[1]*r.outShape[2]*r.outShape[3],C=r.outShape[2]*r.outShape[3],$=r.outShape[3];for(let S=0;S<r.batchSize;++S){const T=S*b,E=S*s[0];for(let A=0;A<r.inChannels;++A)for(let F=0;F<r.outHeight;++F){const D=F*i-p,_=Math.max(0,D),N=Math.min(r.inHeight,d+D),L=T+F*C;for(let G=0;G<r.outWidth;++G){const Q=G*a-g,K=Math.max(0,Q),Z=Math.min(r.inWidth,f+Q);let te=x,B=0,H=0;for(let z=_;z<N;z+=l){const V=E+z*s[1];for(let oe=K;oe<Z;oe+=u){const ue=V+oe*s[2],he=n[ue+A];o==="max"&&he>te?te=he:o==="avg"&&(B+=he,H++)}if(isNaN(te))break}const X=L+G*$+A;v[X]=o==="avg"?B/H:te}}}return w}function zR(n,e,t,s,r=!1,o=!1){const i=Ze(s.outShape,"int32"),a=s.strideHeight,l=s.strideWidth,u=s.dilationHeight,d=s.dilationWidth,f=s.effectiveFilterHeight,p=s.effectiveFilterWidth,g=s.padInfo.top,x=s.padInfo.left,w=Ze(e,t,n);for(let v=0;v<s.batchSize;++v)for(let b=0;b<s.inChannels;++b)for(let C=0;C<s.outHeight;++C){const $=C*a-g;let S=$;for(;S<0;)S+=u;const T=Math.min(s.inHeight,f+$);for(let E=0;E<s.outWidth;++E){const A=E*l-x;let F=A;for(;F<0;)F+=d;const D=Math.min(s.inWidth,p+A);let _=Number.NEGATIVE_INFINITY,N=-1;for(let L=S;L<T;L+=u){const G=L-$;for(let Q=F;Q<D;Q+=d){const K=Q-A,Z=w.get(v,L,Q,b);Z>_&&(_=Z,r?N=o?((v*s.inHeight+L)*s.inWidth+Q)*s.inChannels+b:(L*s.inWidth+Q)*s.inChannels+b:N=G*p+K)}}i.set(N,v,C,E,b)}}return i}function MR(n,e,t,s,r,o){const i=r.strideDepth,a=r.strideHeight,l=r.strideWidth,u=r.dilationDepth,d=r.dilationHeight,f=r.dilationWidth,p=r.effectiveFilterDepth,g=r.effectiveFilterHeight,x=r.effectiveFilterWidth,w=r.padInfo.front,v=r.padInfo.top,b=r.padInfo.left,C=o==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,$=Ze(r.outShape,t),S=$.values,T=r.outShape[1]*r.outShape[2]*r.outShape[3]*r.outShape[4],E=r.outShape[2]*r.outShape[3]*r.outShape[4],A=r.outShape[3]*r.outShape[4],F=r.outShape[4];for(let D=0;D<r.batchSize;++D){const _=D*T,N=D*s[0];for(let L=0;L<r.inChannels;++L)for(let G=0;G<r.outDepth;++G){const Q=G*i-w;let K=Q;for(;K<0;)K+=u;const Z=Math.min(r.inDepth,p+Q),te=_+G*E;for(let B=0;B<r.outHeight;++B){const H=B*a-v;let X=H;for(;X<0;)X+=d;const z=Math.min(r.inHeight,g+H),V=te+B*A;for(let oe=0;oe<r.outWidth;++oe){const ue=oe*l-b;let he=ue;for(;he<0;)he+=f;const de=Math.min(r.inWidth,x+ue),we=V+oe*F;let xe=C,be=0,Te=0;for(let Ve=K;Ve<Z;Ve+=u){const st=N+Ve*s[1];for(let Xe=X;Xe<z;Xe+=d){const nt=st+Xe*s[2];for(let rt=he;rt<de;rt+=f){const ut=nt+rt*s[3],lt=n[ut+L];if(o==="max"&&lt>xe?xe=lt:o==="avg"&&(be+=lt,Te++),isNaN(xe))break}if(isNaN(xe))break}if(isNaN(xe))break}const Pe=we+L;S[Pe]=o==="avg"?be/Math.max(Te,1):xe}}}}return $}function zj(n,e){const t=Ze(e.outShape,"int32"),s=e.strideDepth,r=e.strideHeight,o=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,d=e.effectiveFilterHeight,f=e.effectiveFilterWidth,p=e.padInfo.front,g=e.padInfo.top,x=e.padInfo.left;for(let w=0;w<e.batchSize;++w)for(let v=0;v<e.inChannels;++v)for(let b=0;b<e.outDepth;++b){const C=b*s-p;let $=C;for(;$<0;)$+=i;const S=Math.min(e.inDepth,u+C);for(let T=0;T<e.outHeight;++T){const E=T*r-g;let A=E;for(;A<0;)A+=a;const F=Math.min(e.inHeight,d+E);for(let D=0;D<e.outWidth;++D){const _=D*o-x;let N=_;for(;N<0;)N+=l;const L=Math.min(e.inWidth,f+_);let G=Number.NEGATIVE_INFINITY,Q=-1;for(let K=$;K<S;K+=i){const Z=K-C;for(let te=A;te<F;te+=a){const B=te-E;for(let H=N;H<L;H+=l){const X=H-_,z=n.get(w,K,te,H,v);z>=G&&(G=z,Q=Z*d*f+B*d+X)}}}t.set(Q,w,b,T,D,v)}}}return t}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mj(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Ee(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;O(zn(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=Js(r.shape,o,i,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&mt(d.inShape,d.outShape))f=Kr({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,g=ze(r.shape),x=Yw(p,r.shape,r.dtype,g,d,"avg");f=t.makeTensorInfo(d.outShape,r.dtype,x.values)}return f}const Pj={kernelName:gp,backendName:"cpu",kernelFunc:Mj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lj(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s;Ee(r,"avgPool3d");const d=yo(r.shape,o,i,1,a,l,u),f=t.data.get(r.dataId).values,p=MR(f,r.shape,r.dtype,ze(r.shape),d,"avg");return t.makeTensorInfo(p.shape,"float32",p.values)}const Bj={kernelName:xp,backendName:"cpu",kernelFunc:Lj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vj(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=s;Ee([r,o],"avgPool3DGrad");const d=yo(o.shape,i,a,1,l,u),f=d.strideDepth,p=d.strideHeight,g=d.strideWidth,x=d.filterDepth,w=d.filterHeight,v=d.filterWidth,b=d.dilationDepth,C=d.dilationHeight,$=d.dilationWidth,S=d.effectiveFilterDepth,T=d.effectiveFilterHeight,E=d.effectiveFilterWidth,A=S-1-d.padInfo.front,F=E-1-d.padInfo.left,D=T-1-d.padInfo.top,_=Ze(o.shape,"float32"),N=1/(x*w*v),L=t.bufferSync(r);for(let G=0;G<d.batchSize;++G)for(let Q=0;Q<d.inChannels;++Q)for(let K=0;K<d.inDepth;++K)for(let Z=0;Z<d.inHeight;++Z)for(let te=0;te<d.inWidth;++te){const B=K-A,H=Z-D,X=te-F;let z=0;for(let V=0;V<S;V+=b){const oe=(B+V)/f;if(!(oe<0||oe>=d.outDepth||Math.floor(oe)!==oe))for(let ue=0;ue<T;ue+=C){const he=(H+ue)/p;if(!(he<0||he>=d.outHeight||Math.floor(he)!==he))for(let de=0;de<E;de+=$){const we=(X+de)/g;if(we<0||we>=d.outWidth||Math.floor(we)!==we)continue;const xe=L.get(G,oe,he,we,Q);z+=xe}}}_.set(z*N,G,K,Z,te,Q)}return t.makeTensorInfo(_.shape,_.dtype,_.values)}const Wj={kernelName:Fy,backendName:"cpu",kernelFunc:Vj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Uj(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;Ee([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=Js(i.shape,a,l,1,u),f=d.strideHeight,p=d.strideWidth,g=d.filterHeight,x=d.filterWidth,w=d.dilationHeight,v=d.dilationWidth,b=d.effectiveFilterHeight,C=d.effectiveFilterWidth,$=C-1-d.padInfo.left,S=b-1-d.padInfo.top,T=Ze(i.shape,"float32"),E=1/(g*x),A=t.data.get(r.dataId).values,F=Ze(r.shape,"float32",A);for(let D=0;D<d.batchSize;++D)for(let _=0;_<d.inChannels;++_)for(let N=0;N<d.inHeight;++N)for(let L=0;L<d.inWidth;++L){const G=N-S,Q=L-$;let K=0;for(let Z=0;Z<b;Z+=w){const te=(G+Z)/f;if(!(te<0||te>=d.outHeight||Math.floor(te)!==te))for(let B=0;B<C;B+=v){const H=(Q+B)/p;if(H<0||H>=d.outWidth||Math.floor(H)!==H)continue;const X=F.get(D,te,H,_);K+=X}}T.set(K*E,D,N,L,_)}return t.makeTensorInfo(T.shape,T.dtype,T.values)}const Gj={kernelName:_y,backendName:"cpu",kernelFunc:Uj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hj(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,scale:o,offset:i,mean:a,variance:l}=e;O(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),O(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),O(o==null||a.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),Ee([r,a,l,o,i],"batchNorm");let{varianceEpsilon:u}=s;u==null&&(u=.001);const d=t.data.get(r.dataId).values,f=t.data.get(a.dataId).values,p=t.data.get(l.dataId).values,g=o?t.data.get(o.dataId).values:new Float32Array([1]),x=i?t.data.get(i.dataId).values:new Float32Array([0]),w=new Float32Array(d.length),v=x.length,b=g.length,C=p.length,$=f.length;let S=0,T=0,E=0,A=0;for(let F=0;F<d.length;++F)w[F]=x[S++]+(d[F]-f[T++])*g[E++]/Math.sqrt(p[A++]+u),S>=v&&(S=0),T>=$&&(T=0),E>=b&&(E=0),A>=C&&(A=0);return t.makeTensorInfo(r.shape,r.dtype,w)}const jj={kernelName:Rp,backendName:"cpu",kernelFunc:Hj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Xj(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;Ee([r],"batchToSpaceND");const a=o.reduce((b,C)=>b*C),l=fh(r.shape,o,a),u=ph(l.length,o.length),d=mh(r.shape,o,a),f=iw(i,o.length),p=aw(d,i,o.length),g=Nt({inputs:{x:r},backend:t,attrs:{shape:l}}),x=rs({inputs:{x:g},backend:t,attrs:{perm:u}}),w=Nt({inputs:{x},backend:t,attrs:{shape:d}}),v=la({inputs:{x:w},backend:t,attrs:{begin:f,size:p}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(w),v}const Kj={kernelName:wp,backendName:"cpu",kernelFunc:Xj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qj(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,u=Hw(a,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,u)}const Yj={kernelName:Oy,backendName:"cpu",kernelFunc:qj};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Qj(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.data.get(s.dataId).values,i=t.data.get(r.dataId).values,a=Ke(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const Zj={kernelName:cI,backendName:"cpu",kernelFunc:Qj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jj=yt(vu,(n,e)=>{const t=e;return n>t.clipValueMax?t.clipValueMax:n<t.clipValueMin?t.clipValueMin:n}),e8={kernelName:vu,backendName:"cpu",kernelFunc:Jj};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t8=n=>{const{x:e}=n.inputs,t=n.backend,s=new Float32Array(ce(e.shape)),r=t.data.get(e.dataId),o=r.complexTensorInfos.real,i=r.complexTensorInfos.imag,a=t.data.get(o.dataId).values,l=t.data.get(i.dataId).values;for(let u=0;u<a.length;u++){const d=a[u],f=l[u];s[u]=Math.hypot(d,f)}return t.makeOutput(s,e.shape,"float32")},n8={kernelName:vp,backendName:"cpu",kernelFunc:t8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bl(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.data.get(s.dataId).complexTensorInfos.imag,o=t.data.get(r.dataId).values;return t.makeTensorInfo(r.shape,r.dtype,o)}const s8={kernelName:Jy,backendName:"cpu",kernelFunc:bl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Cl(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=Je(r,e[0].shape)[0],i=e.map(w=>w.shape);sw(i,o);let a=Lr(e.map(w=>w.shape),o);if(ce(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(w=>ce(w.shape)>0);if(l.length===1)return Kr({inputs:{x:l[0]},backend:t});if(l[0].dtype==="complex64"){const w=l.map(S=>aa({inputs:{input:S},backend:t})),v=l.map(S=>bl({inputs:{input:S},backend:t})),b=Cl({inputs:w,backend:t,attrs:{axis:o}}),C=Cl({inputs:v,backend:t,attrs:{axis:o}}),$=ps({inputs:{real:b,imag:C},backend:t});return w.forEach(S=>t.disposeIntermediateTensorInfo(S)),v.forEach(S=>t.disposeIntermediateTensorInfo(S)),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(C),$}const u=l.map(w=>{const b=[-1,ce(w.shape.slice(o))];return Nt({inputs:{x:w},backend:t,attrs:{shape:b}})}),d=u.map(w=>({vals:t.data.get(w.dataId).values,shape:w.shape}));a=Lr(u.map(w=>w.shape),1);const f=u[0].shape[0]===1,p=WE(d,a,e[0].dtype,f),g=Lr(l.map(w=>w.shape),o),x=t.makeTensorInfo(g,e[0].dtype,p);return u.forEach(w=>t.disposeIntermediateTensorInfo(w)),x}const r8={kernelName:bp,backendName:"cpu",kernelFunc:Cl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PR(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s;Ee([r,o],"conv2d");const f=wo(l),p=Nn(r.shape,o.shape,i,u,a,d,!1,f),g=p.filterHeight,x=p.filterWidth,w=p.dilationHeight,v=p.dilationWidth,b=p.padInfo.left,C=p.padInfo.top,$=p.dataFormat==="channelsLast",S=new Tn(p.outShape,r.dtype),T=ze(r.shape),E=ze(o.shape),A=T[0],F=$?T[1]:T[2],D=$?T[2]:1,_=$?1:T[1],N=S.strides[0],L=$?S.strides[1]:S.strides[2],G=$?S.strides[2]:1,Q=$?1:S.strides[1],K=t.data.get(r.dataId).values,Z=t.data.get(o.dataId).values,te=S.values;for(let B=0;B<p.batchSize;++B){const H=B*A,X=B*N;for(let z=0;z<p.outHeight;++z){const V=X+z*L,oe=z*p.strideHeight-C;for(let ue=0;ue<g;++ue){const he=oe+ue*w;if(he<0||he>=p.inHeight)continue;const de=ue*E[0],we=H+he*F;for(let xe=0;xe<p.outWidth;++xe){const be=V+xe*G,Te=xe*p.strideWidth-b;for(let Pe=0;Pe<x;++Pe){const Ve=Te+Pe*v;if(Ve<0||Ve>=p.inWidth)continue;const st=de+Pe*E[1],Xe=we+Ve*D;let nt=st;for(let rt=0;rt<p.inChannels;++rt){const ut=K[Xe+rt*_];for(let lt=0;lt<p.outChannels;++lt)te[be+lt*Q]+=ut*Z[nt+lt];nt+=p.outChannels}}}}}}return t.makeTensorInfo(S.shape,S.dtype,te)}const o8={kernelName:Cp,backendName:"cpu",kernelFunc:PR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function i8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s;Ee([r,o],"conv2dBackpropFilter");const f=wo(l),p=Nn(r.shape,d,i,1,a,u,!1,f),{strideHeight:g,strideWidth:x,filterHeight:w,filterWidth:v}=p,b=p.dataFormat==="channelsLast",C=new Tn(p.filterShape,"float32"),$=p.padInfo.left,S=p.padInfo.top,T=t.data.get(r.dataId).values,E=t.data.get(o.dataId).values,A=new Tn(r.shape,r.dtype,T),F=new Tn(o.shape,o.dtype,E);for(let D=0;D<w;++D){const _=Math.max(0,Math.ceil((S-D)/g)),N=Math.min(p.outHeight,(p.inHeight+S-D)/g);for(let L=0;L<v;++L){const G=Math.max(0,Math.ceil(($-L)/x)),Q=Math.min(p.outWidth,(p.inWidth+$-L)/x);for(let K=0;K<p.inChannels;++K)for(let Z=0;Z<p.outChannels;++Z){let te=0;for(let B=0;B<p.batchSize;++B)for(let H=_;H<N;++H){const X=D+H*g-S;for(let z=G;z<Q;++z){const V=L+z*x-$;b?te+=A.get(B,X,V,K)*F.get(B,H,z,Z):te+=A.get(B,K,X,V)*F.get(B,Z,H,z)}}C.set(te,D,L,K,Z)}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const a8={kernelName:Py,backendName:"cpu",kernelFunc:i8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function l8(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s;Ee([r,o],"conv2dBackpropInput");const f=ze(o.shape),p=ze(r.shape);let g=wo(u);const x=Nn(i,o.shape,a,1,l,d,!1,g),w=new Tn(x.inShape,"float32"),v=w.values,b=t.data.get(r.dataId).values,C=t.data.get(o.dataId).values,[$,S,T]=f,{batchSize:E,filterHeight:A,filterWidth:F,inChannels:D,inHeight:_,inWidth:N,outChannels:L,outHeight:G,outWidth:Q,strideHeight:K,strideWidth:Z}=x;g=x.dataFormat;const te=A-1-x.padInfo.top,B=F-1-x.padInfo.left,H=g==="channelsLast",X=w.strides[0],z=H?w.strides[1]:w.strides[2],V=H?w.strides[2]:1,oe=H?1:w.strides[1],ue=p[0],he=H?p[1]:p[2],de=H?p[2]:1,we=H?1:p[1];for(let xe=0;xe<E;++xe)for(let be=0;be<D;++be)for(let Te=0;Te<_;++Te){const Pe=Te-te,Ve=Math.max(0,Math.ceil(Pe/K)),st=Math.min(G,(A+Pe)/K);for(let Xe=0;Xe<N;++Xe){const nt=Xe-B,rt=Math.max(0,Math.ceil(nt/Z)),ut=Math.min(Q,(F+nt)/Z);let lt=0;for(let Et=Ve;Et<st;++Et){const bn=Et*K-Pe;for(let Vt=rt;Vt<ut;++Vt){const Sr=Vt*Z-nt,is=ue*xe+he*Et+de*Vt,_s=$*(A-1-bn)+S*(F-1-Sr)+T*be;for(let nr=0;nr<L;++nr){const Fs=b[is+we*nr],vs=C[_s+nr];lt+=Fs*vs}}}const vn=X*xe+z*Te+V*Xe+oe*be;v[vn]=lt}}return t.makeTensorInfo(w.shape,w.dtype,w.values)}const c8={kernelName:kp,backendName:"cpu",kernelFunc:l8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s;Ee([r,o],"conv3d");const u=ai(r.shape,o.shape,i,l,a),{filterDepth:d,filterHeight:f,filterWidth:p,dilationDepth:g,dilationHeight:x,dilationWidth:w,padInfo:v}=u,b=v.front,C=v.left,$=v.top,S=new Tn(u.outShape,r.dtype),T=t.data.get(r.dataId).values,E=t.data.get(o.dataId).values,A=S.values,F=ze(r.shape),D=ze(o.shape);for(let _=0;_<u.batchSize;++_){const N=_*F[0],L=_*S.strides[0];for(let G=0;G<u.outDepth;++G){const Q=L+G*S.strides[1],K=G*u.strideDepth-b;for(let Z=0;Z<d;++Z){const te=K+Z*g;if(te<0||te>=u.inDepth)continue;const B=Z*D[0],H=N+te*F[1];for(let X=0;X<u.outHeight;++X){const z=Q+X*S.strides[2],V=X*u.strideHeight-$;for(let oe=0;oe<f;++oe){const ue=V+oe*x;if(ue<0||ue>=u.inHeight)continue;const he=B+oe*D[1],de=H+ue*F[2];for(let we=0;we<u.outWidth;++we){const xe=z+we*u.outChannels,be=we*u.strideWidth-C;for(let Te=0;Te<p;++Te){const Pe=be+Te*w;if(Pe<0||Pe>=u.inWidth)continue;const Ve=he+Te*D[2],st=de+Pe*u.inChannels;let Xe=Ve;for(let nt=0;nt<u.inChannels;++nt){const rt=T[st+nt];for(let ut=0;ut<u.outChannels;++ut)A[xe+ut]+=rt*E[Xe+ut];Xe+=u.outChannels}}}}}}}}return t.makeTensorInfo(S.shape,S.dtype,S.values)}const h8={kernelName:Sp,backendName:"cpu",kernelFunc:u8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:l}=s;Ee([r,o],"conv3dBackpropFilterV2");const u=ze(r.shape),d=ze(o.shape),f=ai(r.shape,l,i,1,a),p=f.strideDepth,g=f.strideHeight,x=f.strideWidth,w=f.filterDepth,v=f.filterHeight,b=f.filterWidth,C=new Tn(f.filterShape,"float32"),$=C.values,[S,T,E,A]=C.strides,F=t.data.get(o.dataId).values,[D,_,N,L]=d,G=t.data.get(r.dataId).values,[Q,K,Z,te]=u,B=f.padInfo.front,H=f.padInfo.left,X=f.padInfo.top;for(let z=0;z<w;++z){const V=Math.max(0,Math.ceil((B-z)/p)),oe=Math.min(f.outDepth,(f.inDepth+B-z)/p),ue=z*S;for(let he=0;he<v;++he){const de=Math.max(0,Math.ceil((X-he)/g)),we=Math.min(f.outHeight,(f.inHeight+X-he)/g),xe=he*T+ue;for(let be=0;be<b;++be){const Te=Math.max(0,Math.ceil((H-be)/x)),Pe=Math.min(f.outWidth,(f.inWidth+H-be)/x),Ve=be*E+xe;for(let st=0;st<f.inChannels;++st){const Xe=st*A+Ve;for(let nt=0;nt<f.outChannels;++nt){let rt=0;for(let ut=0;ut<f.batchSize;++ut){const lt=ut*Q,vn=ut*D;for(let Et=V;Et<oe;++Et){const Vt=(z+Et*p-B)*K+lt,Sr=Et*_+vn;for(let is=de;is<we;++is){const nr=(he+is*g-X)*Z+Vt,Fs=is*N+Sr;for(let vs=Te;vs<Pe;++vs){const Yr=(be+vs*x-H)*te+nr,Qr=vs*L+Fs;rt+=G[Yr+st]*F[Qr+nt]}}}}$[Xe+nt]=rt}}}}}return t.makeTensorInfo(C.shape,C.dtype,C.values)}const f8={kernelName:Ly,backendName:"cpu",kernelFunc:d8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p8(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:l}=s;Ee([r],"conv3dBackpropInputV2");const u=ze(r.shape),d=ze(o.shape),f=ai(l,o.shape,a,1,i),p=new Tn(f.inShape,"float32"),g=p.values,[x,w,v,b]=p.strides,C=t.data.get(r.dataId).values,[$,S,T,E]=u,A=t.data.get(o.dataId).values,[F,D,_,N]=d,{batchSize:L,filterDepth:G,filterHeight:Q,filterWidth:K,inChannels:Z,inDepth:te,inHeight:B,inWidth:H,outChannels:X,outDepth:z,outHeight:V,outWidth:oe,strideDepth:ue,strideHeight:he,strideWidth:de}=f,we=G-1-f.padInfo.front,xe=Q-1-f.padInfo.top,be=K-1-f.padInfo.left;for(let Te=0;Te<L;++Te)for(let Pe=0;Pe<Z;++Pe)for(let Ve=0;Ve<te;++Ve){const st=Ve-we,Xe=Math.max(0,Math.ceil(st/ue)),nt=Math.min(z,(G+st)/ue);for(let rt=0;rt<B;++rt){const ut=rt-xe,lt=Math.max(0,Math.ceil(ut/he)),vn=Math.min(V,(Q+ut)/he);for(let Et=0;Et<H;++Et){const bn=Et-be,Vt=Math.max(0,Math.ceil(bn/de)),Sr=Math.min(oe,(K+bn)/de);let is=0;for(let _s=Xe;_s<nt;++_s){const nr=_s*ue-st;for(let Fs=lt;Fs<vn;++Fs){const vs=Fs*he-ut;for(let bo=Vt;bo<Sr;++bo){const Yr=bo*de-bn,Qr=$*Te+S*_s+T*Fs+E*bo,Vm=F*(G-1-nr)+D*(Q-1-vs)+_*(K-1-Yr)+N*Pe;for(let mi=0;mi<X;++mi){const Rh=C[Qr+mi],Wm=A[Vm+mi];is+=Rh*Wm}}}}g[x*Te+w*Ve+v*rt+b*Et+Pe]=is}}}return t.makeTensorInfo(p.shape,p.dtype,p.values)}const m8={kernelName:By,backendName:"cpu",kernelFunc:p8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g8=yt(bu,n=>Math.cos(n)),x8={kernelName:bu,backendName:"cpu",kernelFunc:g8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const y8=yt(Cu,n=>Math.cosh(n)),w8={kernelName:Cu,backendName:"cpu",kernelFunc:y8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function v8(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=s,[d,f,p,g]=r.shape,x=o.shape[0],[w,v]=a,b=Ze([x,w,v,g],"float32"),C=t.data.get(o.dataId).values,$=t.data.get(i.dataId).values,S=t.data.get(r.dataId).values,T=ze(r.shape),E=ze(b.shape);for(let A=0;A<x;A++){const F=A*4,D=C[F],_=C[F+1],N=C[F+2],L=C[F+3],G=$[A];if(G>=d)continue;const Q=w>1?(N-D)*(f-1)/(w-1):0,K=v>1?(L-_)*(p-1)/(v-1):0;for(let Z=0;Z<w;Z++){const te=w>1?D*(f-1)+Z*Q:.5*(D+N)*(f-1);if(te<0||te>f-1){for(let B=0;B<v;B++)for(let H=0;H<g;H++){const X=H+B*E[2]+Z*E[1]+A*E[0];b.values[X]=u}continue}if(l==="bilinear"){const B=Math.floor(te),H=Math.ceil(te),X=te-B;for(let z=0;z<v;z++){const V=v>1?_*(p-1)+z*K:.5*(_+L)*(p-1);if(V<0||V>p-1){for(let de=0;de<g;de++){const we=de+z*E[2]+Z*E[1]+A*E[0];b.values[we]=u}continue}const oe=Math.floor(V),ue=Math.ceil(V),he=V-oe;for(let de=0;de<g;de++){let we=de+oe*T[2]+B*T[1]+G*T[0];const xe=S[we];we=de+ue*T[2]+B*T[1]+G*T[0];const be=S[we];we=de+oe*T[2]+H*T[1]+G*T[0];const Te=S[we];we=de+ue*T[2]+H*T[1]+G*T[0];const Pe=S[we],Ve=xe+(be-xe)*he,st=Te+(Pe-Te)*he;we=de+z*E[2]+Z*E[1]+A*E[0],b.values[we]=Ve+(st-Ve)*X}}}else for(let B=0;B<v;++B){const H=v>1?_*(p-1)+B*K:.5*(_+L)*(p-1);if(H<0||H>p-1){for(let V=0;V<g;V++){const oe=V+B*E[2]+Z*E[1]+A*E[0];b.values[oe]=u}continue}const X=Math.round(H),z=Math.round(te);for(let V=0;V<g;V++){const oe=V+X*T[2]+z*T[1]+G*T[0],ue=V+B*E[2]+Z*E[1]+A*E[0];b.values[ue]=S[oe]}}}}return t.makeTensorInfo(b.shape,b.dtype,b.values)}const b8={kernelName:Wy,backendName:"cpu",kernelFunc:v8};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function C8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;Ee(r,"cumprod");const l=Bt([o],r.shape.length);let u=r;l!=null&&(u=rs({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=Kt(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=xs(u.dtype,"int32"),p=Ty(ce(u.shape),f),g=t.data.get(u.dataId).values,x=u.shape[u.shape.length-1],w=a?(b,C)=>b+x-C-1:(b,C)=>b+C;for(let b=0;b<g.length;b+=x)for(let C=0;C<x;C++){const $=w(b,C);if(C===0)p[$]=i?1:g[$];else{const S=w(b,C-1);p[$]=i?g[S]*p[S]:g[$]*p[S]}}const v=t.makeTensorInfo(u.shape,f,p);if(l!=null){const b=li(l),C=rs({inputs:{x:v},backend:t,attrs:{perm:b}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(u),C}return v}const k8={kernelName:Vy,backendName:"cpu",kernelFunc:C8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function S8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;Ee(r,"cumsum");const l=Bt([o],r.shape.length);let u=r;l!=null&&(u=rs({inputs:{x:r},backend:t,attrs:{perm:l}}));const d=Kt(1,r.shape.length)[0];if(d!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${d}`);const f=xs(u.dtype,"int32"),p=Fn(ce(u.shape),f),g=t.data.get(u.dataId).values,x=u.shape[u.shape.length-1],w=a?(b,C)=>b+x-C-1:(b,C)=>b+C;for(let b=0;b<g.length;b+=x)for(let C=0;C<x;C++){const $=w(b,C);if(C===0)p[$]=i?0:g[$];else{const S=w(b,C-1);p[$]=i?g[S]+p[S]:g[$]+p[S]}}const v=t.makeTensorInfo(u.shape,f,p);if(l!=null){const b=li(l),C=rs({inputs:{x:v},backend:t,attrs:{perm:b}});return t.disposeIntermediateTensorInfo(v),t.disposeIntermediateTensorInfo(u),C}return v}const I8={kernelName:Ip,backendName:"cpu",kernelFunc:S8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const l=t.data.get(r.dataId).values,u=t.data.get(o.dataId).values,d=Hw(l,u,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(o),d=LE(l,u,i,a);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const T8={kernelName:Uy,backendName:"cpu",kernelFunc:$8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function N8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s;O(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);const a=r.shape[0],l=r.shape[1],u=r.shape[2],d=r.shape[3],f=l*o,p=u*o,g=d/(o*o),x=t.data.get(r.dataId).values,w=new Float32Array(a*f*p*g);let v=0;for(let b=0;b<a;++b)for(let C=0;C<f;++C){const $=Math.floor(C/o),S=C%o;for(let T=0;T<p;++T){const E=Math.floor(T/o),A=T%o,F=(S*o+A)*g;for(let D=0;D<g;++D){const N=D+F+d*(E+u*($+l*b));w[v++]=x[N]}}}return t.makeTensorInfo([a,f,p,g],r.dtype,w)}const E8={kernelName:Gy,backendName:"cpu",kernelFunc:N8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LR(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=s;Ee([r,o],"depthwiseConv2DNative");const d=ze(r.shape),f=ze(o.shape);let p=l;p==null&&(p=[1,1]),O(zn(i,p),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${p}'`);const g=Nn(r.shape,o.shape,i,p,a,u,!0),{filterHeight:x,filterWidth:w,dilationHeight:v,dilationWidth:b,padInfo:C}=g,$=C.left,S=C.top,T=g.outChannels/g.inChannels,E=new Tn(g.outShape,r.dtype),A=t.data.get(r.dataId).values,F=t.data.get(o.dataId).values,D=E.values;for(let _=0;_<g.batchSize;++_){const N=_*d[0],L=_*E.strides[0];for(let G=0;G<g.outHeight;++G){const Q=L+G*E.strides[1],K=G*g.strideHeight-S;for(let Z=0;Z<x;++Z){const te=K+Z*v;if(te<0||te>=g.inHeight)continue;const B=Z*f[0],H=N+te*d[1];for(let X=0;X<g.outWidth;++X){const z=Q+X*E.strides[2],V=X*g.strideWidth-$;for(let oe=0;oe<w;++oe){const ue=V+oe*b;if(ue<0||ue>=g.inWidth)continue;const he=B+oe*f[1],de=H+ue*g.inChannels;let we=z,xe=he;for(let be=0;be<g.inChannels;++be){const Te=A[de+be];for(let Pe=0;Pe<T;++Pe)D[we+Pe]+=Te*F[xe+Pe];we+=T,xe+=T}}}}}}return t.makeTensorInfo(E.shape,E.dtype,E.values)}const R8={kernelName:$p,backendName:"cpu",kernelFunc:LR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function A8(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s;Ee([r,o],"depthwiseConv2dNativeBackpropFilter");const f=Nn(r.shape,d,i,a,l,u,!0),{strideHeight:p,strideWidth:g,filterHeight:x,filterWidth:w}=f,v=new Tn(f.filterShape,"float32"),b=f.padInfo.left,C=f.padInfo.top,$=f.outChannels/f.inChannels,S=t.data.get(r.dataId).values,T=new Tn(r.shape,r.dtype,S),E=t.data.get(o.dataId).values,A=new Tn(o.shape,o.dtype,E);for(let F=0;F<x;++F){const D=Math.max(0,Math.ceil((C-F)/p)),_=Math.min(f.outHeight,(f.inHeight+C-F)/p);for(let N=0;N<w;++N){const L=Math.max(0,Math.ceil((b-N)/g)),G=Math.min(f.outWidth,(f.inWidth+b-N)/g);for(let Q=0;Q<f.outChannels;++Q){const K=Math.trunc(Q/$),Z=Q%$;let te=0;for(let B=0;B<f.batchSize;++B)for(let H=D;H<_;++H){const X=F+H*p-C;for(let z=L;z<G;++z){const V=N+z*g-b;te+=T.get(B,X,V,K)*A.get(B,H,z,Q)}}v.set(te,F,N,K,Z)}}}return t.makeTensorInfo(v.shape,v.dtype,v.values)}const D8={kernelName:Hy,backendName:"cpu",kernelFunc:A8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _8(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s;Ee([r,o],"depthwiseConv2DNativeBackpropInput");const f=ze(r.shape),p=ze(o.shape),g=Nn(d,o.shape,i,a,l,u,!0),x=new Tn(g.inShape,"float32"),w=x.values,[v,b,C]=x.strides,$=t.data.get(r.dataId).values,[S,T,E]=f,A=t.data.get(o.dataId).values,[F,D,_]=p,{batchSize:N,filterHeight:L,filterWidth:G,inChannels:Q,inHeight:K,inWidth:Z,outChannels:te,outHeight:B,outWidth:H,strideHeight:X,strideWidth:z}=g,V=L-1-g.padInfo.top,oe=G-1-g.padInfo.left,ue=te/Q;for(let he=0;he<N;++he)for(let de=0;de<Q;++de)for(let we=0;we<K;++we){const xe=we-V,be=Math.max(0,Math.ceil(xe/X)),Te=Math.min(B,(L+xe)/X);for(let Pe=0;Pe<Z;++Pe){const Ve=Pe-oe,st=Math.max(0,Math.ceil(Ve/z)),Xe=Math.min(H,(G+Ve)/z);let nt=0;for(let rt=be;rt<Te;++rt){const ut=rt*X-xe;for(let lt=st;lt<Xe;++lt){const vn=lt*z-Ve,Et=S*he+T*rt+E*lt,bn=F*(L-1-ut)+D*(G-1-vn)+_*de;for(let Vt=0;Vt<ue;++Vt){const Sr=de*ue+Vt,is=$[Et+Sr],_s=A[bn+Vt];nt+=is*_s}}}w[v*he+b*we+C*Pe+de]=nt}}return t.makeTensorInfo(x.shape,x.dtype,x.values)}const F8={kernelName:jy,backendName:"cpu",kernelFunc:_8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O8(n){const{inputs:e,backend:t}=n,{x:s}=e,r=ce(s.shape),o=t.data.get(s.dataId).values,i=Ze([r,r],s.dtype),a=i.values;for(let u=0;u<o.length;u++)a[u*r+u]=o[u];const l=[...s.shape,...s.shape];return t.makeTensorInfo(l,i.dtype,i.values)}const z8={kernelName:uI,backendName:"cpu",kernelFunc:O8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const M8={kernelName:Tp,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r}=n,{strides:o,pad:i,dilations:a}=t,l=e,u=l.data.get(s.dataId).values,d=s.shape.length,f=l.data.get(r.dataId).values,p=r.shape.length,{batchSize:g,inHeight:x,inWidth:w,inChannels:v,outHeight:b,outWidth:C,padInfo:$,strideHeight:S,strideWidth:T,filterHeight:E,filterWidth:A,dilationHeight:F,dilationWidth:D,outShape:_}=lh(s.shape,r.shape,o,i,"NHWC",a),N=ce(_),L=_.length,G=Ht(s.dtype,N);for(let K=0;K<g;++K)for(let Z=0;Z<b;++Z){const te=Z*S-$.top;for(let B=0;B<C;++B){const H=B*T-$.left;for(let X=0;X<v;++X){let z=Number.MIN_SAFE_INTEGER;for(let oe=0;oe<E;++oe){const ue=te+oe*F;if(ue>=0&&ue<x)for(let he=0;he<A;++he){const de=H+he*D;if(de>=0&&de<w){const we=Mr([K,ue,de,X],d,ze(s.shape)),xe=Mr([oe,he,X],p,ze(r.shape)),be=u[we]+f[xe];be>z&&(z=be)}}}const V=Mr([K,Z,B,X],L,ze(_));G[V]=z}}}return{dataId:l.write(ha(G,s.dtype),_,s.dtype),shape:_,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const P8={kernelName:Ex,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:l}=t,u=e,d=xr(s.shape,u.data.get(s.dataId).values),f=xr(r.shape,u.data.get(r.dataId).values),{batchSize:p,inHeight:g,inWidth:x,inChannels:w,outHeight:v,outWidth:b,padInfo:C,strideHeight:$,strideWidth:S,filterHeight:T,filterWidth:E,dilationHeight:A,dilationWidth:F,outShape:D}=lh(s.shape,r.shape,i,a,"NHWC",l);O(o.rank===D.length,()=>`Error in ${Ex}, dy must have the same rank as output ${D.length}, but got ${o.rank}`);const _=xr(D,u.data.get(o.dataId).values),N=iI(r.shape,r.dtype);for(let G=0;G<p;++G)for(let Q=0;Q<v;++Q){const K=Q*$-C.top;for(let Z=0;Z<b;++Z){const te=Z*S-C.left;for(let B=0;B<w;++B){let H=Number.MIN_SAFE_INTEGER,X=0,z=0;for(let V=0;V<T;++V){const oe=K+V*A;if(oe>=0&&oe<g)for(let ue=0;ue<E;++ue){const he=te+ue*F;if(he>=0&&he<x){const de=d[G][oe][he][B]+f[V][ue][B];de>H&&(H=de,X=V,z=ue)}}}N[X][z][B]+=_[G][Q][Z][B]}}}return{dataId:u.write(ha(N,s.dtype),r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const L8={kernelName:Nx,backendName:"cpu",kernelFunc:({inputs:n,backend:e,attrs:t})=>{const{x:s,filter:r,dy:o}=n,{strides:i,pad:a,dilations:l}=t,u=e,d=xr(s.shape,u.data.get(s.dataId).values),f=xr(r.shape,u.data.get(r.dataId).values),{batchSize:p,inHeight:g,inWidth:x,inChannels:w,outHeight:v,outWidth:b,padInfo:C,strideHeight:$,strideWidth:S,filterHeight:T,filterWidth:E,dilationHeight:A,dilationWidth:F,outShape:D}=lh(s.shape,r.shape,i,a,"NHWC",l);O(o.rank===D.length,()=>`Error in ${Nx}, dy must have the same rank as output ${D.length}, but got ${o.rank}`);const _=xr(D,u.data.get(o.dataId).values),N=iI(s.shape,s.dtype);for(let G=0;G<p;++G)for(let Q=0;Q<v;++Q){const K=Q*$-C.top;for(let Z=0;Z<b;++Z){const te=Z*S-C.left;for(let B=0;B<w;++B){let H=Number.MIN_SAFE_INTEGER,X=K<0?0:K,z=te<0?0:te;for(let V=0;V<T;++V){const oe=K+V*A;if(oe>=0&&oe<g)for(let ue=0;ue<E;++ue){const he=te+ue*F;if(he>=0&&he<x){const de=d[G][oe][he][B]+f[V][ue][B];de>H&&(H=de,X=oe,z=he)}}}N[G][X][z][B]+=_[G][Q][Z][B]}}}return{dataId:u.write(ha(N,s.dtype),s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function B8(n){const{inputs:e,backend:t,attrs:s}=n,{image:r}=e,{canvas:o,options:i}=s,{contextOptions:a,imageOptions:l}=i||{},u=(l==null?void 0:l.alpha)||1,d=(a==null?void 0:a.contextType)||"2d";if(d!=="2d")throw new Error(`Context type ${a.contextType} is not supported by the CPU backend.`);const f=o.getContext(d,(a==null?void 0:a.contextAttributes)||{});if(f==null)throw new Error(`Could not get the context with ${d} type.`);const[p,g]=r.shape.slice(0,2),x=r.shape.length===2?1:r.shape[2],w=t.data.get(r.dataId).values,v=r.dtype==="float32"?255:1,b=new Uint8ClampedArray(g*p*4);for(let $=0;$<p*g;++$){const S=[0,0,0,255*u];for(let E=0;E<x;E++){const A=w[$*x+E];if(r.dtype==="float32"){if(A<0||A>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${A}.`)}else if(r.dtype==="int32"&&(A<0||A>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${A}.`);x===1?(S[0]=A*v,S[1]=A*v,S[2]=A*v):S[E]=A*v}const T=$*4;b[T+0]=Math.round(S[0]),b[T+1]=Math.round(S[1]),b[T+2]=Math.round(S[2]),b[T+3]=Math.round(S[3])}o.width=g,o.height=p;const C=new ImageData(b,g,p);return f.putImageData(C,0,0),r}const V8={kernelName:eM,backendName:"cpu",kernelFunc:B8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sh(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Ee(r,"sum");let a;r.dtype==="bool"?a=ni({inputs:{x:r},backend:t,attrs:{dtype:"int32"}}):a=Kr({inputs:{x:r},backend:t});const l=a.shape.length,u=Je(o,a.shape),d=Bt(u,l);let f=u,p=a;d!=null&&(p=rs({inputs:{x:a},backend:t,attrs:{perm:d}}),f=Kt(f.length,l)),En("sum",f,p.shape.length);const[g,x]=wn(p.shape,f),w=xs(p.dtype,"int32");let v=qf(t,g,w);const b=ce(x),C=t.data.get(v.dataId).values,$=t.data.get(p.dataId).values;for(let S=0;S<C.length;++S){const T=S*b;let E=0;for(let A=0;A<b;++A)E+=$[T+A];C[S]=E}if(i){const S=tn(v.shape,u),T=v;v=Nt({inputs:{x:v},backend:t,attrs:{shape:S}}),t.disposeIntermediateTensorInfo(T)}return t.disposeIntermediateTensorInfo(a),d!=null&&t.disposeIntermediateTensorInfo(p),v}const W8={kernelName:im,backendName:"cpu",kernelFunc:Sh};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function U8(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:l}=mw(r,o.length);xw(i.length,l,o);const{path:u,steps:d}=yw(a,l),f=d.length;let p=null,g=i.length;const x=[];for(let w=0;w<f;++w){for(const v of d[w]){const{permutationIndices:b,expandDims:C}=gw(g,l[v]);let $;ww(b)?$=o[v]:($=rs({inputs:{x:o[v]},backend:t,attrs:{perm:b}}),x.push($));const S=$.shape.slice();for(let T=0;T<C.length;++T)S.splice(C[T],0,1);mt($.shape,S)||($=Nt({inputs:{x:$},backend:t,attrs:{shape:S}}),x.push($)),p===null?p=$:(p=Om({inputs:{a:$,b:p},backend:t}),x.push(p))}w<f-1&&(u[w]>=0&&(p=Sh({inputs:{x:p},backend:t,attrs:{axis:u[w]-(i.length-g),keepDims:!1}}),x.push(p)),g--)}for(const w of x)w!==p&&t.disposeIntermediateTensorInfo(w);return p}const G8={kernelName:Xy,backendName:"cpu",kernelFunc:U8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function H8(n){const{inputs:e,backend:t}=n,{dy:s,y:r}=e;Ee([s,r],"eluGrad");const o=new Float32Array(ce(r.shape)),i=t.data.get(r.dataId).values,a=t.data.get(s.dataId).values;for(let l=0;l<i.length;++l){const u=i[l];u>=0?o[l]=a[l]:o[l]=a[l]*(u+1)}return t.makeTensorInfo(r.shape,"float32",o)}const j8={kernelName:Ky,backendName:"cpu",kernelFunc:H8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const X8=lw,K8=cw,q8=uw,Y8=hw,Q8=dw,Z8=fw,J8=yt(Iu,n=>{const e=Math.sign(n),t=Math.abs(n),s=1/(1+X8*t);return e*(1-((((Z8*s+Q8)*s+Y8)*s+q8)*s+K8)*s*Math.exp(-t*t))}),eX={kernelName:Iu,backendName:"cpu",kernelFunc:J8};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zf(n){const{inputs:e,backend:t,attrs:s}=n,{input:r}=e,{dim:o}=s,i=r.shape.length,a=r.shape.slice();let l=o;return o<0&&(O(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+o+1),a.splice(l,0,1),Nt({inputs:{x:r},backend:t,attrs:{shape:a}})}const tX={kernelName:Ep,backendName:"cpu",kernelFunc:Zf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const nX=Yt((n,e)=>n/e),Qw=hn(ku,nX),ty={kernelName:ku,backendName:"cpu",kernelFunc:Qw};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BR(n,e,t){const s=n.shape,r=s[0],o=s[1],i=t.data.get(n.dataId),a=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,u=[r,o],d=ce(u),f=_n("float32",d),p=_n("float32",d);for(let v=0;v<r;v++){const b=la({inputs:{x:a},backend:t,attrs:{begin:[v,0],size:[1,o]}}),C=la({inputs:{x:l},backend:t,attrs:{begin:[v,0],size:[1,o]}}),$=ps({inputs:{real:b,imag:C},backend:t}),{real:S,imag:T}=sX($,e,t),E=mo(S,T);for(let A=0;A<o;A++){const F=pw(E,A);f[v*o+A]=F.real,p[v*o+A]=F.imag}t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(C),t.disposeIntermediateTensorInfo($)}const g=t.makeTensorInfo(u,"float32",f),x=t.makeTensorInfo(u,"float32",p),w=ps({inputs:{real:g,imag:x},backend:t});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),w}function sX(n,e,t){const s=ce(n.shape),r=t.data.get(n.dataId),o=t.data.get(r.complexTensorInfos.real.dataId).values,i=t.data.get(r.complexTensorInfos.imag.dataId).values;if(rX(s)){const a=ny(o,i,s,e,t),l=[n.shape[0],n.shape[1]];if(e){const u=t.makeTensorInfo(l,"float32",a.real),d=t.makeTensorInfo(l,"float32",a.imag),f=t.makeTensorInfo([],"float32",oi(s,"float32")),p=Kr({inputs:{x:f},backend:t}),g=ty.kernelFunc({inputs:{a:u,b:f},backend:t}),x=ty.kernelFunc({inputs:{a:d,b:p},backend:t}),w=t.data.get(g.dataId).values,v=t.data.get(x.dataId).values;return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),{real:w,imag:v}}return a}else{const a=mo(o,i),l=oX(a,s,e);return J$(l)}}function rX(n){return(n&n-1)===0}function ny(n,e,t,s,r){if(t===1)return{real:n,imag:e};const o=mo(n,e),i=t/2,a=eT(o),l=a.real,u=a.imag,d=[l.length],f=r.makeTensorInfo(d,"float32",l),p=r.makeTensorInfo(d,"float32",u),g=ps({inputs:{real:f,imag:p},backend:r}),x=tT(o),w=x.real,v=x.imag,b=[w.length],C=r.makeTensorInfo(b,"float32",w),$=r.makeTensorInfo(b,"float32",v),S=ps({inputs:{real:C,imag:$},backend:r}),T=ny(l,u,i,s,r),E=T.real,A=T.imag,F=[E.length],D=r.makeTensorInfo(F,"float32",E),_=r.makeTensorInfo(F,"float32",A),N=ps({inputs:{real:D,imag:_},backend:r}),L=ny(w,v,i,s,r),G=L.real,Q=L.imag,K=[G.length],Z=r.makeTensorInfo(K,"float32",G),te=r.makeTensorInfo(K,"float32",Q),B=ps({inputs:{real:Z,imag:te},backend:r}),H=sT(t,s),X=[H.real.length],z=r.makeTensorInfo(X,"float32",H.real),V=r.makeTensorInfo(X,"float32",H.imag),oe=ps({inputs:{real:z,imag:V},backend:r}),ue=Om({inputs:{a:oe,b:B},backend:r}),he=vl({inputs:{a:N,b:ue},backend:r}),de=qw({inputs:{a:N,b:ue},backend:r}),we=aa({inputs:{input:he},backend:r}),xe=aa({inputs:{input:de},backend:r}),be=bl({inputs:{input:he},backend:r}),Te=bl({inputs:{input:de},backend:r}),Pe=Cl({inputs:[we,xe],backend:r,attrs:{axis:0}}),Ve=Cl({inputs:[be,Te],backend:r,attrs:{axis:0}}),st=r.data.get(Pe.dataId).values,Xe=r.data.get(Ve.dataId).values;return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(C),r.disposeIntermediateTensorInfo($),r.disposeIntermediateTensorInfo(S),r.disposeIntermediateTensorInfo(D),r.disposeIntermediateTensorInfo(_),r.disposeIntermediateTensorInfo(N),r.disposeIntermediateTensorInfo(Z),r.disposeIntermediateTensorInfo(te),r.disposeIntermediateTensorInfo(B),r.disposeIntermediateTensorInfo(z),r.disposeIntermediateTensorInfo(V),r.disposeIntermediateTensorInfo(oe),r.disposeIntermediateTensorInfo(ue),r.disposeIntermediateTensorInfo(he),r.disposeIntermediateTensorInfo(de),r.disposeIntermediateTensorInfo(we),r.disposeIntermediateTensorInfo(be),r.disposeIntermediateTensorInfo(xe),r.disposeIntermediateTensorInfo(Te),r.disposeIntermediateTensorInfo(Pe),r.disposeIntermediateTensorInfo(Ve),{real:st,imag:Xe}}function oX(n,e,t){const s=new Float32Array(e*2);for(let r=0;r<e;r++){let o=0,i=0;for(let a=0;a<e;a++){const l=rT(r*a,e,t),u=pw(n,a);o+=u.real*l.real-u.imag*l.imag,i+=u.real*l.imag+u.imag*l.real}t&&(o/=e,i/=e),nT(s,o,i,r)}return s}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iX(n){const{inputs:e,backend:t}=n,{input:s}=e,r=ce(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=Nt({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),l=BR(a,!1,t),u=Nt({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const aX={kernelName:qy,backendName:"cpu",kernelFunc:iX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zw(n){const{backend:e,attrs:t}=n,{shape:s,value:r,dtype:o}=t,i=o||Tl(r),a=Ht(i,ce(s));return cX(a,r,i),e.makeTensorInfo(s,i,a)}const lX={kernelName:Yy,backendName:"cpu",kernelFunc:Zw};function cX(n,e,t){n.fill(e)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uX={kernelName:Qy,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,r=t,o=_n(s.dtype,ce(s.shape)),[i,a,l,u]=s.shape,d=r.data.get(s.dataId).values;for(let p=0;p<i;p++){const g=p*l*a*u;for(let x=0;x<a;x++){const w=x*(l*u);for(let v=0;v<l;v++){const b=v*u;for(let C=0;C<u;C++){const $=Math.round(l-v-1),S=g+w+b+C;let T=d[S];if($>=0&&$<l){const E=$*u,A=g+w+E+C;T=d[A]}o[S]=T}}}}return{dataId:r.write(o,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s;let w=PR({inputs:{x:r,filter:o},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p}});if(i){const v=w;if(d==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){const b=Nt({inputs:{x:i},backend:t,attrs:{shape:[i.shape[0],1,1]}});w=vl({inputs:{a:w,b},backend:t}),t.disposeIntermediateTensorInfo(b)}else w=vl({inputs:{a:w,b:i},backend:t});t.disposeIntermediateTensorInfo(v)}if(g){const v=w;if(d==="NCHW"&&g==="prelu"&&a.shape.length===1&&a.shape[0]!==1){const b=Nt({inputs:{x:a},backend:t,attrs:{shape:[a.shape[0],1,1]}});w=Qf(t,w,g,b,x),t.disposeIntermediateTensorInfo(b)}else w=Qf(t,w,g,a,x);t.disposeIntermediateTensorInfo(v)}return w}const dX={kernelName:Rf,backendName:"cpu",kernelFunc:hX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s;let w=LR({inputs:{x:r,filter:o},backend:t,attrs:{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p}});if(i){const v=w;w=vl({inputs:{a:w,b:i},backend:t}),t.disposeIntermediateTensorInfo(v)}if(g){const v=w;w=Qf(t,w,g,a,x),t.disposeIntermediateTensorInfo(v)}return w}const pX={kernelName:EI,backendName:"cpu",kernelFunc:fX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mX(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=ce(s.shape),i=r.shape,a=i[i.length-1],[l,u,d,f]=Q1(s,r);if(u===0)return t.makeTensorInfo(l,s.dtype,[]);const p=t.data.get(r.dataId).values,g=t.bufferSync(s),x=YE(p,g,s.dtype,u,a,d,f,s.shape,o);return t.makeTensorInfo(l,s.dtype,x.values)}const gX={kernelName:hI,backendName:"cpu",kernelFunc:mX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:a}=s;Ee([r,o],"gatherV2");const l=Je(i,r.shape)[0],u=t.data.get(o.dataId).values,d=r.shape[l];for(let S=0;S<u.length;++S){const T=u[S];O(T<=d-1&&T>=0,()=>`GatherV2: the index value ${T} is not in [0, ${d-1}]`)}let f=a;a==null&&(f=0);const p=ce(o.shape),g=bw(r,o,l,f),x=Nt({inputs:{x:r},backend:t,attrs:{shape:[g.batchSize,g.outerSize,g.dimSize,g.sliceSize]}}),w=Nt({inputs:{x:o},backend:t,attrs:{shape:[g.batchSize,p/g.batchSize]}}),v=[g.batchSize,g.outerSize,p/g.batchSize,g.sliceSize],b=t.bufferSync(w),C=t.bufferSync(x),$=QE(C,b,v);return t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(w),t.makeTensorInfo(g.outputShape,$.dtype,$.values)}const yX={kernelName:Ap,backendName:"cpu",kernelFunc:xX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function wX(n){const{inputs:e,backend:t}=n,{input:s}=e,r=ce(s.shape),o=s.shape[s.shape.length-1],i=r/o,a=Nt({inputs:{x:s},backend:t,attrs:{shape:[i,o]}}),l=BR(a,!0,t),u=Nt({inputs:{x:l},backend:t,attrs:{shape:s.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(l),u}const vX={kernelName:Zy,backendName:"cpu",kernelFunc:wX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bX=yt(Du,n=>Number.isFinite(n)?1:0,"bool"),CX={kernelName:Du,backendName:"cpu",kernelFunc:bX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const kX=yt(_u,n=>Math.abs(n)===1/0?1:0,"bool"),SX={kernelName:_u,backendName:"cpu",kernelFunc:kX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IX=yt(Fu,n=>Number.isNaN(n)?1:0,"bool"),$X={kernelName:Fu,backendName:"cpu",kernelFunc:IX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TX(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=nR(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const NX={kernelName:dI,backendName:"cpu",kernelFunc:TX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const EX=yt(zu,n=>Math.log1p(n)),RX={kernelName:zu,backendName:"cpu",kernelFunc:EX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const AX=Yt((n,e)=>n&&e),DX=hn(zp,AX,null,"bool"),_X={kernelName:zp,backendName:"cpu",kernelFunc:DX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FX=yt(Mp,n=>n?0:1,"bool"),OX={kernelName:Mp,backendName:"cpu",kernelFunc:FX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zX=Yt((n,e)=>n||e),MX=hn(Pp,zX,null,"bool"),PX={kernelName:Pp,backendName:"cpu",kernelFunc:MX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function LX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:l}=s;Ee(r,"LRN");const u=r.shape[3],d=u-1,f=t.data.get(r.dataId).values,p=ce(r.shape),g=new Float32Array(p);function x(w){const v=w%u;let b=w-v+Math.max(0,v-o);const C=w-v+Math.min(v+o,d);let $=0;for(;b<=C;b++){const S=f[b];$+=S*S}return $}for(let w=0;w<p;w++){const v=x(w),b=f[w]*Math.pow(i+a*v,-l);g[w]=b}return t.makeTensorInfo(r.shape,r.dtype,g)}const BX={kernelName:Lp,backendName:"cpu",kernelFunc:LX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s;Ee(i,"LRNGrad");const f=ce(i.shape),p=i.shape[3],g=t.data.get(i.dataId).values,x=t.data.get(r.dataId).values,w=t.data.get(o.dataId).values,v=new Float32Array(f),b=f;for(let C=0;C<b;C++){const $=C%p,S=C-$+Math.max(0,$-a),T=C-$+Math.min(p,$+a+1);let E=0;for(let A=S;A<T;A++)E+=Math.pow(x[A],2);E=u*E+l;for(let A=S;A<T;A++){let F=-2*u*d*x[A]*w[C]/E;C===A&&(F+=Math.pow(E,-d)),F*=g[C],v[A]+=F}}return t.makeTensorInfo(i.shape,r.dtype,v)}const WX={kernelName:e1,backendName:"cpu",kernelFunc:VX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VR(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=t;let l=r.shape;const u=l.length,d=Je(o,l);let f=d;const p=Bt(f,u);let g=a.data.get(r.dataId).values;if(p!=null){const S=new Array(u);for(let T=0;T<S.length;T++)S[T]=l[p[T]];g=Xw(g,l,r.dtype,p,S),f=Kt(f.length,u),l=S}Ee(r,"max"),En("max",f,u);const[x,w]=wn(l,f),v=ce(w),b=rR(g,v,x,r.dtype),C=a.write(b,x,r.dtype);let $=x;return i&&($=tn(x,d)),{dataId:C,shape:$,dtype:r.dtype}}const UX={kernelName:Bp,backendName:"cpu",kernelFunc:VR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;Ee(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;O(zn(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=Js(r.shape,o,i,u,a,l);let f;if(d.filterWidth===1&&d.filterHeight===1&&mt(d.inShape,d.outShape))f=Kr({inputs:{x:r},backend:t});else{const p=t.data.get(r.dataId).values,g=ze(r.shape),x=Yw(p,r.shape,r.dtype,g,d,"max");f=t.makeTensorInfo(d.outShape,r.dtype,x.values)}return f}const HX={kernelName:Vp,backendName:"cpu",kernelFunc:GX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jX(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s;Ee(r,"maxPool3d");const d=yo(r.shape,o,i,1,a,l,u),f=t.data.get(r.dataId).values,p=MR(f,r.shape,r.dtype,ze(r.shape),d,"max");return t.makeTensorInfo(p.shape,"float32",p.values)}const XX={kernelName:Wp,backendName:"cpu",kernelFunc:jX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KX(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=s;Ee([r,o],"maxPool3DGrad");const d=yo(o.shape,i,a,1,l,u),f=t.bufferSync(o),p=zj(f,d),g=d.strideDepth,x=d.strideHeight,w=d.strideWidth,v=d.dilationDepth,b=d.dilationHeight,C=d.dilationWidth,$=d.effectiveFilterDepth,S=d.effectiveFilterHeight,T=d.effectiveFilterWidth,E=$-1-d.padInfo.front,A=T-1-d.padInfo.left,F=S-1-d.padInfo.top,D=Ze(o.shape,"float32"),_=t.bufferSync(r);for(let N=0;N<d.batchSize;++N)for(let L=0;L<d.inChannels;++L)for(let G=0;G<d.inDepth;++G)for(let Q=0;Q<d.inHeight;++Q)for(let K=0;K<d.inWidth;++K){const Z=G-E,te=Q-F,B=K-A;let H=0;for(let X=0;X<$;X+=v){const z=(Z+X)/g;if(!(z<0||z>=d.outDepth||Math.floor(z)!==z))for(let V=0;V<S;V+=b){const oe=(te+V)/x;if(!(oe<0||oe>=d.outHeight||Math.floor(oe)!==oe))for(let ue=0;ue<T;ue+=C){const he=(B+ue)/w;if(he<0||he>=d.outWidth||Math.floor(he)!==he)continue;const de=$*S*T-1-p.get(N,z,oe,he,L),we=X*S*T+V*T+ue,xe=de===we?1:0;if(xe===0)continue;const be=_.get(N,z,oe,he,L);H+=be*xe}}}D.set(H,N,G,Q,K,L)}return t.makeTensorInfo(D.shape,D.dtype,D.values)}const qX={kernelName:n1,backendName:"cpu",kernelFunc:KX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function YX(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,a=o;Ee([o,i],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,p=Js(a.shape,l,u,1,d,f),g=t.data.get(a.dataId).values,x=Ze(p.outShape,a.dtype,zR(g,a.shape,a.dtype,p).values),w=p.strideHeight,v=p.strideWidth,b=p.dilationHeight,C=p.dilationWidth,$=p.effectiveFilterHeight,S=p.effectiveFilterWidth,T=S-1-p.padInfo.left,E=$-1-p.padInfo.top,A=Ze(a.shape,"float32"),F=t.data.get(r.dataId).values,D=Ze(r.shape,"float32",F);for(let _=0;_<p.batchSize;++_)for(let N=0;N<p.inChannels;++N)for(let L=0;L<p.inHeight;++L)for(let G=0;G<p.inWidth;++G){const Q=L-E,K=G-T;let Z=0;for(let te=0;te<$;te+=b){const B=(Q+te)/w;if(!(B<0||B>=p.outHeight||Math.floor(B)!==B))for(let H=0;H<S;H+=C){const X=(K+H)/v;if(X<0||X>=p.outWidth||Math.floor(X)!==X)continue;const z=$*S-1-x.get(_,B,X,N),V=te*S+H,oe=z===V?1:0;if(oe===0)continue;const ue=D.get(_,B,X,N);Z+=ue*oe}}A.set(Z,_,L,G,N)}return t.makeTensorInfo(A.shape,A.dtype,A.values)}const QX={kernelName:t1,backendName:"cpu",kernelFunc:YX};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ZX(n,e,t,s,r){const o=ze(e),i=Yw(n,e,t,o,r,"max"),a=zR(n,e,t,r,!0,s);return[i.values,a.values]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JX={kernelName:fI,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,l=t;Ee(s,"MaxPoolWithArgmax");const u=l.data.get(s.dataId).values,d=Js(s.shape,r,o,[1,1],i),[f,p]=ZX(u,s.shape,s.dtype,a,d),g=l.write(f,d.outShape,s.dtype),x=l.write(p,d.outShape,s.dtype);return[{dataId:g,shape:d.outShape,dtype:s.dtype},{dataId:x,shape:d.outShape,dtype:"int32"}]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=Je(o,r.shape),u=wn(r.shape,a)[1],d=ce(u),f=[],p=t.makeTensorInfo([],"float32",new Float32Array([d]));f.push(p);const g=ni({inputs:{x:r},backend:t,attrs:{dtype:"float32"}});f.push(g);const x=Qw({inputs:{a:g,b:p},backend:t});f.push(x);const w=Sh({inputs:{x},backend:t,attrs:{axis:o,keepDims:i}});return f.forEach(v=>t.disposeIntermediateTensorInfo(v)),w}const tK={kernelName:Up,backendName:"cpu",kernelFunc:eK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;Ee(r,"min");const a=Je(o,r.shape);let l=a;const u=Bt(l,r.shape.length);let d=r;u!=null&&(d=rs({inputs:{x:r},backend:t,attrs:{perm:u}}),l=Kt(l.length,r.shape.length)),En("min",l,d.shape.length);const[f,p]=wn(d.shape,l),g=ce(p),x=Fn(ce(f),d.dtype),w=t.data.get(d.dataId).values;for(let b=0;b<x.length;++b){const C=b*g;let $=w[C];for(let S=0;S<g;++S){const T=w[C+S];(Number.isNaN(T)||T<$)&&($=T)}x[b]=$}u!=null&&t.disposeIntermediateTensorInfo(d);const v=t.makeTensorInfo(f,d.dtype,x);if(i){const b=tn(f,a),C=Nt({inputs:{x:v},backend:t,attrs:{shape:b}});return t.disposeIntermediateTensorInfo(v),C}return v}const sK={kernelName:Gp,backendName:"cpu",kernelFunc:nK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,mode:i}=s;Ee(r,"mirrorPad");const a=o.map(($,S)=>$[0]+r.shape[S]+$[1]),l=o.map($=>$[0]),u=o.map(($,S)=>$[0]+r.shape[S]),d=i==="reflect"?0:1,f=t.data.get(r.dataId).values,p=r.shape.length,g=ze(r.shape),x=ce(a),w=a.length,v=ze(a),b=_n(r.dtype,x);for(let $=0;$<x;$++){let S=Nl($,w,v);for(let E=0;E<w;E++)S[E]<l[E]?S[E]=l[E]*2-S[E]-d:S[E]>=u[E]&&(S[E]=(u[E]-1)*2-S[E]+d);S=S.map((E,A)=>E-l[A]);const T=Mr(S,p,g);b[$]=f[T]}return{dataId:t.write(b,a,r.dtype),shape:a,dtype:r.dtype}}const oK={kernelName:Hp,backendName:"cpu",kernelFunc:rK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const iK=Yt((n,e)=>{const t=n%e;return n<0&&e<0||n>=0&&e>=0?t:(t+e)%e}),aK=hn(Lu,iK),lK={kernelName:Lu,backendName:"cpu",kernelFunc:aK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WR(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=r.shape.length;let a=o;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);const l=Je([a],r.shape),u=VR({inputs:{x:r},backend:t,attrs:{reductionIndices:l,keepDims:!1}}),d=tn(u.shape,l),f=Nt({inputs:{x:u},backend:t,attrs:{shape:d}}),p=qw({inputs:{a:r,b:f},backend:t}),g=jE({inputs:{x:p},backend:t}),x=Sh({inputs:{x:g},backend:t,attrs:{axis:l,keepDims:!1}}),w=Nt({inputs:{x},backend:t,attrs:{shape:d}}),v=Qw({inputs:{a:g,b:w},backend:t});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(w),v}const cK={kernelName:cm,backendName:"cpu",kernelFunc:WR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uK(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s;Ee(r,"multinomial");const l=a?r:WR({inputs:{logits:r},backend:t,attrs:{dim:-1}}),u=l.shape[0],d=l.shape[1],f=t.data.get(l.dataId).values,p=[u,o],g=Fn(ce(p),"int32");for(let x=0;x<u;++x){const w=x*d,v=new Float32Array(d-1);v[0]=f[w];for(let $=1;$<v.length;++$)v[$]=v[$-1]+f[w+$];const b=z1.alea(i.toString()),C=x*o;for(let $=0;$<o;++$){const S=b();g[C+$]=v.length;for(let T=0;T<v.length;T++)if(S<v[T]){g[C+$]=T;break}}}return a||t.disposeIntermediateTensorInfo(l),t.makeTensorInfo(p,"int32",g)}const hK={kernelName:pI,backendName:"cpu",kernelFunc:uK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dK=H1;function fK(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s;Ee(r,"NonMaxSuppression");const u=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,{selectedIndices:f}=dK(u,d,i,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const pK={kernelName:s1,backendName:"cpu",kernelFunc:fK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mK=j1;function gK(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s;Ee(r,"NonMaxSuppressionPadded");const d=t.data.get(r.dataId).values,f=t.data.get(o.dataId).values,{selectedIndices:p,validOutputs:g}=mK(d,f,i,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const xK={kernelName:r1,backendName:"cpu",kernelFunc:gK};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yK=X1;function wK(n){const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s;Ee(r,"NonMaxSuppressionWithScore");const d=t.data.get(r.dataId).values,f=t.data.get(o.dataId).values,p=i,g=a,x=l,w=u,{selectedIndices:v,selectedScores:b}=yK(d,f,p,g,x,w);return[t.makeTensorInfo([v.length],"int32",new Int32Array(v)),t.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const vK={kernelName:o1,backendName:"cpu",kernelFunc:wK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bK(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:l}=s;Ee(r,"oneHot");const u=ce(r.shape),d=new Float32Array(u*i);d.fill(l);const f=t.data.get(r.dataId).values;for(let p=0;p<u;++p)f[p]>=0&&f[p]<i&&(d[p*i+f[p]]=a);return t.makeTensorInfo([...r.shape,i],o,d)}const CK={kernelName:qp,backendName:"cpu",kernelFunc:bK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Jf(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(s.dtype==="complex64"){const r=aa({inputs:{input:s},backend:t}),o=Jf({inputs:{x:r},backend:t}),i=bl({inputs:{input:s},backend:t}),a=Jf({inputs:{x:i},backend:t}),l=ps({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return Zw({backend:t,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const kK={kernelName:dm,backendName:"cpu",kernelFunc:Jf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function UR(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(s.dtype==="complex64"){const r=aa({inputs:{input:s},backend:t}),o=UR({inputs:{x:r},backend:t}),i=bl({inputs:{input:s},backend:t}),a=Jf({inputs:{x:i},backend:t}),l=ps({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return Zw({backend:t,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const SK={kernelName:Kp,backendName:"cpu",kernelFunc:UR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GR(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return Zf({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{Iy(o,d.shape,"All tensors passed to stack must have matching shapes"),O(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=Zf({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=Cl({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const IK={kernelName:Yp,backendName:"cpu",kernelFunc:GR};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $K(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;Ee(r,"pad");const a=o.map((C,$)=>C[0]+r.shape[$]+C[1]),l=o.map(C=>C[0]),u=t.data.get(r.dataId).values,d=ce(r.shape),f=r.shape.length,p=ze(r.shape),g=ce(a),x=a.length,w=ze(a),v=_n(r.dtype,g);i!==0&&v.fill(i);for(let C=0;C<d;C++){const S=Nl(C,f,p).map((E,A)=>E+l[A]),T=Mr(S,x,w);v[T]=u[C]}return{dataId:t.write(v,a,r.dtype),shape:a,dtype:r.dtype}}const HR={kernelName:Qp,backendName:"cpu",kernelFunc:$K};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const TK=Yt((n,e)=>Math.pow(n,e)),NK=hn(Vu,TK),EK={kernelName:Vu,backendName:"cpu",kernelFunc:NK};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RK(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,l=r.map(b=>t.data.get(b.dataId).values),u=r.map(b=>b.shape),d=t.data.get(o.dataId).values,f=t.data.get(i.dataId).values,[p,g,x]=uR(l,u,d,o.shape,o.dtype,f,i.shape),w=p.map(b=>t.makeTensorInfo([b.length],"int32",b)),v=t.makeTensorInfo(x,o.dtype,g);return w.concat([v])}const AK={kernelName:mI,backendName:"cpu",kernelFunc:RK};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DK(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,[u,d]=hR(i,s.shape,s.dtype,a,r.shape,l,o.shape),f=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([d.length],s.dtype,d);return[f,p]}const _K={kernelName:gI,backendName:"cpu",kernelFunc:DK};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FK(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.data.get(r.dataId).values,d=t.data.get(o.dataId).values,f=t.data.get(i.dataId).values,p=a.map(v=>t.data.get(v.dataId).values),g=a.map(v=>v.shape),[x,w]=dR(u,r.shape,d,o.shape,o.dtype,f,i.shape,p,g,l);return t.makeTensorInfo(x,o.dtype,w)}const OK={kernelName:xI,backendName:"cpu",kernelFunc:FK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zK(n){const{backend:e,attrs:t}=n,{start:s,stop:r,dtype:o,step:i}=t,a=fR(s,r,i,o);return e.makeTensorInfo([a.length],o,a)}const MK={kernelName:i1,backendName:"cpu",kernelFunc:zK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const PK=yt(Wu,n=>1/n),LK={kernelName:Wu,backendName:"cpu",kernelFunc:PK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BK(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;Ee(r,"resizeBilinear");const l=ze(r.shape),[u,d]=a,[f,p,g,x]=r.shape,w=t.data.get(r.dataId).values,v=new Float32Array(ce([f,u,d,x])),b=[o&&u>1?p-1:p,o&&d>1?g-1:g],C=[o&&u>1?u-1:u,o&&d>1?d-1:d];let $=0;const S=b[0]/C[0],T=b[1]/C[1];for(let E=0;E<f;E++)for(let A=0;A<u;A++){let F;i?F=S*(A+.5)-.5:F=S*A;const D=Math.max(0,Math.floor(F)),_=F-D,N=Math.min(p-1,Math.ceil(F)),L=E*l[0]+D*l[1],G=E*l[0]+N*l[1];for(let Q=0;Q<d;Q++){let K;i?K=T*(Q+.5)-.5:K=T*Q;const Z=Math.max(0,Math.floor(K)),te=K-Z,B=Math.min(g-1,Math.ceil(K)),H=L+Z*l[2],X=G+Z*l[2],z=L+B*l[2],V=G+B*l[2];for(let oe=0;oe<x;oe++){const ue=w[H+oe],he=w[X+oe],de=w[z+oe],we=w[V+oe],xe=ue+(de-ue)*te,be=he+(we-he)*te,Te=xe+(be-xe)*_;v[$++]=Te}}}return t.makeTensorInfo([f,u,d,x],"float32",v)}const VK={kernelName:nm,backendName:"cpu",kernelFunc:BK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WK(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;Ee([o,r],"resizeBilinearGrad");const a=ze(r.shape),[l,u,d,f]=r.shape,[,p,g]=o.shape,x=new Float32Array(l*u*d*f),w=[i&&p>1?u-1:u,i&&g>1?d-1:d],v=[i&&p>1?p-1:p,i&&g>1?g-1:g],b=w[0]/v[0],C=w[1]/v[1],$=t.data.get(o.dataId).values;let S=0;for(let T=0;T<l;T++){const E=T*a[0];for(let A=0;A<p;A++){const F=A*b,D=Math.floor(F),_=Math.min(Math.ceil(F),u-1),N=E+D*a[1],L=E+_*a[1],G=F-D,Q=1-G;for(let K=0;K<g;K++){const Z=K*C,te=Math.floor(Z),B=Math.min(Math.ceil(Z),d-1),H=Z-te,X=1-H,z=N+te*a[2],V=N+B*a[2],oe=L+te*a[2],ue=L+B*a[2],he=Q*X,de=Q*H,we=G*X,xe=G*H;for(let be=0;be<f;be++){const Te=$[S++];x[z+be]+=Te*he,x[V+be]+=Te*de,x[oe+be]+=Te*we,x[ue+be]+=Te*xe}}}}return t.makeTensorInfo([l,d,u,f],"float32",x)}const UK={kernelName:c1,backendName:"cpu",kernelFunc:WK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function GK(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s;Ee(r,"resizeNearestNeighbor");const l=ze(r.shape),[u,d]=a,[f,p,g,x]=r.shape,w=t.data.get(r.dataId).values,v=new Float32Array(f*u*d*x),b=[o&&u>1?p-1:p,o&&d>1?g-1:g],C=[o&&u>1?u-1:u,o&&d>1?d-1:d],$=b[0]/C[0],S=b[1]/C[1];let T=0;for(let E=0;E<f;E++){const A=E*l[0];for(let F=0;F<u;F++){const D=i?$*(F+.5):$*F;let _=Math.min(p-1,o?Math.round(D):Math.floor(D));i&&(_=Math.max(0,_));const N=A+_*l[1];for(let L=0;L<d;L++){const G=i?S*(L+.5):S*L;let Q=Math.min(g-1,o?Math.round(G):Math.floor(G));i&&(Q=Math.max(0,Q));const K=N+Q*l[2];for(let Z=0;Z<x;Z++){const te=w[K+Z];v[T++]=te}}}}return t.makeTensorInfo([f,u,d,x],r.dtype,v)}const HK={kernelName:tm,backendName:"cpu",kernelFunc:GK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jK(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s;Ee([o,r],"resizeNearestNeighborGrad");const a=ze(r.shape),l=ze(o.shape),[u,d,f,p]=r.shape,[,g,x]=o.shape,w=new Float32Array(u*d*f*p),v=t.data.get(o.dataId).values,b=[i&&g>1?d-1:d,i&&x>1?f-1:f],C=[i&&g>1?g-1:g,i&&x>1?x-1:x],$=b[0]/C[0],S=b[1]/C[1],T=1/$,E=1/S,A=Math.ceil(T)*2+2,F=Math.ceil(E)*2+2;for(let D=0;D<u;D++){const _=D*a[0];for(let N=0;N<d;N++){const L=_+N*a[1],G=Math.floor(N*T),Q=Math.floor(G-A/2);for(let K=0;K<f;K++){const Z=L+K*a[2],te=Math.floor(K*E),B=Math.floor(te-F/2);for(let H=0;H<p;H++){let X=0;for(let z=0;z<A;z++){const V=z+Q;if(V<0||V>=g)continue;const oe=_+V*l[1],ue=V*$,he=Math.min(d-1,i?Math.round(ue):Math.floor(ue));if(N===he)for(let de=0;de<F;de++){const we=de+B;if(we<0||we>=x)continue;const xe=oe+we*l[2],be=we*S,Te=Math.min(f-1,i?Math.round(be):Math.floor(be));K===Te&&(X+=v[xe+H])}}w[Z+H]=X}}}}return t.makeTensorInfo(r.shape,r.dtype,w)}const XK={kernelName:l1,backendName:"cpu",kernelFunc:jK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function KK(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s;Ee(r,"reverse");const i=r.shape.length,a=Je(o,r.shape);if(i===0)return Kr({inputs:{x:r},backend:t});const l=new Tn(r.shape,r.dtype),u=t.bufferSync(r);for(let d=0;d<l.size;d++){const f=l.indexToLoc(d),p=f.slice();a.forEach(g=>p[g]=r.shape[g]-1-p[g]),l.set(u.get(...p),...f)}return t.makeTensorInfo(l.shape,l.dtype,l.values)}const qK={kernelName:sm,backendName:"cpu",kernelFunc:KK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const YK={kernelName:g1,backendName:"cpu",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,a=t,l=_n(s.dtype,ce(s.shape)),[u,d,f,p]=s.shape,[g,x]=ow(i,d,f),w=255,v=Math.sin(r),b=Math.cos(r),C=a.data.get(s.dataId).values;for(let S=0;S<u;S++){const T=S*f*d*p;for(let E=0;E<d;E++){const A=E*(f*p);for(let F=0;F<f;F++){const D=F*p;for(let _=0;_<p;_++){const N=[u,E,F,_],L=N[2],G=N[1];let Q=(L-g)*b-(G-x)*v,K=(L-g)*v+(G-x)*b;Q=Math.round(Q+g),K=Math.round(K+x);let Z=o;if(typeof o!="number"&&(_===3?Z=w:Z=o[_]),Q>=0&&Q<f&&K>=0&&K<d){const B=K*(f*p),H=Q*p,X=T+B+H+_;Z=C[X]}const te=T+A+D+_;l[te]=Z}}}}return{dataId:a.write(l,s.shape,s.dtype),shape:s.shape,dtype:s.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QK=yt(Hu,n=>{const e=Math.floor(n);return n-e<.5?Math.floor(n):n-e>.5?Math.ceil(n):e%2===0?e:e+1}),ZK={kernelName:Hu,backendName:"cpu",kernelFunc:QK};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function JK(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=pa(o,r,i),p=!0,g=t.bufferSync(r),x=t.bufferSync(o),w=Vi(g,x,i,f,u,l,a,d,0,p);return t.makeTensorInfo(i,w.dtype,w.values)}const eq={kernelName:yI,backendName:"cpu",kernelFunc:JK};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tq(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<e?t=r+1:s=r;return s}function nq(n,e){let t=0,s=n.length,r=0;for(;t<s;)r=Math.floor((t+s)/2),n[r]<=e?t=r+1:s=r;return s}function sq(n,e,t,s,r,o){const i=Ht("int32",t*r);for(let a=0;a<t;++a){const l=n.slice(a*s,(a+1)*s),u=a*r;for(let d=0;d<r;++d)i[u+d]=o==="left"?tq(l,e[d+u]):nq(l,e[d+u])}return i}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rq(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,u=sq(a,l,r.shape[0],r.shape[1],o.shape[1],i);return t.makeTensorInfo(o.shape,"int32",u)}const oq={kernelName:vI,backendName:"cpu",kernelFunc:rq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iq(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e;Ee([s,r,o],"select");const i=s.shape.length,a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(o.dataId).values,d=xs(r.dtype,o.dtype),f=Fn(ce(r.shape),d);let p=0;const g=i===0||i>1||r.shape.length===1?1:ce(r.shape.slice(1));for(let x=0;x<a.length;x++)for(let w=0;w<g;w++)a[x]===1?f[p++]=l[x]:f[p++]=u[x];return t.makeTensorInfo(r.shape,d,f)}const aq={kernelName:rm,backendName:"cpu",kernelFunc:iq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lq=Cm,cq=km,uq=yt(Xu,n=>n>=0?cq*n:lq*(Math.exp(n)-1)),hq={kernelName:Xu,backendName:"cpu",kernelFunc:uq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dq=yt(Yu,n=>n<0?-1:n>0?1:0),fq={kernelName:Yu,backendName:"cpu",kernelFunc:dq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const pq=yt(Ku,n=>Math.sin(n)),mq={kernelName:Ku,backendName:"cpu",kernelFunc:pq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gq=yt(qu,n=>Math.sinh(n)),xq={kernelName:qu,backendName:"cpu",kernelFunc:gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yq=11920928955078125e-23,BS=Math.log(yq)+2,wq=yt(Zu,n=>{const e=n>-BS,t=n<BS,s=Math.exp(n);let r;return t?r=s:e?r=n:r=Math.log(1+s),r}),vq={kernelName:Zu,backendName:"cpu",kernelFunc:wq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;Ee([r],"spaceToBatchND");const a=ce(o),l=[[0,0]];l.push(...i);for(let E=1+o.length;E<r.shape.length;++E)l.push([0,0]);const u=HR.kernelFunc({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),d=fh(u.shape,o,a,!1),f=ph(d.length,o.length,!1),p=mh(u.shape,o,a,!1),w=Nt({inputs:{x:u},backend:t,attrs:{shape:d}}),C=rs({inputs:{x:w},backend:t,attrs:{perm:f}}),T=Nt({inputs:{x:C},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(C),T}const Cq={kernelName:am,backendName:"cpu",kernelFunc:bq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kq(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.data.get(s.dataId).values,l=t.data.get(r.dataId).values,u=t.data.get(o.dataId).values,d=t.data.get(i.dataId).values[0],[f,p,g,x,w]=xR(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(p,s.dtype,f),t.makeTensorInfo([p[0]],r.dtype,g),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(v=>Number(v)))),t.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const Sq={kernelName:bI,backendName:"cpu",kernelFunc:kq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Iq(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.data.get(r.dataId).values),a=t.data.get(s.dataId).values,l=Array.from(t.data.get(o.dataId).values),[u,d,f]=yR(a,s.shape,s.dtype,i,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],o.dtype,new Int32Array(f))]}const $q={kernelName:CI,backendName:"cpu",kernelFunc:Iq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Tq(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,[u,d]=Kw(i,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const Nq={kernelName:kI,backendName:"cpu",kernelFunc:Tq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eq(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${o.shape}`);if(r.shape[0]!==o.shape[0])throw new Error("segmentIds and indices should have same size.");const i=t.data.get(s.dataId).values,a=t.data.get(r.dataId).values,l=t.data.get(o.dataId).values,[u,d]=Kw(i,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const Rq={kernelName:SI,backendName:"cpu",kernelFunc:Eq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Aq(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:p}=pa(o,r,a),g=!1,x=t.bufferSync(r);let w;switch(o.dtype){case"bool":{const v=t.bufferSync(o),b=!!t.data.get(i.dataId).values[0];w=Vi(x,v,a,p,d,u,l,f,b,g);break}case"float32":{const v=t.bufferSync(o),b=t.data.get(i.dataId).values[0];w=Vi(x,v,a,p,d,u,l,f,b,g);break}case"int32":{const v=t.bufferSync(o),b=t.data.get(i.dataId).values[0];w=Vi(x,v,a,p,d,u,l,f,b,g);break}case"string":{const v=t.bufferSync(o),b=Qo(t.data.get(i.dataId).values[0]);w=Vi(x,v,a,p,d,u,l,f,b,g);break}default:throw new Error(`Unsupported type ${o.dtype}`)}return t.makeTensorInfo(a,w.dtype,w.values)}const Dq={kernelName:II,backendName:"cpu",kernelFunc:Aq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _q(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=Je(i,r.shape)[0],l=vw(r,o,a),u=new Array(r.shape.length).fill(0),d=r.shape.slice();return l.map(f=>{const p=[...d];p[a]=f;const g=la({inputs:{x:r},backend:t,attrs:{begin:u,size:p}});return u[a]+=f,g})}const Fq={kernelName:lm,backendName:"cpu",kernelFunc:_q};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Oq={kernelName:u1,backendName:"cpu",kernelFunc:({inputs:n,backend:e})=>{const{x:t}=n,s=e;Ee(t,"square");const r=s.data.get(t.dataId).values,o=new Float32Array(r.length);for(let a=0;a<r.length;++a){const l=r[a];o[a]=l*l}return{dataId:s.write(o,t.shape,t.dtype),shape:t.shape,dtype:t.dtype}}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const zq=yt(oh,(n,e)=>{const t=e;return isNaN(n)?NaN:n>0?1:t.alpha}),Mq={kernelName:oh,backendName:"cpu",kernelFunc:zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=s;Ee(r,"stridedSlice");const{finalShapeSparse:g,finalShape:x,isIdentity:w,sliceDim0:v,isSimpleSlice:b,begin:C,end:$,strides:S}=nw(r.shape,o,i,a,l,u,d,f,p);let T;if(w)T=Nt({inputs:{x:r},backend:t,attrs:{shape:x}});else if(v||b){O(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const E=J1(C,$,S),A=la({inputs:{x:r},backend:t,attrs:{begin:C,size:E}});T=Nt({inputs:{x:A},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(A)}else{const E=t.bufferSync(r),A=bR(g,E,S,C);T=t.makeTensorInfo(x,A.dtype,A.values)}return T}const Lq={kernelName:d1,backendName:"cpu",kernelFunc:Pq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bq(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,p=t.data.get(d.dataId).values,g=t.data.get(f.dataId).values,[x,w]=CR(p,g,r,o,i,a,l,u);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(f.shape,"int32",w)]}const Vq={kernelName:$I,backendName:"cpu",kernelFunc:Bq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Wq(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.data.get(o.dataId).values,l=t.data.get(i.dataId).values[0],[u,d,f]=kR(a,l,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const Uq={kernelName:TI,backendName:"cpu",kernelFunc:Wq};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Gq(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.data.get(o.dataId).values,a=SR(i,r);return t.makeTensorInfo(o.shape,"int32",a)}const Hq={kernelName:NI,backendName:"cpu",kernelFunc:Gq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jq=yt(nh,n=>Math.tan(n)),Xq={kernelName:nh,backendName:"cpu",kernelFunc:jq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kq=yt(sh,n=>Math.tanh(n)),qq={kernelName:sh,backendName:"cpu",kernelFunc:Kq};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yq(n){const{inputs:e,backend:t}=n,{tensor:s,indices:r,updates:o}=e,{sliceRank:i,numUpdates:a,sliceSize:l,strides:u,outputSize:d}=pa(o,r,s.shape),f=!1,p=t.bufferSync(r),g=t.bufferSync(o),x=t.bufferSync(s),w=Vi(p,g,s.shape,d,l,a,i,u,x,f);return t.makeTensorInfo(s.shape,w.dtype,w.values)}const Qq={kernelName:wI,backendName:"cpu",kernelFunc:Yq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zq(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;Ee(r,"tile");const i=$R(t.bufferSync(r),o);return t.makeTensorInfo(i.shape,i.dtype,i.values)}const Jq={kernelName:rh,backendName:"cpu",kernelFunc:Zq};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function e7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s;Ee(r,"topk");const a=t.data.get(r.dataId).values,[l,u]=NR(a,r.shape,r.dtype,o,i);return[t.makeTensorInfo(l.shape,l.dtype,l.values),t.makeTensorInfo(u.shape,u.dtype,u.values)]}const t7={kernelName:f1,backendName:"cpu",kernelFunc:e7};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function n7(n){const{inputs:e,attrs:t,backend:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=t,[d,f,p,g]=r.shape,[x,w]=u??[f,p],v=[d,x,w,g],b=ze(r.shape),C=b[0],$=b[1],S=b[2],T=ze(v),E=T[0],A=T[1],F=T[2],D=_n(r.dtype,ce(v));D.fill(l);const _=s.data.get(r.dataId).values,N=s.data.get(o.dataId).values;for(let G=0;G<d;++G){const Q=o.shape[0]===1?N:N.subarray(G*8,G*8+8);for(let K=0;K<x;++K)for(let Z=0;Z<w;++Z)for(let te=0;te<g;++te){let B;const H=Q[6]*Z+Q[7]*K+1;if(H===0)continue;const X=(Q[0]*Z+Q[1]*K+Q[2])/H,z=(Q[3]*Z+Q[4]*K+Q[5])/H,V=VS(X,p,a),oe=VS(z,f,a);switch(i){case"nearest":B=l7(_,f,p,C,$,S,G,oe,V,te,l);break;case"bilinear":B=c7(_,f,p,C,$,S,G,oe,V,te,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}const ue=G*E+K*A+Z*F+te;D[ue]=B}return s.makeTensorInfo(v,r.dtype,D)}return{dataId:s.write(D,v,r.dtype),shape:r.shape,dtype:r.dtype}}const s7={kernelName:p1,backendName:"cpu",kernelFunc:n7};function VS(n,e,t){switch(t){case"reflect":return r7(n,e);case"wrap":return o7(n,e);case"nearest":return a7(n,e);case"constant":default:return i7(n)}}function r7(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=2*e;t<s&&(t=s*Math.trunc(-t/s)+t),t=t<-e?t+s:-t-1}else if(t>e-1)if(e<=1)t=0;else{const s=2*e;t-=s*Math.trunc(t/s),t>=e&&(t=s-t-1)}return qi(0,t,e-1)}function o7(n,e){let t=n;if(t<0)if(e<=1)t=0;else{const s=e-1;t+=e*(Math.trunc(-t/s)+1)}else if(t>e-1)if(e<=1)t=0;else{const s=e-1;t-=e*Math.trunc(t/s)}return qi(0,t,e-1)}function i7(n,e){return n}function a7(n,e){return qi(0,n,e-1)}function Bc(n,e,t,s,r,o,i,a,l,u,d){const f=i*s+a*r+l*o+u;return 0<=a&&a<e&&0<=l&&l<t?n[f]:d}function l7(n,e,t,s,r,o,i,a,l,u,d){const f=Math.round(a),p=Math.round(l);return Bc(n,e,t,s,r,o,i,f,p,u,d)}function c7(n,e,t,s,r,o,i,a,l,u,d){const f=Math.floor(a),p=Math.floor(l),g=f+1,x=p+1,w=(x-l)*Bc(n,e,t,s,r,o,i,f,p,u,d)+(l-p)*Bc(n,e,t,s,r,o,i,f,x,u,d),v=(x-l)*Bc(n,e,t,s,r,o,i,g,p,u,d)+(l-p)*Bc(n,e,t,s,r,o,i,g,x,u,d);return(g-a)*w+(a-f)*v}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function u7(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;Ee(o,"unique");const i=s.data.get(o.dataId).values,{outputValues:a,outputShape:l,indices:u}=ER(i,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const h7={kernelName:m1,backendName:"cpu",kernelFunc:u7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function d7(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r.shape.length,a=r.shape[o],l=new Array(i-1);let u=0;for(let g=0;g<i;g++)g!==o&&(l[u++]=r.shape[g]);const d=new Array(i).fill(0),f=r.shape.slice();f[o]=1;const p=new Array(a);for(let g=0;g<p.length;g++){d[o]=g;const x=la({inputs:{x:r},backend:t,attrs:{begin:d,size:f}});p[g]=Nt({inputs:{x},backend:t,attrs:{shape:l}}),t.disposeIntermediateTensorInfo(x)}return p}const f7={kernelName:um,backendName:"cpu",kernelFunc:d7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function p7(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s;Ee(r,"unsortedSegmentSum");const a=r.shape.length,l=o.shape.length,u=[],d=[],f=a-l;let p=o;for(let x=0;x<f;++x){const w=Zf({inputs:{input:p},backend:t,attrs:{dim:x+1}});p=w,d.push(w)}for(let x=0;x<i;++x){const w=oi(x,"int32"),v=t.makeTensorInfo([],"int32",w),b=GE({inputs:{a:v,b:p},backend:t}),C=ni({inputs:{x:b},backend:t,attrs:{dtype:"float32"}}),$=Om({inputs:{a:C,b:r},backend:t}),S=Sh({inputs:{x:$},backend:t,attrs:{axis:0,keepDims:!1}});u.push(S),d.push(v),d.push(b),d.push(C),d.push($),d.push(S)}const g=GR({inputs:u,backend:t,attrs:{axis:0}});return d.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const m7={kernelName:hm,backendName:"cpu",kernelFunc:p7};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const g7=[uj,G6,dj,pj,Y6,gj,yj,vj,Cj,Sj,$j,Nj,Rj,_j,Oj,Pj,Bj,Wj,Gj,lj,jj,Kj,Yj,Z6,Zj,K6,eH,e8,H6,n8,r8,o8,a8,c8,h8,f8,m8,x8,w8,b8,k8,I8,T8,E8,R8,D8,F8,z8,M8,P8,L8,V8,G8,tj,j8,tH,eX,nH,tX,rH,aX,lX,uX,iH,lH,dX,pX,gX,yX,uH,dH,j6,vX,s8,CX,SX,$X,nj,pH,gH,NX,yH,RX,_X,OX,PX,BX,WX,UX,vH,HX,XX,qX,QX,JX,tK,sK,CH,oK,lK,hK,SH,$H,pK,xK,vK,NH,CK,SK,IK,HR,EK,rj,AH,AK,_K,OK,MK,X6,ty,LK,oj,ij,aj,VK,UK,HK,XK,qK,YK,ZK,LH,eq,oq,aq,hq,VH,fq,mq,xq,WH,cK,vq,Cq,Sq,$q,Nq,Rq,Dq,Fq,HH,Oq,XH,qH,Mq,Lq,Vq,Uq,Hq,JH,W8,Xq,qq,Qq,Jq,t7,s7,EH,h7,f7,m7,kK];for(const n of g7)RI(n);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Pi={},jd={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function x7(n,e){Pi[n]=e}function Cr(n,e){if(!(n in Pi)||e!=null){const s=w7(n,e);if(s!==null)Pi[n]=s;else return console.log("Could not get context for WebGL version",n),null}const t=Pi[n];return t==null||t.isContextLost()?(delete Pi[n],Cr(n)):(t.disable(t.DEPTH_TEST),t.disable(t.STENCIL_TEST),t.disable(t.BLEND),t.disable(t.DITHER),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SAMPLE_COVERAGE),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),Pi[n])}function y7(n){if(!ie().getBool("IS_SAFARI")&&typeof OffscreenCanvas<"u"&&n===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function w7(n,e){if(n!==1&&n!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const t=e??y7(n);return t.addEventListener("webglcontextlost",s=>{s.preventDefault(),delete Pi[n]},!1),ie().getBool("SOFTWARE_WEBGL_ENABLED")&&(jd.failIfMajorPerformanceCaveat=!1),n===1?t.getContext("webgl",jd)||t.getContext("experimental-webgl",jd):t.getContext("webgl2",jd)}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */var su;(function(n){n[n.DENSE=0]="DENSE",n[n.SHARED_BATCH=1]="SHARED_BATCH"})(su||(su={}));var Ns;(function(n){n[n.RENDER=0]="RENDER",n[n.UPLOAD=1]="UPLOAD",n[n.PIXELS=2]="PIXELS",n[n.DOWNLOAD=3]="DOWNLOAD"})(Ns||(Ns={}));var $n;(function(n){n[n.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",n[n.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",n[n.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",n[n.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",n[n.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})($n||($n={}));function Ih(n,e){return[e,n]}function v7(n,e){return n*e}function Xd(n){const e=ce(n),t=Math.ceil(e/4);return Sx(t)}function Ol(n,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(n/2))]}function b7(n,e){const[t,s]=Ol(n,e);return t*s*4}function Jw(n,e){const t=n;let s,r,o,i,a,l,u,d,f,p;return ie().getNumber("WEBGL_VERSION")===2?(s=t.R32F,r=t.R16F,o=t.RGBA16F,i=t.RGBA32F,a=t.RED,u=4,d=1,f=t.HALF_FLOAT,p=t.FLOAT,l=t.RGBA8):(s=n.RGBA,r=n.RGBA,o=n.RGBA,i=t.RGBA,a=n.RGBA,u=4,d=4,f=e!=null?e.HALF_FLOAT_OES:null,p=n.FLOAT,l=n.RGBA),{internalFormatFloat:s,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:d,textureTypeHalfFloat:f,textureTypeFloat:p}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Se(n,e){const t=e();return ie().getBool("DEBUG")&&C7(n),t}function C7(n){const e=n.getError();if(e!==n.NO_ERROR)throw new Error("WebGL Error: "+$7(n,e))}const k7=596e-10,S7=65504;function I7(n){return!!(ie().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||n===0||k7<Math.abs(n)&&Math.abs(n)<S7)}function $7(n,e){switch(e){case n.NO_ERROR:return"NO_ERROR";case n.INVALID_ENUM:return"INVALID_ENUM";case n.INVALID_VALUE:return"INVALID_VALUE";case n.INVALID_OPERATION:return"INVALID_OPERATION";case n.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case n.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case n.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function Kd(n,e){return vo(n,()=>n.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function T7(n,e){const t=vo(n,()=>n.createShader(n.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Se(n,()=>n.shaderSource(t,e)),Se(n,()=>n.compileShader(t)),n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw console.log(n.getShaderInfoLog(t)),new Error("Failed to compile vertex shader.");return t}function N7(n,e){const t=vo(n,()=>n.createShader(n.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Se(n,()=>n.shaderSource(t,e)),Se(n,()=>n.compileShader(t)),ie().get("ENGINE_COMPILE_ONLY"))return t;if(n.getShaderParameter(t,n.COMPILE_STATUS)===!1)throw jR(e,n.getShaderInfoLog(t)),new Error("Failed to compile fragment shader.");return t}const E7=/ERROR: [0-9]+:([0-9]+):/g;function jR(n,e){const t=E7.exec(e);if(t==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(n);return}const s=+t[1],r=n.split(`
`),o=r.length.toString().length+2,i=r.map((f,p)=>sl((p+1).toString(),o)+f);let a=0;for(let f=0;f<i.length;f++)a=Math.max(i[f].length,a);const l=i.slice(0,s-1),u=i.slice(s-1,s),d=i.slice(s);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${sl(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(d.join(`
`))}function R7(n){return vo(n,()=>n.createProgram(),"Unable to create WebGLProgram.")}function A7(n,e){if(Se(n,()=>n.linkProgram(e)),!ie().get("ENGINE_COMPILE_ONLY")&&n.getProgramParameter(e,n.LINK_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function sx(n,e){if(Se(n,()=>n.validateProgram(e)),n.getProgramParameter(e,n.VALIDATE_STATUS)===!1)throw console.log(n.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function D7(n,e){const t=vo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Se(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),Se(n,()=>n.bufferData(n.ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function _7(n,e){const t=vo(n,()=>n.createBuffer(),"Unable to create WebGLBuffer");return Se(n,()=>n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t)),Se(n,()=>n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW)),t}function F7(n){return vo(n,()=>n.createTexture(),"Unable to create WebGLTexture.")}function O7(n,e){const t=ie().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(n<=0||e<=0){const s=`[${n}x${e}]`;throw new Error("Requested texture size "+s+" is invalid.")}if(n>t||e>t){const s=`[${n}x${e}]`,r=`[${t}x${t}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+r+".")}}function z7(n){return vo(n,()=>n.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function WS(n,e,t,s,r,o,i){const a=n.getAttribLocation(e,t);return a===-1?!1:(Se(n,()=>n.bindBuffer(n.ARRAY_BUFFER,s)),Se(n,()=>n.vertexAttribPointer(a,r,n.FLOAT,!1,o,i)),Se(n,()=>n.enableVertexAttribArray(a)),!0)}function M7(n,e,t){W7(n,t),Se(n,()=>n.activeTexture(n.TEXTURE0+t)),Se(n,()=>n.bindTexture(n.TEXTURE_2D,e))}function P7(n,e,t){return vo(n,()=>n.getUniformLocation(e,t),'uniform "'+t+'" not present in program.')}function L7(n,e,t){return n.getUniformLocation(e,t)}function B7(n,e,t,s){Se(n,()=>M7(n,e,s)),Se(n,()=>n.uniform1i(t,s))}function rx(n,e,t){Se(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,t)),Se(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0))}function US(n,e){Se(n,()=>n.bindFramebuffer(n.FRAMEBUFFER,e)),Se(n,()=>n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,null,0))}function qd(n){const e=n.checkFramebufferStatus(n.FRAMEBUFFER);if(e!==n.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+V7(n,e))}function V7(n,e){switch(e){case n.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case n.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case n.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function vo(n,e,t){const s=Se(n,()=>e());if(s==null)throw new Error(t);return s}function W7(n,e){const t=n.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+n.TEXTURE0;if(s<n.TEXTURE0||s>t){const r=`[gl.TEXTURE0, gl.TEXTURE${t}]`;throw new Error(`textureUnit must be in ${r}.`)}}function kl(n,e=2){return ce(n.slice(0,n.length-e))}function Sl(n){if(n.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[n.length>1?n[n.length-2]:1,n[n.length-1]]}function Yd(n){let e=[1,1,1];return n.length===0||n.length===1&&n[0]===1||(e=[kl(n),...Sl(n)]),e}function U7(n,e=!1){let t=ie().getNumber("WEBGL_MAX_TEXTURE_SIZE"),s=ie().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");s===1/0&&ie().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(s=t/2),e&&(t=t*2,s=s*2,n=n.map((a,l)=>l>=n.length-2?Sy(n[l]):n[l]),n.length===1&&(n=[2,n[0]])),n.length!==2&&(n=ri(n).newShape);let r=ce(n),o=null;n.length<=1&&r<=t?o=[1,r]:n.length===2&&n[0]<=t&&n[1]<=t?o=n:n.length===3&&n[0]*n[1]<=t&&n[2]<=t?o=[n[0]*n[1],n[2]]:n.length===3&&n[0]<=t&&n[1]*n[2]<=t?o=[n[0],n[1]*n[2]]:n.length===4&&n[0]*n[1]*n[2]<=t&&n[3]<=t?o=[n[0]*n[1]*n[2],n[3]]:n.length===4&&n[0]<=t&&n[1]*n[2]*n[3]<=t&&(o=[n[0],n[1]*n[2]*n[3]]);const i=o!=null&&Math.max(...o)>s&&Math.min(...o)<=(e?2:1)&&Math.min(...o)>0;if(o==null||i)if(e){const a=kl(n);let l=2,u=2;n.length&&([l,u]=Sl(n)),r=a*(l/2)*(u/2),o=Sx(r).map(d=>d*2)}else o=Sx(r);return o}function Qd(n){return n%2===0}function ep(n,e){if(n=n.slice(-2),e=e.slice(-2),mt(n,e)||!n.length||!e.length||n[0]===0||n[1]===0||e[0]===0||e[1]===0)return!0;if(n.length!==e.length){const t=n[n.length-1],s=e[e.length-1];if(t===s||Qd(t)&&Qd(s)&&(n[0]===1||e[0]===1))return!0}return n[1]===e[1]&&Qd(n[0])&&Qd(e[0])}let ox,ix;function G7(n){if(ox==null){const e=Cr(n);ox=e.getParameter(e.MAX_TEXTURE_SIZE)}return ox}function H7(n){if(ix==null){const e=Cr(n);ix=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,ix)}function j7(n){if(n===0)return 0;let e;const t=Cr(n);return Xs(t,"EXT_disjoint_timer_query_webgl2")&&n===2?e=2:Xs(t,"EXT_disjoint_timer_query")?e=1:e=0,e}function Xs(n,e){return n.getExtension(e)!=null}function GS(n){try{if(Cr(n)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function X7(n){if(n===0)return!1;const e=Cr(n);if(n===1){if(!Xs(e,"OES_texture_float"))return!1}else if(!Xs(e,"EXT_color_buffer_float"))return!1;return sy(e)}function K7(n){if(n===0)return!1;const e=Cr(n);if(n===1){if(!Xs(e,"OES_texture_float")||!Xs(e,"WEBGL_color_buffer_float"))return!1}else{if(Xs(e,"EXT_color_buffer_float"))return sy(e);const s="EXT_color_buffer_half_float";if(Xs(e,s)){const r=e.getExtension(s);return q7(e,r)}return!1}return sy(e)}function sy(n){const e=Jw(n),t=n.createTexture();n.bindTexture(n.TEXTURE_2D,t),n.texImage2D(n.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);const o=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,o),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const i=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(t),n.deleteFramebuffer(o),i}function q7(n,e){const t=Jw(n,e),s=n.createTexture();n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t.internalFormatHalfFloat,1,1,0,t.textureFormatFloat,t.textureTypeHalfFloat,null);const i=n.createFramebuffer();n.bindFramebuffer(n.FRAMEBUFFER,i),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,s,0);const a=n.checkFramebufferStatus(n.FRAMEBUFFER)===n.FRAMEBUFFER_COMPLETE;return n.bindTexture(n.TEXTURE_2D,null),n.bindFramebuffer(n.FRAMEBUFFER,null),n.deleteTexture(s),n.deleteFramebuffer(i),a}function Y7(n){return n!==2?!1:Cr(n).fenceSync!=null}function $h(n,e){Array.isArray(n)||(n=[n]),n.forEach(t=>{t!=null&&O(t.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ae=ie();Ae.registerFlag("HAS_WEBGL",()=>Ae.getNumber("WEBGL_VERSION")>0);Ae.registerFlag("WEBGL_VERSION",()=>GS(2)?2:GS(1)?1:0);Ae.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Ae.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Ae.get("WEBGL_VERSION")===2);Ae.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Ae.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Ae.registerFlag("WEBGL_PACK",()=>Ae.getBool("HAS_WEBGL"));Ae.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_CLIP",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_REDUCE",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_LAZILY_UNPACK",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_CONV_IM2COL",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_PACK_CONV2DTRANSPOSE",()=>Ae.getBool("WEBGL_PACK"));Ae.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>G7(Ae.getNumber("WEBGL_VERSION")));Ae.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>H7(Ae.getNumber("WEBGL_VERSION")));Ae.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{const n=Ae.getNumber("WEBGL_VERSION");return n===0?0:j7(n)});Ae.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Ae.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!UI());Ae.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>X7(Ae.getNumber("WEBGL_VERSION")));Ae.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Ae.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Ae.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Ae.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>K7(Ae.getNumber("WEBGL_VERSION")));Ae.registerFlag("WEBGL_FENCE_API_ENABLED",()=>Y7(Ae.getNumber("WEBGL_VERSION")));Ae.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Ae.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Ae.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${n}.`)});Ae.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>UI()?1:-1,n=>{if(typeof n!="number")throw new Error(`WEBGL_FLUSH_THRESHOLD must be a number but got ${n}.`);if(n<0&&n!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${n}.`)});Ae.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Ae.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Ae.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Ae.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Ae.registerFlag("WEBGL_EXP_CONV",()=>!1);Ae.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Ae.getBool("IS_TEST"));Ae.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Ae.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Ae.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Ae.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yn(){let n,e,t,s,r,o,i,a,l,u;return ie().getNumber("WEBGL_VERSION")===2?(n="#version 300 es",e="in",t="out",s="in",r="texture",o="outputColor",i="out vec4 outputColor;",a=ie().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(n="",e="attribute",t="varying",s="varying",r="texture2D",o="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:n,attribute:e,varyingVs:t,varyingFs:s,texture2D:r,output:o,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function xa(n,e,t="index"){const s=ze(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / ${r}`,a=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * ${r}`:`index -= ${n[o]} * ${r}`;return`${i}; ${a};`}).join("")}function zm(n,e,t="index"){const s=ze(e);return s.map((r,o)=>{const i=`int ${n[o]} = ${t} / outShapeStrides[${o}]`,a=o===s.length-1?`int ${n[o+1]} = ${t} - ${n[o]} * outShapeStrides[${o}]`:`index -= ${n[o]} * outShapeStrides[${o}]`;return`${i}; ${a};`}).join("")}function Q7(n,e){const t=n.length,s=n.map(o=>`${e}[${o}]`),r=new Array(t-1);r[t-2]=s[t-1];for(let o=t-3;o>=0;--o)r[o]=`(${r[o+1]} * ${s[o+1]})`;return r}function Z7(n,e,t="index"){const s=n.map((o,i)=>i),r=Q7(s,e);return r.map((o,i)=>{const a=`int ${n[i]} = ${t} / ${r[i]}`,l=i===r.length-1?`int ${n[i+1]} = ${t} - ${n[i]} * ${r[i]}`:`index -= ${n[i]} * ${r[i]}`;return`${a}; ${l};`}).join("")}function ev(n){const e=ze(n).map(t=>t.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function tv(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}const XR=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{getBroadcastDims:KR}=LW;function J7(n,e,t){const s=[];if(n.forEach(g=>{const x=ce(g.shapeInfo.logicalShape);if(g.shapeInfo.isUniform?s.push(`uniform float ${g.name}${x>1?`[${x}]`:""};`):(s.push(`uniform sampler2D ${g.name};`),s.push(`uniform int offset${g.name};`)),t.enableShapeUniforms){const{uniformShape:w}=nv(t.packedInputs,g.shapeInfo.logicalShape,g.shapeInfo.texShape);switch(w.length){case 1:s.push(`uniform int ${g.name}Shape;`);break;case 2:s.push(`uniform ivec2 ${g.name}Shape;`);break;case 3:s.push(`uniform ivec3 ${g.name}Shape;`);break;case 4:s.push(`uniform ivec4 ${g.name}Shape;`);break}s.push(`uniform ivec2 ${g.name}TexShape;`)}}),t.enableShapeUniforms){switch(e.logicalShape.length){case 1:s.push("uniform int outShape;");break;case 2:s.push("uniform ivec2 outShape;"),s.push("uniform int outShapeStrides;");break;case 3:s.push("uniform ivec3 outShape;"),s.push("uniform ivec2 outShapeStrides;");break;case 4:s.push("uniform ivec4 outShape;"),s.push("uniform ivec3 outShapeStrides;");break}s.push("uniform ivec2 outTexShape;")}t.customUniforms&&t.customUniforms.forEach(g=>{s.push(`uniform ${g.type} ${g.name}${g.arrayIndex?`[${g.arrayIndex}]`:""};`)});const r=s.join(`
`),o=n.map(g=>e9(g,e,t.packedInputs,t.enableShapeUniforms)).join(`
`),i=e.texShape,a=Yn(),l=s9(a);let u,d,f=i9(a);return e.isPacked?(u=t9(e.logicalShape,i,t.enableShapeUniforms),d=o9(a)):(u=n9(e.logicalShape,i,t.enableShapeUniforms),d=r9(a)),t.packedInputs&&(f+=u9),[f,l,d,r,u,o,t.userCode].join(`
`)}function zl(n,e=!1){const t=n.shapeInfo.logicalShape;switch(t.length){case 0:return C9(n,e);case 1:return S9(n,e);case 2:return $9(n,e);case 3:return N9(n,e);case 4:return R9(n,e);case 5:return A9(n);case 6:return D9(n);default:throw new Error(`${t.length}-D input sampling is not yet supported`)}}function qR(n,e){switch(n.shapeInfo.logicalShape.length){case 0:return b9(n);case 1:return k9(n,e);case 2:return I9(n,e);case 3:return T9(n,e);default:return E9(n,e)}}function e9(n,e,t=!1,s){let r="";t?r+=qR(n,s):r+=zl(n,s);const o=n.shapeInfo.logicalShape,i=e.logicalShape;return o.length<=i.length&&(t?r+=_9(n,e):r+=F9(n,e)),r}function t9(n,e,t){switch(n.length){case 0:return YR();case 1:return h9(n,e,t);case 2:return w9(n,e,t);case 3:return f9(n,e,t);default:return m9(n,e,t)}}function n9(n,e,t){switch(n.length){case 0:return YR();case 1:return d9(n,e,t);case 2:return v9(n,e,t);case 3:return p9(n,e,t);case 4:return g9(n,e,t);case 5:return x9(n,e);case 6:return y9(n,e);default:throw new Error(`${n.length}-D output sampling is not yet supported`)}}function s9(n){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${n.texture2D}(textureSampler, uv).r;
    }
  `}function r9(n){return`
    void setOutput(float val) {
      ${n.output} = vec4(val, 0, 0, 0);
    }
  `}function o9(n){return`
    void setOutput(vec4 val) {
      ${n.output} = val;
    }
  `}function i9(n){return`${n.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${n.varyingFs} vec2 resultUV;
    ${n.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${n.defineSpecialNaN}
    ${n.defineSpecialInf}
    ${n.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${a9}
    ${l9}
    ${c9}
  `}const a9=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,l9=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,c9=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,u9=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function YR(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function h9(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return s[0]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${s[1]}.0);
      }
    `:s[1]===1?t?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${s[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      return 2 * (resTexRC.x * ${s[1]} + resTexRC.y);
    }
  `}function d9(n,e,t){return e[0]===1?t?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?t?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:t?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function f9(n,e,t){if(t)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[2]/2),o=r*Math.ceil(n[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec3(b, r, c);
    }
  `}function p9(n,e,t){if(t)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${zm(["r","c","d"],n)}
    return ivec3(r, c, d);
  }
`;const s=xa(["r","c","d"],n);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec3(r, c, d);
    }
  `}function m9(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(n[n.length-1]/2),o=r*Math.ceil(n[n.length-2]/2);let i=o,a="",l="b, r, c";for(let u=2;u<n.length-1;u++)i*=n[n.length-u-1],a=`
      int b${u} = index / ${i};
      index -= b${u} * ${i};
    `+a,l=`b${u}, `+l;return`
    ivec${n.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));
      int index = resTexRC.x * ${s[1]} + resTexRC.y;

      ${a}

      int b = index / ${o};
      index -= b * ${o};

      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec${n.length}(${l});
    }
  `}function g9(n,e,t){if(t)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${zm(["r","c","d","d2"],n)}
      return ivec4(r, c, d, d2);
    }
  `;const s=xa(["r","c","d","d2"],n);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${s}
      return ivec4(r, c, d, d2);
    }
  `}function x9(n,e){const t=xa(["r","c","d","d2","d3"],n);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function y9(n,e){const t=xa(["r","c","d","d2","d3","d4"],n);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${t}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function w9(n,e,t){const s=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(mt(n,e))return t?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${s[0]}, ${s[1]}));
      }
    `;const r=Math.ceil(n[1]/2);return t?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${s[0]}, ${s[1]}));

      int index = resTexRC.x * ${s[1]} + resTexRC.y;
      int r = 2 * (index / ${r});
      int c = imod(index, ${r}) * 2;

      return ivec2(r, c);
    }
  `}function v9(n,e,t){return mt(n,e)?t?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:n[1]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:n[0]===1?t?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:t?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${n[1]};
      int c = index - r * ${n[1]};
      return ivec2(r, c);
    }
  `}function ya(n){return`offset${n}`}function b9(n){const e=n.name,t="get"+e.charAt(0).toUpperCase()+e.slice(1),s=Yn();return`
    vec4 ${t}() {
      return ${s.texture2D}(${e}, halfCR);
    }
  `}function C9(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`float ${s}() {return ${t};}`;const[r,o]=n.shapeInfo.texShape;if(r===1&&o===1)return`
      float ${s}() {
        return sampleTexture(${t}, halfCR);
      }
    `;const i=ya(t);if(e)return`
    float ${s}() {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], ${i});
      return sampleTexture(${t}, uv);
    }
  `;const[a,l]=n.shapeInfo.texShape;return`
    float ${s}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${i});
      return sampleTexture(${t}, uv);
    }
  `}function k9(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=n.shapeInfo.texShape,o=Yn();if(e)return`
    vec4 ${s}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${o.texture2D}(${t}, uv);
    }
  `;const i=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)];return`
    vec4 ${s}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${o.texture2D}(${t}, uv);
    }
  `}function S9(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1);if(n.shapeInfo.isUniform)return`
      float ${s}(int index) {
        ${Ml(n)}
      }
    `;const r=n.shapeInfo.texShape,o=r[0],i=r[1];if(i===1&&o===1)return`
      float ${s}(int index) {
        return sampleTexture(${t}, halfCR);
      }
    `;const a=ya(t);return i===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${t}TexShape[0]));
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${o}.0);
        return sampleTexture(${t}, uv);
      }
    `:o===1?e?`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${t}TexShape[1]), 0.5);
        return sampleTexture(${t}, uv);
      }
    `:`
      float ${s}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${t}, uv);
      }
    `:e?`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${t}TexShape[0], ${t}TexShape[1], index + ${a});
      return sampleTexture(${t}, uv);
    }
  `:`
    float ${s}(int index) {
      vec2 uv = uvFromFlat(${o}, ${i}, index + ${a});
      return sampleTexture(${t}, uv);
    }
  `}function I9(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=o[0],a=o[1],l=Yn();if(o!=null&&mt(t,o))return e?`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);

        return ${l.texture2D}(${s}, uv);
      }
    `:`
      vec4 ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${l.texture2D}(${s}, uv);
      }
    `;if(e)return`
    vec4 ${r}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `;const u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)],d=Math.ceil(t[1]/2);return`
    vec4 ${r}(int row, int col) {
      vec2 uv = packedUVfrom2D(${d}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${s}, uv);
    }
  `}function $9(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape;if(o!=null&&mt(t,o)){if(e)return`
      float ${r}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `;const p=o[0],g=o[1];return`
    float ${r}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${g}.0, ${p}.0);
      return sampleTexture(${s}, uv);
    }
  `}const{newShape:i,keptDims:a}=ri(t),l=i;if(l.length<t.length){const p=Pl(n,l),g=["row","col"];return`
      ${zl(p,e)}
      float ${r}(int row, int col) {
        return ${r}(${Ll(g,a)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${t[1]}, 1)));
        ${Ml(n)}
      }
    `;const u=o[0],d=o[1],f=ya(s);return d===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${s}TexShape[0]));
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${s}, uv);
    }
  `:u===1?e?`
      float ${r}(int row, int col) {
        float index = dot(vec3(row, col, ${f}), vec3(${s}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${s}TexShape[1]), 0.5);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col) {
      float index = dot(vec3(row, col, ${f}), vec3(${t[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${d}.0, 0.5);
      return sampleTexture(${s}, uv);
    }
  `:e?`
      float ${r}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s}Shape[1] + col + ${f};
        vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
        return sampleTexture(${s}, uv);
      }
    `:`
  float ${r}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${t[1]} + col + ${f};
    vec2 uv = uvFromFlat(${u}, ${d}, index);
    return sampleTexture(${s}, uv);
  }
`}function T9(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=n.shapeInfo.texShape,i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];if(t[0]===1){const p=t.slice(1),g=[1,2],x=Pl(n,p),w=["b","row","col"];return`
        ${qR(x,e)}
        vec4 ${r}(int b, int row, int col) {
          return ${r}(${Ll(w,g)});
        }
      `}const a=Yn();if(e)return`
    vec4 ${r}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${s}TexShape[0]) / 2.0), ceil(float(${s}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${s}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${s}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `;const l=i[0],u=i[1],d=Math.ceil(t[2]/2),f=d*Math.ceil(t[1]/2);return`
    vec4 ${r}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${f}, ${d}, b, row, col);
      return ${a.texture2D}(${s}, uv);
    }
  `}function N9(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[1]*t[2],i=t[2],{newShape:a,keptDims:l}=ri(t),u=a;if(u.length<t.length){const w=Pl(n,u),v=["row","col","depth"];return`
        ${zl(w,e)}
        float ${r}(int row, int col, int depth) {
          return ${r}(${Ll(v,l)});
        }
      `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${o}, ${i}, 1)));
        ${Ml(n)}
      }
    `;const d=n.shapeInfo.texShape,f=d[0],p=d[1],g=n.shapeInfo.flatOffset;if(p===o&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        int stride1 = ${s}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
        float ${r}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${p}.0, ${f}.0);
          return sampleTexture(${s}, uv);
        }
      `;if(p===i&&g==null)return e?`
      float ${r}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${s}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
    float ${r}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${t[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${p}.0, ${f}.0);
      return sampleTexture(${s}, uv);
    }
  `;const x=ya(s);return e?`
    float ${r}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${s}Shape[1] * ${s}Shape[2];
      int stride1 = ${s}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${x};
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index);
      return sampleTexture(${s}, uv);
    }
    `:`
      float ${r}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${o} + col * ${i} + depth + ${x};
        vec2 uv = uvFromFlat(${f}, ${p}, index);
        return sampleTexture(${s}, uv);
      }
  `}function E9(n,e){const t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=Yn();if(e)return`
    vec4 ${s}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${t}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${t}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${t}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${t}TexShape[0]) / 2.0), ceil(float(${t}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${r.texture2D}(${t}, uv);
    }
  `;const o=n.shapeInfo.logicalShape,i=o.length,a=n.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],d=l[1],f=Math.ceil(o[i-1]/2);let p=f*Math.ceil(o[i-2]/2),g="int b, int row, int col",x=`b * ${p} + (row / 2) * ${f} + (col / 2)`;for(let w=2;w<i-1;w++)g=`int b${w}, `+g,p*=o[i-w-1],x=`b${w} * ${p} + `+x;return`
    vec4 ${s}(${g}) {
      int index = ${x};
      int texR = index / ${d};
      int texC = index - texR * ${d};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${d}, ${u});
      return ${r.texture2D}(${t}, uv);
    }
  `}function R9(n,e){const t=n.shapeInfo.logicalShape,s=n.name,r="get"+s.charAt(0).toUpperCase()+s.slice(1),o=t[3],i=t[2]*o,a=t[1]*i,{newShape:l,keptDims:u}=ri(t);if(l.length<t.length){const C=Pl(n,l),$=["row","col","depth","depth2"];return`
      ${zl(C,e)}
      float ${r}(int row, int col, int depth, int depth2) {
        return ${r}(${Ll($,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${r}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${o}, 1)));
        ${Ml(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1],x=`int stride2 = ${s}Shape[3];`,w=`int stride1 = ${s}Shape[2] * stride2;`,v=`int stride0 = ${s}Shape[1] * stride1;`;if(g===a&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        ${x}
        ${w}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;if(g===o&&d==null)return e?`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${s}Shape[1] * ${s}Shape[2], ${s}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${s}TexShape[1], ${s}TexShape[0]);
        return sampleTexture(${s}, uv);
      }
    `:`
      float ${r}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${t[1]*t[2]}, ${t[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${s}, uv);
      }
    `;const b=ya(s);return e?`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${x}
      ${w}
      ${v}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${s}TexShape[0], ${s}TexShape[1], index + ${b});
      return sampleTexture(${s}, uv);
    }
  `:`
    float ${r}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${o} + depth2;
      vec2 uv = uvFromFlat(${p}, ${g}, index + ${b});
      return sampleTexture(${s}, uv);
    }
  `}function A9(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e[4],o=e[3]*r,i=e[2]*o,a=e[1]*i,{newShape:l,keptDims:u}=ri(e);if(l.length<e.length){const w=Pl(n,l),v=["row","col","depth","depth2","depth3"];return`
      ${zl(w)}
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        return ${s}(${Ll(v,u)});
      }
    `}if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${o}, ${r})) +
          depth3;
        ${Ml(n)}
      }
    `;const d=n.shapeInfo.flatOffset,f=n.shapeInfo.texShape,p=f[0],g=f[1];if(g===a&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${o}, ${r}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(g===r&&d==null)return`
      float ${s}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${g}.0, ${p}.0);
        return sampleTexture(${t}, uv);
      }
    `;const x=ya(t);return`
    float ${s}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${o} +
          depth2 * ${r} + depth3 + ${x};
      vec2 uv = uvFromFlat(${p}, ${g}, index);
      return sampleTexture(${t}, uv);
    }
  `}function D9(n){const e=n.shapeInfo.logicalShape,t=n.name,s="get"+t.charAt(0).toUpperCase()+t.slice(1),{newShape:r,keptDims:o}=ri(e);if(r.length<e.length){const v=Pl(n,r),b=["row","col","depth","depth2","depth3","depth4"];return`
      ${zl(v)}
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${s}(${Ll(b,o)});
      }
    `}const i=e[5],a=e[4]*i,l=e[3]*a,u=e[2]*l,d=e[1]*u;if(n.shapeInfo.isUniform)return`
      float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${d}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Ml(n)}
      }
    `;const f=n.shapeInfo.flatOffset,p=n.shapeInfo.texShape,g=p[0],x=p[1];if(x===d&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${x}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;if(x===i&&f==null)return`
      float ${s}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${x}.0, ${g}.0);
        return sampleTexture(${t}, uv);
      }
    `;const w=ya(t);return`
    float ${s}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${d} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${w};
      vec2 uv = uvFromFlat(${g}, ${x}, index);
      return sampleTexture(${t}, uv);
    }
  `}function Ml(n){const e=n.name,t=ce(n.shapeInfo.logicalShape);return t<2?`return ${e};`:`
    for (int i = 0; i < ${t}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function _9(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=n.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=KR(n.shapeInfo.logicalShape,e.logicalShape),l=Ct(i),u=i-o;let d;const f=["x","y","z","w","u","v"];o===0?d="":i<2&&a.length>=1?d="coords = 0;":d=a.map(C=>`coords.${f[C+u]} = 0;`).join(`
`);let p="";i<2&&o>0?p="coords":p=n.shapeInfo.logicalShape.map((C,$)=>`coords.${f[$+u]}`).join(", ");let g="return outputValue;";const w=ce(n.shapeInfo.logicalShape)===1,b=ce(e.logicalShape)===1;if(o===1&&!w&&!b)g=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(w&&!b)i===1?g=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:g=`
        return vec4(outputValue.x);
      `;else if(a.length){const C=o-2,$=o-1;a.indexOf(C)>-1&&a.indexOf($)>-1?g="return vec4(outputValue.x);":a.indexOf(C)>-1?g="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf($)>-1&&(g="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${r}() {
      ${l} coords = getOutputCoords();
      ${d}
      vec4 outputValue = get${s}(${p});
      ${g}
    }
  `}function F9(n,e){const t=n.name,s=t.charAt(0).toUpperCase()+t.slice(1),r="get"+s+"AtOutCoords",o=e.texShape,i=n.shapeInfo.texShape,a=n.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!n.shapeInfo.isUniform&&a===l&&n.shapeInfo.flatOffset==null&&mt(i,o))return`
      float ${r}() {
        return sampleTexture(${t}, resultUV);
      }
    `;const u=Ct(l),d=KR(n.shapeInfo.logicalShape,e.logicalShape),f=l-a;let p;const g=["x","y","z","w","u","v"];a===0?p="":l<2&&d.length>=1?p="coords = 0;":p=d.map(w=>`coords.${g[w+f]} = 0;`).join(`
`);let x="";return l<2&&a>0?x="coords":x=n.shapeInfo.logicalShape.map((w,v)=>`coords.${g[v+f]}`).join(", "),`
    float ${r}() {
      ${u} coords = getOutputCoords();
      ${p}
      return get${s}(${x});
    }
  `}function Ct(n){if(n<=1)return"int";if(n===2)return"ivec2";if(n===3)return"ivec3";if(n===4)return"ivec4";if(n===5)return"ivec5";if(n===6)return"ivec6";throw Error(`GPU for rank ${n} is not yet supported`)}function nv(n,e,t){const{newShape:s,keptDims:r}=ri(e),o=e.length,i=n&&o===3&&e[0]===1,a=i?e.slice(1):s,l=!n&&o>1&&!mt(e,t)&&s.length<o||i;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:r}}function Pl(n,e){const t=JSON.parse(JSON.stringify(n));return t.shapeInfo.logicalShape=e,t}function Ll(n,e){return e.map(t=>n[t]).join(", ")}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function O9(n,e,t,s){const r=t.map((d,f)=>{const p={logicalShape:d.shape,texShape:d.isUniform?null:d.texData.texShape,isUniform:d.isUniform,isPacked:d.isUniform?!1:d.texData.isPacked,flatOffset:null};return d.texData!=null&&d.texData.slice!=null&&d.texData.slice.flatOffset>0&&(p.flatOffset=d.texData.slice.flatOffset),{name:e.variableNames[f],shapeInfo:p}}),o=r.map(d=>d.shapeInfo),i={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},a=J7(r,i,e),l=N7(n.gl,a),u=n.createProgram(l);return ie().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:o,outShapeInfo:i,variablesLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:(n.buildVao(u),Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:o,outShapeInfo:i},QR(n,e,u)))}function QR(n,e,t){const s=[],r=[];let o,i,a,l=null,u=null;u=n.getUniformLocation(t,"NAN",!1),ie().getNumber("WEBGL_VERSION")===1&&(l=n.getUniformLocation(t,"INFINITY",!1));const d=!1;for(const f of e.variableNames){const p={name:f,uniform:n.getUniformLocation(t,f,d),offset:n.getUniformLocation(t,`offset${f}`,d)};e.enableShapeUniforms&&(p.shape=n.getUniformLocation(t,`${f}Shape`,d),p.texShape=n.getUniformLocation(t,`${f}TexShape`,d)),s.push(p)}if(e.enableShapeUniforms&&(o=n.getUniformLocation(t,"outShape",d),a=n.getUniformLocation(t,"outShapeStrides",d),i=n.getUniformLocation(t,"outTexShape",d)),e.customUniforms)for(const f of e.customUniforms)r.push(n.getUniformLocation(t,f.name,d));return{variablesLocations:s,customUniformLocations:r,infLoc:l,nanLoc:u,outShapeLocation:o,outShapeStridesLocation:a,outTexShapeLocation:i}}function HS(n,e){if(n.length!==e.length)throw Error(`Binary was compiled with ${n.length} inputs, but was executed with ${e.length} inputs`);n.forEach((t,s)=>{const r=t.logicalShape,o=e[s],i=o.shape;if(!mt(r,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${r} and ${i} must match`);if(t.isUniform&&o.isUniform)return;const a=t.texShape,l=o.isUniform?null:o.texData.texShape;if(!mt(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function z9(n,e,t,s,r){e.program.enableShapeUniforms||(HS(e.inShapeInfos,t),HS([e.outShapeInfo],[s]));const o=s.texData.texture,i=s.texData.texShape;s.texData.isPacked?n.setOutputPackedMatrixTexture(o.texture,i[0],i[1]):n.setOutputMatrixTexture(o.texture,i[0],i[1]),n.setProgram(e.webGLProgram),n.bindVertexArray(e.webGLProgram.vao),ie().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&n.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&n.gl.uniform1f(e.nanLoc,NaN);for(let l=0;l<t.length;++l){const u=t[l],{uniform:d,offset:f,shape:p,texShape:g}=e.variablesLocations[l];if(p){const{uniformShape:x}=nv(e.program.packedInputs,u.shape,u.texData.texShape);switch(x.length){case 1:n.gl.uniform1iv(p,new Int32Array(x));break;case 2:n.gl.uniform2iv(p,new Int32Array(x));break;case 3:n.gl.uniform3iv(p,new Int32Array(x));break;case 4:n.gl.uniform4iv(p,new Int32Array(x));break}}if(g&&n.gl.uniform2i(g,u.texData.texShape[0],u.texData.texShape[1]),d!=null){if(u.isUniform){if(ce(u.shape)<2)n.gl.uniform1f(d,u.uniformValues[0]);else{let x=u.uniformValues;x instanceof Float32Array||(x=new Float32Array(x)),n.gl.uniform1fv(d,x)}continue}u.texData.slice!=null&&f!=null&&n.gl.uniform1i(f,u.texData.slice.flatOffset),n.setInputMatrixTexture(u.texData.texture.texture,d,l)}}const a=e.outShapeLocation;if(a)switch(s.shape.length){case 1:n.gl.uniform1iv(a,new Int32Array(s.shape));break;case 2:n.gl.uniform2iv(a,new Int32Array(s.shape));break;case 3:n.gl.uniform3iv(a,new Int32Array(s.shape));break;case 4:n.gl.uniform4iv(a,new Int32Array(s.shape));break}if(e.outShapeStridesLocation){const l=ze(s.shape);switch(s.shape.length){case 2:n.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:n.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:n.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break}}if(e.outTexShapeLocation&&n.gl.uniform2i(e.outTexShapeLocation,s.texData.texShape[0],s.texData.texShape[1]),e.program.customUniforms&&r)for(let l=0;l<e.program.customUniforms.length;++l){const u=e.program.customUniforms[l],d=e.customUniformLocations[l],f=r[l];if(u.type==="float")n.gl.uniform1fv(d,f);else if(u.type==="vec2")n.gl.uniform2fv(d,f);else if(u.type==="vec3")n.gl.uniform3fv(d,f);else if(u.type==="vec4")n.gl.uniform4fv(d,f);else if(u.type==="int")n.gl.uniform1iv(d,f);else if(u.type==="ivec2")n.gl.uniform2iv(d,f);else if(u.type==="ivec3")n.gl.uniform3iv(d,f);else if(u.type==="ivec4")n.gl.uniform4iv(d,f);else throw Error(`uniform type ${u.type} is not supported yet.`)}n.executeProgram()}function M9(n,e,t){let s="";e.concat(t).forEach(i=>{const a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(n.enableShapeUniforms&&!i.isUniform){const l=i.texData.texShape,{useSqueezeShape:u,uniformShape:d,keptDims:f}=nv(n.packedInputs,i.shape,l);let p="",g="",x="";if(d.length===1&&n.packedInputs){const T=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];p=`${T[0]>1}_${T[1]>1}`}else if(d.length===2&&!n.packedInputs)g=`${d[0]>1}_${d[1]>1}`;else if(d.length>2&&!n.packedInputs){const T=ze(d);x=`${T[0]===l[1]}_${T[T.length-1]===l[1]}`}const w=i.shape.length,v=d.length===2&&mt(i.shape,l),b=ce(i.shape)===1,C=xl(i.shape,t.shape),$=!n.packedInputs&&w===t.shape.length&&mt(l,t.texData.texShape),S=n.packedInputs||d.length>2?"":`${l[0]>1}_${l[1]>1}`;s+=`${w}_${$}_${u?f:""}_${d.length}_${b}_${C}_${v}_${p}_${g}_${x}_${S}_${a}`}else{const l=i.isUniform?"uniform":i.texData.texShape;s+=`${i.shape}_${l}_${a}`}});const r=n.userCode;let o=n.constructor.name;return o+="_"+s+"_"+r+`${ie().getNumber("WEBGL_VERSION")}`,o}function Pn(n){return ie().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&n<=4}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class P9{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=su.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Yn();this.outputShape=e,this.enableShapeUniforms=Pn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?zm(["r","c","d"],e):xa(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class L9{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=su.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];const t=Yn();this.outputShape=e,this.enableShapeUniforms=Pn(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?zm(["r","c","d"],e):xa(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class B9{constructor(e){this.variableNames=["A"],this.outTexUsage=Ns.DOWNLOAD;const t=Yn();this.outputShape=e,this.userCode=`
      ${XR}

      void main() {
        float x = getAAtOutCoords();
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class V9{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ns.DOWNLOAD;const t=Yn();this.outputShape=e,this.userCode=`
      ${XR}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${t.output} = encode_float(x);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const W9={R:0,G:1,B:2,A:3};class jS{constructor(e,t=!1,s="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];const r=Yn();this.outputShape=e,this.enableShapeUniforms=Pn(this.outputShape.length);let o="result";t&&(o="floor(result * 255. + 0.5)");let i="";for(let a=0;a<s.length;a++){const l=s[a];i+=`
          if(offset == ${a}) {
            result = values[${W9[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?tv():ev(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${s.length});

        flatIndex = idiv(flatIndex, ${s.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${r.texture2D}(A, uv);
          ${i}
        }
        ${r.output} = vec4(${o}, 0., 0., 0.);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class U9{constructor(e,t=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];const s=Yn();this.outputShape=e,this.enableShapeUniforms=Pn(this.outputShape.length);let r="",o="result";t&&(o="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){const l=i*2+a;r+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${s.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?tv():ev(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${r}

          ${s.output} = ${o};
        }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function G9(n){const e=Yn(),t=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return T7(n,t)}function H9(n){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return D7(n,e)}function j9(n){const e=new Uint16Array([0,1,2,2,1,3]);return _7(n,e)}function Th(n,e,t,s,r,o){O7(e,t);const i=F7(n),a=n.TEXTURE_2D;return Se(n,()=>n.bindTexture(a,i)),Se(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE)),Se(n,()=>n.texParameteri(a,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE)),Se(n,()=>n.texParameteri(a,n.TEXTURE_MIN_FILTER,n.NEAREST)),Se(n,()=>n.texParameteri(a,n.TEXTURE_MAG_FILTER,n.NEAREST)),ie().getNumber("WEBGL_VERSION")===1?Se(n,()=>n.texImage2D(a,0,s,e,t,0,r,o,null)):Se(n,()=>n.texStorage2D(a,1,s,e,t)),Se(n,()=>n.bindTexture(n.TEXTURE_2D,null)),{texture:i,texShape:[t,e]}}function ZR(n){return n.internalFormatFloat}function X9(n,e,t,s){const[r,o]=Ih(e,t);return Th(n,r,o,ZR(s),s.textureFormatFloat,n.FLOAT)}function JR(n){return n.internalFormatHalfFloat}function K9(n,e,t,s){const[r,o]=Ih(e,t);return Th(n,r,o,JR(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function eA(n){return n.downloadTextureFormat}function q9(n,e,t,s){const[r,o]=Ih(e,t);return Th(n,r,o,eA(s),n.RGBA,n.UNSIGNED_BYTE)}function tA(n){return n.internalFormatPackedFloat}function Y9(n,e,t,s){const[r,o]=Ol(e,t);return Th(n,r,o,tA(s),n.RGBA,n.FLOAT)}function nA(n){return n.internalFormatPackedHalfFloat}function Q9(n,e,t,s){const[r,o]=Ol(e,t);return Th(n,r,o,nA(s),n.RGBA,s.textureTypeHalfFloat)}function Z9(n,e,t){return Se(n,()=>n.bindBuffer(n.ARRAY_BUFFER,t)),WS(n,e,"clipSpacePos",t,3,20,0)&&WS(n,e,"uv",t,2,20,12)}function J9(n,e,t,s,r,o){Se(n,()=>n.bindTexture(n.TEXTURE_2D,e));let i,a,l;r instanceof Uint8Array?(i=new Uint8Array(t*s*4),a=n.UNSIGNED_BYTE,l=n.RGBA):(i=new Float32Array(t*s*4),a=n.FLOAT,l=o.internalFormatPackedFloat),i.set(r),ie().getNumber("WEBGL_VERSION")===2?Se(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t,s,n.RGBA,a,i)):Se(n,()=>n.texImage2D(n.TEXTURE_2D,0,l,t,s,0,n.RGBA,a,i)),Se(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function eY(n,e,t){Se(n,()=>n.bindTexture(n.TEXTURE_2D,e)),t.data instanceof Uint8Array?ie().getNumber("WEBGL_VERSION")===2?Se(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,t.width,t.height,n.RGBA,n.UNSIGNED_BYTE,t.data)):Se(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,t.width,t.height,0,n.RGBA,n.UNSIGNED_BYTE,t.data)):ie().getNumber("WEBGL_VERSION")===2?Se(n,()=>n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,t)):Se(n,()=>n.texImage2D(n.TEXTURE_2D,0,n.RGBA,n.RGBA,n.UNSIGNED_BYTE,t)),Se(n,()=>n.bindTexture(n.TEXTURE_2D,null))}function tY(n,e,t,s){const r=n.createBuffer();Se(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,r));const a=4*4*e*t;return Se(n,()=>n.bufferData(n.PIXEL_PACK_BUFFER,a,n.STREAM_READ)),Se(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,0)),Se(n,()=>n.bindBuffer(n.PIXEL_PACK_BUFFER,null)),r}function nY(n,e,t){const s=n,r=new Float32Array(t);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,r),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),r}function sY(n,e,t,s){const[r,o]=Ih(e,t),i=4,a=new Uint8Array(v7(e*t,i));return Se(n,()=>n.readPixels(0,0,r,o,s.downloadTextureFormat,n.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function rY(n,e,t,s,r,o,i,a){const l=n,u=new Float32Array(b7(o,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function oY(n,e,t){const s=new Float32Array(e*t*4);return Se(n,()=>n.readPixels(0,0,t,e,n.RGBA,n.FLOAT,s)),s}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ax{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];const t=ie().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,x7(t,e)):this.gl=Cr(t),e=this.gl,ie().getNumber("WEBGL_VERSION")===2){const o=e;this.createVertexArray=()=>Se(o,()=>o.createVertexArray()),this.bindVertexArray=i=>Se(o,()=>o.bindVertexArray(i)),this.deleteVertexArray=i=>Se(o,()=>o.deleteVertexArray(i)),this.getVertexArray=()=>Se(o,()=>o.getParameter(o.VERTEX_ARRAY_BINDING))}else if(e!=null){const o=e.getExtension("OES_vertex_array_object");if(o==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Se(e,()=>o.createVertexArrayOES()),this.bindVertexArray=i=>Se(e,()=>o.bindVertexArrayOES(i)),this.deleteVertexArray=i=>Se(e,()=>o.deleteVertexArrayOES(i)),this.getVertexArray=()=>Se(e,()=>e.getParameter(o.VERTEX_ARRAY_BINDING_OES))}let s="WEBGL_color_buffer_float";const r="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),ie().getNumber("WEBGL_VERSION")===1){const o="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=Kd(this.gl,o),Xs(this.gl,i))this.textureHalfFloatExtension=Kd(this.gl,i);else if(ie().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(s),Xs(this.gl,r))this.colorBufferHalfFloatExtension=Kd(this.gl,r);else if(ie().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(s="EXT_color_buffer_float",Xs(this.gl,s))this.colorBufferFloatExtension=this.gl.getExtension(s);else if(Xs(this.gl,r))this.colorBufferHalfFloatExtension=this.gl.getExtension(r);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=H9(this.gl),this.indexBuffer=j9(this.gl),this.framebuffer=z7(this.gl),this.textureConfig=Jw(this.gl,this.textureHalfFloatExtension)}get debug(){return ie().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const e=this.gl;Se(e,()=>e.finish()),Se(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Se(e,()=>e.deleteFramebuffer(this.framebuffer)),Se(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Se(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Se(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,t){return this.throwIfDisposed(),X9(this.gl,e,t,this.textureConfig)}createFloat16MatrixTexture(e,t){return this.throwIfDisposed(),K9(this.gl,e,t,this.textureConfig)}createUnsignedBytesMatrixTexture(e,t){return this.throwIfDisposed(),q9(this.gl,e,t,this.textureConfig)}uploadPixelDataToTexture(e,t){this.throwIfDisposed(),eY(this.gl,e,t)}uploadDenseMatrixToTexture(e,t,s,r){this.throwIfDisposed(),J9(this.gl,e,t,s,r,this.textureConfig)}createFloat16PackedMatrixTexture(e,t){return this.throwIfDisposed(),Q9(this.gl,e,t,this.textureConfig)}createPackedMatrixTexture(e,t){return this.throwIfDisposed(),Y9(this.gl,e,t,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(US(this.gl,this.framebuffer),this.outputTexture=null),Se(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,t,s){return this.downloadMatrixDriver(e,()=>sY(this.gl,t,s,this.textureConfig))}downloadPackedMatrixFromBuffer(e,t,s,r,o,i){return rY(this.gl,e,t,s,r,o,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,t){return nY(this.gl,e,t)}createBufferFromTexture(e,t,s){this.bindTextureToFrameBuffer(e);const r=tY(this.gl,t,s,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}createAndWaitForFence(){const e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let t,s;if(ie().getBool("WEBGL_FENCE_API_ENABLED")){const r=e,o=r.fenceSync(r.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),s=()=>{const i=r.clientWaitSync(o,0,0);return i===r.ALREADY_SIGNALED||i===r.CONDITION_SATISFIED},t=o}else ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),s=()=>this.isQueryAvailable(t,ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):s=()=>!0;return{query:t,isFencePassed:s}}downloadMatrixFromPackedTexture(e,t,s){return this.downloadMatrixDriver(e,()=>oY(this.gl,t,s))}createProgram(e){this.throwIfDisposed();const t=this.gl;this.vertexShader==null&&(this.vertexShader=G9(t));const s=R7(t);Se(t,()=>t.attachShader(s,this.vertexShader)),Se(t,()=>t.attachShader(s,e)),A7(t,s);const r=Object.assign(s,{vao:this.createVertexArray()});return this.debug&&sx(t,r),r}buildVao(e){this.setProgram(e),this.bindVertexArray(e.vao);const t=this.gl;Se(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),Z9(t,e,this.vertexBuffer)}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Se(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&this.debug&&sx(this.gl,this.program),Se(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,t,s=!0){return this.throwIfDisposed(),s?P7(this.gl,e,t):L7(this.gl,e,t)}getAttributeLocation(e,t){return this.throwIfDisposed(),Se(this.gl,()=>this.gl.getAttribLocation(e,t))}getUniformLocationNoThrow(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}setInputMatrixTexture(e,t,s){this.throwIfDisposed(),this.throwIfNoProgram(),B7(this.gl,e,t,s)}setOutputMatrixTexture(e,t,s){this.setOutputMatrixTextureDriver(e,s,t)}setOutputPackedMatrixTexture(e,t,s){this.throwIfDisposed();const[r,o]=Ol(t,s);this.setOutputMatrixTextureDriver(e,r,o)}setOutputMatrixWriteRegion(e,t,s,r){this.setOutputMatrixWriteRegionDriver(s,e,r,t)}setOutputPackedMatrixWriteRegion(e,t,s,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&sx(this.gl,this.program),qd(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const e=this.gl;if(this.debug){const t=this.getVertexArray();console.assert(t===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Se(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Se(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=Kd(this.gl,ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.createQuery();return s.beginQuery(r.TIME_ELAPSED_EXT,o),o}const e=this.getQueryTimerExtensionWebGL1(),t=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,t),t}endQuery(){if(ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){const t=this.gl,s=this.getQueryTimerExtensionWebGL2();t.endQuery(s.TIME_ELAPSED_EXT);return}const e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await $k(()=>this.disposed||this.isQueryAvailable(e,ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,t){if(t===0)return null;if(t===2){const s=this.gl;return s.getQueryParameter(e,s.QUERY_RESULT)/1e6}else{const s=this.getQueryTimerExtensionWebGL1();return s.getQueryObjectEXT(e,s.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,t){if(t===0)return!0;if(t===2){const s=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=s.getQueryParameter(e,s.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}else{const s=this.getQueryTimerExtensionWebGL1(),r=s.getQueryObjectEXT(e,s.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(s.GPU_DISJOINT_EXT)),r&&!this.disjoint}}pollFence(e){return new Promise(t=>{this.addItemToPoll(()=>e.isFencePassed(),()=>t())})}pollItems(){const e=iY(this.itemsToPoll.map(t=>t.isDoneFn));for(let t=0;t<=e;++t){const{resolveFn:s}=this.itemsToPoll[t];s()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,t){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1)return;let s;"setTimeoutCustom"in ie().platform&&(s=ie().platform.setTimeoutCustom.bind(ie().platform)),$k(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,s)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),rx(this.gl,e,this.framebuffer),this.debug&&qd(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(rx(this.gl,this.outputTexture,this.framebuffer),this.debug&&qd(this.gl)):US(this.gl,this.framebuffer)}downloadMatrixDriver(e,t){this.bindTextureToFrameBuffer(e);const s=t();return this.unbindTextureToFrameBuffer(),s}setOutputMatrixTextureDriver(e,t,s){this.throwIfDisposed();const r=this.gl;rx(r,e,this.framebuffer),this.debug&&qd(r),this.outputTexture=e,Se(r,()=>r.viewport(0,0,t,s)),Se(r,()=>r.scissor(0,0,t,s))}setOutputMatrixWriteRegionDriver(e,t,s,r){this.throwIfDisposed(),Se(this.gl,()=>this.gl.scissor(e,t,s,r))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}}function iY(n){let e=0;for(;e<n.length&&n[e]();++e);return e-1}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const{addImpl:aY,bincountImpl:sA,bincountReduceImpl:lY,bitwiseAndImpl:cY,castImpl:uY,ceilImpl:hY,concatImpl:dY,equalImpl:fY,expImpl:pY,expm1Impl:mY,floorImpl:gY,gatherNdImpl:xY,gatherV2Impl:yY,greaterImpl:wY,greaterEqualImpl:vY,lessImpl:bY,lessEqualImpl:CY,linSpaceImpl:kY,logImpl:SY,maxImpl:IY,maximumImpl:$Y,minimumImpl:TY,multiplyImpl:NY,negImpl:EY,notEqualImpl:RY,prodImpl:AY,raggedGatherImpl:DY,raggedRangeImpl:_Y,raggedTensorToTensorImpl:FY,rangeImpl:OY,rsqrtImpl:zY,scatterImpl:MY,sigmoidImpl:PY,simpleAbsImpl:rA,sliceImpl:LY,sparseFillEmptyRowsImpl:BY,sparseReshapeImpl:VY,sparseSegmentReductionImpl:oA,sqrtImpl:WY,staticRegexReplaceImpl:UY,stridedSliceImpl:GY,stringNGramsImpl:HY,stringSplitImpl:jY,stringToHashBucketFastImpl:XY,subImpl:KY,tileImpl:qY,topKImpl:YY,transposeImpl:sv,uniqueImpl:QY}=ej;/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iA(n,e){return["x","y","z","w","u","v"].slice(0,e).map(t=>`${n}.${t}`)}function Hn(n,e){return e===1?[n]:iA(n,e)}function ZY(n,e){if(n===1)return"rc";let t="";for(let s=0;s<n;s++)t+=e[s],s<n-1&&(t+=",");return t}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JY{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Pn(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{const t=Hn("rc",this.rank),s=Ct(this.rank),r=this.getOutOfBoundsCondition(t),o=this.getSetup(t),i=this.getOutput(t);this.userCode=`
        void main() {
          ${s} rc = getOutputCoords();

          if(${r}) {
            setOutput(vec4(0));
          } else {
            ${o}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){const t=[];for(let s=0;s<=1;s++)for(let r=0;r<=1;r++){let o=`${s===0?"r":"rp1"}, ${r===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)o=`${e[e.length-1-i]},`+o;t.push(o)}return t}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let t="";for(let s=this.rank-2;s<this.rank;s++)t+=`${e[s]} >= ${this.enableShapeUniforms?`outShape[${s}]`:this.outputShape[s]}`,s<this.rank-1&&(t+="||");return t}getSetup(e){if(this.rank===1)return"";const t=e.slice(-2),s=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],r=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${t[0]};
      int c = ${t[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${s};
      bool rEdge = rp1 >= ${r};
    `}getOutput(e){const t=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${t[0]}),
            cEdge ? 0. : getA(${t[1]}),
            rEdge ? 0. : getA(${t[2]}),
            rEdge || cEdge ? 0. : getA(${t[3]})`}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aA{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Pn(this.outputShape.length);let s="";for(let r=0;r<4;r++){let o="thisRC = rc;";r%2===1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),s+=`
        ${o}
        ${r>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${r}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${r>0?"}":""}
      `}this.userCode=`
      ${eQ(t,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?tv():ev(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${s}

        setOutput(result);
      }
    `}}function eQ(n,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?Z7(["r","c","d"],"inputShape"):xa(["r","c","d"],n)}
      return ivec3(r, c, d);
    }
  `}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class tQ{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.usedTextures={},this.logEnabled=!1}acquireTexture(e,t,s){const r=KS(t,s),o=qS(e,r,s);o in this.freeTextures||(this.freeTextures[o]=[]),o in this.usedTextures||(this.usedTextures[o]=[]);const i=XS(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,s);if(this.freeTextures[o].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();const l=this.freeTextures[o].pop();return this.usedTextures[o].push(l),l}let a;return r===$n.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===$n.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===$n.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===$n.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===$n.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[o].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,t,s,r){if(this.freeTextures==null)return;const o=KS(s,r),i=qS(t,o,r);i in this.freeTextures||(this.freeTextures[i]=[]);const a=XS(t,o,this.gpgpu.gl,this.gpgpu.textureConfig,r),l=ie().getNumber("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;const u=this.usedTextures[i],d=u&&u.indexOf(e);if(d==null||d<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u[d]=u[u.length-1],u.pop(),this.log()}log(){if(!this.logEnabled)return;const e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);const t=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*t)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(const e in this.freeTextures)this.freeTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});for(const e in this.usedTextures)this.usedTextures[e].forEach(t=>{this.gpgpu.deleteMatrixTexture(t.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function nQ(n,e){const t=n;if(e===t.R32F)return 4;if(e===t.R16F)return 2;if(e===t.RGBA32F)return 16;if(e===n.RGBA)return 16;if(e===t.RGBA16F)return 8;if(e===t.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function XS(n,e,t,s,r){const o=sQ(e,s);let i;if(r){const[l,u]=Ol(n[0],n[1]);i=l*u}else{const[l,u]=Ih(n[0],n[1]);i=l*u}const a=nQ(t,o);return i*a}function sQ(n,e){switch(n){case $n.PACKED_2X2_FLOAT32:return tA(e);case $n.PACKED_2X2_FLOAT16:return nA(e);case $n.UNPACKED_FLOAT32:return ZR(e);case $n.UNPACKED_FLOAT16:return JR(e);case $n.PACKED_4X1_UNSIGNED_BYTE:return eA(e);default:throw new Error(`Unknown physical texture type ${n}`)}}function rQ(n){return ie().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?n?$n.PACKED_2X2_FLOAT32:$n.UNPACKED_FLOAT32:n?$n.PACKED_2X2_FLOAT16:$n.UNPACKED_FLOAT16}function KS(n,e){if(n===Ns.UPLOAD)return $n.PACKED_2X2_FLOAT32;if(n===Ns.RENDER||n==null)return rQ(e);if(n===Ns.DOWNLOAD||n===Ns.PIXELS)return $n.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${n}`)}function qS(n,e,t){return`${n[0]}_${n[1]}_${e}_${t}`}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class zr{constructor(e,t){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Pn(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${t}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}}const tr="if (isnan(x)) return x;",oQ="return x;",YS="return abs(x);",iQ="return (x >= 0.0) ? x : (exp(x) - 1.0);",aQ=tr+`
  return (x < 0.0) ? 0.0 : x;
`,lQ=tr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Wo="return x;",cQ="return 1.0 / (1.0 + exp(-1.0 * x));";/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uQ="return x;",hQ=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,dQ=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,fQ=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,pQ="return 1.0 / (1.0 + exp(-1.0 * x));";class Ho{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Pn(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${t}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mQ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Pn(this.outputShape.length);const t=e.length,s=Hn("rc",t),r=Ct(t),o=ZY(t,s),i=s.slice(-2),a=t<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${r} rc = getOutputCoords();
        vec4 packedInput = getA(${o});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gQ=E$,xQ=1e-7,yQ=1e-4,Zd={};function wQ(n){return n in Zd||(Zd[n]={}),Zd[n]}const vQ=ie().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),bQ=600;function CQ(){return ie().global.screen==null?1024:ie().global.screen.height*ie().global.screen.width*window.devicePixelRatio*bQ/1024/1024}class Mm extends ky{nextDataId(){return Mm.nextDataId++}constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!ie().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let t;if(e!=null){if(e instanceof ax)t=e;else{const s=Cr(ie().getNumber("WEBGL_VERSION"),e);t=new ax(s)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{const s=Cr(ie().getNumber("WEBGL_VERSION"));t=new ax(s),this.binaryCache=wQ(ie().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=t,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new tQ(this.gpgpu),this.numMBBeforeWarning=CQ(),this.texData=new nI(this,Rr())}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,t,s,r,o,i){const a=this.makeTensorInfo(t,s),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[r,o]},l.texShape=[r,o];const u=Yd(t),d=new jS(u,!1,i),f=this.runWebGLProgram(d,[a],s,[[r,o]]);return f.shape=t,l.texture=null,this.disposeIntermediateTensorInfo(a),f.dataId}write(e,t,s){if((ie().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ie().getBool("DEBUG"))&&this.checkNumericalProblems(e),s==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:s,values:e,usage:Ns.UPLOAD,refCount:1}),r}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){const t=this.texData.get(e);t.refCount++}decRef(e){if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--}}move(e,t,s,r,o){if(ie().getBool("DEBUG")&&this.checkNumericalProblems(t),r==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:s,dtype:r,values:t,usage:Ns.UPLOAD,refCount:o})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){const t=this.texData.get(e),{values:s,dtype:r,complexTensorInfos:o,slice:i,shape:a,isPacked:l}=t;if(i!=null){let p;l?p=new Ho(a,Wo):p=new zr(a,Wo);const g=this.runWebGLProgram(p,[{dataId:e,shape:a,dtype:r}],r),x=this.readSync(g.dataId);return this.disposeIntermediateTensorInfo(g),x}if(s!=null)return this.convertAndCacheOnCPU(e);if(r==="string")return s;const u=this.activeTimers!=null;let d;u&&(d=Jn());let f;if(r==="complex64"){const p=this.readSync(o.real.dataId),g=this.readSync(o.imag.dataId);f=mo(p,g)}else f=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=Jn()-d),this.convertAndCacheOnCPU(e,f)}async read(e){if(this.pendingRead.has(e)){const x=this.pendingRead.get(e);return new Promise(w=>x.push(w))}const t=this.texData.get(e),{values:s,shape:r,slice:o,dtype:i,complexTensorInfos:a,isPacked:l}=t;if(o!=null){let x;l?x=new Ho(r,Wo):x=new zr(r,Wo);const w=this.runWebGLProgram(x,[{dataId:e,shape:r,dtype:i}],i),v=this.read(w.dataId);return this.disposeIntermediateTensorInfo(w),v}if(s!=null)return this.convertAndCacheOnCPU(e);if(ie().getBool("DEBUG")&&!ie().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&ie().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,d;if(i!=="complex64"&&ie().get("WEBGL_BUFFER_SUPPORTED")){d=this.decode(e);const x=this.texData.get(d.dataId);u=this.gpgpu.createBufferFromTexture(x.texture.texture,...Xd(r))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let f;if(i==="complex64"){const x=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),w=x[0],v=x[1];f=mo(w,v)}else if(u==null)f=this.getValuesFromTexture(e);else{const x=ce(r);f=this.gpgpu.downloadFloat32MatrixFromBuffer(u,x)}if(d!=null&&this.disposeIntermediateTensorInfo(d),u!=null){const x=this.gpgpu.gl;Se(x,()=>x.deleteBuffer(u))}const p=this.convertAndCacheOnCPU(e,f),g=this.pendingRead.get(e);return this.pendingRead.delete(e),g.forEach(x=>x(p)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&Rr().removeDataId(e,this),this.pendingDeletes--),p}readToGPU(e,t={}){const s=this.texData.get(e),{values:r,shape:o,slice:i,dtype:a,isPacked:l,texture:u}=s;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let g;l?g=new Ho(o,Wo):g=new zr(o,Wo);const x=this.runWebGLProgram(g,[{dataId:e,shape:o,dtype:a}],a),w=this.readToGPU(x,t);return this.disposeIntermediateTensorInfo(x),w}if(u==null)throw r!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");const d=this.decode(e,t.customTexShape),f=Rr().makeTensorFromTensorInfo(d),p=this.texData.get(d.dataId);return Object.assign({tensorRef:f},p.texture)}bufferSync(e){const t=this.readSync(e.dataId);if(e.dtype==="string")try{const s=t.map(r=>Qo(r));return Ze(e.shape,e.dtype,s)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ze(e.shape,e.dtype,t)}checkNumericalProblems(e){if(e!=null)for(let t=0;t<e.length;t++){const s=e[t];if(!I7(s))throw ie().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${s} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${s} cannot be represented on this device.`)}}getValuesFromTexture(e){const{shape:t,dtype:s,isPacked:r}=this.texData.get(e),o=ce(t);if(ie().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const p=this.decode(e),g=this.texData.get(p.dataId),x=this.gpgpu.downloadMatrixFromPackedTexture(g.texture.texture,...Xd(t)).subarray(0,o);return this.disposeIntermediateTensorInfo(p),x}const i=ie().getBool("WEBGL_PACK")&&r===!0,a=i?Yd(t):t,l=i?new V9(a):new B9(a),u=this.runWebGLProgram(l,[{shape:a,dtype:s,dataId:e}],"float32"),d=this.texData.get(u.dataId),f=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(d.texture.texture,d.texShape[0],d.texShape[1]).subarray(0,o);return this.disposeIntermediateTensorInfo(u),f}timerAvailable(){return ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){const t=this.activeTimers,s=[];let r=!1;this.programTimersStack==null?(this.programTimersStack=s,r=!0):this.activeTimers.push(s),this.activeTimers=s,e();const o=Yi(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),i=Yi(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=t,r&&(this.programTimersStack=null);const a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const l=await Promise.all(o);a.kernelMs=V3(l),a.getExtraProfileInfo=()=>l.map((u,d)=>({name:i[d],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Jn(),endMs:null}}endTimer(e){return ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Jn(),e)}async getQueryTime(e){if(ie().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);const t=e;return t.endMs-t.startMs}disposeData(e,t=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);const{complexTensorInfos:s}=this.texData.get(e);return s!=null&&(this.disposeData(s.real.dataId,t),this.disposeData(s.imag.dataId,t)),this.texData.delete(e),!0}releaseGPUData(e){const{texture:t,dtype:s,texShape:r,usage:o,isPacked:i,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),t!=null&&(this.numBytesInGPU-=this.computeBytes(r,s),this.textureManager.releaseTexture(t,r,o,i)));const d=this.texData.get(e);d.texture=null,d.texShape=null,d.isPacked=!1,d.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,t=vQ){return ie().getBool("WEBGL_CPU_FORWARD")&&e.every(s=>this.texData.get(s.dataId).texture==null&&ce(s.shape)<t)}getGPGPUContext(){return this.gpgpu}where(e){Ts("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const t=e.dataSync();return gQ(e.shape,t)}packedUnaryOp(e,t,s){const r=new Ho(e.shape,t),o=this.compileAndRun(r,[e],s);return Rr().makeTensorFromTensorInfo(o)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){const r=rA(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,r)}if(ie().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,YS,e.dtype);const t=new zr(e.shape,YS),s=this.compileAndRun(t,[e]);return Rr().makeTensorFromTensorInfo(s)}makeTensorInfo(e,t,s){let r;if(t==="string"&&s!=null&&s.length>0&&uu(s[0])){const o=s.map(i=>Ko(i));r=this.write(o,e,t)}else r=this.write(s,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}makeOutput(e,t,s){return Rr().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,s),this)}unpackTensor(e){const t=new mQ(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}packTensor(e){const t=new JY(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}packedReshape(e,t){const s=[kl(e.shape),...Sl(e.shape)],r={dtype:e.dtype,shape:s,dataId:e.dataId},o=[kl(t),...Sl(t)],i=new aA(o,s),a=!0,l=[s],u=this.runWebGLProgram(i,[r],e.dtype,l,a);return{dataId:u.dataId,shape:t,dtype:u.dtype}}decode(e,t){const s=this.texData.get(e),{isPacked:r,shape:o,dtype:i}=s;if(t!=null){const p=ce(o),g=t[0]*t[1]*4;O(p<=g,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}const a=Yd(o);let l;r?l=new L9(a):l=new P9(a);const u=!0,d=[t??Xd(a)],f=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],i,d,u,t);return{dtype:i,shape:o,dataId:f.dataId}}runWebGLProgram(e,t,s,r,o=!1,i){const a=this.makeTensorInfo(e.outputShape,s),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===su.DENSE){const b=i??Xd(e.outputShape);l.texShape=b.map(C=>C*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),ce(a.shape)===0)return l.values=_n(a.dtype,0),a;const u=[],d=t.map(b=>{if(b.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let C=this.texData.get(b.dataId);if(C.texture==null){if(!e.packedInputs&&ce(b.shape)<=ie().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:b.shape,texData:null,isUniform:!0,uniformValues:C.values};e.packedInputs&&(C.isPacked=!0,C.shape=b.shape)}if(this.uploadToGPU(b.dataId),!!C.isPacked!=!!e.packedInputs)b=C.isPacked?this.unpackTensor(b):this.packTensor(b),u.push(b),C=this.texData.get(b.dataId);else if(C.isPacked&&!ep(C.shape,b.shape)){const $=b,S=b.shape;b.shape=C.shape,b=this.packedReshape(b,S),u.push(b),C=this.texData.get(b.dataId),$.shape=S}return{shape:b.shape,texData:C,isUniform:!1}});this.uploadToGPU(a.dataId);const f={shape:a.shape,texData:l,isUniform:!1},p=M9(e,d,f),g=this.getAndSaveBinary(p,()=>O9(this.gpgpu,e,d,f)),x=this.activeTimers!=null;let w;x&&(w=this.startTimer()),ie().get("ENGINE_COMPILE_ONLY")||z9(this.gpgpu,g,d,f,r),u.forEach(b=>this.disposeIntermediateTensorInfo(b)),x&&(w=this.endTimer(w),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(w)}));const v=ie().getNumber("WEBGL_FLUSH_THRESHOLD");if(v>0){const b=Jn();b-this.lastGlFlushTime>v&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=b)}if(!ie().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&o===!1){const b=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),b}return a}compileAndRun(e,t,s,r,o=!1){return s=s||t[0].dtype,this.runWebGLProgram(e,t,s,r,o)}getAndSaveBinary(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(ie().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=se(()=>{if(!ie().get("WEBGL_RENDER_FLOAT32_ENABLED")){const e=ie().getBool("DEBUG");ie().set("DEBUG",!1);const t=this.abs(pt(1e-8)).dataSync()[0];if(ie().set("DEBUG",e),t>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?xQ:yQ}uploadToGPU(e){const t=this.texData.get(e),{shape:s,dtype:r,values:o,texture:i,usage:a,isPacked:l}=t;if(i!=null)return;const u=this.activeTimers!=null;let d;u&&(d=Jn());let f=t.texShape;if(f==null&&(f=U7(s,l),t.texShape=f),o!=null){const p=Yd(s);let g,x=f[1],w=f[0];const v=o instanceof Uint8Array||o instanceof Uint8ClampedArray;(l||!v)&&([x,w]=Ol(f[0],f[1])),l?g=new U9(p,v):g=new jS(p,v);const b=v?[w,x]:f,C=this.makeTensorInfo(b,r),$=this.texData.get(C.dataId);v?$.usage=Ns.PIXELS:$.usage=Ns.UPLOAD,$.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(C.dataId),x,w,o);const S=[[w,x]],E=this.runWebGLProgram(g,[C],r,S,!0),A=this.texData.get(E.dataId);t.texShape=A.texShape,t.isPacked=A.isPacked,t.usage=A.usage,ie().get("ENGINE_COMPILE_ONLY")?this.disposeData(E.dataId):(t.texture=A.texture,t.values=null,this.texData.delete(E.dataId)),this.disposeIntermediateTensorInfo(C),u&&(this.uploadWaitMs+=Jn()-d)}else{const p=this.acquireTexture(f,a,r,l);t.texture=p}}convertAndCacheOnCPU(e,t){const s=this.texData.get(e),{dtype:r}=s;return t!=null&&(s.values=kQ(t,r)),s.values}acquireTexture(e,t,s,r){if(this.numBytesInGPU+=this.computeBytes(e,s),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){const o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${o} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,t,r)}computeBytes(e,t){return e[0]*e[1]*Nf(t)}checkCompileCompletion(){for(const[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){const e=[];if(this.gpgpu.parallelCompilationExtension){for(const[,t]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(t));return Promise.all(e)}else{for(const[,t]of Object.entries(this.binaryCache)){const s=new Promise(r=>{try{this.checkCompletion_(t),r(!0)}catch(o){throw o}});e.push(s)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await K$(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(jR(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(const e of Object.values(this.binaryCache)){this.gpgpu.buildVao(e.webGLProgram);const{variablesLocations:t,customUniformLocations:s,infLoc:r,nanLoc:o,outShapeLocation:i,outShapeStridesLocation:a,outTexShapeLocation:l}=QR(this.gpgpu,e.program,e.webGLProgram);e.variablesLocations=t,e.customUniformLocations=s,e.infLoc=r,e.nanLoc=o,e.outShapeLocation=i,e.outShapeStridesLocation=a,e.outTexShapeLocation=l}}createTensorFromGPUData(e,t,s){e.channels=e.channels||"RGBA";const{texture:r,height:o,width:i,channels:a}=e,l=Rr().backend;if(!l.gpgpu.gl.isTexture(r))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");const u=l.writeTexture(r,t,s,o,i,a);return Rr().makeTensorFromDataId(u,t,s,l)}}Mm.nextDataId=0;function kQ(n,e){if(e==="float32"||e==="complex64")return n;if(e==="int32"||e==="bool"){const t=e==="int32"?new Int32Array(n.length):new Uint8Array(n.length);for(let s=0;s<t.length;++s)t[s]=Math.round(n[s]);return t}else throw new Error(`Unknown dtype ${e}`)}/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */GI()&&XI("webgl",()=>new Mm,2);/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rv=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;class ca{constructor(e,t,s){this.variableNames=["A","B"],this.outputShape=Ke(t,s),this.enableShapeUniforms=Pn(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wa=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;class Bl{constructor(e,t,s,r=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Ke(t,s);const o=this.outputShape.length;this.enableShapeUniforms=Pn(o);let i="";if(r)if(o===0||ce(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${Ct(o)} coords = getOutputCoords();
        `,o===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{const l=Hn("coords",o);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= outShape[${o} - 2];
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= outShape[${o} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${l[o-2]} + 1) >= ${this.outputShape[o-2]};
            bool nextColOutOfBounds =
              (${l[o-1]} + 1) >= ${this.outputShape[o-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ws(n){const{inputs:e,backend:t}=n,{x:s}=e;return t.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const SQ={kernelName:Au,backendName:"webgl",kernelFunc:ws};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pi(n){const{inputs:e,backend:t}=n,{real:s,imag:r}=e,o=t.makeTensorInfo(s.shape,"complex64"),i=t.texData.get(o.dataId),a=ws({inputs:{x:s},backend:t}),l=ws({inputs:{x:r},backend:t});return i.complexTensorInfos={real:a,imag:l},o}const IQ={kernelName:My,backendName:"webgl",kernelFunc:pi};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lA="return (a < 0.) ? b * a : a;",cA=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function $Q(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{alpha:o}=s,i=t.makeTensorInfo([],"float32",oi(o,"float32")),a=ie().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bl(cA,r.shape,i.shape):new ca(lA,r.shape,i.shape),l=t.runWebGLProgram(a,[r,i],"float32");return t.disposeIntermediateTensorInfo(i),l}const TQ={kernelName:_p,backendName:"webgl",kernelFunc:$Q};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const uA="return (a < 0.) ? b * a : a;",hA=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function NQ(n){const{inputs:e,backend:t}=n,{x:s,alpha:r}=e,o=ie().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bl(hA,s.shape,r.shape):new ca(uA,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],"float32")}const EQ={kernelName:Zp,backendName:"webgl",kernelFunc:NQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vl="if (isnan(x)) return x;";function at({opSnippet:n,packedOpSnippet:e,cpuKernelImpl:t,dtype:s}){return({inputs:r,backend:o})=>{const{x:i}=r,a=o,l=s||i.dtype;if(a.shouldExecuteOnCPU([i])&&t!=null){const f=a.texData.get(i.dataId),p=t(f.values,l);return a.makeTensorInfo(i.shape,l,p)}const u=ie().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null;let d;return u?d=new Ho(i.shape,e):d=new zr(i.shape,n),a.runWebGLProgram(d,[i],l)}}function Rn({opSnippet:n,packedOpSnippet:e,checkOutOfBounds:t=!1,supportsComplex:s=!1,cpuKernelImpl:r,dtype:o}){return({inputs:i,backend:a})=>{const{a:l,b:u}=i,d=a;if(s&&l.dtype==="complex64"){const x=d.texData.get(l.dataId),w=d.texData.get(u.dataId),[v,b]=[[x.complexTensorInfos.real,w.complexTensorInfos.real],[x.complexTensorInfos.imag,w.complexTensorInfos.imag]].map($=>{const[S,T]=$,E={dataId:S.dataId,dtype:S.dtype,shape:l.shape},A={dataId:T.dataId,dtype:T.dtype,shape:u.shape},F=new ca(n,l.shape,u.shape);return d.runWebGLProgram(F,[E,A],xs(S.dtype,T.dtype))}),C=pi({inputs:{real:v,imag:b},backend:d});return d.disposeIntermediateTensorInfo(v),d.disposeIntermediateTensorInfo(b),C}const f=o||xs(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||d.shouldExecuteOnCPU([l,u]))&&r!=null){const x=d.texData.get(l.dataId).values,w=d.texData.get(u.dataId).values,v=l.dtype==="string"?go(x):x,b=l.dtype==="string"?go(w):w,[C,$]=r(l.shape,u.shape,v,b,f),S=d.makeTensorInfo($,f),T=d.texData.get(S.dataId);return T.values=C,S}const p=ie().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null;let g;return p?g=new Bl(e,l.shape,u.shape,t):g=new ca(n,l.shape,u.shape),d.runWebGLProgram(g,[l,u],f)}}function ru(n,e=!1){if(n==="linear")return e?uQ:oQ;if(n==="relu")return e?dQ:aQ;if(n==="elu")return e?hQ:iQ;if(n==="relu6")return e?fQ:lQ;if(n==="prelu")return e?hA:uA;if(n==="leakyrelu")return e?cA:lA;if(n==="sigmoid")return e?pQ:cQ;throw new Error(`Activation ${n} has not been implemented for the WebGL backend.`)}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dA{constructor(e,t,s,r=!1,o=!1,i=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=s,this.enableShapeUniforms=Pn(this.outputShape.length);const d=r?e[1]:e[2],f=Math.ceil(d/2),p=r?"i * 2, rc.y":"rc.y, i * 2",g=o?"rc.z, i * 2":"i * 2, rc.z",x=r?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],w=o?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let v="",b="";a&&(l?v=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?v=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:v=`vec4 activation(vec4 x) {
          ${a}
        }`,b="result = activation(result);");const C=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let $="rc.x",S="rc.x";e[0]<t[0]?$=`imod(rc.x, ${e[0]})`:t[0]<e[0]&&(S=`imod(rc.x, ${t[0]})`),this.userCode=`
      ${v}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${f}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        int batchA = ${$};
        int batchB = ${S};
        for (int i = 0; i < ${f}; i++) {
          vec4 a = getMatrixA(batchA, ${p});
          vec4 b = getMatrixB(batchB, ${g});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${x[0]} * ${w[0]});
          result += (${x[1]} * ${w[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${C}

        ${b}

        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const QS={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class ZS{constructor(e,t,s){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Ke(t,s),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JS="return a * b;";function ov(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=xs(s.dtype,r.dtype);if(s.dtype==="complex64"){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),u=new ZS(QS.REAL,s.shape,r.shape),d=new ZS(QS.IMAG,s.shape,r.shape),f=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:s.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:r.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:r.shape}],p=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),x=pi({inputs:{real:p,imag:g},backend:t});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),x}if(t.shouldExecuteOnCPU([s,r])){const a=t.texData.get(s.dataId),l=t.texData.get(r.dataId),[u,d]=NY(s.shape,r.shape,a.values,l.values,o),f=t.makeTensorInfo(d,o),p=t.texData.get(f.dataId);return p.values=u,f}let i;return ie().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Bl(JS,s.shape,r.shape):i=new ca(JS,s.shape,r.shape),t.runWebGLProgram(i,[s,r],o)}const RQ={kernelName:Bu,backendName:"webgl",kernelFunc:ov};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function AQ(n,e,t){const s=[kl(n.shape),...Sl(n.shape)],r={dtype:n.dtype,shape:s,dataId:n.dataId},o=[kl(e),...Sl(e)],i=new aA(o,s),a=!0,l=[s],u=t.runWebGLProgram(i,[r],n.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ke(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{shape:o}=s,i=t,a=ce(r.shape),l=sI(o,a),u=ce(l);O(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${r.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);const d=i.texData.get(r.dataId);return d.isPacked&&!ep(r.shape,l)&&!(d.texture!==null&&ep(d.shape,l))?AQ(r,l,i):(i.incRef(r.dataId),{dataId:r.dataId,shape:l,dtype:r.dtype})}const DQ={kernelName:em,backendName:"webgl",kernelFunc:ke};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class e2{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];const a=Math.floor(s/4)*4,l=s%4;let u="sumValue += dot(values, ones);";if(t!=null){const f=1/t;u=`sumValue += dot(values * ${pl(f)?f.toPrecision(2):f}, ones);`}let d="";o%s>0&&(d=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class _Q{constructor(e,t){this.variableNames=["x"];const{windowSize:s,batchSize:r,inSize:o,outSize:i}=e;this.outputShape=[r,i];let a="0.0",l="";t==="prod"?a="1.0":t==="min"?(a="1.0 / 1e-20",l="min"):t==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="sum"?u="sumValue":t==="prod"?u="prodValue":t==="all"?u="allValue":t==="any"&&(u="anyValue");const d=Math.floor(s/4)*4,f=s%4;let p=`
      if (${t==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${t==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${t==="min"} || ${t==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,g="vec4";t==="all"?(a="1.0",p=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,g="bvec4"):t==="any"&&(a="0.0",p=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,g="bvec4");let x="";o%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${x}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${s};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===2}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${p}
        } else if (${f===3}) {
          ${g} values = ${g}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FQ(n){const e=[];for(;e.length===0||e[e.length-1].outSize!==1;){const t=e.length?e[e.length-1].outSize:n[1],s=bm(t);e.push({inSize:t,windowSize:s,outSize:Math.ceil(t/s)})}return e}function va(n,e,t,s){const r=FQ(n.shape);let o=n;for(let i=0;i<r.length;i++){const{inSize:a,windowSize:l,outSize:u}=r[i];let d,f;t==="mean"?d=i===0?new e2({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},a):new e2({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u}):d=new _Q({windowSize:l,inSize:a,batchSize:n.shape[0],outSize:u},t),f=o,o=s.runWebGLProgram(d,[o],e),f.dataId!==n.dataId&&s.disposeIntermediateTensorInfo(f)}return o}/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OQ{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[t[i]];this.outputShape=s,this.rank=s.length;const r=Ct(this.rank),o=zQ(t);this.userCode=`
    void main() {
      ${r} resRC = getOutputCoords();
      setOutput(getA(${o}));
    }
    `}}function zQ(n){const e=n.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let r=0;r<n.length;r++)s[n[r]]=t[r];return s.join()}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class MQ{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const s=new Array(e.length);for(let d=0;d<s.length;d++)s[d]=e[t[d]];if(this.outputShape=s,this.rank=s.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const r=Ct(this.rank),o=iA("rc",this.rank),i=new Array(this.rank);for(let d=0;d<t.length;d++)i[t[d]]=o[d];const a=`vec2(${i.slice(-2).join()})`,l=`++${o[this.rank-1]} < ${s[this.rank-1]}`,u=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${r} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${o[this.rank-1]};
      if(++${o[this.rank-2]} < ${s[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pm(n,e,t){const s=ie().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new MQ(n.shape,e):new OQ(n.shape,e);return t.runWebGLProgram(s,[n],n.dtype)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PQ(n,e,t,s){const r=e,o=n.shape.length,i=Je(r,n.shape);let a=i;const l=Bt(a,o),u=l!=null;let d=n;u&&(d=Pm(n,l,s),a=Kt(a.length,o)),En("sum",a,o);const[f,p]=wn(d.shape,a);let g=f;t&&(g=tn(f,i));const x=ce(p),v=ce(n.shape)/x,b=ke({inputs:{x:d},attrs:{shape:[v,x]},backend:s}),C=x1(n.dtype),$=va(b,C,"sum",s),S=ke({inputs:{x:$},attrs:{shape:g},backend:s});return s.disposeIntermediateTensorInfo(b),s.disposeIntermediateTensorInfo($),u&&s.disposeIntermediateTensorInfo(d),S}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lm(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s;return PQ(r,o,i,t)}const LQ={kernelName:im,backendName:"webgl",kernelFunc:Lm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function qn(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{perm:o}=s,i=t,a=r.shape.length,l=new Array(a);for(let d=0;d<l.length;d++)l[d]=r.shape[o[d]];let u;if(i.shouldExecuteOnCPU([r])){const f=i.texData.get(r.dataId).values,p=sv(f,r.shape,r.dtype,o,l);u=i.makeTensorInfo(l,r.dtype);const g=i.texData.get(u.dataId);g.values=p}else u=Pm(r,o,i);return u}const BQ={kernelName:rl,backendName:"webgl",kernelFunc:qn};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fA=1e3;function tp({a:n,b:e,transposeA:t,transposeB:s,backend:r,bias:o=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:l=null}){const u=n.shape.length,d=e.shape.length,f=t?n.shape[u-2]:n.shape[u-1],p=s?e.shape[d-1]:e.shape[d-2],g=t?n.shape[u-1]:n.shape[u-2],x=s?e.shape[d-2]:e.shape[d-1],w=n.shape.slice(0,-2),v=e.shape.slice(0,-2),b=ce(w),C=ce(v),S=Ke(n.shape.slice(0,-2),e.shape.slice(0,-2)).concat([g,x]);O(f===p,()=>`Error in matMul: inner shapes (${f}) and (${p}) of Tensors with shapes ${n.shape} and ${e.shape} and transposeA=${t} and transposeB=${s} must match.`);const T=t?[b,f,g]:[b,g,f],E=s?[C,x,p]:[C,p,x],A=ke({inputs:{x:n},backend:r,attrs:{shape:T}}),F=ke({inputs:{x:e},backend:r,attrs:{shape:E}}),D=[A,F],_=Math.max(b,C),N=t?A.shape[1]:A.shape[2],L=o!=null,G=i!=null,Q=l==="leakyrelu",K=l!=null?ru(l,!0):null,Z=L||G||Q||K!=null;let te;if((g===1||x===1)&&N>fA&&Z===!1){let H=A,X=F;t&&(H=qn({inputs:{x:A},backend:r,attrs:{perm:[0,2,1]}}),D.push(H)),s&&(X=qn({inputs:{x:F},backend:r,attrs:{perm:[0,2,1]}}),D.push(X));const z=x!==1,V=x===1;let oe=H;z&&(oe=ke({inputs:{x:H},backend:r,attrs:{shape:[_,N,1]}}),D.push(oe));const ue=x===1?2:1;let he=X;V&&(he=ke({inputs:{x:X},backend:r,attrs:{shape:[_,1,N]}}),D.push(he));const de=ov({inputs:{a:oe,b:he},backend:r});te=Lm({inputs:{x:de},backend:r,attrs:{axis:ue,keepDims:!0}}),D.push(de)}else{const H=xs(n.dtype,e.dtype),X=new dA(T,E,[_,g,x],t,s,L,K,G,Q),z=[A,F];if(o!=null&&z.push(o),G&&z.push(i),Q){const V=r.makeTensorInfo([],"float32",oi(a,"float32"));z.push(V),D.push(V)}te=r.runWebGLProgram(X,z,H)}const B=ke({inputs:{x:te},backend:r,attrs:{shape:S}});D.push(te);for(const H of D)r.disposeIntermediateTensorInfo(H);return B}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function VQ(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:d,leakyreluAlpha:f}=s;return tp({a:r,b:o,transposeA:l,transposeB:u,backend:t,bias:i,preluActivationWeights:a,leakyreluAlpha:f,activation:d})}const WQ={kernelName:Ef,backendName:"webgl",kernelFunc:VQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const t2="return abs(x);";function UQ(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])&&s.dtype!=="complex64"){const o=t.texData.get(s.dataId),i=rA(o.values);return t.makeTensorInfo(s.shape,s.dtype,i)}let r;return ie().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Ho(s.shape,t2):r=new zr(s.shape,t2),t.runWebGLProgram(r,[s],s.dtype)}const GQ={kernelName:fp,backendName:"webgl",kernelFunc:UQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const HQ=tr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,jQ=at({opSnippet:HQ}),XQ={kernelName:hu,backendName:"webgl",kernelFunc:jQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KQ=tr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,qQ=at({opSnippet:KQ}),YQ={kernelName:du,backendName:"webgl",kernelFunc:qQ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const n2="return a + b;",QQ=Rn({opSnippet:n2,packedOpSnippet:n2,supportsComplex:!0,cpuKernelImpl:aY}),ZQ={kernelName:El,backendName:"webgl",kernelFunc:QQ};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class JQ{constructor(e,t){this.outputShape=[],this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`float v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        float result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class eZ{constructor(e,t){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=t.map((o,i)=>`T${i}`);const s=[];this.variableNames.forEach(o=>{s.push(`vec4 v${o} = get${o}AtOutCoords();`)});const r=this.variableNames.map(o=>`v${o}`).join(" + ");this.userCode=`
      void main() {
        ${s.join(`
        `)}

        vec4 result = ${r};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yf(n){const{inputs:e,backend:t}=n,s=e;if(s.length===1)return ws({inputs:{x:s[0]},backend:t});if(s.length>ie().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const l=Math.floor(s.length/2),u=yf({inputs:s.slice(0,l),backend:t}),d=yf({inputs:s.slice(l),backend:t});return yf({inputs:[u,d],backend:t})}const r=s.map(l=>l.dtype).reduce((l,u)=>xs(l,u)),o=s.map(l=>l.shape),a=ie().getBool("WEBGL_PACK")?new eZ(s[0].shape,o):new JQ(s[0].shape,o);return t.runWebGLProgram(a,s,r)}const tZ={kernelName:Ry,backendName:"webgl",kernelFunc:yf};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=Je(o,r.shape);let u=l;const d=Bt(u,a);let f=r;d!=null&&(f=qn({inputs:{x:r},backend:t,attrs:{perm:d}}),u=Kt(u.length,a)),En("all",u,a);const[p,g]=wn(f.shape,u),x=ce(g),w=ke({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),v=va(w,w.dtype,"all",t);let b;if(i){const C=tn(p,l);b=ke({inputs:{x:v},backend:t,attrs:{shape:C}})}else b=ke({inputs:{x:v},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v),d!=null&&t.disposeIntermediateTensorInfo(f),b}const sZ={kernelName:Ay,backendName:"webgl",kernelFunc:nZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=Je(o,r.shape);let u=l;const d=Bt(u,a);let f=r;d!=null&&(f=qn({inputs:{x:r},backend:t,attrs:{perm:d}}),u=Kt(u.length,a)),En("any",u,a);const[p,g]=wn(f.shape,u),x=ce(g),w=ke({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),v=va(w,w.dtype,"any",t);let b;if(i){const C=tn(p,l);b=ke({inputs:{x:v},backend:t,attrs:{shape:C}})}else b=ke({inputs:{x:v},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v),d!=null&&t.disposeIntermediateTensorInfo(f),b}const oZ={kernelName:Dy,backendName:"webgl",kernelFunc:rZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iZ{constructor(e,t,s){this.variableNames=["A"];const{windowSize:r,batchSize:o,outSize:i}=e;s||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];const a=t==="max"?">":"<",l=s?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${r};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${r}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class aZ{constructor(e,t,s,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,O(e.length>2,()=>`Packed arg${s.charAt(0).toUpperCase()+s.slice(1)} supports only inputs with rank above 2.`);const o=e[e.length-1],i=Math.ceil(o/t);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),r||this.variableNames.push("bestIndicesA");const a=this.outputShape,l=a.length,u=Ct(l),d=Hn("coords",l);let f,p;if(i===1){p=l+1;const F=Ct(p);f=`
        ${F} sourceLocR = ${F}(${d.join()}, 0);
        ++${d[l-1]};
        ${F} sourceLocG = ${F}(${d.join()}, 0);
        ++${d[l-2]};
        ${F} sourceLocA = ${F}(${d.join()}, 0);
        --${d[l-1]};
        ${F} sourceLocB = ${F}(${d.join()}, 0);
        --${d[l-2]};`}else p=l,f=`
        ${u} sourceLocR = coords;
        ++${d[l-1]};
        ${u} sourceLocG = coords;
        ++${d[l-2]};
        ${u} sourceLocA = coords;
        --${d[l-1]};
        ${u} sourceLocB = coords;
        --${d[l-2]};`;const g=["x","y","z","w","u","v"].slice(0,p),x="."+g[p-1],w=g.map(F=>"int "+F),v=Hn("sourceLocR",p-1).concat("inIdx.r"),b=Hn("sourceLocG",p-1).concat("inIdx.g"),C=Hn("sourceLocB",p-1).concat("inIdx.b"),$=Hn("sourceLocA",p-1).concat("inIdx.a"),S=s==="max"?"greaterThan":"lessThan",T=r?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${v.join()}),
                             getBestIndicesAChannel(${b.join()}),
                             getBestIndicesAChannel(${C.join()}),
                             getBestIndicesAChannel(${$.join()})));`,E=`vec4(
            getAChannel(${v.join()}),
            hasNextCol ? getAChannel(${b.join()}) : 0.,
            hasNextRow ? getAChannel(${C.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${$.join()}) : 0.)`,A=r?"":`
      float getBestIndicesAChannel(${w.join()}) {
        return getChannel(getBestIndicesA(${g.join()}),
                                          vec2(${g.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${w.join()}) {
        return getChannel(getA(${g.join()}),
                               vec2(${g.slice(-2).join()}));
      }
      ${A}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${d[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${d[l-2]} < ${a[l-2]-1};
        ${f}
        ivec4 srcIdx = ivec4(sourceLocR${x}, sourceLocG${x},
          sourceLocB${x}, sourceLocA${x}) * ${t};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${E};

        for (int i = 0; i < ${t}; i++) {
          inIdx = srcIdx;
          ${T}
          vec4 candidate = ${E};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${S}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function pA(n,e,t,s=null){let r=e.shape[0],o=e.shape[1];s!=null&&(r=s.shape[0],o=s.shape[1]);const i=bm(o),a={windowSize:i,inSize:o,batchSize:r,outSize:Math.ceil(o/i)},l=new iZ(a,t,s==null),u=[e];s!=null&&u.push(s);const d=n.runWebGLProgram(l,u,"int32");if(d.shape[1]===1)return d;const f=pA(n,e,t,d);return n.disposeIntermediateTensorInfo(d),f}function mA(n,e,t,s=null){const r=s!=null?s.shape:e.shape,o=r[r.length-1],i=bm(o),a=new aZ(r,i,t,s==null),l=s==null?[e]:[e,s],u=n.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){const d=mA(n,e,t,u);return n.disposeIntermediateTensorInfo(u),d}return u}function gA(n,e,t,s){const r=[t];if(En("arg"+s.charAt(0).toUpperCase()+s.slice(1),r,e.shape.length),!ie().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const o=[],i=n.texData.get(e.dataId),a=i!==null&&i.isPacked;let l=e;a&&(l=n.unpackTensor(e),o.push(l));const[u,d]=wn(l.shape,r),f=ce(d),p=ke({inputs:{x:l},backend:n,attrs:{shape:[-1,f]}});o.push(p);const g=pA(n,p,s);o.push(g);const x=ke({inputs:{x:g},backend:n,attrs:{shape:u}});return o.forEach(w=>n.disposeIntermediateTensorInfo(w)),x}return mA(n,e,s)}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=Je(o,r.shape);const a=Bt(i,r.shape.length);let l=r;const u=[];a!=null&&(l=qn({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),i=Kt(i.length,l.shape.length)),En("argMax",[i[0]],l.shape.length);const d=gA(t,l,i[0],"max");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const cZ={kernelName:pp,backendName:"webgl",kernelFunc:lZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o}=s;let i=Je(o,r.shape);const a=Bt(i,r.shape.length);let l=r;const u=[];a!=null&&(l=qn({inputs:{x:r},backend:t,attrs:{perm:a}}),u.push(l),i=Kt(i.length,l.shape.length)),En("argMin",[i[0]],l.shape.length);const d=gA(t,l,i[0],"min");return u.forEach(f=>t.disposeIntermediateTensorInfo(f)),d}const hZ={kernelName:mp,backendName:"webgl",kernelFunc:uZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const dZ=tr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,fZ=at({opSnippet:dZ}),pZ={kernelName:fu,backendName:"webgl",kernelFunc:fZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const mZ=tr+"return log(x + sqrt(x * x + 1.0));",gZ=at({opSnippet:mZ}),xZ={kernelName:pu,backendName:"webgl",kernelFunc:gZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yZ=tr+`
  return atan(x);
`,wZ=at({opSnippet:yZ}),vZ={kernelName:mu,backendName:"webgl",kernelFunc:wZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const bZ=rv+`
  return atan(a, b);
`,CZ=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+wa+`
  return result;
`,kZ=Rn({opSnippet:bZ,packedOpSnippet:CZ}),SZ={kernelName:xu,backendName:"webgl",kernelFunc:kZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const IZ=tr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,$Z=at({opSnippet:IZ}),TZ={kernelName:gu,backendName:"webgl",kernelFunc:$Z};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ou{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterHeight,p=e.effectiveFilterWidth,g=e.padInfo.top,x=e.padInfo.left;this.outputShape=e.outShape;const w=t==="avg",v=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,b=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`;let C="0.0";if(w||(C="-1.0 / 1e-20"),s){const F=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${g}, ${x});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${p};
                wC += ${d}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${F} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${r?o?v:b:`wR * ${p} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const $="max";let S=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(S="avgValue / max(count, 1.0)");const T=Math.floor(i/4)*4,E=i%4,A=`
      if (${w}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${$}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${g}, ${x});
      const float initializationValue = ${C};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${C});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${f};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${T}; wC += 4) {
            int xC = xCCorner + wC * ${d};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              getValue(batch, xR, xC + 3 * ${d}, d)
            );

            ${A}
          }

          int xC = xCCorner + ${T};
          if (${E===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${A}
          } else if (${E===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              initializationValue,
              initializationValue
            );

            ${A}
          } else if (${E===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${d}, d),
              getValue(batch, xR, xC + 2 * ${d}, d),
              initializationValue
            );

            ${A}
          }
        }
        setOutput(${S});
      }
    `}}class iv{constructor(e,t,s,r=!1,o=!1){if(this.variableNames=["x"],t==="avg"&&s)throw new Error("Cannot compute positions for average pool.");const i=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,d=e.dilationDepth,f=e.dilationHeight,p=e.dilationWidth,g=e.effectiveFilterDepth,x=e.effectiveFilterHeight,w=e.effectiveFilterWidth,v=e.padInfo.front,b=e.padInfo.top,C=e.padInfo.left;this.outputShape=e.outShape;const $=t==="avg";let S="0.0";if($||(S="-1.0 / 1e-20"),s){const _=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${v}, ${b}, ${C});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${g};
              wD += ${d}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${x};
                wR += ${f}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${w};
                  wC += ${p}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${_} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${r?o?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${x} * ${w} +
                      wR * ${w} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}const T="max";let E=`${t}(${t}(${t}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;t==="avg"&&(E="avgValue / max(count, 1.0)");const A=Math.floor(i/4)*4,F=i%4,D=`
      if (${$}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${T}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${v}, ${b}, ${C});
      const float initializationValue = ${S};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${S});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${g};
            wD += ${d}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${x};
            wR += ${f}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${A}; wC += 4) {
              int xC = xCCorner + wC * ${p};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                getValue(batch, xD, xR, xC + 3 * ${p}, ch)
              );

              ${D}
            }

            int xC = xCCorner + ${A};
            if (${F===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${D}
            } else if (${F===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                initializationValue,
                initializationValue
              );

              ${D}
            } else if (${F===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${p}, ch),
                getValue(batch, xD, xR, xC + 2 * ${p}, ch),
                initializationValue
              );

              ${D}
            }
          }
        }
        setOutput(${E});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;$h(r,"avgPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;O(zn(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=Js(r.shape,o,i,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&mt(d.inShape,d.outShape))return ws({inputs:{x:r},backend:t});const f=new ou(d,"avg",!1);return t.runWebGLProgram(f,[r],"float32")}const EZ={kernelName:gp,backendName:"webgl",kernelFunc:NZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function RZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=s,d=[1,1,1],f=yo(r.shape,o,i,d,a,l,u),p=new iv(f,"avg",!1);return t.runWebGLProgram(p,[r],"float32")}const AZ={kernelName:xp,backendName:"webgl",kernelFunc:RZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class DZ{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,d=l-1-e.padInfo.top,f=u-1-e.padInfo.left,p=1/(t*s);this.userCode=`
      const ivec2 pads = ivec2(${d}, ${f});
      const float avgMultiplier = float(${p});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}}class _Z{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.effectiveFilterDepth,p=e.effectiveFilterHeight,g=e.effectiveFilterWidth,x=f-1-e.padInfo.front,w=p-1-e.padInfo.top,v=g-1-e.padInfo.left,b=1/(t*s*r);this.userCode=`
      const ivec3 pads = ivec3(${x}, ${w}, ${v});
      const float avgMultiplier = float(${b});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${f};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${o}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${p};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${g};
                wC += ${d}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function FZ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],p=yo(i.shape,a,l,f,u,d),g=new _Z(p);return t.runWebGLProgram(g,[r],i.dtype)}const OZ={kernelName:Fy,backendName:"webgl",kernelFunc:FZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zZ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o;$h([r,o],"avgPoolGrad");const{filterSize:a,strides:l,pad:u}=s,d=Js(i.shape,a,l,1,u),f=new DZ(d);return t.runWebGLProgram(f,[r],i.dtype)}const MZ={kernelName:_y,backendName:"webgl",kernelFunc:zZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PZ(n){const{inputs:e,backend:t,attrs:s}=n,{a:r,b:o}=e,{transposeA:i,transposeB:a}=s;return tp({a:r,b:o,transposeA:i,transposeB:a,backend:t})}const LZ={kernelName:yp,backendName:"webgl",kernelFunc:PZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class BZ{constructor(e,t,s,r,o,i){this.outputShape=[],this.variableNames=["x","mean","variance"],Ke(e,t),Ke(e,s);let a="0.0";r!=null&&(Ke(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";o!=null&&(Ke(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class VZ{constructor(e,t,s,r,o,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Ke(e,t),Ke(e,s);let a="vec4(0.0)";r!=null&&(Ke(e,r),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";o!=null&&(Ke(e,o),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const WZ=({inputs:n,backend:e,attrs:t})=>{const{x:s,mean:r,variance:o,offset:i,scale:a}=n;O(r.shape.length===o.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),O(i==null||r.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),O(a==null||r.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=t;l==null&&(l=.001);const u=[s,r,o];let d=null;i!=null&&(d=i.shape,u.push(i));let f=null;a!=null&&(f=a.shape,u.push(a));const p=ie().getBool("WEBGL_PACK_NORMALIZATION")?new VZ(s.shape,r.shape,o.shape,d,f,l):new BZ(s.shape,r.shape,o.shape,d,f,l);return e.runWebGLProgram(p,u,u[0].dtype)},UZ={kernelName:Rp,backendName:"webgl",kernelFunc:WZ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class GZ{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;const t=Ct(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const s=HZ(this.rank);let r;const o=e.map((i,a)=>`sourceLoc.${ry[a]} = start[${a}] + coords.${ry[a]};`);r=`
        ${t} sourceLoc;
        ${t} coords = getOutputCoords();
        ${o.join(`
`)}
      `,this.userCode=`
      void main() {
        ${r}
        setOutput(getSource(${s}));
      }
    `}}const ry=["x","y","z","w","u","v"];function HZ(n){if(n===1)return"sourceLoc";if(n<=6)return ry.slice(0,n).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class jZ{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];const t=Ct(this.rank),s=Hn("coords",this.rank),r=Hn("sourceLoc",this.rank),o=this.rank===1?"sourceLoc":`vec2(${r.slice(-2).join()})`,i=`getChannel(getSource(${r.join()}), ${o})`,a=`
      result.x = ${i};
      if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
        ++${r[this.rank-1]};
        result.y = ${i};
        --${r[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${s[this.rank-1]};
      if (++${s[this.rank-2]} < ${e[this.rank-2]}) {
        ++${r[this.rank-2]};
        result.z = ${i};
        if (++${s[this.rank-1]} < ${e[this.rank-1]}) {
          ++${r[this.rank-1]};
          result.w = ${i};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${t}(${e.map((d,f)=>`start[${f}]`).join()});`:e.map((d,f)=>`${r[f]} = ${s[f]} + start[${f}];`).join(`
`);this.userCode=`
      void main() {
        ${t} coords = getOutputCoords();
        ${t} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function XZ(n,e,t,s){const r=s.texData.get(n.dataId),o=s.makeTensorInfo(t,n.dtype),i=s.texData.get(o.dataId);Object.assign(i,r),i.refCount=1,i.shape=t,i.dtype=n.dtype;let a=tw(e,ze(n.shape));r.slice&&(a+=r.slice.flatOffset),i.slice={flatOffset:a,origDataId:r.slice&&r.slice.origDataId||n.dataId};const l=s.dataRefCount.get(i.slice.origDataId)||1;return s.dataRefCount.set(i.slice.origDataId,l+1),o}function Wl(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,size:i}=s,[a,l]=vm(r,o,i);if(Z1(r,a,l),ce(l)===0)return t.makeTensorInfo(l,r.dtype,[]);if(t.shouldExecuteOnCPU([r])||r.dtype==="string"){const f=t.texData.get(r.dataId),p=LY(f.values,a,l,r.shape,r.dtype);return t.makeTensorInfo(l,r.dtype,p)}const{isPacked:u}=t.texData.get(r.dataId),d=ew(r.shape,a,l);if(u||!d){const f=ie().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new jZ(l):new GZ(l),p=[a];return t.runWebGLProgram(f,[r],r.dtype,p)}return t.uploadToGPU(r.dataId),XZ(r,a,l,t)}const KZ={kernelName:om,backendName:"webgl",kernelFunc:Wl};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qZ=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,crops:i}=s;O(r.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((C,$)=>C*$),l=fh(r.shape,o,a),u=ph(l.length,o.length),d=mh(r.shape,o,a),f=iw(i,o.length),p=aw(d,i,o.length),g=[],x=ke({inputs:{x:r},backend:t,attrs:{shape:l}}),w=qn({inputs:{x},backend:t,attrs:{perm:u}}),v=ke({inputs:{x:w},backend:t,attrs:{shape:d}}),b=Wl({inputs:{x:v},backend:t,attrs:{begin:f,size:p}});return g.push(x),g.push(w),g.push(v),g.forEach(C=>t.disposeIntermediateTensorInfo(C)),b},YZ={kernelName:wp,backendName:"webgl",kernelFunc:qZ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function QZ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i}=s,a=t.readSync(r.dataId),l=t.readSync(o.dataId),u=sA(a,l,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,u)}const ZZ={kernelName:Oy,backendName:"webgl",kernelFunc:QZ};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const JZ=`
  int r = int(a.r) & int(b.r);
  int g = int(a.g) & int(b.g);
  int rb = int(a.b) & int(b.b);
  int ra = int(a.a) & int(b.a);
  return vec4(r, g, rb, ra);
`,eJ=`
  return float(int(a.r) & int(b.r));
`;function tJ(n){const{inputs:e,backend:t}=n,{a:s,b:r}=e,o=ie().getBool("WEBGL_PACK_BINARY_OPERATIONS"),i=ie().getNumber("WEBGL_VERSION");if(t.shouldExecuteOnCPU([s,r])||i===1){const l=t.texData.get(s.dataId).values,u=t.texData.get(r.dataId).values,[d,f]=cY(s.shape,r.shape,l,u,s.dtype),p=t.makeTensorInfo(f,s.dtype),g=t.texData.get(p.dataId);return g.values=d,p}let a;return o?a=new Bl(JZ,s.shape,r.shape,!1):a=new ca(eJ,s.shape,r.shape),t.runWebGLProgram(a,[s,r],s.dtype)}const nJ={kernelName:zy,backendName:"webgl",kernelFunc:tJ};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sJ(n){const{inputs:e,backend:t}=n,{s0:s,s1:r}=e,o=t.readSync(s.dataId),i=t.readSync(r.dataId),a=Ke(Array.from(o),Array.from(i));return t.makeTensorInfo([a.length],"int32",Int32Array.from(a))}const rJ={kernelName:cI,backendName:"webgl",kernelFunc:sJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oJ="return float(a != b);",xA=Rn({opSnippet:oJ,cpuKernelImpl:RY,dtype:"bool"}),iJ={kernelName:Xp,backendName:"webgl",kernelFunc:xA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Nh(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return ws({inputs:{x:r.complexTensorInfos.real},backend:t})}const aJ={kernelName:a1,backendName:"webgl",kernelFunc:Nh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const lJ="return float(int(x));";function cJ(n,e){const t=new zr(n.shape,lJ),s=e.runWebGLProgram(t,[n],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function oy(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dtype:o}=s;if(o==="complex64"){if(r.dtype==="complex64")return ws({inputs:{x:r},backend:t});const i=gn(r.shape),a=oy({inputs:{x:r},backend:t,attrs:{dtype:"float32"}}),l=pi({inputs:{real:a,imag:i},backend:t});return i.dispose(),t.disposeIntermediateTensorInfo(a),l}if(r.dtype==="complex64"){const i=Nh({inputs:{input:r},backend:t}),a=oy({inputs:{x:i},backend:t,attrs:{dtype:o}});return t.disposeIntermediateTensorInfo(i),a}if(!rI(r.dtype,o)){const i=ws({inputs:{x:r},backend:t});return{dataId:i.dataId,shape:i.shape,dtype:o}}if(t.shouldExecuteOnCPU([r])){const i=t.texData.get(r.dataId).values,[a,l,u]=uY(i,r.shape,r.dtype,o);return t.makeTensorInfo(a,l,u)}if(o==="int32")return cJ(r,t);if(o==="bool"){const i=t.makeTensorInfo([],"bool",_n("bool",1)),l=xA({inputs:{a:r,b:i},backend:t});return t.disposeIntermediateTensorInfo(i),l}throw new Error(`Error in Cast: failed to cast ${r.dtype} to ${o}`)}const uJ={kernelName:yu,backendName:"webgl",kernelFunc:oy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const s2="return ceil(x);",hJ=at({opSnippet:s2,packedOpSnippet:s2,cpuKernelImpl:hY}),dJ={kernelName:wu,backendName:"webgl",kernelFunc:hJ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fJ{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pJ{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mJ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{clipValueMin:o,clipValueMax:i}=s;let a;ie().getBool("WEBGL_PACK_CLIP")?a=new pJ(r.shape):a=new fJ(r.shape);const l=[[o],[i]];return t.runWebGLProgram(a,[r],r.dtype,l)}const gJ={kernelName:vu,backendName:"webgl",kernelFunc:mJ};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xJ{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function r2(n,e){return{dataId:e.dataId,dtype:e.dtype,shape:n.shape}}function yJ(n){const{inputs:e,backend:t}=n,{x:s}=e,r=t.texData.get(s.dataId),o=new xJ(s.shape),i=[r2(s,r.complexTensorInfos.real),r2(s,r.complexTensorInfos.imag)];return t.runWebGLProgram(o,i,i[0].dtype)}const wJ={kernelName:vp,backendName:"webgl",kernelFunc:yJ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vJ{constructor(e){this.outputShape=[],this.outputShape=Lr(e,1),this.variableNames=e.map((i,a)=>`T${a}`);const t=new Array(e.length-1);t[0]=e[0][1];for(let i=1;i<t.length;i++)t[i]=t[i-1]+e[i][1];const s=[`if (yC < ${t[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<t.length;i++){const a=t[i-1];s.push(`else if (yC < ${t[i]}) setOutput(getT${i}(yR, yC-${a}));`)}const r=t.length,o=t[t.length-1];s.push(`else setOutput(getT${r}(yR, yC-${o}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${s.join(`
        `)}
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class bJ{constructor(e,t){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Lr(e,t);const s=this.outputShape,r=s.length,o=Ct(r),i=Hn("coords",r),a=["x","y","z","w","u","v"].slice(0,r);this.variableNames=e.map((w,v)=>`T${v}`);const l=new Array(e.length-1);l[0]=e[0][t];for(let w=1;w<l.length;w++)l[w]=l[w-1]+e[w][t];const u=a[t],d=a.slice(-2),f=a.join();let p=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${f}), vec2(${d.join()}));
        }`;for(let w=1;w<l.length;w++){const v=l[w-1];p+=`
        if (${u} < ${l[w]}  && ${u} >= ${l[w-1]}) {
          return getChannel(
            getT${w}(${Jd(a,u,v)}),
            vec2(${Jd(d,u,v)}));
        }`}const g=l.length,x=l[l.length-1];p+=`
        return getChannel(
          getT${g}(${Jd(a,u,x)}),
          vec2(${Jd(d,u,x)}));`,this.userCode=`
      float getValue(${a.map(w=>"int "+w)}) {
        ${p}
      }

      void main() {
        ${o} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[r-1]} = ${i[r-1]} + 1;
        if (${i[r-1]} < ${s[r-1]}) {
          result.g = getValue(${i});
        }

        ${i[r-2]} = ${i[r-2]} + 1;
        if (${i[r-2]} < ${s[r-2]}) {
          result.a = getValue(${i});
        }

        ${i[r-1]} = ${i[r-1]} - 1;
        if (${i[r-2]} < ${s[r-2]} &&
            ${i[r-1]} < ${s[r-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}}function Jd(n,e,t){const s=n.indexOf(e);return n.map((o,i)=>i===s?`${o} - ${t}`:o).join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Bm(n){const{inputs:e,backend:t}=n,{input:s}=e,r=t.texData.get(s.dataId);return ws({inputs:{x:r.complexTensorInfos.imag},backend:t})}const CJ={kernelName:Jy,backendName:"webgl",kernelFunc:Bm};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Vc(n,e,t){const s=n[0].dtype;if(s==="complex64"){const g=n.map(C=>Nh({inputs:{input:C},backend:t})),x=n.map(C=>Bm({inputs:{input:C},backend:t})),w=Vc(g,e,t),v=Vc(x,e,t),b=pi({inputs:{real:w,imag:v},backend:t});return g.forEach(C=>t.disposeIntermediateTensorInfo(C)),x.forEach(C=>t.disposeIntermediateTensorInfo(C)),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v),b}let r=t.shouldExecuteOnCPU(n);if(s==="string"&&(r=!0),r){const g=n.map(S=>{const E=[-1,ce(S.shape.slice(e))];return ke({inputs:{x:S},backend:t,attrs:{shape:E}})}),x=g.map(S=>({vals:t.readSync(S.dataId),shape:S.shape})),w=Lr(g.map(S=>S.shape),1),v=g[0].shape[0]===1,b=dY(x,w,s,v),C=Lr(n.map(S=>S.shape),e),$=t.makeTensorInfo(C,s,b);return g.forEach(S=>t.disposeIntermediateTensorInfo(S)),$}const o=n.filter(g=>ce(g.shape)>0),i=ie().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&o[0].shape.length>1;if(o.length===1){const g=i?new zr(n[0].shape,Wo):new Ho(n[0].shape,Wo);return t.runWebGLProgram(g,n,s)}const a=ie().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(o.length>a){const g=[];for(let w=0;w<o.length;w+=a){const v=o.slice(w,w+a);g.push(Vc(v,e,t))}const x=Vc(g,e,t);for(const w of g)t.disposeIntermediateTensorInfo(w);return x}if(i){const g=new bJ(o.map(x=>x.shape),e);return t.runWebGLProgram(g,o,s)}const{tensors2D:l,outShape:u}=kJ(o,e,t),d=new vJ(l.map(g=>g.shape)),f=t.runWebGLProgram(d,l,s);l.forEach(g=>t.disposeIntermediateTensorInfo(g));const p=ke({inputs:{x:f},attrs:{shape:u},backend:t});return t.disposeIntermediateTensorInfo(f),p}function kJ(n,e,t){const s=Lr(n.map(o=>o.shape),e);return{tensors2D:n.map(o=>ke({inputs:{x:o},attrs:{shape:[-1,ce(o.shape.slice(e))]},backend:t})),outShape:s}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yA(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s,o=Je(r,e[0].shape)[0],i=e.map(u=>u.shape);sw(i,o);const a=Lr(e.map(u=>u.shape),o);if(ce(a)===0)return t.makeTensorInfo(a,e[0].dtype,[]);const l=e.filter(u=>ce(u.shape)>0);return l.length===1?ws({inputs:{x:l[0]},backend:t}):Vc(l,o,t)}const SJ={kernelName:bp,backendName:"webgl",kernelFunc:yA};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wA{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;const i=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,d=e.dilationHeight,f=e.dilationWidth,p=e.filterHeight,g=e.filterWidth,x=Math.floor(e.inChannels/4)*4,w=e.inChannels%4,v=e.dataFormat==="channelsLast",b=v?1:2,C=v?2:3,$=v?3:1;let S="",T="";s&&(r?S=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?S=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:S=`
          float activation(float x) {
            ${s}
          }
        `,T="result = activation(result);");const E=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${S}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${$}];

        ivec2 xRCCorner =
            ivec2(coords[${b}], coords[${C}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${p}; wR++) {
          int xR = xRCorner + wR * ${d};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${g}; wC++) {
            int xC = xCCorner + wC * ${f};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${x}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${v}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${w===1}) {

              if (${v}) {
                dotProd +=
                    getX(batch, xR, xC, ${x}) *
                    getW(wR, wC, ${x}, d2);
              } else {
                dotProd +=
                    getX(batch, ${x}, xR, xC) *
                    getW(wR, wC, ${x}, d2);
              }

            } else if (${w===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2)
              );

              if (${v}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${w===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${x}, d2),
                getW(wR, wC, ${x} + 1, d2),
                getW(wR, wC, ${x} + 2, d2)
              );

              if (${v}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${x}),
                  getX(batch, xR, xC, ${x} + 1),
                  getX(batch, xR, xC, ${x} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${x}, xR, xC),
                  getX(batch, ${x} + 1, xR, xC),
                  getX(batch, ${x} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${E}
        ${T}
        setOutput(result);
      }
    `}}class IJ{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const t=e.padInfo.front,s=e.padInfo.top,r=e.padInfo.left,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,d=e.dilationWidth,f=e.filterDepth,p=e.filterHeight,g=e.filterWidth,x=Math.floor(e.inChannels/4)*4,w=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${o}, ${i}, ${a});
      const ivec3 pads = ivec3(${t}, ${s}, ${r});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${f}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${p}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${g}; wC++) {
              int xC = xCCorner + wC * ${d};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${x}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${w===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${x}) *
                  getW(wF, wR, wC, ${x}, d2);
              } else if (${w===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${w===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${x}),
                  getX(batch, xF, xR, xC, ${x} + 1),
                  getX(batch, xF, xR, xC, ${x} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${x}, d2),
                  getW(wF, wR, wC, ${x} + 1, d2),
                  getW(wF, wR, wC, ${x} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vA{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Pn(this.outputShape.length);const i=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,d=e.filterWidth,f=d;let p=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let v=0;v<d;v++)p+=`
           vec4 xTexelC${v*2};
           int xTexelC${v*2}Ready;
           vec4 xTexelC${v*2+1};
           int xTexelC${v*2+1}Ready;
           vec4 xC${v};`;p+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let v=0;v<d;v++)p+=`
           xTexelC${v*2} = vec4(0.0);
           xTexelC${v*2}Ready = 0;
           xTexelC${v*2+1} = vec4(0.0);
           xTexelC${v*2+1}Ready = 0;
           xC${v} = vec4(0.0);`;p+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let v=0;v<(f+1)/2;v++){const b=v*2;if(p+=`
           xC = xCCorner + ${b*l};
           `,a===1){if(b<d&&(i%2===1?(p+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }
               `,l===1&&b>0?p+=`
                 xC${b} = vec4(xTexelC${b-2}.zw, xTexelC${b}.xy);
                 `:p+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${b} = vec4(previous.zw, xTexelC${b}.xy);
                   } else {
                     xC${b} = vec4(0.0, 0.0, xTexelC${b}.xy);
                   }
                   `):p+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xC${b} = xTexelC${b};
                 `,b+1<d)){const C=i%2===0?Sy(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(p+=`
                   xCOffset = xC + imod(pads[1], 2) + ${C};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                     xTexelC${b+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${b+1}.zw = vec2(0.0);
                     }
                     xTexelC${b+1}Ready = 1;
                   }
                   `,l>1?p+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${b+1} = vec4(previous.zw, xTexelC${b+1}.xy);
                     } else {
                      xC${b+1} = vec4(0.0, 0.0, xTexelC${b+1}.xy);
                     }
                     `:p+=`
                     xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.xy);
                     `):C===1?p+=`
                     xC${b+1} = xTexelC${b};
                     `:p+=`
                     xCOffset = xC + ${C};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                       xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${b+1}.zw = vec2(0.0);
                       }
                       xTexelC${b+1}Ready = 1;
                     }

                     xC${b+1} = xTexelC${b+1};
                     `}}else b<d&&(i%2===1?(p+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.0);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
               `,b+1<d&&(p+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${b+1} = vec4(xTexelC${b+1}.xy, final.xy);
                 `)):(p+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${b}Ready == 0) {
                   xTexelC${b} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${b}.zw = vec2(0.0);
                   }
                   xTexelC${b}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${b+1}Ready == 0) {
                   xTexelC${b+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${b+1}.zw = vec2(0.);
                   }
                   xTexelC${b+1}Ready = 1;
                 }

                 xC${b} = vec4(
                   xTexelC${b}.xy, xTexelC${b+1}.xy);
               `,b+1<d&&(p+=`
                   xC${b+1} = vec4(xTexelC${b}.zw, xTexelC${b+1}.zw);
                 `)));b<d&&(p+=`
             wTexel = getW(r, ${b}, d1, d2);
             dotProd += xC${b}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${b}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,b+1<d&&(p+=`
               wTexel = getW(r, ${b+1}, d1, d2);
               dotProd += xC${b+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${b+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}p+=`
     }
   `,p+=`
     }
   `,p+=`
     }
   `;let g="",x="";s&&(r?g=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${s}
         }`:o?g=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${s}
         }`:g=`vec4 activation(vec4 x) {
           ${s}
         }`,x="result = activation(result);");const w=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${g}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${p}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${w}
         ${x}
         setOutput(result);
       }
     `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $J{constructor(e,t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Pn(this.outputShape.length);const{dataFormat:s}=t,r=Yn(),o=s==="channelsLast",i=o?1:2,a=o?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`;let u="";for(let d=0;d<=1;d++)for(let f=0;f<=1;f++)u+=`
          blockIndex = rc.z + ${f};
          pos = rc.y + ${d};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${o}) {
                  innerDims = vec2(d1, ch);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${d*2+f}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${r.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function np(n,e){const t=n.length;return t>=3?e?[...n.slice(0,-3),n[t-3]*n[t-2],n[t-1]]:[...n.slice(0,-3),n[t-3],n[t-2]*n[t-1]]:!e&&t===1&&n[0]>1?[n[0],1]:null}function bA({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const l=n.shape,u=s.texData.get(n.dataId),d=t.inChannels,f=l[0]*l[1]*l[2],p=t.outChannels,g=t.dataFormat==="channelsLast",x=!1,w=!1;let v;const b=[];if(o!=null){const S=np(o.shape,g);S!=null&&(o=ke({inputs:{x:o},backend:s,attrs:{shape:S}}),b.push(o))}if(r!=null){const S=np(r.shape,g);S!=null&&(r=ke({inputs:{x:r},backend:s,attrs:{shape:S}}),b.push(r))}if(!((f===1||p===1)&&d>fA)&&u.isPacked&&g&&u.texture!=null&&l[2]%2!==0&&mt(u.shape.slice(-3),l.slice(-3))){const S=l[0]*l[1]*(l[2]+1),T={dataId:n.dataId,shape:[1,S,t.inChannels],dtype:n.dtype},E=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,O(ep(u.shape,T.shape),()=>`packed reshape ${u.shape} to ${T.shape} isn't free`);const A=ke({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}});b.push(A);const F=tp({a:T,b:A,backend:s,transposeA:x,transposeB:w,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i}),D=s.texData.get(F.dataId);O(D.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=E,D.shape=t.outShape,v=ws({inputs:{x:F},backend:s}),v.shape=t.outShape,b.push(F)}else{const S=t.outHeight*t.outWidth,T=ke({inputs:{x:n},backend:s,attrs:{shape:g?[t.batchSize,S,t.inChannels]:[t.batchSize,t.inChannels,S]}}),E=ke({inputs:{x:e},backend:s,attrs:{shape:[1,t.inChannels,t.outChannels]}}),A=tp({a:g?T:E,b:g?E:T,transposeA:!g,transposeB:w,backend:s,bias:r,activation:a,preluActivationWeights:o,leakyreluAlpha:i});v=ke({inputs:{x:A},backend:s,attrs:{shape:t.outShape}}),b.push(T),b.push(E),b.push(A)}for(const S of b)s.disposeIntermediateTensorInfo(S);return v}function CA({x:n,filter:e,convInfo:t,backend:s,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:i=0,activation:a=null}){const{filterWidth:l,filterHeight:u,inChannels:d,outWidth:f,outHeight:p,dataFormat:g}=t,x=g==="channelsLast",w=l*u*d,v=p*f,b=[t.batchSize,w,v],C=!0,$=!1,S=[];if(o!=null){const B=np(o.shape,x);B!=null&&(o=ke({inputs:{x:o},backend:s,attrs:{shape:B}}),S.push(o))}if(r!=null){const B=np(r.shape,x);B!=null&&(r=ke({inputs:{x:r},backend:s,attrs:{shape:B}}),S.push(r))}const T=ke({inputs:{x:e},backend:s,attrs:{shape:[1,w,ce(e.shape)/w]}});S.push(T);const E=new $J(b,t),A=[n.shape,[t.padInfo.top,t.padInfo.left],[t.strideHeight,t.strideWidth],[t.dilationHeight,t.dilationWidth],[t.inChannels],[t.filterWidth*t.inChannels],[t.outWidth]],F=s.runWebGLProgram(E,[n],"float32",A),D=ke({inputs:{x:F},backend:s,attrs:{shape:b}});S.push(F),S.push(D);const _=r!=null,N=o!=null,L=a==="leakyrelu",G=a?ru(a,!0):null,Q=new dA(x?D.shape:T.shape,x?T.shape:D.shape,x?[t.batchSize,v,t.outChannels]:[t.batchSize,t.outChannels,v],C,$,_,G,N,L),K=x?[D,T]:[T,D];if(r&&K.push(r),N&&K.push(o),L){const B=s.makeTensorInfo([],"float32",oi(i,"float32"));K.push(B),S.push(B)}const Z=s.runWebGLProgram(Q,K,"float32"),te=ke({inputs:{x:Z},backend:s,attrs:{shape:t.outShape}});S.push(Z);for(const B of S)s.disposeIntermediateTensorInfo(B);return te}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TJ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:d}=s,f=wo(l),p=Nn(r.shape,o.shape,i,u,a,d,!1,f);let g;if(p.filterHeight===1&&p.filterWidth===1&&p.dilationHeight===1&&p.dilationWidth===1&&p.strideHeight===1&&p.strideWidth===1&&(p.padInfo.type==="SAME"||p.padInfo.type==="VALID"))g=bA({x:r,filter:o,convInfo:p,backend:t});else if(p.strideWidth<=2&&f==="channelsLast"&&ie().getBool("WEBGL_EXP_CONV")){const w=new vA(p),v=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];g=t.runWebGLProgram(w,[r,o],"float32",v)}else if(ie().getBool("WEBGL_CONV_IM2COL"))g=CA({x:r,filter:o,convInfo:p,backend:t});else{const w=new wA(p);g=t.runWebGLProgram(w,[r,o],"float32")}const x=ke({inputs:{x:g},backend:t,attrs:{shape:p.outShape}});return t.disposeIntermediateTensorInfo(g),x}const NJ={kernelName:Cp,backendName:"webgl",kernelFunc:TJ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class EJ{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              ${i?`float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);`:`float dyValue = getDy(b, d2, yR, yC);
              float xValue = getX(b, d1, xR, xC);
              dotProd += (xValue * dyValue);`}
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class RJ{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=e.dataFormat==="channelsLast",a=t-1-e.padInfo.top,l=s-1-e.padInfo.left,u=i?1:2,d=i?2:3,f=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${f}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${d}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}}class AJ{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${t} - ${o};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${s} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${r} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class DJ{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterDepth,s=e.filterHeight,r=e.filterWidth,o=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=t-1-e.padInfo.front,u=s-1-e.padInfo.top,d=r-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${t}; wF++) {
          float dyF = float(dyFCorner + wF) / ${o}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${t} - 1 - wF;

          for (int wR = 0; wR < ${s}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${s} - 1 - wR;

            for (int wC = 0; wC < ${r}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${r} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _J(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:d}=s,f=wo(l),p=Nn(r.shape,d,i,1,a,u,!1,f),g=new EJ(p);return t.runWebGLProgram(g,[r,o],"float32")}const FJ={kernelName:Py,backendName:"webgl",kernelFunc:_J};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class OJ{constructor(e){this.variableNames=["dy","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"strides",type:"vec2"}],this.outputShape=e.inShape,this.enableShapeUniforms=Pn(this.outputShape.length);const t=e.filterHeight,s=e.filterWidth,r=t-1-e.padInfo.top,o=s-1-e.padInfo.left;this.userCode=`
      const ivec2 pads = ivec2(${r}, ${o});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];

        ivec2 dyCorner = ivec2(coords[1], coords[2]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        vec4 result = vec4(0.);
        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / strides[0];
          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);
          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            int wCPerm = ${s} - 1 - wC;

            float dyC = float(dyCCorner + wC) / strides[1];
            bool idyCVal = (dyC >= 0.0) && (dyC < ${e.outWidth}.0)
              && (fract(dyC) == 0.0);
            int idyC = int(dyC);

            float dyC2 = float(dyCCorner + wC + 1) / strides[1];
            bool idyCVal2 = (dyC2 >= 0.0) && (dyC2 < ${e.outWidth}.0)
              && (fract(dyC2) == 0.0);
            int idyC2 = int(dyC2);

            if (idyCVal && idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec4 dySample2 = (idyC / 2 == idyC2 / 2) ?
                  dySample : getDy(batch, idyR, idyC2, d2);

                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));

                dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample2.xy : dySample2.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC, d2);
                vec2 dyValue = mod(float(idyC), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.xy += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            } else if (idyCVal2) {
              for (int d2 = 0; d2 < ${e.outChannels}; d2 += 2) {
                vec4 wValue = getW(wRPerm, wCPerm, d1, d2);
                vec4 dySample = getDy(batch, idyR, idyC2, d2);
                vec2 dyValue = mod(float(idyC2), 2.) == 0. ?
                  dySample.xy : dySample.zw;
                result.zw += vec2(dot(dyValue, wValue.xy),
                  dot(dyValue, wValue.zw));
              }
            }
          }
        }
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zJ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:d}=s,f=wo(u),p=Nn(i,o.shape,a,1,l,d,!1,f);if(ie().getBool("WEBGL_PACK_CONV2DTRANSPOSE")&&f==="channelsLast"){const g=[[p.strideHeight,p.strideWidth]],x=new OJ(p);return t.runWebGLProgram(x,[r,o],"float32",g)}else{const g=new RJ(p);return t.runWebGLProgram(g,[r,o],"float32")}}const MJ={kernelName:kp,backendName:"webgl",kernelFunc:zJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function PJ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s,u=ai(r.shape,o.shape,i,l,a),d=new IJ(u);return t.runWebGLProgram(d,[r,o],"float32")}const LJ={kernelName:Sp,backendName:"webgl",kernelFunc:PJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function BJ(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,pad:a,filterShape:l}=s,u=ai(r.shape,l,i,1,a),d=new AJ(u);return t.runWebGLProgram(d,[r,o],"float32")}const VJ={kernelName:Ly,backendName:"webgl",kernelFunc:BJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function WJ(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{pad:i,strides:a,inputShape:l}=s,u=ai(l,o.shape,a,1,i),d=new DJ(u);return t.runWebGLProgram(d,[r,o],"float32")}const UJ={kernelName:By,backendName:"webgl",kernelFunc:WJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const GJ=Vl+`
  return cos(x);
`,HJ=`
  vec4 result = cos(x);
  bvec4 isNaN = isnan(x);
  ${wa}
  return result;
`,jJ=at({opSnippet:GJ,packedOpSnippet:HJ}),XJ={kernelName:bu,backendName:"webgl",kernelFunc:jJ};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const KJ=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,qJ=at({opSnippet:KJ}),YJ={kernelName:Cu,backendName:"webgl",kernelFunc:qJ};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class QJ{constructor(e,t,s,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[i,a,l,u]=e,[d]=t,[f,p]=s;this.outputShape=[d,f,p,u];const g=r==="bilinear"?1:0,[x,w]=[`${a-1}.0`,`${l-1}.0`],[v,b,C]=f>1?[`${(a-1)/(f-1)}`,"(y2-y1) * height_ratio",`y1*${x} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${x}`],[$,S,T]=p>1?[`${(l-1)/(p-1)}`,"(x2-x1) * width_ratio",`x1*${w} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${w}`];this.userCode=`
      const float height_ratio = float(${v});
      const float width_ratio = float(${$});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${b};
        float width_scale = ${S};

        float in_y = ${C};
        if( in_y < 0.0 || in_y > ${x} ) {
          setOutput(float(${o}));
          return;
        }
        float in_x = ${T};
        if( in_x < 0.0 || in_x > ${w} ) {
          setOutput(float(${o}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${g} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ZJ=n=>{const{inputs:e,backend:t,attrs:s}=n,{image:r,boxes:o,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=s,d=new QJ(r.shape,o.shape,a,l,u);return t.runWebGLProgram(d,[r,o,i],"float32")},JJ={kernelName:Wy,backendName:"webgl",kernelFunc:ZJ};var iu;(function(n){n.Prod="*",n.Sum="+"})(iu||(iu={}));class o2{constructor(e,t,s,r){this.op=e,this.outputShape=t,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];const o=this.outputShape.length,i=this.op===iu.Prod?"1.0":"0.0",a=s?i:`getX(${i2(o,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1];let u="",d="";s?(u=r?`end != ${l-1}`:"end != 0",d=r?"end + 1":"end - 1"):(u=r?`end + pow2 < ${l}`:"end >= pow2",d=r?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${Ct(o)} coords = getOutputCoords();
        int end = ${a2(o,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${d};
          ${a2(o,"coords",this.op)} = idx;
          val ${this.op}= getX(${i2(o,"coords",this.op)});
        }
        setOutput(val);
      }
    `}}function i2(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.x, ${e}.y`;if(n===3)return`${e}.x, ${e}.y, ${e}.z`;if(n===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}function a2(n,e,t){if(n===1)return`${e}`;if(n===2)return`${e}.y`;if(n===3)return`${e}.z`;if(n===4)return`${e}.w`;throw new Error(`Cumulative ${t} for rank ${n} is not yet supported`)}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kA(n,e,t,s,r,o){const i=e.shape.length,a=Bt([s],i);let l=e;a!=null&&(l=qn({inputs:{x:e},backend:t,attrs:{perm:a}}));const u=Kt(1,i)[0];if(u!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${s}`);const d=l.shape[u];let f=ws({inputs:{x:l},backend:t});for(let p=0;p<=Math.ceil(Math.log2(d))-1;p++){const g=new o2(n,l.shape,!1,o),x=[[p]],w=f;f=t.runWebGLProgram(g,[f],f.dtype,x),t.disposeIntermediateTensorInfo(w)}if(r){const p=new o2(n,l.shape,r,o),g=f;f=t.runWebGLProgram(p,[f],f.dtype),t.disposeIntermediateTensorInfo(g)}if(a!=null){const p=li(a),g=qn({inputs:{x:f},backend:t,attrs:{perm:p}});return t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(l),g}return f}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return kA(iu.Prod,r,t,o,i,a)}const tee={kernelName:Vy,backendName:"webgl",kernelFunc:eee};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function nee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,exclusive:i,reverse:a}=s;return kA(iu.Sum,r,t,o,i,a)}const see={kernelName:Ip,backendName:"webgl",kernelFunc:nee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ree(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,weights:o}=e,{size:i,binaryOutput:a}=s;if(r.shape.length===1){const l=t.readSync(r.dataId),u=t.readSync(o.dataId),d=sA(l,u,o.dtype,o.shape,i);return t.makeTensorInfo([i],o.dtype,d)}else if(r.shape.length===2){const l=t.bufferSync(r),u=t.bufferSync(o),d=lY(l,u,i,a);return t.makeTensorInfo(d.shape,o.dtype,d.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${r.shape.length}.`)}const oee={kernelName:Uy,backendName:"webgl",kernelFunc:ree};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class iee{constructor(e,t,s){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=t,this.dataFormat=s,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${t};
      int offset_h = imod(h, ${t});
      int in_w = w / ${t};
      int offset_w = imod(w, ${t});
      int offset_d = (offset_h * ${t} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function aee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockSize:o,dataFormat:i}=s,a=r.shape[0],l=i==="NHWC"?r.shape[1]:r.shape[2],u=i==="NHWC"?r.shape[2]:r.shape[3],d=i==="NHWC"?r.shape[3]:r.shape[1],f=l*o,p=u*o,g=d/(o*o),x=i==="NHWC"?[a,f,p,g]:[a,g,f,p],w=new iee(x,o,i);return t.runWebGLProgram(w,[r],r.dtype)}const lee={kernelName:Gy,backendName:"webgl",kernelFunc:aee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class SA{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Pn(this.outputShape.length);const i=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels;let u="",d="";s&&(r?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:u=`
          float activation(float x) {
            ${s}
          }
        `,d="result = activation(result);");const f=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${f}
        ${d}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class IA{constructor(e,t=!1,s=null,r=!1,o=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Pn(this.outputShape.length);const i=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,d=e.filterHeight,f=e.filterWidth,p=f;let g=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let b=0;b<f;b++)g+=`
          vec4 xTexelC${b*2};
          int xTexelC${b*2}Ready;
          vec4 xTexelC${b*2+1};
          int xTexelC${b*2+1}Ready;
          vec4 xC${b};`;g+=`
    for (int r = 0; r < ${d}; r++) {
      `;for(let b=0;b<f;b++)g+=`
          xTexelC${b*2} = vec4(0.0);
          xTexelC${b*2}Ready = 0;
          xTexelC${b*2+1} = vec4(0.0);
          xTexelC${b*2+1}Ready = 0;
          xC${b} = vec4(0.0);`;g+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let b=0;b<(p+1)/2;b++){const C=b*2;if(g+=`
          xC = xCCorner + ${C*u};
          `,l===1){if(C<f&&(a%2===1?(g+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }
              `,u===1&&C>0?g+=`
                xC${C} = vec4(xTexelC${C-2}.zw, xTexelC${C}.xy);
                `:g+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${C} = vec4(previous.zw, xTexelC${C}.xy);
                  } else {
                    xC${C} = vec4(0.0, 0.0, xTexelC${C}.xy);
                  }
                  `):g+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xC${C} = xTexelC${C};
                `,C+1<f)){const $=a%2===0?Sy(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(g+=`
                  xCOffset = xC + imod(pads[1], 2) + ${$};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                    xTexelC${C+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${C+1}.zw = vec2(0.0);
                    }
                    xTexelC${C+1}Ready = 1;
                  }
                  `,u>1?g+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${C+1} = vec4(previous.zw, xTexelC${C+1}.xy);
                    } else {
                     xC${C+1} = vec4(0.0, 0.0, xTexelC${C+1}.xy);
                    }
                    `:g+=`
                    xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.xy);
                    `):$===1?g+=`
                    xC${C+1} = xTexelC${C};
                    `:g+=`
                    xCOffset = xC + ${$};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                      xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${C+1}.zw = vec2(0.0);
                      }
                      xTexelC${C+1}Ready = 1;
                    }

                    xC${C+1} = xTexelC${C+1};
                    `}}else C<f&&(a%2===1?(g+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.0);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
              `,C+1<f&&(g+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${C+1} = vec4(xTexelC${C+1}.xy, final.xy);
                `)):(g+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${C}Ready == 0) {
                  xTexelC${C} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${C}.zw = vec2(0.0);
                  }
                  xTexelC${C}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${C+1}Ready == 0) {
                  xTexelC${C+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${C+1}.zw = vec2(0.);
                  }
                  xTexelC${C+1}Ready = 1;
                }

                xC${C} = vec4(
                  xTexelC${C}.xy, xTexelC${C+1}.xy);
              `,C+1<f&&(g+=`
                  xC${C+1} = vec4(xTexelC${C}.zw, xTexelC${C+1}.zw);
                `)));C<f&&(g+=`
            wTexel = getW(r, ${C}, d1, q);
            dotProd += xC${C} * vec4(wTexel.xz, wTexel.xz);
          `,C+1<f&&(g+=`
              wTexel = getW(r, ${C+1}, d1, q);
              dotProd += xC${C+1} * vec4(wTexel.xz, wTexel.xz);
            `))}g+=`
    }
  `,g+=`
      }
    `;let x="",w="";s&&(r?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${s}
        }`:o?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${s}
        }`:x=`vec4 activation(vec4 x) {
          ${s}
        }`,w="result = activation(result);");const v=t?"result += getBiasAtOutCoords();":"";t&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),o&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${x}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${g}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${v}
        ${w}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function cee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=s;let d=l;d==null&&(d=[1,1]),O(zn(i,d),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${d}'`);const f=Nn(r.shape,o.shape,i,d,a,u,!0);let p;ie().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?p=new IA(f):p=new SA(f);const g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return t.runWebGLProgram(p,[r,o],"float32",g)}const uee={kernelName:$p,backendName:"webgl",kernelFunc:cee};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hee{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;const t=e.strideHeight,s=e.strideWidth,r=e.padInfo.top,o=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${t} - ${r};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${s} - ${o};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}}class dee{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;const t=e.filterHeight,s=e.filterWidth,r=e.strideHeight,o=e.strideWidth,i=t-1-e.padInfo.top,a=s-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${t}; wR++) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${t} - 1 - wR;

          for (int wC = 0; wC < ${s}; wC++) {
            float dyC = float(dyCCorner + wC) / ${o}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${s} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,dy:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:d}=s,f=Nn(r.shape,d,i,a,l,u,!0),p=new hee(f);return t.runWebGLProgram(p,[r,o],"float32")}const pee={kernelName:Hy,backendName:"webgl",kernelFunc:fee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mee(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,filter:o}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:d}=s,f=Nn(d,o.shape,i,a,l,u,!0),p=new dee(f);return t.runWebGLProgram(p,[r,o],"float32")}const gee={kernelName:jy,backendName:"webgl",kernelFunc:mee};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xee{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yee(n){const{inputs:e,backend:t}=n,{x:s}=e,r=[...s.shape,...s.shape],o=ce(s.shape),i=ke({inputs:{x:s},backend:t,attrs:{shape:[o]}}),a=new xee(o),l=t.runWebGLProgram(a,[i],i.dtype),u=ke({inputs:{x:l},backend:t,attrs:{shape:r}});return t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(l),u}const wee={kernelName:uI,backendName:"webgl",kernelFunc:yee};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class vee{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;const{inHeight:t,inWidth:s,padInfo:r,strideHeight:o,strideWidth:i,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:d}=e,{top:f,left:p}=r;this.userCode=`
      const ivec2 strides = ivec2(${o}, ${i});
      const ivec2 pads = ivec2(${f}, ${p});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${t}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${d};

              if (wIn >= 0 && wIn < ${s}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function bee(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o}=e,{strides:i,pad:a,dilations:l}=s,u=lh(r.shape,o.shape,i,a,"NHWC",l);let d;const f=new vee(u);d=t.runWebGLProgram(f,[r,o],"float32");const p=ke({inputs:{x:d},backend:t,attrs:{shape:u.outShape}});return t.disposeIntermediateTensorInfo(d),p}const Cee={kernelName:Tp,backendName:"webgl",kernelFunc:bee};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function kee(n){const{inputs:e,backend:t,attrs:s}=n,{equation:r}=s,o=e,{allDims:i,summedDims:a,idDims:l}=mw(r,o.length);xw(i.length,l,o);const{path:u,steps:d}=yw(a,l),f=d.length;let p=null,g=i.length;const x=[];for(let w=0;w<f;++w){for(const v of d[w]){const{permutationIndices:b,expandDims:C}=gw(g,l[v]);let $;ww(b)?$=o[v]:($=qn({inputs:{x:o[v]},backend:t,attrs:{perm:b}}),x.push($));const S=$.shape.slice();for(let T=0;T<C.length;++T)S.splice(C[T],0,1);mt($.shape,S)||($=ke({inputs:{x:$},backend:t,attrs:{shape:S}}),x.push($)),p===null?p=$:(p=ov({inputs:{a:$,b:p},backend:t}),x.push(p))}w<f-1&&(u[w]>=0&&(p=Lm({inputs:{x:p},backend:t,attrs:{axis:u[w]-(i.length-g),keepDims:!1}}),x.push(p)),g--)}for(const w of x)w!==p&&t.disposeIntermediateTensorInfo(w);return p}const See={kernelName:Xy,backendName:"webgl",kernelFunc:kee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Iee="return (x >= 0.0) ? x : (exp(x) - 1.0);",$ee=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Tee=at({opSnippet:Iee,packedOpSnippet:$ee}),Nee={kernelName:Su,backendName:"webgl",kernelFunc:Tee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Eee="return (b >= 0.0) ? a : a * (b + 1.0);",Ree=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,Aee=n=>{const{inputs:e,backend:t}=n,{dy:s,y:r}=e,o=ie().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bl(Ree,s.shape,r.shape):new ca(Eee,s.shape,r.shape);return t.runWebGLProgram(o,[s,r],s.dtype)},Dee={kernelName:Ky,backendName:"webgl",kernelFunc:Aee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const _ee=`
  return vec4(equal(a, b));
`,Fee="return float(a == b);",Oee=Rn({opSnippet:Fee,packedOpSnippet:_ee,dtype:"bool",cpuKernelImpl:fY}),zee={kernelName:Np,backendName:"webgl",kernelFunc:Oee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mee=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${lw};
  float a1 = ${cw};
  float a2 = ${uw};
  float a3 = ${hw};
  float a4 = ${dw};
  float a5 = ${fw};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,Pee=at({opSnippet:Mee}),Lee={kernelName:Iu,backendName:"webgl",kernelFunc:Pee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bee=Vl+`
  return exp(x);
`,Vee=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,$A=at({opSnippet:Bee,packedOpSnippet:Vee,cpuKernelImpl:pY,dtype:"float32"}),Wee={kernelName:$u,backendName:"webgl",kernelFunc:$A};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function iy(n){const{inputs:e,attrs:t,backend:s}=n,{dim:r}=t,{input:o}=e,i=o.shape.length,a=o.shape.slice();let l=r;return r<0&&(O(-(i+1)<=r,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+r+1),a.splice(l,0,1),ke({inputs:{x:o},backend:s,attrs:{shape:a}})}const Uee={kernelName:Ep,backendName:"webgl",kernelFunc:iy};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const l2="return exp(x) - 1.0;",Gee=at({opSnippet:l2,packedOpSnippet:l2,cpuKernelImpl:mY}),Hee={kernelName:Tu,backendName:"webgl",kernelFunc:Gee};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class c2{constructor(e,t,s){this.variableNames=["real","imag"];const r=t[1];this.outputShape=t;const o=s?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=s?`${r}.0`:"1.0";let a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${o};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${r});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${r}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function TA(n,e,t){const s=t.texData.get(n.dataId),r=ce(n.shape),o=n.shape[n.shape.length-1],i=r/o,a=ke({inputs:{x:n},backend:t,attrs:{shape:[i,o]}}),l=a.shape,u=new c2("real",l,e),d=new c2("imag",l,e),f=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:l},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:l}],p=t.runWebGLProgram(u,f,"float32"),g=t.runWebGLProgram(d,f,"float32"),x=pi({inputs:{real:p,imag:g},backend:t});t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g);const w=ke({inputs:{x},backend:t,attrs:{shape:n.shape}});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(x),w}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function jee(n){const{inputs:e,backend:t}=n,{input:s}=e;return TA(s,!1,t)}const Xee={kernelName:qy,backendName:"webgl",kernelFunc:jee};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Kee{constructor(e,t){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Eh(n){const{backend:e,attrs:t}=n,{shape:s,value:r}=t;let{dtype:o}=t;if(o=o||Tl(r),o==="string"){const i=Ht(o,ce(s));return i.fill(r),e.makeTensorInfo(s,o,i)}else{const i=new Kee(s,r),a=[[r]];return e.runWebGLProgram(i,[],o,a)}}const qee={kernelName:Yy,backendName:"webgl",kernelFunc:Eh};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Yee{constructor(e){this.variableNames=["Image"],this.outputShape=[];const t=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${t} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${t}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qee={kernelName:Qy,backendName:"webgl",kernelFunc:({inputs:n,backend:e})=>{const{image:t}=n,s=e,r=new Yee(t.shape);return s.runWebGLProgram(r,[t],t.dtype)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const u2="return floor(x);",Zee=at({opSnippet:u2,packedOpSnippet:u2,cpuKernelImpl:gY}),Jee={kernelName:Nu,backendName:"webgl",kernelFunc:Zee};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ete=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,tte=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,nte=Rn({opSnippet:ete,packedOpSnippet:tte,dtype:"int32"}),ste={kernelName:Eu,backendName:"webgl",kernelFunc:nte};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class rte{constructor(e){this.variableNames=["A"];const t=Yn(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${r}.0, ${s}.0);

        vec4 values = ${t.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}}/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ote{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const t=Yn(),[s,r]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${r}.0, ${s}.0);
            vec4 values = ${t.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${t.output} = result;
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ite={kernelName:nM,backendName:"webgl",kernelFunc:ate};let Ka,lx=ie().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function ate(n){const{inputs:e,backend:t,attrs:s}=n;let{pixels:r}=e;const{numChannels:o}=s,i=typeof HTMLVideoElement<"u"&&r instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement,[l,u]=i?[r.videoWidth,r.videoHeight]:[r.width,r.height],d=[u,l],f=[u,l,o];if(a||i){const w=ie().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Ka==null||w!==lx)&&(lx=w,Ka=document.createElement("canvas").getContext("2d",{willReadFrequently:lx})),Ka.canvas.width=l,Ka.canvas.height=u,Ka.drawImage(r,0,0,l,u),r=Ka.canvas}const p=t.makeTensorInfo(d,"int32");t.texData.get(p.dataId).usage=Ns.PIXELS,t.gpgpu.uploadPixelDataToTexture(t.getTexture(p.dataId),r);const g=ie().getBool("WEBGL_PACK")?new ote(f):new rte(f),x=t.runWebGLProgram(g,[p],"int32");return t.disposeData(p.dataId),x}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lte(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:d,dilations:f,dimRoundingMode:p,activation:g,leakyreluAlpha:x}=s,w=wo(d),v=Nn(r.shape,o.shape,l,f,u,p,!1,w);let b;const C=[],$=i!=null,S=a!=null,T=g==="leakyrelu",E=()=>{const F=[r,o],D=(_,N)=>{if(N==="NCHW"&&_.shape.length===1&&_.shape[0]!==1){const L=ke({inputs:{x:_},backend:t,attrs:{shape:[_.shape[0],1,1]}});return C.push(L),L}return _};if($&&F.push(D(i,d)),S&&F.push(D(a,d)),T){const _=t.makeTensorInfo([],"float32",oi(x,"float32"));F.push(_),C.push(_)}return F};if(v.filterHeight===1&&v.filterWidth===1&&v.dilationHeight===1&&v.dilationWidth===1&&v.strideHeight===1&&v.strideWidth===1&&(v.padInfo.type==="SAME"||v.padInfo.type==="VALID"))b=bA({x:r,filter:o,convInfo:v,backend:t,bias:i,activation:g,preluActivationWeights:a,leakyreluAlpha:x});else if(v.strideWidth<=2&&w==="channelsLast"&&ie().getBool("WEBGL_EXP_CONV")){const F=g?ru(g,!0):null,D=new vA(v,$,F,S,T),_=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],N=E();b=t.runWebGLProgram(D,N,"float32",_)}else if(ie().getBool("WEBGL_CONV_IM2COL"))b=CA({x:r,filter:o,convInfo:v,backend:t,bias:i,activation:g,preluActivationWeights:a,leakyreluAlpha:x});else{const F=g?ru(g,!1):null,D=new wA(v,$,F,S,T),_=E();b=t.runWebGLProgram(D,_,"float32")}const A=ke({inputs:{x:b},backend:t,attrs:{shape:v.outShape}});return C.push(b),C.forEach(F=>t.disposeIntermediateTensorInfo(F)),A}const cte={kernelName:Rf,backendName:"webgl",kernelFunc:lte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ute(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,filter:o,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:d,dimRoundingMode:f,activation:p,leakyreluAlpha:g}=s,x=[];let w=d;w==null&&(w=[1,1]),O(zn(l,w),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${w}'`);const v=Nn(r.shape,o.shape,l,w,u,f,!0),b=ie().getBool("WEBGL_PACK_DEPTHWISECONV")&&v.strideWidth<=2&&v.outChannels/v.inChannels===1,C=p?ru(p,b):null,$=[r,o],S=i!=null,T=a!=null,E=p==="leakyrelu";if(S&&$.push(i),T&&$.push(a),E){const _=t.makeTensorInfo([],"float32",oi(g,"float32"));$.push(_),x.push(_)}let A;b?A=new IA(v,S,C,T,E):A=new SA(v,S,C,T,E);const F=[[v.padInfo.top,v.padInfo.left],[v.strideHeight,v.strideWidth],[v.dilationHeight,v.dilationWidth],[v.inHeight,v.inWidth]],D=t.runWebGLProgram(A,$,"float32",F);return x.forEach(_=>t.disposeIntermediateTensorInfo(_)),D}const hte={kernelName:EI,backendName:"webgl",kernelFunc:ute};class dte{constructor(e,t,s,r){this.sliceDim=e,this.strides=t,this.paramsShape=r,this.variableNames=["x","indices"],this.outputShape=s;const o=Ct(s.length);let i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${o} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function fte(n){const{inputs:e,backend:t}=n,{params:s,indices:r}=e,o=r.shape,i=o[o.length-1],a=ce(s.shape),[l,u,d,f]=Q1(s,r),p=ke({inputs:{x:r},backend:t,attrs:{shape:[u,i]}}),g=ke({inputs:{x:s},backend:t,attrs:{shape:[ce(s.shape)/d,d]}});if(t.shouldExecuteOnCPU([s,r])||s.dtype==="string"){const b=t.readSync(r.dataId),C=t.bufferSync(s),$=xY(b,C,s.dtype,u,i,d,f,s.shape,a);return t.makeTensorInfo(l,s.dtype,$.values)}const x=new dte(i,f,[u,d],s.shape),w=t.runWebGLProgram(x,[g,p],g.dtype),v=ke({inputs:{x:w},backend:t,attrs:{shape:l}});return t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(w),v}const pte={kernelName:hI,backendName:"webgl",kernelFunc:fte};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mte{constructor(e,t){this.variableNames=["A","indices"],this.outputShape=t,this.rank=t.length;const s=Ct(this.rank),r=gte(e);this.userCode=`
      void main() {
        ${s} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${r}));
      }
    `}}function gte(n,e){const t=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let r=0;r<n.length;r++)r===2?s.push("index"):s.push(`${t[r]}`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function NA(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,indices:o}=e,{axis:i,batchDims:a}=s,l=Je(i,r.shape)[0];if(ie().get("DEBUG")){const C=t.readSync(o.dataId),$=r.shape[l];for(let S=0;S<C.length;++S){const T=C[S];O(T<=$-1&&T>=0,()=>`GatherV2: the index value ${T} is not in [0, ${$-1}]`)}}const u=bw(r,o,l,a),d=ce(o.shape),f=[],p=ke({inputs:{x:r},backend:t,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),g=ke({inputs:{x:o},backend:t,attrs:{shape:[u.batchSize,d/u.batchSize]}});f.push(p),f.push(g);const x=[u.batchSize,u.outerSize,d/u.batchSize,u.sliceSize];if(t.shouldExecuteOnCPU([r,o])||r.dtype==="string"){const C=t.bufferSync(g),$=t.bufferSync(p),S=yY($,C,x);return f.forEach(T=>t.disposeIntermediateTensorInfo(T)),t.makeTensorInfo(u.outputShape,S.dtype,S.values)}const w=new mte(p.shape,x),v=t.runWebGLProgram(w,[p,g],p.dtype);f.push(v);const b=ke({inputs:{x:v},backend:t,attrs:{shape:u.outputShape}});return f.forEach(C=>t.disposeIntermediateTensorInfo(C)),b}const xte={kernelName:Ap,backendName:"webgl",kernelFunc:NA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yte="return float(a > b);",wte=`
  return vec4(greaterThan(a, b));
`,vte=Rn({opSnippet:yte,packedOpSnippet:wte,cpuKernelImpl:wY,dtype:"bool"}),bte={kernelName:Dp,backendName:"webgl",kernelFunc:vte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cte="return float(a >= b);",kte=`
  return vec4(greaterThanEqual(a, b));
`,Ste=Rn({opSnippet:Cte,packedOpSnippet:kte,dtype:"bool",cpuKernelImpl:vY}),Ite={kernelName:Ru,backendName:"webgl",kernelFunc:Ste};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $te(n){const{inputs:e,backend:t}=n,{input:s}=e;return TA(s,!0,t)}const Tte={kernelName:Zy,backendName:"webgl",kernelFunc:$te};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Nte="return float(!isnan(x) && !isinf(x));",Ete=at({opSnippet:Nte,dtype:"bool"}),Rte={kernelName:Du,backendName:"webgl",kernelFunc:Ete};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ate="return float(isinf(x));",Dte=at({opSnippet:Ate,dtype:"bool"}),_te={kernelName:_u,backendName:"webgl",kernelFunc:Dte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fte="return float(isnan(x));",Ote=at({opSnippet:Fte,dtype:"bool"}),zte={kernelName:Fu,backendName:"webgl",kernelFunc:Ote};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mte="return float(a < b);",Pte=`
  return vec4(lessThan(a, b));
`,Lte=Rn({opSnippet:Mte,packedOpSnippet:Pte,cpuKernelImpl:bY,dtype:"bool"}),Bte={kernelName:Fp,backendName:"webgl",kernelFunc:Lte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vte="return float(a <= b);",Wte=`
  return vec4(lessThanEqual(a, b));
`,Ute=Rn({opSnippet:Vte,packedOpSnippet:Wte,cpuKernelImpl:CY,dtype:"bool"}),Gte={kernelName:Op,backendName:"webgl",kernelFunc:Ute};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Hte(n){const{backend:e,attrs:t}=n,{start:s,stop:r,num:o}=t,i=kY(s,r,o);return e.makeTensorInfo([i.length],"float32",i)}const jte={kernelName:dI,backendName:"webgl",kernelFunc:Hte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Xte=Vl+`
  return x < 0.0 ? 0./0. : log(x);
`,Kte=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,qte=at({opSnippet:Xte,packedOpSnippet:Kte,cpuKernelImpl:SY}),Yte={kernelName:Ou,backendName:"webgl",kernelFunc:qte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qte=Vl+`
  return log(1.0 + x);
`,Zte=at({opSnippet:Qte}),Jte={kernelName:zu,backendName:"webgl",kernelFunc:Zte};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ene="return float(a >= 1.0 && b >= 1.0);",tne=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,nne=Rn({opSnippet:ene,packedOpSnippet:tne,dtype:"bool"}),sne={kernelName:zp,backendName:"webgl",kernelFunc:nne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const rne="return float(!(x >= 1.0));",one=at({opSnippet:rne}),ine={kernelName:Mp,backendName:"webgl",kernelFunc:one};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ane="return float(a >= 1.0 || b >= 1.0);",lne=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,cne=Rn({opSnippet:ane,packedOpSnippet:lne,dtype:"bool"}),une={kernelName:Pp,backendName:"webgl",kernelFunc:cne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class hne{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[];const i=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${u})`:o===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class dne{constructor(e,t,s,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const i=t,a=e[3]-1;this.outputShape=e;let l;const u=`float(${s}) + float(${r}) * sum`;o===.5?l=`inversesqrt(${u})`:o===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${o}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fne=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{depthRadius:o,bias:i,alpha:a,beta:l}=s,u=ie().getBool("WEBGL_PACK_NORMALIZATION")?new dne(r.shape,o,i,a,l):new hne(r.shape,o,i,a,l);return t.runWebGLProgram(u,[r],r.dtype)},pne={kernelName:Lp,backendName:"webgl",kernelFunc:fne};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class mne{constructor(e,t,s,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=t,this.bias=s,this.alpha=r,this.beta=o,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${t})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${t} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${r}) * norm + float(${s});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${r})
                * float(${o})
                * getInputImage(b, r, c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${o});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gne=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r,y:o,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:d}=s,f=new mne(r.shape,a,l,u,d);return t.runWebGLProgram(f,[r,o,i],r.dtype)},xne={kernelName:e1,backendName:"webgl",kernelFunc:gne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function yne(n,e,t,s){const r=ce(e),i=ce(n.shape)/r,a=ke({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),l=va(a,n.dtype,"max",s),u=ke({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function EA(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reductionIndices:o,keepDims:i}=s,a=r.shape.length,l=Je(o,r.shape);let u=l;const d=Bt(u,a),f=d!=null,p=t.shouldExecuteOnCPU([r]);let g=r;if(f){if(p){const $=t.texData.get(g.dataId).values,S=new Array(a);for(let A=0;A<S.length;A++)S[A]=r.shape[d[A]];const T=sv($,r.shape,r.dtype,d,S);g=t.makeTensorInfo(S,r.dtype);const E=t.texData.get(g.dataId);E.values=T}else g=Pm(r,d,t);u=Kt(u.length,a)}En("max",u,a);const[x,w]=wn(g.shape,u);let v=x;i&&(v=tn(x,l));let b;if(p){const $=t.texData.get(g.dataId).values,S=IY($,ce(w),v,r.dtype);b=t.makeTensorInfo(v,r.dtype);const T=t.texData.get(b.dataId);T.values=S}else b=yne(g,w,v,t);return f&&t.disposeIntermediateTensorInfo(g),b}const wne={kernelName:Bp,backendName:"webgl",kernelFunc:EA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vne=rv+`
  return max(a, b);
`,bne=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+wa+`
  return result;
`,Cne=Rn({opSnippet:vne,packedOpSnippet:bne,cpuKernelImpl:$Y}),kne={kernelName:Mu,backendName:"webgl",kernelFunc:Cne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;$h(r,"maxPool");const{filterSize:o,strides:i,pad:a,dimRoundingMode:l}=s,u=1;O(zn(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);const d=Js(r.shape,o,i,u,a,l);if(d.filterWidth===1&&d.filterHeight===1&&mt(d.inShape,d.outShape))return ws({inputs:{x:r},backend:t});const f=new ou(d,"max",!1);return t.runWebGLProgram(f,[r],r.dtype)}const Ine={kernelName:Vp,backendName:"webgl",kernelFunc:Sne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $ne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{filterSize:o,strides:i,pad:a,dataFormat:l,dimRoundingMode:u}=s,d=[1,1,1],f=yo(r.shape,o,i,d,a,u,l),p=new iv(f,"max",!1);return t.runWebGLProgram(p,[r],r.dtype)}const Tne={kernelName:Wp,backendName:"webgl",kernelFunc:$ne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nne{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideHeight,s=e.strideWidth,r=e.dilationHeight,o=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=o-1-e.padInfo.top,l=i-1-e.padInfo.left,u=o*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${o};
          wR += ${r}) {
          float dyR = float(dyRCorner + wR) / ${t}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}}class Ene{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;const t=e.strideDepth,s=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,d=e.effectiveFilterWidth,f=l-1-e.padInfo.front,p=u-1-e.padInfo.top,g=d-1-e.padInfo.left,x=l*u*d-1;this.userCode=`
      const ivec3 pads = ivec3(${f}, ${p}, ${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${o}) {
          float dyD = float(dyDCorner + wD) / ${t}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${s}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${r}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${x} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${d} +
                  wR * ${d} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Rne(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o}=e,i=o,{filterSize:a,strides:l,pad:u,dimRoundingMode:d}=s,f=[1,1,1],p=yo(i.shape,a,l,f,u,d),g=new iv(p,"max",!0),x=t.runWebGLProgram(g,[i],i.dtype),w=new Ene(p),v=t.runWebGLProgram(w,[r,x],i.dtype);return t.disposeIntermediateTensorInfo(x),v}const Ane={kernelName:n1,backendName:"webgl",kernelFunc:Rne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dne(n){const{inputs:e,backend:t,attrs:s}=n,{dy:r,input:o,output:i}=e,a=o;$h([o,i],"maxPoolGrad");const{filterSize:l,strides:u,pad:d,dimRoundingMode:f}=s,p=Js(a.shape,l,u,1,d,f),g=!0,x=new ou(p,"max",g),w=t.runWebGLProgram(x,[a],a.dtype),v=new Nne(p),b=t.runWebGLProgram(v,[r,w],a.dtype);return t.disposeIntermediateTensorInfo(w),b}const _ne={kernelName:t1,backendName:"webgl",kernelFunc:Dne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Fne(n,e,t,s){let r=new ou(t,"max",!1);const o=s.runWebGLProgram(r,[n],"float32");r=new ou(t,"max",!0,!0,e);const i=s.runWebGLProgram(r,[n],"float32");return[o,i]}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const One={kernelName:fI,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{filterSize:r,strides:o,pad:i,includeBatchInIndex:a}=e,l=t;O(s.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`);const u=[1,1];O(zn(o,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${u}'`);const d=Js(s.shape,r,o,u,i),[f,p]=Fne(s,a,d,l);return[f,p]}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zne(n,e,t,s){const r=ce(e),i=ce(n.shape)/r,a=ke({inputs:{x:n},attrs:{shape:[i,r]},backend:s}),l=va(a,"float32","mean",s),u=ke({inputs:{x:l},attrs:{shape:t},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(l),u}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mne={kernelName:Up,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{x:s}=n,{keepDims:r,axis:o}=e,i=t,a=s.shape.length,l=Je(o,s.shape);let u=l;const d=Bt(u,a),f=d!=null,p=i.shouldExecuteOnCPU([s]),g=[];let x=s;if(f){if(p){const S=i.texData.get(x.dataId).values,T=new Array(a);for(let F=0;F<T.length;F++)T[F]=s.shape[d[F]];const E=sv(S,s.shape,s.dtype,d,T);x=i.makeTensorInfo(T,s.dtype);const A=i.texData.get(x.dataId);A.values=E}else x=Pm(s,d,i);g.push(x),u=Kt(u.length,a)}En("sum",u,a);const[w,v]=wn(x.shape,u);let b=w;r&&(b=tn(w,l));const C=zne(x,v,b,i);for(const $ of g)i.disposeIntermediateTensorInfo($);return C}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Pne(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=Je(o,r.shape);let u=l;const d=Bt(u,a);let f=r;d!=null&&(f=qn({inputs:{x:r},backend:t,attrs:{perm:d}}),u=Kt(u.length,r.shape.length)),En("min",u,a);const[p,g]=wn(f.shape,u),x=ce(g),w=ke({inputs:{x:f},backend:t,attrs:{shape:[-1,x]}}),v=va(w,w.dtype,"min",t);let b;if(i){const C=tn(p,l);b=ke({inputs:{x:v},backend:t,attrs:{shape:C}})}else b=ke({inputs:{x:v},backend:t,attrs:{shape:p}});return t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(v),d!=null&&t.disposeIntermediateTensorInfo(f),b}const Lne={kernelName:Gp,backendName:"webgl",kernelFunc:Pne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Bne=rv+`
  return min(a, b);
`,Vne=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+wa+`
  return result;
`,Wne=Rn({opSnippet:Bne,packedOpSnippet:Vne,cpuKernelImpl:TY}),Une={kernelName:Pu,backendName:"webgl",kernelFunc:Wne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Gne{constructor(e,t,s){this.variableNames=["x"],this.outputShape=t.map((d,f)=>d[0]+e[f]+d[1]);const r=e.length,o=Ct(r),i=t.map(d=>d[0]).join(","),a=t.map((d,f)=>d[0]+e[f]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r),u=s==="reflect"?0:1;if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        for (int i = 0; i < ${r}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${o} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Hne{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.map((x,w)=>x[0]+e[w]+x[1]);const r=e.length,o=Ct(r),i=t.map(x=>x[0]).join(","),a=t.map((x,w)=>x[0]+e[w]).join(","),l=Hn("rc",r),u=Hn("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,p=s==="reflect"?0:1;let g="";if(r===1){const x=`
        ${o} source = rc;
        if (source < start) {
          source = start * 2 - source - ${p};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${p};
        }
        source -= start;
      `;g=`
        ${o} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${x}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
      `}else{const x=`
        ${o} source = rc;
        ${o} lt = ${o}(lessThan(source, start));
        ${o} gte = ${o}(greaterThanEqual(source, end));
        ${o} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${p}) +
                gte * ((end - 1) * 2 - source + ${p});
        source -= start;
      `;g=`
        ${o} rc = outputLoc;
        ${x}
        result[0] = getChannel(getX(${u.join()}), ${f});
        ${l[r-1]} += 1;
        if(${d}) {
          ${x}
          result[1] = getChannel(getX(${u.join()}), ${f});
        }
        rc = outputLoc;
        ${l[r-2]} += 1;
        if(${l[r-2]} < ${this.outputShape[r-2]}) {
          ${x}
          result[2] = getChannel(getX(${u.join()}), ${f});
          ${l[r-1]} += 1;
          if(${d}) {
            ${x}
            result[3] = getChannel(getX(${u.join()}), ${f});
          }
        }
      `}this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${g}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const jne=({inputs:n,backend:e,attrs:t})=>{const{x:s}=n,{paddings:r,mode:o}=t,i=ie().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Hne(s.shape,r,o):new Gne(s.shape,r,o);return e.runWebGLProgram(i,[s],s.dtype)},Xne={kernelName:Hp,backendName:"webgl",kernelFunc:jne};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kne=`if (b == 0.0) return NAN;
  return mod(a, b);`,qne=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+wa+`
  return result;
`,Yne=Rn({opSnippet:Kne,packedOpSnippet:qne}),Qne={kernelName:Lu,backendName:"webgl",kernelFunc:Yne};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Zne{constructor(e,t,s){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,s],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${t-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${t-1}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Jne=`
if (a == b) {
  return 1.0;
};
return a / b;`,ese=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,RA=Rn({opSnippet:Jne,packedOpSnippet:ese,checkOutOfBounds:!0}),tse={kernelName:ku,backendName:"webgl",kernelFunc:RA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const h2="return a - b;",AA=Rn({opSnippet:h2,packedOpSnippet:h2,supportsComplex:!0,cpuKernelImpl:KY}),nse={kernelName:th,backendName:"webgl",kernelFunc:AA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function DA(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{dim:o}=s,i=Je([o],r.shape),a=EA({inputs:{x:r},backend:t,attrs:{reductionIndices:i,keepDims:!1}}),l=tn(a.shape,i),u=ke({inputs:{x:a},backend:t,attrs:{shape:l}}),d=AA({inputs:{a:r,b:u},backend:t}),f=$A({inputs:{x:d},backend:t}),p=Lm({inputs:{x:f},backend:t,attrs:{axis:i,keepDims:!1}}),g=ke({inputs:{x:p},backend:t,attrs:{shape:l}}),x=RA({inputs:{a:f,b:g},backend:t});return t.disposeIntermediateTensorInfo(a),t.disposeIntermediateTensorInfo(u),t.disposeIntermediateTensorInfo(d),t.disposeIntermediateTensorInfo(f),t.disposeIntermediateTensorInfo(p),t.disposeIntermediateTensorInfo(g),x}const sse={kernelName:cm,backendName:"webgl",kernelFunc:DA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rse(n){const{inputs:e,backend:t,attrs:s}=n,{logits:r}=e,{numSamples:o,seed:i,normalized:a}=s,l=a?r:DA({inputs:{logits:r},backend:t,attrs:{dim:r.shape.length-1}}),u=l.shape[0],d=l.shape[1],f=new Zne(u,d,o),p=[[i]],g=t.runWebGLProgram(f,[l],"int32",p);return a||t.disposeIntermediateTensorInfo(l),g}const ose={kernelName:pI,backendName:"webgl",kernelFunc:rse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const ise=tr+`
  return -x;
`,ase=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function lse(n){const{inputs:e,backend:t}=n,{x:s}=e;if(t.shouldExecuteOnCPU([s])){const o=t.texData.get(s.dataId),[i,a]=EY(o.values,s.shape,s.dtype);return t.makeTensorInfo(a,s.dtype,i)}let r;return ie().getBool("WEBGL_PACK_UNARY_OPERATIONS")?r=new Ho(s.shape,ase):r=new zr(s.shape,ise),t.runWebGLProgram(r,[s],s.dtype)}const cse={kernelName:jp,backendName:"webgl",kernelFunc:lse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const use=H1;function hse(n){Ts("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=s,u=t.readSync(r.dataId),d=t.readSync(o.dataId),{selectedIndices:f}=use(u,d,i,a,l);return t.makeTensorInfo([f.length],"int32",new Int32Array(f))}const dse={kernelName:s1,backendName:"webgl",kernelFunc:hse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const fse=j1;function pse(n){Ts("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=s,d=t.readSync(r.dataId),f=t.readSync(o.dataId),{selectedIndices:p,validOutputs:g}=fse(d,f,i,a,l,u);return[t.makeTensorInfo([p.length],"int32",new Int32Array(p)),t.makeTensorInfo([],"int32",new Int32Array([g]))]}const mse={kernelName:r1,backendName:"webgl",kernelFunc:pse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const gse=X1;function xse(n){Ts("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:t,attrs:s}=n,{boxes:r,scores:o}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=s,d=t.readSync(r.dataId),f=t.readSync(o.dataId),p=i,g=a,x=l,w=u,{selectedIndices:v,selectedScores:b}=gse(d,f,p,g,x,w);return[t.makeTensorInfo([v.length],"int32",new Int32Array(v)),t.makeTensorInfo([b.length],"float32",new Float32Array(b))]}const yse={kernelName:o1,backendName:"webgl",kernelFunc:xse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class wse{constructor(e,t,s,r){this.variableNames=["indices"],this.outputShape=[e,t],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${r}), float(${s}),
                      float(index == coords.y)));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const vse=n=>{const{inputs:e,backend:t,attrs:s}=n,{indices:r}=e,{dtype:o,depth:i,onValue:a,offValue:l}=s,u=ce(r.shape),d=new wse(u,i,a,l),f=ke({inputs:{x:r},backend:t,attrs:{shape:[u]}}),p=t.runWebGLProgram(d,[f],o);t.disposeIntermediateTensorInfo(f);const g=[...r.shape,i],x=ke({inputs:{x:p},backend:t,attrs:{shape:g}});return t.disposeIntermediateTensorInfo(p),x},bse={kernelName:qp,backendName:"webgl",kernelFunc:vse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sp(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="complex64"){const r=Nh({inputs:{input:s},backend:t}),o=sp({inputs:{x:r},backend:t}),i=Bm({inputs:{input:s},backend:t}),a=sp({inputs:{x:i},backend:t}),l=pi({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return Eh({attrs:{shape:s.shape,dtype:s.dtype,value:s.dtype==="string"?"":0},backend:t})}const Cse={kernelName:dm,backendName:"webgl",kernelFunc:sp};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _A(n){const{inputs:e,backend:t}=n,{x:s}=e;if(s.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(s.dtype==="complex64"){const r=Nh({inputs:{input:s},backend:t}),o=_A({inputs:{x:r},backend:t}),i=Bm({inputs:{input:s},backend:t}),a=sp({inputs:{x:i},backend:t}),l=pi({inputs:{real:o,imag:a},backend:t});return t.disposeIntermediateTensorInfo(r),t.disposeIntermediateTensorInfo(o),t.disposeIntermediateTensorInfo(i),t.disposeIntermediateTensorInfo(a),l}else return Eh({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:t})}const kse={kernelName:Kp,backendName:"webgl",kernelFunc:_A};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Sse(n){const{inputs:e,backend:t,attrs:s}=n,{axis:r}=s;if(e.length===1)return iy({inputs:{input:e[0]},backend:t,attrs:{dim:r}});const o=e[0].shape,i=e[0].dtype;e.forEach(d=>{Iy(o,d.shape,"All tensors passed to stack must have matching shapes"),O(i===d.dtype,()=>"All tensors passed to stack must have matching dtypes")});const a=[],l=e.map(d=>{const f=iy({inputs:{input:d},backend:t,attrs:{dim:r}});return a.push(f),f}),u=yA({inputs:l,backend:t,attrs:{axis:r}});return a.forEach(d=>t.disposeIntermediateTensorInfo(d)),u}const Ise={kernelName:Yp,backendName:"webgl",kernelFunc:Sse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class $se{constructor(e,t,s){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((u,d)=>u[0]+e[d]+u[1]);const r=e.length,o=Ct(r),i=t.map(u=>u[0]).join(","),a=t.map((u,d)=>u[0]+e[d]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);if(r===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${o} start = ${o}(${i});
      ${o} end = ${o}(${a});

      void main() {
        ${o} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${o} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Tse{constructor(e,t,s){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=t.map((w,v)=>w[0]+e[v]+w[1]);const r=e.length,o=Ct(r),i=t.map(w=>w[0]).join(","),a=t.map((w,v)=>w[0]+e[v]).join(","),l=Hn("rc",r),u=Hn("source",r),d=`${l[r-1]} < ${this.outputShape[r-1]}`,f=r===1?"source":`vec2(${u.slice(-2).join()})`,p=[`${o} rc = outputLoc;`,`${l[r-1]} += 1;
       if(${d}) {
      `,r===1?"":`}
       rc = outputLoc;
       ${l[r-2]} += 1;
       if(${l[r-2]} < ${this.outputShape[r-2]}) {`,r===1?"":`  ${l[r-1]} += 1;
         if(${d}) {`],g=r===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let x="";for(let w=0,v=r===1?2:4;w<v;w++)x+=`
        ${p[w]}
        if (${g}) {
          result[${w}] = float(value);
        } else {
          ${o} source = rc - start;
          result[${w}] = getChannel(getX(${u.join()}), ${f});
        }
      `;x+=r===1?"} ":"}}",this.userCode=`
      const ${o} start = ${o}(${i});
      const ${o} end = ${o}(${a});

      void main() {
        ${o} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${x}
        setOutput(result);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const FA=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{paddings:o,constantValue:i}=s;if(ce(r.shape)===0){const u=o.map((d,f)=>d[0]+r.shape[f]+d[1]);return Eh({backend:t,attrs:{shape:u,value:i,dtype:r.dtype}})}const a=ie().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Tse(r.shape,o,i):new $se(r.shape,o,i),l=[[i]];return t.runWebGLProgram(a,[r],r.dtype,l)},Nse={kernelName:Qp,backendName:"webgl",kernelFunc:FA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Ese=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Rse=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+wa+`
  return result;
`,Ase=Rn({opSnippet:Ese,packedOpSnippet:Rse}),Dse={kernelName:Vu,backendName:"webgl",kernelFunc:Ase};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function _se(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{axis:o,keepDims:i}=s,a=r.shape.length,l=[],u=Je(o,r.shape);let d=u;const f=Bt(d,a);let p=r;f!=null&&(p=qn({inputs:{x:r},backend:t,attrs:{perm:f}}),d=Kt(d.length,a),l.push(p)),En("prod",d,a);let g;if(t.shouldExecuteOnCPU([p])){const x=t.texData.get(p.dataId).values,{outVals:w,outShape:v,outDtype:b}=AY(p.shape,p.dtype,x,d);g=t.makeTensorInfo(v,b,w)}else{const[x,w]=wn(p.shape,d),v=ce(w),b=ke({inputs:{x:p},backend:t,attrs:{shape:[-1,v]}}),C=x1(r.dtype),$=va(b,C,"prod",t);g=ke({inputs:{x:$},backend:t,attrs:{shape:x}}),l.push(b),l.push($)}if(i){l.push(g);const x=tn(g.shape,u);g=ke({inputs:{x:g},backend:t,attrs:{shape:x}})}return l.forEach(x=>t.disposeIntermediateTensorInfo(x)),g}const Fse={kernelName:Jp,backendName:"webgl",kernelFunc:_se};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ose(n){const{inputs:e,backend:t,attrs:s}=n,{paramsNestedSplits:r,paramsDenseValues:o,indices:i}=e,{outputRaggedRank:a}=s,l=r.map(b=>t.readSync(b.dataId)),u=r.map(b=>b.shape),d=t.readSync(o.dataId),f=t.readSync(i.dataId),[p,g,x]=DY(l,u,d,o.shape,o.dtype,f,i.shape,a),w=p.map(b=>t.makeTensorInfo([b.length],"int32",b)),v=t.makeTensorInfo(x,o.dtype,g);return w.concat([v])}const zse={kernelName:mI,backendName:"webgl",kernelFunc:Ose};/**
 * @license
 * Copyright 2022 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Mse(n){const{inputs:e,backend:t}=n,{starts:s,limits:r,deltas:o}=e,i=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(o.dataId),[u,d]=_Y(i,s.shape,s.dtype,a,r.shape,l,o.shape),f=t.makeTensorInfo([u.length],"int32",u),p=t.makeTensorInfo([d.length],s.dtype,d);return[f,p]}const Pse={kernelName:gI,backendName:"webgl",kernelFunc:Mse};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Lse(n){const{inputs:e,backend:t,attrs:s}=n,{shape:r,values:o,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=s,u=t.readSync(r.dataId),d=t.readSync(o.dataId),f=t.readSync(i.dataId),p=a.map(v=>t.readSync(v.dataId)),g=a.map(v=>v.shape),[x,w]=FY(u,r.shape,d,o.shape,o.dtype,f,i.shape,p,g,l);return t.makeTensorInfo(x,o.dtype,w)}const Bse={kernelName:xI,backendName:"webgl",kernelFunc:Lse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const OA=n=>{const{backend:e,attrs:t}=n,{start:s,stop:r,step:o,dtype:i}=t,a=OY(s,r,o,i);return e.makeTensorInfo([a.length],i,a)},Vse={kernelName:i1,backendName:"webgl",kernelFunc:OA};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Wse="return 1.0 / x;",Use=at({opSnippet:Wse}),Gse={kernelName:Wu,backendName:"webgl",kernelFunc:Use};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Hse=tr+`
  return (x < 0.0) ? 0.0 : x;
`,jse=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Xse=at({opSnippet:Hse,packedOpSnippet:jse}),Kse={kernelName:Uu,backendName:"webgl",kernelFunc:Xse};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const qse=tr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Yse=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Qse=at({opSnippet:qse,packedOpSnippet:Yse}),Zse={kernelName:Gu,backendName:"webgl",kernelFunc:Qse};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Jse{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;o?p="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":p="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ere{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s];let p;o?p="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":p="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${p};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function tre(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[l,u]=a,d=ie().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new ere(r.shape,l,u,o,i):new Jse(r.shape,l,u,o,i);return t.runWebGLProgram(d,[r],"float32")}const nre={kernelName:nm,backendName:"webgl",kernelFunc:tre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class sre{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,a]=e,l=[s&&i>1?r-1:r,s&&a>1?o-1:o],u=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],p=1/d,g=1/f,x=Math.ceil(p)*2+2,w=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${x});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${r-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${o-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function rre(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,a=new sre(o.shape,r.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const ore={kernelName:c1,backendName:"webgl",kernelFunc:rre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ire{constructor(e,t,s,r,o){this.variableNames=["A"],this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let g;o?g="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":g="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${d[0]/f[0]},
          ${d[1]/f[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class are{constructor(e,t,s,r,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[i,a,l,u]=e;this.outputShape=[i,t,s,u];const d=[r&&t>1?a-1:a,r&&s>1?l-1:l],f=[r&&t>1?t-1:t,r&&s>1?s-1:s],p=r?"0.5":"0.0";let g;o?g="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":g="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${d[0]/f[0]},
          ${d[1]/f[1]},
          ${d[1]/f[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${g};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${p})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${s-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function lre(n){const{inputs:e,backend:t,attrs:s}=n,{images:r}=e,{alignCorners:o,halfPixelCenters:i,size:a}=s,[l,u]=a,d=ie().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new are(r.shape,l,u,o,i):new ire(r.shape,l,u,o,i);return t.runWebGLProgram(d,[r],r.dtype)}const cre={kernelName:tm,backendName:"webgl",kernelFunc:lre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class ure{constructor(e,t,s){this.variableNames=["dy"],this.outputShape=[],this.outputShape=t;const[,r,o]=t,[,i,a]=e,l=[s&&i>1?r-1:r,s&&a>1?o-1:o],u=[s&&i>1?i-1:i,s&&a>1?a-1:a],d=l[0]/u[0],f=l[1]/u[1],p=1/d,g=1/f,x=Math.ceil(p)*2+2,w=Math.ceil(g)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${d});
        const float widthScale = float(${f});

        const float invHeightScale = float(${p});
        const float invWidthScale = float(${g});

        const int winHeight = int(${x});
        const int winWidth = int(${w});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${r}) - 1),
                ${s} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${o}) - 1),
                ${s} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function hre(n){const{inputs:e,backend:t,attrs:s}=n,{images:r,dy:o}=e,{alignCorners:i}=s,a=new ure(o.shape,r.shape,i);return t.runWebGLProgram(a,[o],o.dtype)}const dre={kernelName:l1,backendName:"webgl",kernelFunc:hre};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class fre{constructor(e,t){this.variableNames=["x"];const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);if(this.outputShape=e,s===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}const r=a=>t.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,o=e.map((a,l)=>r(l)).join(","),i=Ct(s);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${o}));
      }
    `}}/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class pre{constructor(e,t){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const s=e.length;if(s>4)throw new Error(`WebGL backend: Reverse of rank-${s} tensor is not yet supported`);this.outputShape=e;const r=Hn("rc",s),o=`${r[s-1]} + 1 < ${this.outputShape[s-1]}`,i=`${r[s-2]} + 1 < ${this.outputShape[s-2]}`,a=Ct(s);s===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${o}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(r.slice())};
          if(${o}){
            result.g = ${u(r.slice())};
          }
          if(${i}) {
            result.b = ${d(r.slice())};
            if(${o}) {
              result.a = ${f(r.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(x){return p(x)}function u(x){return x[s-1]="("+x[s-1]+" + 1)",p(x)}function d(x){return x[s-2]="("+x[s-2]+" + 1)",p(x)}function f(x){return x[s-1]="("+x[s-1]+" + 1)",x[s-2]="("+x[s-2]+" + 1)",p(x)}function p(x){const w=e.map((C,$)=>g($,x)),v=w.join(","),b=w.slice(-2).join(",");return`getChannel(getX(${v}), vec2(${b}))`}function g(x,w){return t.indexOf(x)!==-1&&e[x]!==1?`${e[x]} - ${w[x]} - 1`:`${w[x]}`}}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function mre(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{dims:o}=s,i=r.shape.length,a=Je(o,r.shape);if(i===0)return ws({inputs:{x:r},backend:t});const l=ie().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new pre(r.shape,a):new fre(r.shape,a);return t.runWebGLProgram(l,[r],r.dtype)}const gre={kernelName:sm,backendName:"webgl",kernelFunc:mre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class xre{constructor(e,t){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];const s=e[1],r=e[2];this.outputShape=e;let o="";typeof t=="number"?o=`float outputValue = ${t.toFixed(2)};`:o=`
        vec3 fill = vec3(${t.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${o}
          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${s}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const yre={kernelName:g1,backendName:"webgl",kernelFunc:({inputs:n,attrs:e,backend:t})=>{const{image:s}=n,{radians:r,fillValue:o,center:i}=e,a=t,l=new xre(s.shape,o),[u,d]=ow(i,s.shape[1],s.shape[2]),f=[[u,d,Math.sin(r),Math.cos(r)]];return a.runWebGLProgram(l,[s],s.dtype,f)}};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const wre=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,vre=at({opSnippet:wre}),bre={kernelName:Hu,backendName:"webgl",kernelFunc:vre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Cre="return inversesqrt(x);",kre=at({opSnippet:Cre,cpuKernelImpl:zY}),Sre={kernelName:ju,backendName:"webgl",kernelFunc:kre};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class av{constructor(e,t,s,r,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;const u=Ct(o.length),d=Ct(i.length);let f="";s===1?f="i":s===2&&(f="i, j");const p=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const x=`getUpdates(${g})`;let w="";l&&(w="coords[0], coords[1]");const v=`getDefaultValue(${w})`,b=t>1?"strides[j]":"strides";this.userCode=`
        ${u} strides = ${u}(${o});

        void main() {
          ${d} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${t}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${b};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${x};
              found = true;
            }
          }
          setOutput(mix(${v}, sum, float(found)));
        }
      `}}/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ire{constructor(e,t,s,r,o,i,a=!0,l=!1){this.variableNames=["updates","indices","defaultValue"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=i;const u=Ct(o.length),d=Ct(i.length);let f="";s===1?f="i":s===2&&(f="i, j");const p=`getIndices(${f})`;let g="";r===1?g="i":r===2&&(g="i, coords[1]");const x=`getUpdates(${g})`;let w="";l&&(w="coords[0], coords[1]");const v=`getDefaultValue(${w})`,b=t>1?"strides[j]":"strides",C=t>1?"strides[j + 1]":"strides";this.userCode=`
        ${u} strides = ${u}(${o});

        void main() {
          ${d} coords = getOutputCoords();
          vec4 sum = vec4(0.);
          vec4 found = vec4(0.);
          for (int i = 0; i < ${e}; i+=2) {
            ivec2 flattenedIndex = ivec2(0);
            for (int j = 0; j < ${t}; j+=2) {
              ivec4 index = round(${p});
              flattenedIndex += index.xz * ${b};
              if (j + 1 < ${t}) {
                flattenedIndex += index.yw * ${C};
              }
            }
            if (flattenedIndex[0] == coords[0] || flattenedIndex[1] == coords[0] ||
                flattenedIndex[0] == coords[0] + 1 || flattenedIndex[1] == coords[0] + 1) {
              vec4 updVals = ${x};
              if (flattenedIndex[0] == coords[0]) {
                sum.xy += updVals.xy;
                found.xy = vec2(1.);
              } else if (flattenedIndex[0] == coords[0] + 1) {
                sum.zw += updVals.xy;
                found.zw = vec2(1.);
              }
              if (flattenedIndex[1] == coords[0]) {
                sum.xy += updVals.zw;
                found.xy = vec2(1.);
              } else if (flattenedIndex[1] == coords[0] + 1) {
                sum.zw += updVals.zw;
                found.zw = vec2(1.);
              }
            }
          }
          setOutput(mix(${v}, sum, found));
        }
      `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $re(n){const{inputs:e,backend:t,attrs:s}=n,{indices:r,updates:o}=e,{shape:i}=s,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=pa(o,r,i),p=[f/u,u];if(f===0)return t.makeTensorInfo(i,r.dtype);const g=ke({inputs:{x:r},backend:t,attrs:{shape:[l,a]}}),x=ke({inputs:{x:o},backend:t,attrs:{shape:[l,u]}}),w=t.makeTensorInfo([],"float32",new Float32Array([0]));let v;ie().getBool("WEBGL_PACK")?v=new Ire(l,a,g.shape.length,x.shape.length,d,p):v=new av(l,a,g.shape.length,x.shape.length,d,p);const b=t.runWebGLProgram(v,[x,g,w],x.dtype),C=ke({inputs:{x:b},backend:t,attrs:{shape:i}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(b),t.disposeIntermediateTensorInfo(w),C}const Tre={kernelName:yI,backendName:"webgl",kernelFunc:$re};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Nre{constructor(e,t,s,r){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,s];const o="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(t+1))}; ++i) { if (left >= right) break;`,a=ie().getNumber("WEBGL_VERSION")===2?o:i,l=r==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}}/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ere(n){const{inputs:e,backend:t,attrs:s}=n,{sortedSequence:r,values:o}=e,{side:i}=s,a=new Nre(r.shape[0],r.shape[1],o.shape[1],i),l=[[r.shape[1]]];return t.runWebGLProgram(a,[r,o],"int32",l)}const Rre={kernelName:vI,backendName:"webgl",kernelFunc:Ere};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Are{constructor(e,t,s){this.variableNames=["c","a","b"],this.outputShape=t;let r,o;if(s>4)throw Error(`Where for rank ${s} is not yet supported`);if(s===1)o="resRC",r="resRC";else{const a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let d=0;d<t.length;d++)u.push(`${a[d]}`),d<e&&l.push(`${a[d]}`);r=l.join(),o=u.join()}const i=Ct(s);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${r});
        if (cVal >= 1.0) {
          setOutput(getA(${o}));
        } else {
          setOutput(getB(${o}));
        }
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Dre(n){const{inputs:e,backend:t}=n,{condition:s,t:r,e:o}=e,i=new Are(s.shape.length,r.shape,r.shape.length);return t.runWebGLProgram(i,[s,r,o],xs(r.dtype,o.dtype))}const _re={kernelName:rm,backendName:"webgl",kernelFunc:Dre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Fre=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${Cm};
  float scale = ${km};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,Ore=at({opSnippet:Fre}),zre={kernelName:Xu,backendName:"webgl",kernelFunc:Ore};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Mre=Vl+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,Pre=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Lre=at({opSnippet:Mre,packedOpSnippet:Pre,cpuKernelImpl:PY}),Bre={kernelName:Qu,backendName:"webgl",kernelFunc:Lre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Vre=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,Wre=at({opSnippet:Vre}),Ure={kernelName:Yu,backendName:"webgl",kernelFunc:Wre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Gre=Vl+`
  return sin(x);
`,Hre=`
  vec4 result = sin(x);
  bvec4 isNaN = isnan(x);
  ${wa}
  return result;
`,jre=at({opSnippet:Gre,packedOpSnippet:Hre}),Xre={kernelName:Ku,backendName:"webgl",kernelFunc:jre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Kre=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,qre=at({opSnippet:Kre}),Yre={kernelName:qu,backendName:"webgl",kernelFunc:qre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Qre=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,Zre=at({opSnippet:Qre}),Jre={kernelName:Zu,backendName:"webgl",kernelFunc:Zre};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const eoe=n=>{const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{blockShape:o,paddings:i}=s;O(r.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");const a=o.reduce((b,C)=>b*C),l=[[0,0]];l.push(...i);for(let b=1+o.length;b<r.shape.length;++b)l.push([0,0]);const u=[],d=FA({inputs:{x:r},backend:t,attrs:{paddings:l,constantValue:0}}),f=fh(d.shape,o,a,!1),p=ph(f.length,o.length,!1),g=mh(d.shape,o,a,!1),x=ke({inputs:{x:d},backend:t,attrs:{shape:f}}),w=qn({inputs:{x},backend:t,attrs:{perm:p}}),v=ke({inputs:{x:w},backend:t,attrs:{shape:g}});return u.push(d),u.push(x),u.push(w),u.forEach(b=>t.disposeIntermediateTensorInfo(b)),v},toe={kernelName:am,backendName:"webgl",kernelFunc:eoe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function noe(n){const{inputs:e,backend:t}=n,{indices:s,values:r,denseShape:o,defaultValue:i}=e;if(o.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${o.shape}`);if(s.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${s.shape}`);if(r.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${r.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);const a=t.readSync(s.dataId),l=t.readSync(r.dataId),u=t.readSync(o.dataId),d=t.readSync(i.dataId)[0],[f,p,g,x,w]=BY(a,s.shape,s.dtype,l,r.dtype,u,d);return[t.makeTensorInfo(p,s.dtype,f),t.makeTensorInfo([p[0]],r.dtype,g),t.makeTensorInfo([x.length],"bool",new Uint8Array(x.map(v=>Number(v)))),t.makeTensorInfo([w.length],s.dtype,new Int32Array(w))]}const soe={kernelName:bI,backendName:"webgl",kernelFunc:noe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function roe(n){const{inputs:e,backend:t}=n,{inputIndices:s,inputShape:r,newShape:o}=e;if(s.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${s.shape}`);if(r.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${r.shape}`);if(o.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${o.shape}`);const i=Array.from(t.readSync(r.dataId)),a=t.readSync(s.dataId),l=Array.from(t.readSync(o.dataId)),[u,d,f]=VY(a,s.shape,s.dtype,i,l);return[t.makeTensorInfo(d,s.dtype,u),t.makeTensorInfo([f.length],o.dtype,new Int32Array(f))]}const ooe={kernelName:CI,backendName:"webgl",kernelFunc:roe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function ioe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${o.shape}`);const i=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(o.dataId),[u,d]=oA(i,s.shape,s.dtype,a,l,!0);return t.makeTensorInfo(d,s.dtype,u)}const aoe={kernelName:kI,backendName:"webgl",kernelFunc:ioe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function loe(n){const{inputs:e,backend:t}=n,{data:s,indices:r,segmentIds:o}=e;if(s.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(r.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${r.shape}`);if(o.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${o.shape}`);const i=t.readSync(s.dataId),a=t.readSync(r.dataId),l=t.readSync(o.dataId),[u,d]=oA(i,s.shape,s.dtype,a,l);return t.makeTensorInfo(d,s.dtype,u)}const coe={kernelName:SI,backendName:"webgl",kernelFunc:loe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function uoe(n){const{inputs:e,backend:t,attrs:s}=n,{sparseIndices:r,sparseValues:o,defaultValue:i}=e,{outputShape:a}=s,{sliceRank:l,numUpdates:u,sliceSize:d,strides:f,outputSize:p}=pa(o,r,a),g=!1;if(o.dtype==="string"){const b=t.bufferSync(r),C=t.bufferSync(o),$=Qo(t.readSync(i.dataId)[0]),S=MY(b,C,a,p,d,u,l,f,$,g);return t.makeTensorInfo(a,S.dtype,S.values)}const x=new av(u,l,r.shape.length,o.shape.length,f,[p,1],g),w=t.runWebGLProgram(x,[o,r,i],o.dtype),v=ke({inputs:{x:w},backend:t,attrs:{shape:a}});return t.disposeIntermediateTensorInfo(w),v}const hoe={kernelName:II,backendName:"webgl",kernelFunc:uoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function doe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{numOrSizeSplits:o,axis:i}=s,a=Je(i,r.shape)[0],l=vw(r,o,a),u=r.shape.length,d=new Array(u).fill(0),f=r.shape.slice();return l.map(p=>{const g=[...f];g[a]=p;const x=Wl({inputs:{x:r},backend:t,attrs:{begin:d,size:g}});return d[a]+=p,x})}const foe={kernelName:lm,backendName:"webgl",kernelFunc:doe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const d2="return sqrt(x);",poe=at({opSnippet:d2,packedOpSnippet:d2,cpuKernelImpl:WY}),moe={kernelName:Ju,backendName:"webgl",kernelFunc:poe};/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const goe="return x * x;",xoe=at({opSnippet:goe}),yoe={kernelName:u1,backendName:"webgl",kernelFunc:xoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const f2="return (a - b) * (a - b);",woe=Rn({opSnippet:f2,packedOpSnippet:f2}),voe={kernelName:eh,backendName:"webgl",kernelFunc:woe};/**
 * @license
 * Copyright 2023 Google LLC.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function boe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e;if(r.dtype!=="string")throw new Error("Input must be of datatype string");const o=t.readSync(r.dataId),i=go(o),a=UY(i,"string",s);return t.makeTensorInfo(r.shape,"string",a)}const Coe={kernelName:h1,backendName:"webgl",kernelFunc:boe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function koe({inputs:n,attrs:e,backend:t}){const{x:s}=n,r=tr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,o=new zr(s.shape,r);return t.runWebGLProgram(o,[s],s.dtype)}const Soe={kernelName:oh,backendName:"webgl",kernelFunc:koe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Ioe{constructor(e,t,s){this.variableNames=["x"],this.outputShape=s;const r=s.length,o=Ct(s.length),i=Ct(s.length);let a="";if(r===1)a="coords * strides + begin";else{let l=0;a=s.map((u,d)=>(l++,s.length===1?`coords * strides[${d}] + begin[${d}]`:`coords[${l-1}] * strides[${d}] + begin[${d}]`)).join(",")}this.userCode=`
      ${o} begin = ${o}(${e});
      ${o} strides = ${o}(${t});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function $oe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{begin:o,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:d,newAxisMask:f,shrinkAxisMask:p}=s,{finalShapeSparse:g,finalShape:x,isIdentity:w,sliceDim0:v,isSimpleSlice:b,begin:C,end:$,strides:S}=nw(r.shape,o,i,a,l,u,d,f,p);let T;if(w)T=ke({inputs:{x:r},backend:t,attrs:{shape:x}});else if(v||b){O(r.shape.length>=1,()=>`Input must have rank at least 1, got: ${r.shape.length}`);const A=J1(C,$,S),F=Wl({inputs:{x:r},backend:t,attrs:{begin:C,size:A}});T=ke({inputs:{x:F},backend:t,attrs:{shape:x}}),t.disposeIntermediateTensorInfo(F)}else if(t.shouldExecuteOnCPU([r])){const F=t.readSync(r.dataId),D=Ze(r.shape,r.dtype,F),_=GY(g,D,S,C);T=t.makeTensorInfo(x,r.dtype,_.values)}else{const F=new Ioe(C,S,g);T=t.runWebGLProgram(F,[r],r.dtype)}const E=ke({inputs:{x:T},backend:t,attrs:{shape:x}});return t.disposeIntermediateTensorInfo(T),E}const Toe={kernelName:d1,backendName:"webgl",kernelFunc:$oe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Noe(n){const{inputs:e,backend:t,attrs:s}=n,{separator:r,nGramWidths:o,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=s,{data:d,dataSplits:f}=e,p=t.readSync(d.dataId),g=t.readSync(f.dataId),[x,w]=HY(p,g,r,o,i,a,l,u);return[t.makeTensorInfo([x.length],"string",x),t.makeTensorInfo(f.shape,"int32",w)]}const Eoe={kernelName:$I,backendName:"webgl",kernelFunc:Noe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Roe(n){const{inputs:e,backend:t,attrs:s}=n,{skipEmpty:r}=s,{input:o,delimiter:i}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(o.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${o.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);const a=t.readSync(o.dataId),l=t.readSync(i.dataId)[0],[u,d,f]=jY(a,l,r),p=d.length;return[t.makeTensorInfo([p,2],"int32",u),t.makeTensorInfo([p],"string",d),t.makeTensorInfo([2],"int32",new Int32Array(f))]}const Aoe={kernelName:TI,backendName:"webgl",kernelFunc:Roe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Doe(n){const{inputs:e,backend:t,attrs:s}=n,{numBuckets:r}=s,{input:o}=e;if(o.dtype!=="string")throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");const i=t.readSync(o.dataId),a=XY(i,r);return t.makeTensorInfo(o.shape,"int32",a)}const _oe={kernelName:NI,backendName:"webgl",kernelFunc:Doe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Foe="return tan(x);",Ooe=at({opSnippet:Foe}),zoe={kernelName:nh,backendName:"webgl",kernelFunc:Ooe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const Moe=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Poe=at({opSnippet:Moe}),Loe={kernelName:sh,backendName:"webgl",kernelFunc:Poe};/**
 * @license
 * Copyright 2022 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Boe(n){const{inputs:e,backend:t,attrs:s}=n,{tensor:r,indices:o,updates:i}=e,{sliceRank:a,numUpdates:l,sliceSize:u,strides:d,outputSize:f}=pa(i,o,r.shape),p=[f/u,u];if(f===0)return t.makeTensorInfo(r.shape,o.dtype);const g=ke({inputs:{x:o},backend:t,attrs:{shape:[l,a]}}),x=ke({inputs:{x:i},backend:t,attrs:{shape:[l,u]}}),w=ke({inputs:{x:r},backend:t,attrs:{shape:p}}),v=new av(l,a,g.shape.length,x.shape.length,d,p,!1,!0),b=t.runWebGLProgram(v,[x,g,w],w.dtype),C=ke({inputs:{x:b},backend:t,attrs:{shape:r.shape}});return t.disposeIntermediateTensorInfo(g),t.disposeIntermediateTensorInfo(x),t.disposeIntermediateTensorInfo(w),t.disposeIntermediateTensorInfo(b),C}const Voe={kernelName:wI,backendName:"webgl",kernelFunc:Boe};/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class Woe{constructor(e,t){this.variableNames=["A"];const s=new Array(e.length);for(let i=0;i<s.length;i++)s[i]=e[i]*t[i];this.outputShape=s,this.rank=s.length;const r=Ct(this.rank),o=Uoe(e);this.userCode=`
      void main() {
        ${r} resRC = getOutputCoords();
        setOutput(getA(${o}));
      }
    `}}function Uoe(n){const e=n.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${n[0]})`;const t=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let r=0;r<n.length;r++)s.push(`imod(${t[r]}, ${n[r]})`);return s.join()}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function zA(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{reps:o}=s;if(r.dtype==="string"||r.shape.length>5){const l=t.readSync(r.dataId),u=r.dtype==="string"?l.map(p=>Qo(p)):l,d=Ze(r.shape,r.dtype,u),f=qY(d,o);return t.makeTensorInfo(f.shape,f.dtype,f.values)}const i=new Woe(r.shape,o);return t.runWebGLProgram(i,[r],r.dtype)}const Goe={kernelName:rh,backendName:"webgl",kernelFunc:zA};class Hoe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}}class joe{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Ai(n,e){e!==null&&n.disposeIntermediateTensorInfo(e)}function p2(n){let e=1;for(;e<n;)e*=2;return e}function Xoe(n){const{inputs:e,backend:t,attrs:s}=n,{x:r}=e,{k:o,sorted:i}=s,a=ie().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=ie().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=r.shape,d=u[u.length-1];if(t.shouldExecuteOnCPU([r])||d<a||o>l){const _=t.readSync(r.dataId),[N,L]=YY(_,u,r.dtype,o,i);return[t.makeTensorInfo(N.shape,N.dtype,N.values),t.makeTensorInfo(L.shape,L.dtype,L.values)]}if(o===0)return u[u.length-1]=0,[t.makeTensorInfo(u,r.dtype,[]),t.makeTensorInfo(u,"int32",[])];if(d===1)return[r,Eh({attrs:{shape:u,dtype:"int32",value:0},backend:t})];const f=t.texData.get(r.dataId),p=f!==null&&f.isPacked,g=p?t.unpackTensor(r):r,w=ce(u)/d,v=ke({inputs:{x:g},attrs:{shape:[w,d]},backend:t});p&&Ai(t,g);const b=p2(o),C=p2(d);let $=null;const S=()=>$===null?[v,v]:[v,$],T=(_,N,L)=>{const G=S(),Q=new Hoe(L),Z=[[d],[$===null?1:0],[Number.NEGATIVE_INFINITY],[_],[N]],te=$;$=t.runWebGLProgram(Q,G,"int32",Z),Ai(t,te)};for(let _=1;_<b;_*=2){const N=_*2;for(let L=_;L>=1;L/=2)T(N,L,[w,C])}for(let _=C;_>b;_/=2){const N=S(),L=new joe([w,_/2]),Q=[[d],[$===null?1:0],[b]],K=$;$=t.runWebGLProgram(L,N,"int32",Q),Ai(t,K);const Z=b/2,te=Z*2;for(let B=Z;B>=1;B/=2)T(te,B,$.shape)}let E=$;$=Wl({inputs:{x:$},backend:t,attrs:{begin:0,size:[w,o]}}),Ai(t,E);let A=NA({inputs:{x:v,indices:$},backend:t,attrs:{axis:1,batchDims:1}});Ai(t,v);const F=u.slice(0,-1);F.push(o),E=$,$=ke({inputs:{x:$},attrs:{shape:F},backend:t}),Ai(t,E);const D=A;return A=ke({inputs:{x:A},attrs:{shape:F},backend:t}),Ai(t,D),[A,$]}const Koe={kernelName:f1,backendName:"webgl",kernelFunc:Xoe};/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class qoe{constructor(e,t,s,r,o,i){this.variableNames=["Image","Transforms"],this.outputShape=i;const a=s==="nearest"?1:2;let l;switch(r){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${t}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${o});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${o});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${t}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}}/**
 * @license
 * Copyright 2021 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Yoe(n){const{inputs:e,backend:t,attrs:s}=n,{image:r,transforms:o}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=s,[d,f,p,g]=r.shape,[x,w]=u??[f,p],v=[d,x,w,g],b=new qoe(f,p,i,a,l,v);return t.runWebGLProgram(b,[r,o],"float32")}const Qoe={kernelName:p1,backendName:"webgl",kernelFunc:Yoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function Zoe(n){const{inputs:e,attrs:t,backend:s}=n,{axis:r}=t,{x:o}=e;$h(o,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const i=s.readSync(o.dataId),{outputValues:a,outputShape:l,indices:u}=QY(i,r,o.shape,o.dtype);return[s.makeTensorInfo(l,o.dtype,a),s.makeTensorInfo([u.length],"int32",u)]}const Joe={kernelName:m1,backendName:"webgl",kernelFunc:Zoe};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function eie(n){const{inputs:e,backend:t,attrs:s}=n,{value:r}=e;let{axis:o}=s;o<0&&(o+=r.shape.length);const i=r,a=i.shape.length,l=r.shape[o],u=new Array(a-1);let d=0;for(let w=0;w<a;w++)w!==o&&(u[d++]=i.shape[w]);const f=[],p=new Array(a).fill(0),g=i.shape.slice();g[o]=1;const x=new Array(l);for(let w=0;w<x.length;w++){p[o]=w;const v=Wl({inputs:{x:i},backend:t,attrs:{begin:p,size:g}}),b=ke({inputs:{x:v},backend:t,attrs:{shape:u}});x[w]=b,f.push(v)}return f.forEach(w=>t.disposeIntermediateTensorInfo(w)),x}const tie={kernelName:um,backendName:"webgl",kernelFunc:eie};/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */class nie{constructor(e,t){this.variableNames=["x","segmentIds"];const s=e.windowSize,r=e.batchSize,o=e.inSize,i=e.numSegments,a=i*Math.ceil(o/s);this.outputShape=[r,a];const l="0.0",u="sumValue",d=Math.floor(s/4)*4,f=s%4,p=`
        sumValue += dot(values, segFilter);
    `;let g="";o%s>0&&(g=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return initializationValue;
        }
      `);let x="";o%s>0&&(x=`
        if (inIdx < 0 || inIdx >= ${o}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${g}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${x}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${s}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${d}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${p}
        }

        int inIdx = inOffset + ${d};
        if (${f===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${p}
        } else if (${f===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${p}
        } else if (${f===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${p}
        }
        setOutput(${u});
      }
    `}}/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */function sie(n){const{inputs:e,backend:t,attrs:s}=n,{x:r,segmentIds:o}=e,{numSegments:i}=s,a=r.shape.length,l=[];let u=0;const d=Bt([u],a);let f=r;d!=null&&(f=qn({inputs:{x:r},backend:t,attrs:{perm:d}}),l.push(f),u=Kt(1,a)[0]);const p=xT(f.shape,u,i),g=ce([f.shape[u]]),x=ke({inputs:{x:f},backend:t,attrs:{shape:[-1,g]}});l.push(x);const w=x1(r.dtype),v=(S,T,E,A,F)=>{const D=S.shape[0],_=S.shape[1],N=gT(_,F),L={windowSize:N,inSize:_,batchSize:D,numSegments:F},G=new nie(L,T),Q=t.compileAndRun(G,[S,E],A);if(l.push(Q),Q.shape[1]===F)return Q;const K=OA({backend:t,attrs:{start:0,stop:F,step:1,dtype:"float32"}}),Z=zA({inputs:{x:K},backend:t,attrs:{reps:[_/N]}});return l.push(K),l.push(Z),v(Q,T,Z,A,F)},b=v(x,"unsortedSegmentSum",o,w,i),C=ke({inputs:{x:b},backend:t,attrs:{shape:p}});let $=C;if(d!=null){l.push(C);const S=li(d);$=qn({inputs:{x:$},backend:t,attrs:{perm:S}})}return l.forEach(S=>t.disposeIntermediateTensorInfo(S)),$}const rie={kernelName:hm,backendName:"webgl",kernelFunc:sie};/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */const oie=[WQ,GQ,XQ,YQ,ZQ,tZ,sZ,oZ,cZ,hZ,pZ,xZ,vZ,SZ,TZ,EZ,AZ,OZ,MZ,LZ,UZ,YZ,ZZ,nJ,rJ,uJ,dJ,gJ,IQ,wJ,SJ,NJ,FJ,MJ,LJ,VJ,UJ,XJ,YJ,JJ,tee,see,oee,lee,uee,pee,gee,wee,Cee,See,Nee,Dee,zee,Lee,Wee,Uee,Hee,Xee,qee,Qee,Jee,ste,ite,cte,hte,pte,xte,bte,Ite,SQ,Tte,CJ,Rte,_te,zte,TQ,Bte,Gte,jte,Yte,Jte,sne,ine,une,pne,xne,wne,kne,Ine,Tne,Ane,_ne,One,Mne,Lne,Une,Xne,Qne,ose,RQ,cse,dse,mse,yse,iJ,bse,kse,Ise,Nse,Dse,EQ,Fse,zse,Pse,Bse,Vse,aJ,tse,Gse,Kse,Zse,DQ,nre,ore,cre,dre,gre,yre,bre,Sre,Tre,Rre,_re,zre,Bre,Ure,Xre,Yre,KZ,sse,Jre,toe,soe,ooe,aoe,coe,hoe,foe,moe,yoe,voe,Coe,Soe,Toe,Eoe,Aoe,_oe,nse,LQ,zoe,Loe,Voe,Goe,Koe,Qoe,BQ,Joe,tie,rie,Cse];for(const n of oie)RI(n);const wf={tank:0,warrior:1,archer:2,artillery:3},el={...wf,terrainHeight:4},Ki={tank:0,warrior:1,archer:2,artillery:3},ay={"advance-wait":4,advance:5,"wait-advance":6,"flank-left":7,"flank-right":8},Oi={...Ki,...ay};Object.keys(el).length;const m2=Object.keys(Oi).length,ua=30,Il=Math.floor(ua/(Ks/qs));let ho=null;async function MA(){try{ho?console.log("Model is already loaded"):(ho=await b6(window.location.origin+window.location.pathname+"/tfmodel/model.json"),console.log("Model loaded successfully"))}catch(n){throw console.error("Failed to load the model:",n),n}}function PA(n){return[n.data.map(e=>e.flat())]}function iie(n){return[n.data.map(e=>e.flat())]}function aie(n,e){const t=n.map(PA).flat(),s=e.map(iie).flat(),r=Ux(t),o=Ux(s);return[r,o]}async function lie(n,e,t={}){if(ho||await MA(),!ho)throw new Error("Model not loaded. Call loadModel() first.");const{epochs:s=5,batchSize:r=32,learningRate:o=.001}=t,[i,a]=aie(n,e);try{ho.compile({optimizer:Fi.adam(o),loss:"meanSquaredError",metrics:["accuracy"]}),await ho.fit(i,a,{epochs:s,batchSize:r})}catch(l){throw console.error("Training failed:",l),l}finally{i.dispose(),a.dispose()}}async function cie(n){if(ho||await MA(),!ho)throw new Error("Model not loaded. Call loadModel() first.");const e=Ux(PA(n)),t=ho.predict(e),s=t.squeeze([0]),r=s.arraySync();return e.dispose(),t.dispose(),s.dispose(),{data:r.map(o=>o.reduce((i,a,l)=>(l%m2===0&&i.push(o.slice(l,l+m2)),i),[])),cols:ua,rows:Il}}function LA(n,e){const t=ua,s=Il,r=Array.from({length:s},()=>Array.from({length:t},()=>Array(Object.keys(el).length).fill(0)));let o=0;for(const a of n)for(let l=0;l<a.sizeRow;l++)for(let u=0;u<a.sizeCol;u++){const d=qs/2+a.row+l,f=Ks/2+a.col+u,p=Math.min(Math.floor(d*s/qs),Il-1),g=Math.min(Math.floor(f*t/Ks),ua-1);r[p]&&r[p][g]&&(r[p][g][el[a.type]]=1+(r[p][g][el[a.type]]||0),o=Math.max(o,r[p][g][el[a.type]]))}const i=Math.max(...e.heightMap.flat());for(let a=0;a<s;a++)for(let l=0;l<t;l++){const u=Math.floor(a*qs/s),d=Math.floor(l*Ks/t),f=e.heightMap[u][d];r[a][l][el.terrainHeight]=f/i}for(const a of r)for(const l of a)for(const u in wf)l[wf[u]]=l[wf[u]]/o;return{cols:t,rows:s,data:r}}function uie(n){const e=ua,t=Il,s=Array.from({length:t},()=>Array.from({length:e},()=>Array(Object.keys(Oi).length).fill(0)));let r=0;for(const o of n)for(let i=0;i<o.sizeRow;i++)for(let a=0;a<o.sizeCol;a++){const l=qs/2+o.row+i,u=Ks/2+o.col+a,d=Math.min(Math.floor(l*t/qs),Il-1),f=Math.min(Math.floor(u*e/Ks),ua-1);s[d]&&s[d][f]&&(s[d][f][Oi[o.type]]=1+(s[d][f][Oi[o.type]]||0),r=Math.max(r,s[d][f][Oi[o.type]]),o.command&&Oi[o.command]&&(s[d][f][Oi[o.command]]=1))}for(const o of s)for(const i of o)for(const a in Ki)i[Ki[a]]=i[Ki[a]]/r;return{cols:e,rows:t,data:s}}function hie(n){var a,l,u;const e=[],t={},s=n.data.map(d=>d.map(f=>Object.values(Ki).map(p=>f[p]))).flat(2),r=Math.min(...s),o=Math.max(...s),i=r+(o-r)*.5;for(let d=0;d<n.rows;d++)for(let f=0;f<n.cols;f++){const p=(l=(a=Object.keys(Ki).map(x=>[x,n.data[d][f][Ki[x]]]).sort((x,w)=>w[1]-x[1]).filter(x=>x[1]>i))==null?void 0:a[0])==null?void 0:l[0],g=(u=Object.keys(ay).map(x=>[x,n.data[d][f][ay[x]]]).sort((x,w)=>w[1]-x[1])[0])==null?void 0:u[0];p&&(t[d+","+f]={type:p,command:g})}for(let d=0;d<Ks;d++)for(let f=0;f<qs;f++){const p=Math.min(Math.floor(f*n.rows/qs),Il-1),g=Math.min(Math.floor(d*n.cols/Ks),ua-1),x=t[p+","+g];x&&e.push({id:e.length+1,col:d-Ks/2,row:f-qs/2,sizeCol:1,sizeRow:1,type:x.type,command:x.command||"advance"})}return Tf(e)}function die(n,e){if(e<=0)throw new Error("maxSoldiers must be a positive integer.");const t=n.map(o=>({...o})),s=rp(t);if(s<=e)return t;let r=s-e;for(t.sort((o,i)=>i.sizeCol*i.sizeRow-o.sizeCol*o.sizeRow);r>0;){let o=!1;for(const i of t)if(i.sizeCol>1&&i.sizeRow>1){const a=i.sizeCol*i.sizeRow-(i.sizeCol-1)*(i.sizeRow-1);if(a<=0)continue;if(a<=r&&(i.sizeCol-=1,i.sizeRow-=1,r-=a,o=!0,r<=0))break}if(!o){for(const i of t)if(i.sizeCol>1&&i.sizeRow>1){if(i.sizeCol/i.sizeRow>=1?(i.sizeCol-=1,r-=i.sizeRow):(i.sizeRow-=1,r-=i.sizeCol),r<=0)break}else if(i.sizeCol>1&&i.sizeRow===1){if(i.sizeCol-=1,r-=i.sizeRow,r<=0)break}else if(i.sizeRow>1&&i.sizeCol===1&&(i.sizeRow-=1,r-=i.sizeCol,r<=0))break;break}}if(r>0){t.sort((o,i)=>i.sizeCol*i.sizeRow-o.sizeCol*o.sizeRow);for(const o of t){for(;r>0;){if(o.sizeCol>1&&o.sizeRow>1)o.sizeCol-=1,o.sizeRow-=1,r-=o.sizeCol+o.sizeRow+1;else if(o.sizeCol>1)o.sizeCol-=1,r-=o.sizeRow;else if(o.sizeRow>1)o.sizeRow-=1,r-=o.sizeCol;else break;if(o.sizeCol<1||o.sizeRow<1){o.sizeCol=Math.max(o.sizeCol,1),o.sizeRow=Math.max(o.sizeRow,1);break}if(r<=0)break}if(r<=0)break}}return t}function rp(n){return n.reduce((e,t)=>e+t.sizeCol*t.sizeRow,0)}function fie(n){var d,f,p;if(n.length===0)return[];let e=1/0,t=1/0,s=-1/0,r=-1/0;n.forEach(g=>{e=Math.min(e,g.col),t=Math.min(t,g.row),s=Math.max(s,g.col+g.sizeCol-1),r=Math.max(r,g.row+g.sizeRow-1)});const o=s-e+1,i=r-t+1,a=Array.from({length:i},()=>Array(o).fill(null));n.forEach(g=>{var x;for(let w=g.row;w<g.row+g.sizeRow;w++)for(let v=g.col;v<g.col+g.sizeCol;v++){const b=w-t,C=v-e;if(a[b][C]&&((x=a[b][C])==null?void 0:x.unit.id)!==g.id)throw new Error("Units overlap on the grid.");a[b][C]={unit:g,processed:!1}}});const l=[];let u=Math.max(...n.map(g=>g.id))+1;for(let g=0;g<i;g++)for(let x=0;x<o;x++){const w=a[g][x];if(w&&!w.processed){const{unit:v}=w;let b=x;for(;b+1<o&&((d=a[g][b+1])==null?void 0:d.unit.type)===v.type&&((f=a[g][b+1])==null?void 0:f.unit.command)===v.command&&!((p=a[g][b+1])!=null&&p.processed);)b++;let C=g,$=!0;for(;$&&C+1<i;){for(let T=x;T<=b;T++){const E=a[C+1][T];if(!E||E.unit.type!==v.type||E.unit.command!==v.command||E.processed){$=!1;break}}$&&C++}for(let T=g;T<=C;T++)for(let E=x;E<=b;E++)a[T][E].processed=!0;const S={id:u++,col:x+e,row:g+t,sizeCol:b-x+1,sizeRow:C-g+1,type:v.type,command:v.command};l.push(S)}}return l}async function pie(n,e){const t=LA(n,e),s=await cie(t);return die(fie(hie(s)),rp(n))}const mie=()=>{const[n,e]=Le.useState([]),t=Le.useCallback(async(s,r)=>{let o;try{o=await pie(s,r),console.log("Generated counter plan using AI model"),rp(o)<rp(s)*.7&&(console.warn("Counter plan has insufficient number of soldiers:",o.length,s.length),o=Ik(s,Ck))}catch(i){console.error("Error predicting counter plan:",i),o=Ik(s,Ck),console.log("Fallback to pre-defined plan selection")}return e(o),o},[]);return{oppositionPlan:n,generateOppositionPlan:()=>vy,updateOppositionPlan:t}},gie=Tf(vy.map(n=>({...n,command:"advance-wait"}))),xie=({onStartBattle:n,initialPlayerUnits:e})=>{const[t,s]=Le.useState([]),[r,o]=Le.useState([]),[i,a]=Le.useState(!1),l=Le.useMemo(()=>c3(Kn),[]),{selectedUnit:u,handleUnitSelect:d,setSelectedUnit:f}=M3(t),{handleDragStart:p,handleDragMove:g,handleDragEnd:x,isDragging:w}=z3(t,s),{generateOppositionPlan:v,updateOppositionPlan:b}=mie();Le.useEffect(()=>{s(e??gie),o(v())},[]);const C=Le.useCallback((E,A)=>{s(F=>F.map(D=>D.id===E?{...D,...A}:D)),f(F=>(F==null?void 0:F.id)===E?{...F,...A}:F)},[]),$=Le.useCallback(async()=>{n(t,await b(t,l),l)},[t,r,n]),S=Le.useCallback((E,A)=>{a(!0),d(E,A)},[d]),T=Le.useCallback(E=>{a(!0),p(E)},[p]);return gO(()=>{b(t,l).then(o)},1e3,[t]),De.jsx(F3,{playerUnits:t,oppositionUnits:r,selectedUnit:u,hasInteracted:i,terrainData:l,isDragging:w,onCellClick:S,onDragStart:T,onDragMove:g,onDragEnd:x,onModifyUnit:C,onStartBattle:$})};function yie(n,e){const t=new CustomEvent(n,{bubbles:!0,detail:e});document.dispatchEvent(t)}function wie(n,e){Le.useEffect(()=>{const t=s=>{e(s.detail)};return document.addEventListener(n,t,!1),()=>{document.removeEventListener(n,t,!1)}},[n,e])}const vie=Y2`
#game-hud {
  position: fixed;
  z-index: 2;
  pointer-events: none;
  width: 100%;
  height: 100%;
  display: block;
}

#hud-top-right {
  position: fixed;
  top: 20px;
  display: flex;
  gap: 16px;
  pointer-events: all;

  @media (orientation: landscape) {
    right: 20px;
    align-items: flex-start;
  }
  @media (orientation: portrait) {
    justify-content: space-around;
    width: 100%;
  }
}

#battle-controls {
  display: flex;
  gap: 10px;

  button {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    cursor: pointer;
    font-size: 14px;
    white-space: nowrap;
    transition: background-color 0.2s ease;
  }

  button:hover {
    background: rgba(0, 0, 0, 0.8);
  }
}

#battle-result:empty {
  display: none;
}

#battle-result:not(:empty) div {
  width: 404px;
  height: 300px;
  color: white;
  left: 50%;
  top: 50%;
  margin: -150px -150px;
  text-align: center;
  position: absolute;
  font-size: 30px;
  background: rgba(0, 0, 0, 0.7);
  border-radius: 4px;
  padding: 20px;
  backdrop-filter: blur(5px);
}

#battle-result:not(:empty) {
  width: 100%;
  height: 100%;
  display: block;
  background: rgba(0, 0, 0, 0.3);
  position: fixed;
  top: 0;
  left: 0;
}

#battle-result span.result {
  color: white;
  font-weight: bold;
  animation: blinker 1s linear infinite;
}

@keyframes blinker {
  50% {
    opacity: 0;
  }
}

#battle-result span.winner {
  position: absolute;
  top: 80px;
  left: 0px;
  right: 0px;
  font-weight: bold;
}

#battle-result span.loser {
  position: absolute;
  top: 120px;
  left: 0px;
  right: 0px;
}

#battle-result span.continue {
  color: white;
  position: absolute;
  font-size: 15px;
  bottom: 5px;
  left: 5px;
  width: 100%;
}

#battle-result span {
  display: block;
}

#battle-stats {
  background: rgba(0, 0, 0, 0.7);
  padding: 6px 16px;
  border-radius: 4px;
  color: white;
  min-width: 300px;
  backdrop-filter: blur(5px);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
  gap: 16px;
}

#battle-time {
  font-size: 14px;
  color: white;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
}

#battle-time:before {
  content: attr(data-time);
  display: block;
}

/* Battle Balance Styles */
#battle-balance {
  display: flex;
  align-items: center;
  gap: 4px;
  flex: 1;
}

#battle-balance-left, #battle-balance-right {
  flex: 1;
  height: 4px;
  border-radius: 2px;
  transition: width 0.3s ease-in-out;
  position: relative;
}

#battle-balance-left {
  background: linear-gradient(90deg, #ff0000, #ff4444);
}

#battle-balance-right {
  background: linear-gradient(90deg, #44ff44, #00ff00);
}

#battle-balance-left:after, #battle-balance-right:after {
  content: attr(data-percentage);
  position: absolute;
  top: -18px;
  font-size: 12px;
  color: white;
}

#battle-balance-left:after {
  right: 0;
}

#battle-balance-right:after {
  left: 0;
}

#battle-balance-left[data-winning="true"] {
  animation: pulse-red 2s infinite;
}

#battle-balance-right[data-winning="true"] {
  animation: pulse-green 2s infinite;
}

@keyframes pulse-red {
  0% {
    filter: brightness(1);
  }
  50% {
    filter: brightness(1.3);
  }
  100% {
    filter: brightness(1);
  }
}

@keyframes pulse-green {
  0% {
    filter: brightness(1);
  }
  50% {
    filter: brightness(1.3);
  }
  100% {
    filter: brightness(1);
  }
}

canvas#layer-default {
  max-width: 100%;
  max-height: 100%;
  position: absolute;
  pointer-events: none;
  z-index: 1;
}
`;let kt=0;const BA=kt++,VA=kt++,WA=kt++,bie=kt++,Cie=kt++,UA=kt++,GA=kt++,kie=kt++,Sie=kt++,Iie=kt++,$ie=kt++,Tie=kt++,HA=kt++,Nie=kt++,Eie=kt++,Rie=kt++,Aie=kt++,Die=kt++,_ie=kt++,Fie=kt++,Oie=kt++,zie=kt++,Mie=kt++,ly=kt++,cy=kt++,jA=kt++,XA=kt++,KA=kt++,qA=kt++,Oe={EPSILON:Math.pow(2,-16),length:function(n){return Math.sqrt(n[0]*n[0]+n[1]*n[1])},distanceSquared:function(n,e){return Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)},distance:function(n,e){return Math.sqrt(this.distanceSquared(n,e))},withinDistance:function(n,e,t){const s=n[0]-e[0],r=n[1]-e[1];if(Math.abs(s)>t||Math.abs(r)>t)return!1;const o=Math.pow(s,2)+Math.pow(r,2);return Math.sqrt(o)<t},normalize:function(n){return this.scale(n,1/this.length(n))},angle:function(n,e){return Math.atan2(this.perpDot(n,e),this.dot(n,e))},dot:function(n,e){return n[0]*e[0]+n[1]*e[1]},perpDot:function(n,e){return n[0]*e[1]-n[1]*e[0]},atan2:function(n,e){return Math.atan2(e[1]-n[1],e[0]-n[0])},sub:function(n,e){return[n[0]-e[0],n[1]-e[1]]},add:function(n,e){return[n[0]+e[0],n[1]+e[1]]},scale:function(n,e){return[n[0]*e,n[1]*e]},rotate:function(n,e){const t=this.length(n);return e=Math.atan2(n[1],n[0])+e,[Math.cos(e)*t,Math.sin(e)*t]},reflect:function(){return[0,0]},project:function(){return[0,0]},normal:function(n,e){let t=this.sub(e,n);return t=this.scale(t,1/this.length(t)),[[-t[1],t[0]],[t[1],-t[0]]]},intersectLineLine:function(n,e,t,s){const r=this.sub(e,n),o=this.sub(s,t),i=this.perpDot(o,r);if(i==0)return;const a=this.perpDot(this.sub(n,t),o)/i,l=this.perpDot(this.sub(n,t),r)/i;if(!(a<0||l<0||a>1||l>1))return[a,l]},intersectSphereSphere:function(n,e,t,s,r,o){const i=this.sub(e,n),a=this.sub(s,t),l=r+o,u=this.dot(i,i),d=l*l,f=this.dot(a,a);if(f==0)return;const p=2*this.dot(a,i),g=u-d;if(u<=d)return[0,0];let x=p*p-4*f*g;if(x<0)return;x=Math.sqrt(x);const w=(-p-x)/(2*f),v=(-p+x)/(2*f);return w<v?[w,v]:[v,w]},intersectSphereLine:function(n,e,t,s,r){const o=this.sub(r,s),i=t/Math.sqrt(this.dot(o,o));let a=this.scale([-o[1],o[0]],i),l=this.scale([o[1],-o[0]],i);a=this.add(n,a),l=this.add(n,l);let u=[this.intersectLineLine(a,this.add(a,e),s,r),this.intersectLineLine(l,this.add(l,e),s,r)];if(!u[0]||!u[1])return u[0]||u[1];if(!(!u[0]&&!u[1])&&(u[0][0]<u[1][0]?u=u[0]:u=u[1],!(u[0][0]<0||u[1]<0)&&u[0]<=1&&u[1]<=1))return u}};class Pie{constructor(){this.ids=[],this.values=[],this.length=0}clear(){this.length=0}push(e,t){let s=this.length++;for(;s>0;){const r=s-1>>1,o=this.values[r];if(t>=o)break;this.ids[s]=this.ids[r],this.values[s]=o,s=r}this.ids[s]=e,this.values[s]=t}pop(){if(this.length===0)return;const e=this.ids[0];if(this.length--,this.length>0){const t=this.ids[0]=this.ids[this.length],s=this.values[0]=this.values[this.length],r=this.length>>1;let o=0;for(;o<r;){let i=(o<<1)+1;const a=i+1;let l=this.ids[i],u=this.values[i];const d=this.values[a];if(a<this.length&&d<u&&(i=a,l=this.ids[a],u=d),u>=s)break;this.ids[o]=l,this.values[o]=u,o=i}this.ids[o]=t,this.values[o]=s}return e}peek(){if(this.length!==0)return this.ids[0]}peekValue(){if(this.length!==0)return this.values[0]}shrink(){this.ids.length=this.values.length=this.length}}const g2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],cx=3;class lv{static from(e,t=0){if(t%8!==0)throw new Error("byteOffset must be 8-byte aligned.");if(!e||e.byteLength===void 0||e.buffer)throw new Error("Data must be an instance of ArrayBuffer or SharedArrayBuffer.");const[s,r]=new Uint8Array(e,t+0,2);if(s!==251)throw new Error("Data does not appear to be in a Flatbush format.");const o=r>>4;if(o!==cx)throw new Error(`Got v${o} data when expected v${cx}.`);const i=g2[r&15];if(!i)throw new Error("Unrecognized array type.");const[a]=new Uint16Array(e,t+2,1),[l]=new Uint32Array(e,t+4,1);return new lv(l,a,i,void 0,e,t)}constructor(e,t=16,s=Float64Array,r=ArrayBuffer,o,i=0){if(e===void 0)throw new Error("Missing required argument: numItems.");if(isNaN(e)||e<=0)throw new Error(`Unexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.byteOffset=i;let a=e,l=a;this._levelBounds=[a*4];do a=Math.ceil(a/this.nodeSize),l+=a,this._levelBounds.push(l*4);while(a!==1);this.ArrayType=s,this.IndexArrayType=l<16384?Uint16Array:Uint32Array;const u=g2.indexOf(this.ArrayType),d=l*4*this.ArrayType.BYTES_PER_ELEMENT;if(u<0)throw new Error(`Unexpected typed array class: ${s}.`);o&&o.byteLength!==void 0&&!o.buffer?(this.data=o,this._boxes=new this.ArrayType(this.data,i+8,l*4),this._indices=new this.IndexArrayType(this.data,i+8+d,l),this._pos=l*4,this.minX=this._boxes[this._pos-4],this.minY=this._boxes[this._pos-3],this.maxX=this._boxes[this._pos-2],this.maxY=this._boxes[this._pos-1]):(this.data=new r(8+d+l*this.IndexArrayType.BYTES_PER_ELEMENT),this._boxes=new this.ArrayType(this.data,8,l*4),this._indices=new this.IndexArrayType(this.data,8+d,l),this._pos=0,this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,new Uint8Array(this.data,0,2).set([251,(cx<<4)+u]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e),this._queue=new Pie}add(e,t,s=e,r=t){const o=this._pos>>2,i=this._boxes;return this._indices[o]=o,i[this._pos++]=e,i[this._pos++]=t,i[this._pos++]=s,i[this._pos++]=r,e<this.minX&&(this.minX=e),t<this.minY&&(this.minY=t),s>this.maxX&&(this.maxX=s),r>this.maxY&&(this.maxY=r),o}finish(){if(this._pos>>2!==this.numItems)throw new Error(`Added ${this._pos>>2} items when expected ${this.numItems}.`);const e=this._boxes;if(this.numItems<=this.nodeSize){e[this._pos++]=this.minX,e[this._pos++]=this.minY,e[this._pos++]=this.maxX,e[this._pos++]=this.maxY;return}const t=this.maxX-this.minX||1,s=this.maxY-this.minY||1,r=new Uint32Array(this.numItems),o=65535;for(let i=0,a=0;i<this.numItems;i++){const l=e[a++],u=e[a++],d=e[a++],f=e[a++],p=Math.floor(o*((l+d)/2-this.minX)/t),g=Math.floor(o*((u+f)/2-this.minY)/s);r[i]=Bie(p,g)}uy(r,e,this._indices,0,this.numItems-1,this.nodeSize);for(let i=0,a=0;i<this._levelBounds.length-1;i++){const l=this._levelBounds[i];for(;a<l;){const u=a;let d=e[a++],f=e[a++],p=e[a++],g=e[a++];for(let x=1;x<this.nodeSize&&a<l;x++)d=Math.min(d,e[a++]),f=Math.min(f,e[a++]),p=Math.max(p,e[a++]),g=Math.max(g,e[a++]);this._indices[this._pos>>2]=u,e[this._pos++]=d,e[this._pos++]=f,e[this._pos++]=p,e[this._pos++]=g}}}search(e,t,s,r,o){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let i=this._boxes.length-4;const a=[],l=[];for(;i!==void 0;){const u=Math.min(i+this.nodeSize*4,y2(i,this._levelBounds));for(let d=i;d<u;d+=4){if(s<this._boxes[d]||r<this._boxes[d+1]||e>this._boxes[d+2]||t>this._boxes[d+3])continue;const f=this._indices[d>>2]|0;i>=this.numItems*4?a.push(f):(o===void 0||o(f))&&l.push(f)}i=a.pop()}return l}neighbors(e,t,s=1/0,r=1/0,o){if(this._pos!==this._boxes.length)throw new Error("Data not yet indexed - call index.finish().");let i=this._boxes.length-4;const a=this._queue,l=[],u=r*r;e:for(;i!==void 0;){const d=Math.min(i+this.nodeSize*4,y2(i,this._levelBounds));for(let f=i;f<d;f+=4){const p=this._indices[f>>2]|0,g=x2(e,this._boxes[f],this._boxes[f+2]),x=x2(t,this._boxes[f+1],this._boxes[f+3]),w=g*g+x*x;w>u||(i>=this.numItems*4?a.push(p<<1,w):(o===void 0||o(p))&&a.push((p<<1)+1,w))}for(;a.length&&a.peek()&1;)if(a.peekValue()>u||(l.push(a.pop()>>1),l.length===s))break e;i=a.length?a.pop()>>1:void 0}return a.clear(),l}}function x2(n,e,t){return n<e?e-n:n<=t?0:n-t}function y2(n,e){let t=0,s=e.length-1;for(;t<s;){const r=t+s>>1;e[r]>n?s=r:t=r+1}return e[t]}function uy(n,e,t,s,r,o){if(Math.floor(s/o)>=Math.floor(r/o))return;const i=n[s+r>>1];let a=s-1,l=r+1;for(;;){do a++;while(n[a]<i);do l--;while(n[l]>i);if(a>=l)break;Lie(n,e,t,a,l)}uy(n,e,t,s,l,o),uy(n,e,t,l+1,r,o)}function Lie(n,e,t,s,r){const o=n[s];n[s]=n[r],n[r]=o;const i=4*s,a=4*r,l=e[i],u=e[i+1],d=e[i+2],f=e[i+3];e[i]=e[a],e[i+1]=e[a+1],e[i+2]=e[a+2],e[i+3]=e[a+3],e[a]=l,e[a+1]=u,e[a+2]=d,e[a+3]=f;const p=t[s];t[s]=t[r],t[r]=p}function Bie(n,e){let t=n^e,s=65535^t,r=65535^(n|e),o=n&(e^65535),i=t|s>>1,a=t>>1^t,l=r>>1^s&o>>1^r,u=t&r>>1^o>>1^o;t=i,s=a,r=l,o=u,i=t&t>>2^s&s>>2,a=t&s>>2^s&(t^s)>>2,l^=t&r>>2^s&o>>2,u^=s&r>>2^(t^s)&o>>2,t=i,s=a,r=l,o=u,i=t&t>>4^s&s>>4,a=t&s>>4^s&(t^s)>>4,l^=t&r>>4^s&o>>4,u^=s&r>>4^(t^s)&o>>4,t=i,s=a,r=l,o=u,l^=t&r>>8^s&o>>8,u^=s&r>>8^(t^s)&o>>8,t=l^l>>1,s=u^u>>1;let d=n^e,f=s|65535^(d|t);return d=(d|d<<8)&16711935,d=(d|d<<4)&252645135,d=(d|d<<2)&858993459,d=(d|d<<1)&1431655765,f=(f|f<<8)&16711935,f=(f|f<<4)&252645135,f=(f|f<<2)&858993459,f=(f|f<<1)&1431655765,(f<<1|d)>>>0}function Vie(n){return{searchSoldiers:w2(n.queryObjects("Soldier")),searchArrows:w2(n.queryObjects("Arrow").filter(e=>e.isHit()))}}function w2(n,e){n=[...n];const t=n.length===0?void 0:new lv(n.length);for(const o of n)t==null||t.add(o.vec[0],o.vec[1],o.vec[0],o.vec[1]);t==null||t.finish();const s=new Map;return{byRect:o=>(t==null?void 0:t.search(o.left,o.top,o.right,o.bottom).map(i=>n[i]))??[],byRadius:(o,i)=>(t==null?void 0:t.neighbors(o[0],o[1],void 0,i).map(a=>n[a]))??[],byProperty:(o,i)=>{if(!s.has(o)){const a=s.set(o,new Map).get(o);n.forEach(l=>{if(o in l){const u=l[o];a.has(u)||a.set(u,[]),a.get(u).push(l)}})}return s.get(o).get(i)??[]},resetPropertyCache:()=>{s.clear()}}}const ip=class ip{constructor(e,t,s,r,o,i){me(this,"id");me(this,"vec");me(this,"direction");me(this,"objectWidth");me(this,"objectHeight");me(this,"world");this.id=String(ip.idCounter++),this.vec=[e,t],this.direction=o,this.objectWidth=s,this.objectHeight=r,this.world=i}getTargetVelocity(){}render(e){e.addObjectCommand(this.getX(),this.getY(),this.getZ(),!0,"red",[[-this.getWidth()/2+this.getX(),-this.getHeight()/2+this.getY()-this.getZ()],[this.getWidth(),this.getHeight()]])}getX(){return this.vec[0]}setX(e){this.vec[0]=e}getY(){return this.vec[1]}setY(e){this.vec[1]=e}getZ(){return this.world.terrain.getHeightAt(this.vec)}getDirection(){return this.direction}setDirection(e){this.direction=e}getWidth(){return this.objectWidth}getHeight(){return this.objectHeight}getClass(){return"Object"}};me(ip,"idCounter",0);let au=ip;const v2={arrow:[10,1],ball:[10,10]};class YA extends au{constructor(t,s,r,o,i){super(t[0],t[1],v2[i][0],v2[i][1],Oe.atan2(t,s),r);me(this,"from");me(this,"to");me(this,"maxDist");me(this,"attackBase");me(this,"type");me(this,"v");me(this,"adir");me(this,"ay");this.from=t,this.to=s,this.maxDist=Oe.distance(t,s),this.attackBase=o,this.type=i,this.v=Oe.normalize(Oe.sub(s,t))}update(t){const s=Oe.scale(this.v,t*20);this.vec[0]+=s[0],this.vec[1]+=s[1];const r=Math.sin(Oe.distance(this.from,this.vec)/this.maxDist*Math.PI);this.adir=this.direction-Math.PI/3*(1-r),this.ay=this.vec[1]-r*this.maxDist/10,Oe.distance(this.from,this.vec)>this.maxDist&&this.world.removeObject(this)}render(t){const r=(this.type==="arrow"?[[-this.getWidth()*2,0],[this.getWidth()*2,0],[0,-this.getHeight()]]:[[-this.getWidth()/2,-this.getHeight()/2],[this.getWidth()/2,-this.getHeight()/2],[this.getWidth()/2,this.getHeight()/2],[-this.getWidth()/2,this.getHeight()/2]]).map(o=>{const i=o[0]*Math.cos(this.getDirection())-o[1]*Math.sin(this.getDirection()),a=o[0]*Math.sin(this.getDirection())+o[1]*Math.cos(this.getDirection());return[i,a]});t.addObjectCommand(this.getX(),this.getY(),this.getZ(),!0,"red",r)}getY(){return this.ay}getDirection(){return this.adir}isHit(){return this.maxDist-Oe.distance(this.from,this.vec)<10}hit(t,s){t.hitByArrow(this,s)}getAttack(){return this.attackBase}getClass(){return"Arrow"}}class Wie extends au{constructor(t,s,r){super(t[0],t[1],nl*2,nl*2,0,r);me(this,"time");this.time=s}render(t){const s=this.world.getTime()-this.time;if(s<100){const r=nl*Math.min(s/100,1),o=16,i=[];for(let a=0;a<=o;a++){const l=a/o*Math.PI*2;i.push([Math.cos(l)*r,Math.sin(l)*r])}t.addObjectCommand(this.getX(),this.getY(),this.getZ(),!0,"black",i)}}update(){}getClass(){return"Explosion"}}class Uie{constructor(e,t){me(this,"soldier");me(this,"velocity",0);me(this,"targetVelocity",1);me(this,"force",[0,0]);me(this,"targetDirection");me(this,"terrain");this.soldier=e,this.targetDirection=e.getDirection(),this.terrain=t}update(e){this.updateVelocity(e),this.updatePosition(e),this.updateDirection(e),this.updateForce(e)}calculateTerrainSlope(){const e=this.terrain.getHeightAt([this.soldier.getX(),this.soldier.getY()]),t=[this.soldier.getX()+Math.cos(this.soldier.getDirection())*.1,this.soldier.getY()+Math.sin(this.soldier.getDirection())*.1];return this.terrain.getHeightAt(t)-e}updateVelocity(e){const t=this.calculateTerrainSlope();let s=1;t<0?s=5/4:t>0&&(s=4/5);const r=this.getTargetVelocity()*s;this.velocity=r*e+this.velocity*(1-e)}updatePosition(e){this.soldier.setX(this.soldier.getX()+this.force[0]*e),this.soldier.setY(this.soldier.getY()+this.force[1]*e)}updateDirection(e){const t=Math.cos(this.soldier.getDirection())*(1-e),s=Math.sin(this.soldier.getDirection())*(1-e),r=Math.cos(this.targetDirection)*e,o=Math.sin(this.targetDirection)*e;this.soldier.setDirection(Math.atan2(s+o,t+r))}updateForce(e){this.soldier.state.isAlive()&&this.addForce(Oe.scale([Math.cos(this.soldier.getDirection()),Math.sin(this.soldier.getDirection())],this.velocity*(1-Math.random())*e/2)),this.force=Oe.sub(this.force,Oe.scale(this.force,e*.1)),Oe.length(this.force)<Oe.EPSILON&&(this.force=[0,0])}setTargetDirection(e){this.targetDirection=e}setTargetVelocity(e){this.targetVelocity=e*this.soldier.state.baseSpeed}getTargetVelocity(){return this.targetVelocity}getVelocity(){return this.velocity}addForce(e){this.force=Oe.add(this.force,e)}distance(e){return Oe.distance(this.soldier.vec,e.vec)}}function Gie(){this.setSettings=function(n){for(var e=0;e<24;e++)this[String.fromCharCode(97+e)]=n[e]||0;this.c<.01&&(this.c=.01);var t=this.b+this.c+this.e;if(t<.18){var s=.18/t;this.b*=s,this.c*=s,this.e*=s}}}function Hie(){this._params=new Gie;var n,e,t,s,r,o,i,a,l,u,d,f;this.reset=function(){var p=this._params;s=100/(p.f*p.f+.001),r=100/(p.g*p.g+.001),o=1-p.h*p.h*p.h*.01,i=-p.i*p.i*p.i*1e-6,p.a||(d=.5-p.n/2,f=-p.o*5e-5),a=1+p.l*p.l*(p.l>0?-.9:10),l=0,u=p.m==1?0:(1-p.m)*(1-p.m)*2e4+32},this.totalReset=function(){this.reset();var p=this._params;return n=p.b*p.b*1e5,e=p.c*p.c*1e5,t=p.e*p.e*1e5+12,((n+e+t)/3|0)*3},this.synthWave=function(p,g){var x=this._params,w=x.s!=1||x.v,v=x.v*x.v*.1,b=1+x.w*3e-4,C=x.s*x.s*x.s*.1,$=1+x.t*1e-4,S=x.s!=1,T=x.x*x.x,E=x.g,A=x.q||x.r,F=x.r*x.r*x.r*.2,D=x.q*x.q*(x.q<0?-1020:1020),_=x.p?((1-x.p)*(1-x.p)*2e4|0)+32:0,N=x.d,L=x.j/2,G=x.k*x.k*.01,Q=x.a,K=n,Z=1/n,te=1/e,B=1/t,H=5/(1+x.u*x.u*20)*(.01+C);H>.8&&(H=.8),H=1-H;var X=!1,z=0,V=0,oe=0,ue=0,he=0,de,we=0,xe,be=0,Te,Pe=0,Ve,st=0,Xe,nt,rt=0,ut=new Array(1024),lt=new Array(32);for(let Vt=ut.length;Vt--;)ut[Vt]=0;for(let Vt=lt.length;Vt--;)lt[Vt]=Math.random()*2-1;for(var vn=0;vn<g;vn++){if(X)return vn;if(_&&++st>=_&&(st=0,this.reset()),u&&++l>=u&&(u=0,s*=a),o+=i,s*=o,s>r&&(s=r,E>0&&(X=!0)),xe=s,L>0&&(rt+=G,xe*=1+Math.sin(rt)*L),xe|=0,xe<8&&(xe=8),Q||(d+=f,d<0?d=0:d>.5&&(d=.5)),++V>K)switch(V=0,++z){case 1:K=e;break;case 2:K=t}switch(z){case 0:oe=V*Z;break;case 1:oe=1+(1-V*te)*2*N;break;case 2:oe=1-V*B;break;case 3:oe=0,X=!0}A&&(D+=F,Te=D|0,Te<0?Te=-Te:Te>1023&&(Te=1023)),w&&b&&(v*=b,v<1e-5?v=1e-5:v>.1&&(v=.1)),nt=0;for(var Et=8;Et--;){if(be++,be>=xe&&(be%=xe,Q==3))for(var bn=lt.length;bn--;)lt[bn]=Math.random()*2-1;switch(Q){case 0:Xe=be/xe<d?.5:-.5;break;case 1:Xe=1-be/xe*2;break;case 2:Ve=be/xe,Ve=(Ve>.5?Ve-1:Ve)*6.28318531,Xe=1.27323954*Ve+.405284735*Ve*Ve*(Ve<0?1:-1),Xe=.225*((Xe<0?-1:1)*Xe*Xe-Xe)+Xe;break;case 3:Xe=lt[Math.abs(be*32/xe|0)]}w&&(de=we,C*=$,C<0?C=0:C>.1&&(C=.1),S?(he+=(Xe-we)*C,he*=H):(we=Xe,he=0),we+=he,ue+=we-de,ue*=1-v,Xe=ue),A&&(ut[Pe%1024]=Xe,Xe+=ut[(Pe-Te+1024)%1024],Pe++),nt+=Xe}nt*=.125*oe*T,p[vn]=nt>=1?32767:nt<=-1?-32768:nt*32767|0}return g}}var ux=new Hie;const jie=function(n){ux._params.setSettings(n);var e=ux.totalReset(),t=new Uint8Array(((e+1)/2|0)*4+44),s=ux.synthWave(new Uint16Array(t.buffer,44),e)*2,r=new Uint32Array(t.buffer,0,44);r[0]=1179011410,r[1]=s+36,r[2]=1163280727,r[3]=544501094,r[4]=16,r[5]=65537,r[6]=44100,r[7]=88200,r[8]=1048578,r[9]=1635017060,r[10]=s,s+=44;for(var o=0,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a="data:audio/wav;base64,";o<s;o+=3){var l=t[o]<<16|t[o+1]<<8|t[o+2];a+=i[l>>18]+i[l>>12&63]+i[l>>6&63]+i[l&63]}return a},hx=typeof window<"u";class Xie{constructor(){this.enabled=!0,this.sounds={},hx&&(this.audioContext=new(window.AudioContext||window.webkitAudioContext))}async add(e,t,s){if(hx){this.sounds[e]=[];for(let r=0;r<s.length;r++){const o={tick:0,count:t,buffers:[]};for(let i=0;i<t;i++){const a=jie(s[r]),l=await this.base64ToArrayBuffer(a),u=await this.audioContext.decodeAudioData(l);o.buffers.push(u)}this.sounds[e].push(o)}}}play(e){if(!hx||!this.enabled)return;const t=this.sounds[e],s=t.length>1?t[Math.floor(Math.random()*t.length)]:t[0],r=this.audioContext.createBufferSource();r.buffer=s.buffers[s.tick];const o=this.audioContext.createGain();r.connect(o),o.connect(this.audioContext.destination),r.start(0),s.tick<s.count-1?s.tick++:s.tick=0}async base64ToArrayBuffer(e){const t=e.split(",")[1],s=atob(t),r=s.length,o=new Uint8Array(r);for(let i=0;i<r;i++)o[i]=s.charCodeAt(i);return o.buffer}setEnabled(e){this.enabled=e}}const si=new Xie;si.add("arrow",10,[[0,.13,.12,.21,.28,.7097,.11,.4399,,,,.2845,.6608,,,,,,1,,,,,.32]]);si.add("hitarrow",10,[[2,,.0664,,.1176,.7984,,-.5791,,,,,,,,,,,1,,,.0922,,.47]]);si.add("damage",10,[[3,,.0421,,.1467,.7815,,-.4846,,,,,,.4464,,,,,1,,,.2247,,.47]]);class QA{constructor(e,t,s,r,o,i,a,l,u="blood"){me(this,"gravity",5);this.x=e,this.y=t,this.z=s,this.terrain=r,this.velocityX=o,this.velocityY=i,this.velocityZ=a,this.life=l,this.type=u}update(e){this.x+=this.velocityX*e,this.y+=this.velocityY*e,this.z=Math.max(this.z+this.velocityZ*e,this.terrain.getHeightAt([this.x,this.y])),this.type==="smoke"?(this.velocityX*=.99,this.velocityY*=.99,this.velocityZ=Math.max(this.velocityZ-1*e,.5)):(this.velocityX*=.98,this.velocityY*=.98,this.velocityZ-=this.gravity*e),this.life-=e}isAlive(){return this.life>0}isDead(){return this.life<=0}}const dx=typeof window<"u";class Kie{constructor(e,t,s){me(this,"particles",[]);me(this,"deadParticlesCanvas");me(this,"deadParticlesContext");this.terrain=s,dx&&(this.deadParticlesCanvas=document.createElement("canvas"),this.deadParticlesCanvas.width=e,this.deadParticlesCanvas.height=t,this.deadParticlesContext=this.deadParticlesCanvas.getContext("2d"),this.deadParticlesContext.translate(e/2,t/2))}addParticle(e){dx&&this.particles.push(e)}update(e){if(!dx)return;const t=[];this.particles=this.particles.filter(s=>(s.update(e),s.isDead()?(s.type==="blood"&&t.push(s),!1):!0)),this.renderDeadParticles(t)}renderDeadParticles(e){this.deadParticlesContext&&(this.deadParticlesContext.fillStyle="rgba(255, 0, 0, 0.5)",e.forEach(t=>{t.type==="blood"&&(this.deadParticlesContext.beginPath(),this.deadParticlesContext.arc(t.x,t.y-t.z,1,0,Math.PI*2),this.deadParticlesContext.fill())}))}renderDead(e){this.deadParticlesCanvas&&e.drawImage(this.deadParticlesCanvas,-this.deadParticlesCanvas.width/2,-this.deadParticlesCanvas.height/2)}addRenderCommands(e){const t=this.particles.filter(r=>r.type==="blood"),s=this.particles.filter(r=>r.type==="smoke");t.length>0&&t.forEach(r=>{e.renderShape("particles",r.x,r.y,r.z,[[0,0],[1,0],[1,1],[0,1]],"rgba(255, 0, 0, 0.5)")}),s.length>0&&s.forEach(r=>{const o=Math.min(r.life,2)*3;e.renderShape("particles",r.x-o/2,r.y-o/2,r.z,[[0,0],[o,0],[o,o],[0,o]],"rgba(28, 28, 28, 0.5)")})}}function qie([n,e],[t,s],r){const[o,i]=Oe.scale(Oe.normalize([n-t,e-s]),5),a=3+Math.random()*2;for(let l=0;l<a;l++){const u=(Math.random()-Math.random())*2+o,d=(Math.random()-Math.random())*2+i,f=Math.random()*10+5,p=50,g=new QA(n,e,r.terrain.getHeightAt([n,e]),r.terrain,u,d,f,p,"smoke");r.addParticle(g)}}class Yie{constructor(e){me(this,"soldier");me(this,"enemy",null);this.soldier=e}seekEnemy(e=this.soldier.state.seekRange){if(this.enemy&&(this.enemy.state.life<=0||this.enemy.distance(this.soldier)>e)&&this.clearEnemy(),!this.enemy&&this.soldier.state.cooldown("seek-"+e,bO)&&this.setEnemy(this.queryEnemy(e)),this.enemy){const t=this.enemy.vec,s=Oe.distance(this.soldier.vec,t),r=Oe.atan2(this.soldier.vec,t);this.soldier.movement.setTargetDirection(r);let o=0;return this.soldier.state.canCharge&&s>50&&s<e&&!this.soldier.state.cooldown("charge",10)&&(o+=1),this.soldier.movement.setTargetVelocity(this.soldier.state.isMelee||s>this.soldier.state.attackRange?1+o:0),this.soldier.state.rangeAttack&&s<this.soldier.state.attackRange&&s>vO&&this.soldier.state.cooldown("arrow",this.soldier.state.rangedCooldown)&&(this.soldier.world.addObject(new YA(this.soldier.vec,this.enemy.vec,this.soldier.world,this.soldier.state.rangeAttack,this.soldier.state.rangeType)),si.play("arrow"),this.soldier.type==="artillery"&&(this.soldier.state.hitBy(50),qie(this.soldier.vec,this.enemy.vec,this.soldier.world.particles))),s<kx&&this.soldier.state.cooldown("sword",this.soldier.state.meleeAttackCooldown)&&this.soldier.attack.hit(this.enemy),!0}return!1}queryEnemy(e){const t=this.soldier.world.queryObjects("Soldier",s=>s.isEnemy(this.soldier)&&s.state.life>0&&Oe.withinDistance(s.vec,this.soldier.vec,e)&&this.soldier.plan.canClaim(s,this.soldier));if(t.length>0){const s=this.soldier.type==="artillery"?(r,o)=>o.distance(this.soldier)>r.distance(this.soldier)?o:r:(r,o)=>o.distance(this.soldier)<r.distance(this.soldier)?o:r;return t.reduce(s,t[0])}return null}setEnemy(e){this.enemy&&(this.soldier.plan.unclaim(this.enemy,this.soldier),this.enemy=null),e&&this.soldier.plan.claim(e,this.soldier)&&(this.enemy=e)}clearEnemy(){this.setEnemy(null)}hasEnemy(){return this.enemy!==null}getEnemy(){return this.enemy}}function b2([n,e],[t,s],r,o){const[i,a]=Oe.scale(Oe.normalize([n-t,e-s]),15);for(let l=0;l<r+2;l++){const u=(Math.random()-Math.random())*5+i,d=(Math.random()-Math.random())*5+a,f=Math.random()*15,p=2,g=new QA(n,e,o.terrain.getHeightAt([n,e]),o.terrain,u,d,f,p);o.addParticle(g)}}class Qie{constructor(e){me(this,"soldier");this.soldier=e}hit(e){const t=(this.soldier.state.cooldown("defence",this.soldier.state.defenceCooldown)?this.getDefence(e,this.soldier.state.meleeDefence):1)*this.getAttack(e);e.state.hitBy(t),vt(ly,{soldier:e,damage:t}),e.targeting.setEnemy(this.soldier),si.play("damage"),b2(e.vec,this.soldier.vec,t/5,this.soldier.world.particles)}hitByArrow(e,t){let s;e.type==="ball"?s=e.getAttack()/Math.pow(t,1/4):s=e.getAttack()*(this.soldier.state.cooldown("defence",this.soldier.state.defenceCooldown)?this.getDefence(e,this.soldier.state.rangeDefence):1),this.soldier.state.hitBy(s),vt(cy,{soldier:this.soldier,damage:s}),si.play("hitarrow"),b2(this.soldier.vec,e.vec,s/5,this.soldier.world.particles)}getDefence(e,t){const s=Math.abs(Oe.angle(Oe.sub(e.vec,this.soldier.vec),[Math.cos(this.soldier.getDirection()),Math.sin(this.soldier.getDirection())]))/Math.PI;return Math.min(s/t,.3)}getAttack(e){return(1-this.getDefence(e,this.soldier.state.meleeDefence))*this.soldier.state.meleeAttack}}class Zie{constructor(e){me(this,"soldier");me(this,"life",$f);me(this,"newLife",$f);me(this,"defenceCooldown",J2);me(this,"weight",1);me(this,"baseSpeed",1);me(this,"seekRange",0);me(this,"attackRange",0);me(this,"rangeDefence",0);me(this,"meleeDefence",0);me(this,"meleeAttack",0);me(this,"meleeAttackCooldown",wO);me(this,"rangeAttack");me(this,"rangedCooldown");me(this,"canCharge",!1);me(this,"isMelee",!1);me(this,"rangeType");me(this,"cooldowns",{});this.soldier=e}setProperties(e){Object.assign(this,e)}update(){this.life=this.newLife}cooldown(e,t){return!this.cooldowns[e]||this.soldier.world.getTime()>this.cooldowns[e]?(this.cooldowns[e]=this.soldier.world.getTime()+t,!0):!1}hitBy(e){this.newLife=Math.max(this.newLife-e,0)}isAlive(){return this.life>0}}function Jie(n,e){const t=Math.cos(e),s=Math.sin(e);return n.map(r=>{const o=r.x*t-r.z*s,i=r.x*s+r.z*t;return{x:o,y:r.y,z:i}})}function eae(n,e=200){const t=e/(e+n.z);return{x:n.x*t,y:n.y*t,z:n.z}}function tae(n,e,t=1){const s=Math.cos(e)*.3+.7,r=parseInt(n.slice(1),16),o=Math.floor((r>>16&255)*s),i=Math.floor((r>>8&255)*s),a=Math.floor((r&255)*s);return`rgba(${o},${i},${a},${t})`}const Rc={head:{points:[{x:-5,y:-15,z:5},{x:5,y:-15,z:5},{x:5,y:-5,z:5},{x:-5,y:-5,z:5}],zIndex:3},body:{points:[{x:-7,y:-5,z:0},{x:7,y:-5,z:0},{x:7,y:10,z:0},{x:-7,y:10,z:0}],zIndex:2},legs:{points:[{x:-7,y:10,z:-2},{x:-3,y:10,z:-2},{x:-3,y:15,z:-2},{x:-7,y:15,z:-2},{x:3,y:10,z:-2},{x:7,y:10,z:-2},{x:7,y:15,z:-2},{x:3,y:15,z:-2}],zIndex:1}},Ac={head:{points:[{x:-5,y:-2,z:5},{x:5,y:-2,z:5},{x:5,y:8,z:5},{x:-5,y:8,z:5}],zIndex:3},body:{points:[{x:-7,y:-10,z:0},{x:7,y:-10,z:0},{x:7,y:5,z:0},{x:-7,y:5,z:0}],zIndex:2},legs:{points:[{x:-7,y:-15,z:-2},{x:-3,y:-15,z:-2},{x:-3,y:-10,z:-2},{x:-7,y:-10,z:-2},{x:3,y:-15,z:-2},{x:7,y:-15,z:-2},{x:7,y:-10,z:-2},{x:3,y:-10,z:-2}],zIndex:1}};function nae(n){switch(n){case"warrior":return{...Rc,sword:{points:[{x:8,y:-5,z:3},{x:18,y:-10,z:3},{x:20,y:-8,z:3},{x:10,y:-3,z:3}],zIndex:4}};case"archer":return{...Rc,bow:{points:[{x:8,y:-10,z:3},{x:12,y:-8,z:3},{x:12,y:8,z:3},{x:8,y:10,z:3}],zIndex:4},arrow:{points:[{x:12,y:0,z:4},{x:20,y:-2,z:4},{x:20,y:2,z:4}],zIndex:5}};case"tank":return{...Rc,shield:{points:[{x:-12,y:-10,z:5},{x:-8,y:-12,z:5},{x:-8,y:12,z:5},{x:-12,y:10,z:5}],zIndex:4}};case"artillery":return{...Rc,cannon:{points:[{x:8,y:-3,z:3},{x:20,y:-3,z:3},{x:20,y:3,z:3},{x:8,y:3,z:3}],zIndex:4}};default:return Rc}}function sae(n){switch(n){case"warrior":return{...Ac,sword:{points:[{x:5,y:-8,z:1},{x:15,y:-5,z:1},{x:15,y:-3,z:1},{x:5,y:-6,z:1}],zIndex:4}};case"archer":return{...Ac,bow:{points:[{x:5,y:-10,z:1},{x:10,y:-8,z:1},{x:10,y:2,z:1},{x:5,y:4,z:1}],zIndex:4},arrow:{points:[{x:10,y:-2,z:2},{x:18,y:-1,z:2},{x:18,y:1,z:2}],zIndex:5}};case"tank":return{...Ac,shield:{points:[{x:-10,y:-8,z:4},{x:-6,y:-9,z:4},{x:-6,y:5,z:4},{x:-10,y:4,z:4}],zIndex:4}};case"artillery":return{...Ac,cannon:{points:[{x:6,y:-5,z:2},{x:16,y:-4,z:2},{x:16,y:2,z:2},{x:6,y:1,z:2}],zIndex:4}};default:return Ac}}const ZA=["warrior","archer","tank","artillery"],rae=Object.fromEntries(ZA.map(n=>[n,Object.entries(nae(n)).sort((e,t)=>e[1].zIndex-t[1].zIndex)])),oae=Object.fromEntries(ZA.map(n=>[n,Object.entries(sae(n)).sort((e,t)=>e[1].zIndex-t[1].zIndex)])),iae=Array.from({length:20},(n,e)=>{const t=e/20*2*Math.PI;return[Kn/3*Math.cos(t),Ur/4*Math.sin(t)]});class aae{constructor(e){me(this,"soldier");me(this,"unitColor");this.soldier=e,this.unitColor=e.color}addRenderCommands(e){this.soldier.state.isAlive()&&this.renderShadow(e),this.renderSoldier(e)}renderShadow(e){e.addShadowCommand(this.soldier.getX(),this.soldier.getY()+this.soldier.getHeight()/2,this.soldier.getZ(),"rgba(0, 0, 0, 0.3)",iae)}renderSoldier(e){const t=this.soldier.state.isAlive(),s=t?this.soldier.getDirection():Math.PI/2,r=t?this.unitColor:"#808080",o=t?rae[this.soldier.type]:oae[this.soldier.type],i=e.getShadingAt(...this.soldier.vec);for(const[,a]of o){const u=Jie(a.points,s+Math.PI/2).map(p=>eae(p)),d=tae(r,s,t?1:.5),f=this.combineColors(d,i);e.addObjectCommand(this.soldier.getX(),this.soldier.getY()+(t?0:this.soldier.getHeight()/2),this.soldier.getZ(),t,f,u.map(p=>[p.x,p.y]))}}combineColors(e,t){const s=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+),?\s*([\d.]+)?\)/);if(!s)return e;const r=parseInt(s[1],10),o=parseInt(s[2],10),i=parseInt(s[3],10),a=s[4]!==void 0?parseFloat(s[4]):1,l=Math.floor(r*t),u=Math.floor(o*t),d=Math.floor(i*t);return`rgba(${l},${u},${d},${a})`}}let lae=0;class vf extends au{constructor(t,s,r,o,i,a,l){r+=(Math.random()-Math.random())/1e3;super(t,s,Kn,Ur,r,i);me(this,"soldierId");me(this,"plan");me(this,"type");me(this,"color");me(this,"movement");me(this,"targeting");me(this,"attack");me(this,"state");me(this,"soldierRender");me(this,"lastAttackTime",0);me(this,"attackDuration",500);this.soldierId=lae++,this.plan=o,this.type=l,this.color=a,this.movement=new Uie(this,i.terrain),this.targeting=new Yie(this),this.attack=new Qie(this),this.state=new Zie(this),this.soldierRender=new aae(this),this.initializeTypeSpecificProperties()}initializeTypeSpecificProperties(){switch(this.type){case"warrior":this.initializeWarrior();break;case"tank":this.initializeTank();break;case"archer":this.initializeArcher();break;case"artillery":this.initializeArtillery();break}}initializeWarrior(){this.state.setProperties({seekRange:xk,attackRange:kx,rangeDefence:30,meleeDefence:50,meleeAttack:25,baseSpeed:3,canCharge:!0,isMelee:!0})}initializeTank(){this.state.setProperties({seekRange:xk,attackRange:kx*1.1,rangeDefence:100,meleeDefence:100,meleeAttack:15,life:$f*2,newLife:$f*2,defenceCooldown:J2/5,weight:3,canCharge:!1,isMelee:!0})}initializeArcher(){this.state.setProperties({seekRange:wk,attackRange:yk,rangeAttack:45,rangeDefence:25,rangedCooldown:vk,meleeDefence:10,meleeAttack:10,rangeType:"arrow"})}initializeArtillery(){this.state.setProperties({seekRange:wk,attackRange:yk*5,weight:10,baseSpeed:.1,rangeAttack:100,rangeDefence:1,rangedCooldown:vk*10,meleeDefence:1,meleeAttack:1,rangeType:"ball"})}update(t){this.state.isAlive()?this.updatePlan():this.targeting.hasEnemy()&&this.targeting.clearEnemy(),this.movement.update(t),this.state.update()}updatePlan(){const t=this.plan.getCommand(this.world.getTime()),s=t.getProgress({worldTime:this.world.getTime(),soldier:this});this.targeting.seekEnemy(Math.max(this.state.seekRange*s,xO))||t.execute(this)}render(t){this.soldierRender.addRenderCommands(t)}distance(t){return this.movement.distance(t)}hitByArrow(t,s){this.attack.hitByArrow(t,s)}isEnemy(t){return this.plan.masterPlan!==t.plan.masterPlan}getClass(){return"Soldier"}}class cae{constructor(e){me(this,"tileSize",32);me(this,"offsetX",gs*1.5/this.tileSize);me(this,"offsetY",gs/this.tileSize);me(this,"heightMap");me(this,"width");me(this,"height");this.width=e.width,this.height=e.height,this.heightMap=e.heightMap}getHeightAt(e){return JA(e,this.heightMap,this.tileSize,this.offsetX,this.offsetY)}}function JA(n,e,t,s,r){const o=n[0]/t+s,i=n[1]/t+r,a=Math.min(Math.max(Math.floor(o),0),e[0].length-1),l=Math.min(a+1,e[0].length-1),u=Math.min(Math.max(Math.floor(i),0),e.length-1),d=Math.max(Math.min(u+1,e.length-1),0),f=e[u][a],p=e[u][l],g=e[d][a],x=e[d][l],w=o-a,v=i-u,b=f*(1-w)+p*w,C=g*(1-w)+x*w;return b*(1-v)+C*v}class uae{constructor(e){me(this,"objects");me(this,"objectsByType");me(this,"collisionHandlers");me(this,"edgeRadius");me(this,"worldTime");me(this,"particles");me(this,"terrain");this.objects=[],this.objectsByType={Soldier:[],Arrow:[],Explosion:[]},this.collisionHandlers=[],this.edgeRadius=gs*1.5,this.terrain=new cae(e),this.particles=new Kie(gs*3,gs*2,this.terrain),this.worldTime=0,this.onCollision(vf,vf,this.onSoldierCollision.bind(this)),this.onCollision(vf,YA,this.onArrowCollision.bind(this))}destroy(){}getTime(){return this.worldTime}getEdgeRadius(){return this.edgeRadius}addObject(...e){for(const t of e)this.objects.push(t),this.objectsByType[t.getClass()].push(t)}removeObject(e){this.objects.splice(this.objects.indexOf(e),1)}queryObjects(e,t){return this.objectsByType[e].filter(s=>!t||t(s))}update(e){const t=Math.min(e,Z2);return this.objects.forEach(s=>{this.updateObject(s,t/gk)}),e-=t,this.worldTime+=t,this.collisions(),this.particles.update(t/gk),e}collisions(){const e=Vie(this),t={},s=this.queryObjects("Arrow",r=>r.isHit());this.queryObjects("Soldier").forEach(r=>{r.state.life<=0||(e.searchSoldiers.byRadius(r.vec,r.getWidth()).forEach(o=>{o.state.life<=0||r===o||t[r.id+o.id]||t[o.id+r.id]||(t[r.id+o.id]=!0,Oe.withinDistance(r.vec,o.vec,r.getWidth())&&this.triggerCollisions(r,o))}),e.searchArrows.byRadius(r.vec,Math.max(bk,nl)).forEach(o=>{o&&Oe.withinDistance(r.vec,o.vec,o.type==="arrow"?bk:nl)&&this.triggerCollisions(r,o)}),Oe.withinDistance(r.vec,[0,0],this.getEdgeRadius())||r.movement.addForce(Oe.scale(Oe.normalize(r.vec),-1)))},this),s.forEach(r=>{this.objects.splice(this.objects.indexOf(r),1),this.objectsByType.Arrow.splice(this.objectsByType.Arrow.indexOf(r),1),r.type==="ball"&&this.addObject(new Wie(r.vec,this.getTime(),this))})}triggerCollisions(e,t){this.collisionHandlers.forEach(function(s){e instanceof s.left&&t instanceof s.right&&s.handler(e,t),t instanceof s.left&&e instanceof s.right&&s.handler(t,e)})}onCollision(e,t,s){this.collisionHandlers.push({left:e,right:t,handler:s})}onSoldierCollision(e,t){const s=Oe.distance(e.vec,t.vec);if(s===0){const r=Oe.scale([Math.random()-Math.random(),Math.random()-Math.random()],1/Number.MAX_SAFE_INTEGER);e.movement.addForce(r),t.movement.addForce(Oe.scale(r,-1))}else{const r=Oe.scale(Oe.normalize(Oe.sub(e.vec,t.vec)),e.getWidth()-s);e.movement.addForce(Oe.scale(r,1/e.state.weight*t.state.weight)),t.movement.addForce(Oe.scale(r,-1*e.state.weight/t.state.weight))}}onArrowCollision(e,t){const s=Oe.distance(t.vec,e.vec);if(t.type==="arrow")t.hit(e,s);else if(t.type==="ball"&&e.state.cooldown("ballhit",150)){t.hit(e,s);const r=Oe.scale(Oe.normalize(Oe.sub(e.vec,t.vec)),e.getWidth()-s);e.movement.addForce(Oe.scale(r,-.5/e.state.weight*(1-s/nl)))}}updateObject(e,t){e.update(t)}getAlive(){return this.queryObjects("Soldier",e=>e.state.life>0).reduce((e,t)=>(e[t.color]=(e[t.color]||0)+1,e),{"#ff0000":0,"#00ff00":0})}getBalance(){const e=this.getAlive(),t=Object.keys(this.getAlive());return e[t[0]]/(e[t[0]]+e[t[1]])}}class cv{constructor(){me(this,"startTime",-1);me(this,"done",!1)}start(e){this.startTime=e}}class hy extends cv{constructor(t){super();me(this,"duration");this.duration=t}isDone(t){return!!this.duration&&this.startTime>=0&&t-this.startTime>this.duration}getProgress({worldTime:t}){return this.duration?(t-this.startTime)/this.duration:1}execute(t){t.movement.setTargetVelocity(0)}}class bf extends cv{constructor(){super()}getTarget(e){return e.plan.formation}execute(e){const t=this.getTarget(e),s=Oe.distance(e.vec,t),r=Oe.atan2(e.vec,t);s>50?(e.movement.setTargetVelocity(1),e.movement.setTargetDirection(r)):(e.movement.setTargetVelocity(0),this.done=!0)}isDone(){return this.done}getProgress(e){return e.worldTime>0?1:0}}class eD extends bf{constructor(t,s=300){super();me(this,"angle");me(this,"flankDistance");this.angle=t,this.flankDistance=s}getProgress({soldier:t}){const s=this.getTarget(t),r=Oe.distance(t.vec,s);return r>0?1/r:1}getTarget(t){const s=Oe.rotate([1,0],this.angle),r=[s[1],s[0]],o=Oe.scale(r,this.flankDistance),i=Oe.scale(s,this.flankDistance*.5),a=Oe.add(o,i);return Oe.add(t.plan.formation,a)}}class hae extends eD{getTarget(e){const t=Oe.rotate([1,0],this.angle),s=[-t[1],-t[0]],r=Oe.scale(s,this.flankDistance),o=Oe.scale(t,this.flankDistance*.5),i=Oe.add(r,o);return Oe.add(e.plan.formation,i)}}class qa extends cv{constructor(){super()}execute(e){e.targeting.seekEnemy(gs*2)||(this.done=!0)}isDone(){return this.done}getProgress(){return 1}}class dae{constructor(e,t,s){me(this,"masterPlan");me(this,"formation");me(this,"plan");me(this,"currentCommand");me(this,"claims");this.masterPlan=e,this.formation=t,this.plan=s,this.currentCommand=null,this.claims=e.claims}getPosition(){return this.formation}getCommand(e){return(!this.currentCommand||this.currentCommand.isDone(e))&&this.plan.length>0&&(this.currentCommand=this.plan.splice(0,1)[0],this.currentCommand.start(e)),this.currentCommand||(this.currentCommand=new hy),this.currentCommand}canClaim(e,t){if(this.claims[e.soldierId]||(this.claims[e.soldierId]=[]),this.claims[e.soldierId].length<5)return!0;const s=t.distance(e);return this.claims[e.soldierId].filter(o=>o.distance(e)>s).length===this.claims[e.soldierId].length}unclaim(e,t){const s=this.claims[e.soldierId].indexOf(t);s>=0&&this.claims[e.soldierId].splice(s,1)}claim(e,t){return this.canClaim(e,t)?(this.claims[e.soldierId].push(t),!0):!1}}class fae{constructor(e,t){me(this,"type");me(this,"formation");me(this,"plan");me(this,"claims");const s=Oe.atan2(e,[0,0]);this.type=[],this.formation=[],this.plan=[],this.claims={},t.forEach(r=>{const o=r.sizeCol*r.sizeRow,i=[r.col*Kn,r.row*Ur];for(let a=0;a<o;a++){const l=[a%r.sizeCol*Kn,(a/r.sizeCol<<0)*Ur];switch(this.formation.push(Oe.add(l,i)),this.type.push(r.type),r.command){case"advance-wait":this.plan.push([new bf,new hy(1e4),new qa]);break;case"advance":this.plan.push([new bf,new qa]);break;case"wait-advance":this.plan.push([new hy(1e4),new qa]);break;case"flank-left":this.plan.push([new eD(s),new qa]);break;case"flank-right":this.plan.push([new hae(s),new qa]);break;default:this.plan.push([new bf,new qa]);break}}})}getSoldierCount(){return this.formation.length}getType(e){return this.type[e]}getSolderPlan(e){return new dae(this,this.formation[e],this.plan[e])}}class pae{constructor(e){this.world=e,this.HUD=document.querySelector("#game-hud"),this.battleTime=document.querySelector("#battle-time"),this.battleResult=document.querySelector("#battle-result"),this.balanceLeft=document.querySelector("#battle-balance-left"),this.balanceRight=document.querySelector("#battle-balance-right"),this.HUD.style.display="block"}destroy(){this.HUD.style.display="none",this.battleResult.innerHTML=""}getBalance(e){return e.getBalance()}setNames(e,t){this.balanceLeft.dataset.username=e||"",this.balanceRight.dataset.username=t||""}render(e){var t=60-e.getTime()/1e3<<0,s=(1e3-e.getTime()%1e3)/10<<0;this.battleTime.dataset.time=(t<10?"0":"")+t+":"+(s>=10?s:"0"+s);var r=this.getBalance(e),o=Math.round(r*100),i=Math.round((1-r)*100);this.balanceLeft.style.maxWidth=o+"%",this.balanceLeft.dataset.percentage=o+"%",this.balanceLeft.dataset.winning=r>2/3,this.balanceRight.style.maxWidth=i+"%",this.balanceRight.dataset.percentage=i+"%",this.balanceRight.dataset.winning=r<1/3}renderResults(e){var t=this.getBalance(e),s="</span>";if(t>1/3&&t<2/3)this.battleResult.innerHTML=`<div style="color: white">
                <span class="result">DRAW!${s}
                <span class="continue">Click to continue${s}
            </div>`;else{var r=t>.3333333333333333?"#ff0000":"#00ff00";return this.battleResult.innerHTML=`<div style="color: ${r}">
                <span class="result" style="background: ${r}">${t>2/3?"Victory":"Defeat"}!${s}
                <span class="winner">${t>2/3?this.balanceLeft.dataset.username:this.balanceRight.dataset.username} wins!${s}
                <span class="loser">${t>2/3?this.balanceRight.dataset.username:this.balanceLeft.dataset.username} defeated!${s}
                <span class="continue">Click to continue${s}
            </div>`,r}}showPause(){}}function mae(n){n=n||cu;const e=ll.layers[n];return e||(ll.layers[n]=new ll(n))}function tD(n){n=n||cu;const e=ll.layers[n];e&&(e.destroy(),delete ll.layers[n])}class ll{constructor(e){me(this,"element");me(this,"ctx");this.element=document.createElement("canvas"),this.element.id=e,this.element.width=gs*3,this.element.height=gs*2,this.ctx=this.element.getContext("2d"),document.body.appendChild(this.element)}destroy(){document.body.removeChild(this.element)}getWidth(){return this.element.width}getHeight(){return this.element.height}clear(){return this.ctx.clearRect(0,0,this.getWidth(),this.getHeight()),this}drawText(e,t,s){return this.ctx.fillStyle="white",this.ctx.font="11px serif",this.ctx.fillText(s,e-this.ctx.measureText(s).width/2,t),this}fillStyle(e){return this.ctx.fillStyle=e,this}strokeStyle(e){return this.ctx.strokeStyle=e,this}fillRect(e,t,s,r){return this.ctx.fillRect(e,t,s,r),this}arc(e,t,s){return this.ctx.beginPath(),this.ctx.arc(e,t,s,0,Math.PI*2),this.ctx.stroke(),this}line(e,t,s,r){return this.save(),this.ctx.beginPath(),this.ctx.moveTo(e,t),this.ctx.lineTo(s,r),this.ctx.stroke(),this.restore(),this}drawImage(e,t,s){return this.ctx.drawImage(e,t,s),this}fill(e){this.ctx.fill(e)}scale(e){return this.ctx.scale(e,e),this}translate(e,t){return this.ctx.translate(e,t),this}rotate(e){return this.ctx.rotate(e),this}save(){return this.ctx.save(),this}restore(){return this.ctx.restore(),this}getCtx(){return this.ctx}}me(ll,"layers",{});const ef={terrain:0,deadObjects:1,shadows:2,objects:3,particles:4};class gae{constructor(e){me(this,"commands",[]);this.worldRender=e}getShadingAt(e,t){return this.worldRender.getShadingAt(e,t)}renderShape(e,t,s,r,o,i){this.commands.push({layer:e,x:t,y:s,z:r,points:o,fillStyle:i})}sortCommands(e){return e.sort((t,s)=>ef[t.layer]!==ef[s.layer]?ef[t.layer]-ef[s.layer]:t.y!==s.y?t.y-s.y:t.z-s.z)}batchCommands(){const e=this.sortCommands(this.commands),t=[];let s=[],r;for(const o of e)o.fillStyle!==r&&s.length>0&&(t.push(s),s=[]),s.push(o),r=o.fillStyle;return s.length>0&&t.push(s),t}render(e){const t=this.batchCommands();for(const s of t){e.save(),e.fillStyle(s[0].fillStyle);const r=new Path2D;for(const o of s){const i=o.points[0];r.moveTo(o.x+i[0],o.y+i[1]-o.z);for(let a=1;a<o.points.length;a++){const l=o.points[a];r.lineTo(o.x+l[0],o.y+l[1]-o.z)}}r.closePath(),e.fill(r),e.restore()}this.commands=[]}addObjectCommand(e,t,s,r,o,i){this.renderShape(r?"objects":"deadObjects",e,t,s,i,o)}addShadowCommand(e,t,s,r,o){this.renderShape("shadows",e,t,s,o,r)}addParticleCommand(e,t,s,r,o){this.renderShape("particles",e,t,s,o,r)}}function op(n,e){const t=mae(cu),s=new gae(e);t.clear(),t.drawImage(e.terrainCanvas,0,0),t.save().translate(t.getWidth()/2,t.getHeight()/2),n.particles.renderDead(t),n.objects.forEach(r=>r.render(s)),n.particles.addRenderCommands(s),s.render(t),t.restore()}const C2={grass:"#6B8E23",dirt:"#8C8D7B"};function xae(n,e,t,s=1){const r=Math.min(Math.max(t/50,0),1),o=(Math.cos(e)*.3+.7)*(.8+r*.4),i=parseInt(n.slice(1),16),a=Math.floor((i>>16&255)*o),l=Math.floor((i>>8&255)*o),u=Math.floor((i&255)*o);return`rgba(${a},${l},${u},${s})`}function yae(n,e,t,s){const r=n[t][e],o=n[t][Math.min(e+1,n[0].length-1)],i=n[Math.min(t+1,n.length-1)][e],a=[s,0,o-r],l=[0,s,i-r],u=[l[1]*a[2]-l[2]*a[1],l[2]*a[0]-l[0]*a[2],l[0]*a[1]-l[1]*a[0]],d=Math.sqrt(u[0]*u[0]+u[1]*u[1]+u[2]*u[2]);return[u[0]/d,u[1]/d,u[2]/d]}function wae(n,e,t,s){var u,d;const r=Math.ceil(e/s),o=Math.ceil(t/s),i=document.createElement("canvas");i.width=e,i.height=t;const a=i.getContext("2d"),l=Array(o).fill(0).map(()=>Array(r).fill(0));for(let f=0;f<o;f++)for(let p=0;p<r;p++){const g=n[f][p],x=n[f][p+1]||g,w=((u=n[f+1])==null?void 0:u[p])||g,v=((d=n[f+1])==null?void 0:d[p+1])||x,b=f*s-g,C=f*s-x,$=(f+1)*s-w,S=(f+1)*s-v,T=yae(n,p,f,s),E=Math.atan2(T[1],T[0]),A=(g+x+w+v)/4,F=Math.min(Math.max(A/50,0),1),D=bae(C2.grass,C2.dirt,F),_=xae(D,E,A);a.beginPath(),a.moveTo(p*s,b),a.lineTo((p+1)*s,C),a.lineTo((p+1)*s,S),a.lineTo(p*s,$),a.closePath(),a.fillStyle=_,a.fill();const N=(Math.cos(E)*.3+.7)*(.8+F*.4);l[f][p]=N}return{terrainCanvas:i,shadingMap:l}}function vae(n,e,t,s){return wae(t,n,e,s)}const bae=(n,e,t)=>{const s=g=>parseInt(g.slice(1),16),r=s(n)>>16&255,o=s(n)>>8&255,i=s(n)&255,a=s(e)>>16&255,l=s(e)>>8&255,u=s(e)&255,d=Math.round(r+t*(a-r)),f=Math.round(o+t*(l-o)),p=Math.round(i+t*(u-i));return`#${((1<<24)+(d<<16)+(f<<8)+p).toString(16).slice(1)}`};class Cae{constructor(e){me(this,"terrainCanvas");me(this,"shadingMap");this.gameWorld=e;const{terrainCanvas:t,shadingMap:s}=vae(e.terrain.width,e.terrain.height,e.terrain.heightMap,e.terrain.tileSize);this.terrainCanvas=t,this.shadingMap=s}getShadingAt(e,t){return JA([e,t],this.shadingMap,this.gameWorld.terrain.tileSize,this.gameWorld.terrain.offsetX,this.gameWorld.terrain.offsetY)}}function k2(n,e,t,s){const r=Math.PI/2*e,o=[0,e*gs/2],i=new fae(o,s);for(let a=0;a<i.getSoldierCount();a++){const l=i.getSolderPlan(a);let u=l.getPosition();u=Oe.add(u,o),n.addObject(new vf(u[0],u[1],r+Math.PI,l,n,t,i.getType(a)))}}function kae(n,e,t){const s=new uae(t),r=new Cae(s);k2(s,1,"#ff0000",n),k2(s,-1,"#00ff00",e);const o=new pae(s);return o.setNames("Player","Computer"),si.setEnabled(!0),function(a){if(op(s,r),o.render(s),a==BA)return Sae(s,r,o)}}function Sae(n,e,t){const s={[ly]:{"#ff0000":0,"#00ff00":0},[cy]:{"#ff0000":0,"#00ff00":0}},r=JSON.parse(JSON.stringify(s));let o=!1;return function(a,l){if(a==VA){let u=Math.min(l,1e3);for(;u>0&&!o;)u=n.update(u);op(n,e)}if(a===qA){for(si.setEnabled(!1);n.getTime()<=6e4;){n.update(Z2);const u=n.getBalance();if(u===0||u===1||n.getTime()>=6e4)return op(n,e),t.render(n),fx(n,e,t)}return fx(n,e,t)}if(a===UA&&t.render(n),a===GA){const u=t.getBalance(n);if(n.getTime()>6e4||u===0||u===1)return fx(n,e,t)}if(a===ly||a===cy){const{damage:u,soldier:d}=l;s[a][d.color]+=u,r[a][d.color]++}if(a===jA&&(o=!0),a===XA&&(o=!1),a===KA)return tD(cu),t.destroy(),uv()}}function fx(n,e,t){return t.renderResults(n),function(r){if(op(n,e),r===HA)return tD(cu),t.destroy(),yie("battleEnd",{winner:n.getBalance()>.7?"player":n.getBalance()<.3?"opposition":"draw"}),uv()}}function uv(){return function(e,t){if(e==WA)return kae(t.playerUnits,t.oppositionUnits,t.terrainData)}}let io;function Iae(){io=uv()}function vt(n,e){const t=io==null?void 0:io(n,e);t&&t!==io&&(console.log("Transition from "+(io==null?void 0:io.name)+" to "+t.name),io=t)}document.addEventListener("visibilitychange",function(){document.hidden?vt(bie):vt(Cie)});window.addEventListener("resize",function(){vt(kie)});function Ya(n,e){Le.useEffect(()=>(window.addEventListener(n,e),()=>{window.removeEventListener(n,e)}),[n,e])}function $ae(){return Ya("keydown",function(n){n.keyCode==37&&vt(Rie),n.keyCode==38&&vt(Die),n.keyCode==39&&vt(Aie),n.keyCode==40&&vt(_ie),n.keyCode==27&&vt(Sie),vt(Nie,n.keyCode)}),Ya("keyup",function(n){n.keyCode==37&&vt(Fie),n.keyCode==38&&vt(zie),n.keyCode==39&&vt(Oie),n.keyCode==40&&vt(Mie),vt(Eie,n)}),Ya("mousedown",function(n){vt(Iie,n)}),Ya("mouseup",function(n){vt($ie,n)}),Ya("mousemove",function(n){vt(Tie,n)}),Ya("click",function(n){vt(HA,n)}),null}async function Tae(n,e,t,s){try{const{inputs:r,outputs:o}=Nae(n,e,t,s);await lie(r,o,{epochs:10,batchSize:32,learningRate:.001,onProgress:(i,a)=>{console.log(`Training progress - Epoch ${i+1}: loss = ${a.loss.toFixed(4)}`)}}),console.log("Model training completed successfully")}catch(r){console.error("Failed to train model:",r)}}function Nae(n,e,t,s){const r=[],o=[],i=LA(n==="player"?Tf(t):e,s);r.push(i);const a=n==="player"?Tf(e):t,l=uie(a);return o.push(l),{inputs:r,outputs:o}}function Eae({onBattleEnd:n,playerUnits:e,oppositionUnits:t,terrainData:s}){const[r,o]=Le.useState(!1),i=Le.useRef({});Le.useEffect(()=>(Iae(),vt(WA,{playerUnits:e,oppositionUnits:t,terrainData:s}),a(),()=>{l()}),[]);const a=()=>{i.current.timeout=setTimeout(()=>vt(BA),1e3),i.current.interval100ms=setInterval(()=>vt(UA),100),i.current.interval1s=setInterval(()=>vt(GA),1e3)},l=()=>{i.current.timeout&&clearTimeout(i.current.timeout),i.current.interval100ms&&clearInterval(i.current.interval100ms),i.current.interval1s&&clearInterval(i.current.interval1s)};wie("battleEnd",({winner:w})=>{w!=="draw"&&Tae(w,e,t,s),n()});const u=Le.useRef(),[d,f]=Q2(()=>{if(r)return;const w=Date.now();u.current&&vt(VA,w-u.current),u.current=w},!0),p=()=>{r?(vt(XA),a(),f()):(vt(jA),l(),d()),o(!r)},g=()=>{vt(KA),l(),d(),n()},x=()=>{setTimeout(()=>vt(qA))};return De.jsxs(De.Fragment,{children:[De.jsx(vie,{}),De.jsx($ae,{}),De.jsx("div",{id:"game-hud",children:De.jsxs("div",{id:"hud-top-right",children:[De.jsxs("div",{id:"battle-stats",children:[De.jsxs("div",{id:"battle-balance",children:[De.jsx("div",{id:"battle-balance-left",children:" "}),De.jsx("div",{id:"battle-balance-right",children:" "})]}),De.jsx("div",{id:"battle-time",children:" "})]}),De.jsx("div",{id:"battle-result"}),De.jsxs("div",{id:"battle-controls",children:[De.jsx("button",{onClick:p,children:r?"Resume":"Pause"}),De.jsx("button",{onClick:g,children:"Exit"}),De.jsx("button",{onClick:x,children:"Fast Finish"})]})]})})]})}const Rae=()=>{const[n,e]=Le.useState({name:"intro"}),t=()=>{e({name:"designer"})},s=(o,i,a)=>{e({name:"battle",playerUnits:o,oppositionUnits:i,terrainData:a}),console.log("Battle started!")},r=()=>{e({name:"designer",playerUnits:n.name==="battle"?n.playerUnits:void 0})};return De.jsxs(pr.StrictMode,{children:[De.jsx(uO,{}),(n==null?void 0:n.name)==="intro"&&De.jsx(pO,{onPlayClick:t}),(n==null?void 0:n.name)==="designer"&&De.jsx(xie,{onStartBattle:s,initialPlayerUnits:n.playerUnits}),(n==null?void 0:n.name)==="battle"&&De.jsx(Eae,{onBattleEnd:r,playerUnits:n.playerUnits,oppositionUnits:n.oppositionUnits,terrainData:n.terrainData})]})},Aae=cF.createRoot(document.getElementById("root"));Aae.render(De.jsx(Rae,{}));
